<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>JPA Reference Guide - WildFly 9</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
    <meta content="Scroll Wiki Publisher" name="generator"/>

    <link type="text/css" rel="stylesheet" href="css/blueprint/liquid.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/blueprint/print.css" media="print"/>
    <!--[if lt IE 8]><link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection"/><![endif]-->

    <link type="text/css" rel="stylesheet" href="css/content-style.css" media="screen, projection, print"/>
    <link type="text/css" rel="stylesheet" href="css/screen.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/print.css" media="print"/>
    
    <link type="text/css" rel="stylesheet" href="css/jbossorg.css"/>
    <link type="text/css" rel="stylesheet" href="css/docnav.css"/>    
    
    <link type="text/css" rel="stylesheet" href="sh/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="sh/shCoreDefault.css"/>
    <script type="text/javascript" src="sh/shCore.js"></script>
    <script type="text/javascript" src="sh/shBrushAppleScript.js"></script>
    <script type="text/javascript" src="sh/shBrushAS3.js"></script>
    <script type="text/javascript" src="sh/shBrushBash.js"></script>
    <script type="text/javascript" src="sh/shBrushCpp.js"></script>
    <script type="text/javascript" src="sh/shBrushCSharp.js"></script>
    <script type="text/javascript" src="sh/shBrushCss.js"></script>
    <script type="text/javascript" src="sh/shBrushDiff.js"></script>
    <script type="text/javascript" src="sh/shBrushErlang.js"></script>
    <script type="text/javascript" src="sh/shBrushGroovy.js"></script>
    <script type="text/javascript" src="sh/shBrushJava.js"></script>
    <script type="text/javascript" src="sh/shBrushJavaFX.js"></script>
    <script type="text/javascript" src="sh/shBrushJScript.js"></script>
    <script type="text/javascript" src="sh/shBrushPerl.js"></script>
    <script type="text/javascript" src="sh/shBrushPhp.js"></script>
    <script type="text/javascript" src="sh/shBrushPlain.js"></script>
    <script type="text/javascript" src="sh/shBrushPython.js"></script>
    <script type="text/javascript" src="sh/shBrushRuby.js"></script>
    <script type="text/javascript" src="sh/shBrushScala.js"></script>
    <script type="text/javascript" src="sh/shBrushSql.js"></script>
    <script type="text/javascript" src="sh/shBrushVb.js"></script>
    <script type="text/javascript" src="sh/shBrushXml.js"></script>
    
</head>
<body>
    <div class="container" style="min-width: 760px;">
        <div class="block header">
          <p id="title">
            <a class="site_href" href="http://www.jboss.org"><strong>JBoss.org</strong></a>
            <a class="doc_href" href="http://docs.jboss.org"><strong>Community Documentation</strong></a>
          </p>
                  <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <li class="previous"><a accesskey="p" href="Remote_JNDI_Reference_Update_Draft.html"><strong>Prev</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <li class="next"><a accesskey="n" href="OSGi.html"><strong>Next</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </ul>
                    <div>
            <h1>JPA Reference Guide</h1>
          </div>          
          </div>

        <div class="block content">
<ul class=" "><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-Introduction">Introduction</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-UpdateyourPersistence.xmlforHibernate4.3.0">Update your Persistence.xml for Hibernate 4.3.0</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-Entitymanager">Entity manager</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-Applicationmanagedentitymanager">Application-managed entity manager</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-Containermanagedentitymanager">Container-managed entity manager</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-PersistenceContext">Persistence Context</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-TransactionscopedPersistenceContext">Transaction-scoped Persistence Context</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-ExtendedPersistenceContext">Extended Persistence Context</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-ExtendedPersistenceContextInheritance">Extended Persistence Context Inheritance</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-Entities">Entities</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-Deployment">Deployment</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-Troubleshooting">Troubleshooting</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-BackgroundontheJipijapaproject">Background on the Jipijapa project</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-PackagingpersistenceproviderswithyourapplicationandwhichJipijapaartifactstoinclude">Packaging persistence providers with your application and which Jipijapa artifacts to include</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-UsingtheHibernate4.3.xJPApersistenceprovider">Using the Hibernate 4.3.x JPA persistence provider</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-UsingtheInfinispansecondlevelcache">Using the Infinispan second level cache</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-ReplacingthecurrentHibernate4.3.xjarswithanewerversion">Replacing the current Hibernate 4.3.x jars with a newer version</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-PackagingtheHibernate4.x%28orgreater%29JPApersistenceproviderwithyourapplication">Packaging the Hibernate 4.x (or greater) JPA persistence provider with your application</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-PackagingtheHibernate3.5orgreater3.xJPApersistenceproviderwithyourapplication">Packaging the Hibernate 3.5 or greater 3.x JPA persistence provider with your application</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-SharingtheHibernate3.5orgreaterJPApersistenceproviderbetweenmultipleapplications">Sharing the Hibernate 3.5 or greater JPA persistence provider between multiple applications</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-UsingOpenJPA">Using OpenJPA</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-UsingEclipseLink">Using EclipseLink</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-UsingDataNucleus">Using DataNucleus</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-UsingHibernateOGM">Using Hibernate OGM</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-NativeHibernateuse">Native Hibernate use</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-InjectionofHibernateSessionandSessionFactoryInjectionofHibernateSessionandSessionFactory">Injection of Hibernate Session and SessionFactoryInjection of Hibernate Session and SessionFactory</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-Hibernateproperties">Hibernate properties</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-Persistenceunitproperties">Persistence unit properties</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-Determinethepersistenceprovidermodule">Determine the persistence provider module</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-BindingEntityManagerFactory%2FEntityManagertoJNDI">Binding EntityManagerFactory/EntityManager to JNDI</a>    </p>
</li><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-Community">Community</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="JPA_Reference_Guide.html#80873200_JPAReferenceGuide-PeoplewhohavecontributedtotheWildFlyJPAlayer%3A">People who have contributed to the WildFly JPA layer:</a>    </p>
</li></ul></li></ul>    <div class="section-2"  id="80873200_JPAReferenceGuide-Introduction"  >
        <h2>Introduction</h2>
    
    <p>
The WildFly JPA subsystem implements the JPA 2.1 container-managed requirements. Deploys the persistence unit definitions, the persistence unit/context annotations and persistence unit/context references in the deployment descriptor. JPA Applications use the Hibernate persistence provider, which is included with WildFly. The JPA subsystem uses the standard SPI (javax.persistence.spi.PersistenceProvider) to access the Hibernate persistence provider and some additional extensions as well.    </p>
    <p>
During application deployment, JPA use is detected (e.g. persistence.xml or @PersistenceContext/Unit annotations) and injects Hibernate dependencies into the application deployment. This makes it easy to deploy JPA applications.    </p>
    <p>
In the remainder of this documentation, &rdquo;entity manager&rdquo; refers to an instance of the <i class=" ">javax.persistence.EntityManager</i> class. <a href="http://download.oracle.com/javaee/7/api/javax/persistence/package-summary.html">Javadoc for the JPA interfaces </a> and <a href="https://jcp.org/en/jsr/detail?id=338">JPA 2.1 specification</a>.    </p>
    <p>
The index of the Hibernate documentation is at <a href="http://hibernate.org/orm/documentation/4.3/">http://hibernate.org/orm/documentation/4.3/</a>.    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-UpdateyourPersistence.xmlforHibernate4.3.0"  >
        <h2>Update your Persistence.xml for Hibernate 4.3.0</h2>
    
    <p>
The persistence provider class name in Hibernate 4.3.0 is <strong class=" ">org.hibernate.jpa.HibernatePersistenceProvider</strong>.    </p>
    <p>
Instead of specifying:    </p>
    <p>
<strong class=" ">&lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;</strong>    </p>
    <p>
Switch to*:*    </p>
    <p>
<strong class=" ">&lt;provider&gt;org.hibernate.jpa.HibernatePersistenceProvider&lt;/provider&gt;</strong>    </p>
    <p>
Or remove the persistence provider class name from your persistence.xml (so the default provider will be used).    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-Entitymanager"  >
        <h2>Entity manager</h2>
    
    <p>
The entity manager is similar to the Hibernate Session class; applications use it to create/read/update/delete data (and related operations). Applications can use application-managed or container-managed entity managers. Keep in mind that the entity manager is not expected to be thread safe (don't inject it into a servlet class variable which is visible to multiple threads).    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-Applicationmanagedentitymanager"  >
        <h2>Application-managed entity manager</h2>
    
    <p>
Application-managed entity managers provide direct access to the underlying persistence provider (org.hibernate.ejb.HibernatePersistence). The scope of the application-managed entity manager is from when the application creates it and lasts until the app closes it. Use the <i class=" ">@PersistenceUnit</i> annotation to inject a persistence unit into a <i class=" ">javax.persistence.EntityManagerFactory</i>. The EntityManagerFactory can return an application-managed entity manager.    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-Containermanagedentitymanager"  >
        <h2>Container-managed entity manager</h2>
    
    <p>
Container-managed entity managers auto-magically manage the underlying persistence provider for the application. Container-managed entity managers may use transaction-scoped persistence contexts or extended persistence contexts. The container-managed entity manager will create instances of the underlying persistence provider as needed. Every time that a new underlying persistence provider (<i class=" ">org.hibernate.ejb.HibernatePersistence</i>) instance is created, a new persistence context is also created (as an implementation detail of the underlying persistence provider).    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-PersistenceContext"  >
        <h2>Persistence Context</h2>
    
    <p>
The JPA persistence context contains the entities managed by the persistence provider. The persistence context acts like a first level (transactional) cache for interacting with the datasource. Loaded entities are placed into the persistence context before being returned to the application. Entities changes are also placed into the persistence context (to be saved in the database when the transaction commits).    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-TransactionscopedPersistenceContext"  >
        <h2>Transaction-scoped Persistence Context</h2>
    
    <p>
The transaction-scoped persistence context coordinates with the (active) JTA transaction.&nbsp; When the transaction commits, the persistence context is flushed to the datasource (entity objects are detached but may still be referenced by application code).&nbsp; All entity changes that are expected to be saved to the datasource, must be made during a transaction.&nbsp; Entities read outside of a transaction will be detached when the entity manager invocation completes.&nbsp; Example transaction-scoped persistence context is below.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">@Stateful  // will use container managed transactions
public class CustomerManager {
  @PersistenceContext(unitName = &quot;customerPU&quot;) // default type is PersistenceContextType.TRANSACTION
  EntityManager em;
  public customer createCustomer(String name, String address) {
    Customer customer = new Customer(name, address);
    em.persist(customer);  // persist new Customer when JTA transaction completes (when method ends).
                           // internally:
                           //    1. Look for existing &quot;customerPU&quot; persistence context in active JTA transaction and use if found.
                           //    2. Else create new &quot;customerPU&quot; persistence context (e.g. instance of org.hibernate.ejb.HibernatePersistence)
                           //       and put in current active JTA transaction.
    return customer;       // return Customer entity (will be detached from the persistence context when caller gets control)
  }  // Transaction.commit will be called, Customer entity will be persisted to the database and &quot;customerPU&quot; persistence context closed</pre>
        </div>
    </div>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-ExtendedPersistenceContext"  >
        <h2>Extended Persistence Context</h2>
    
    <p>
The (ee container managed) extended persistence context can span multiple transactions and allows data modifications to be queued up (like a shopping cart), without an active JTA transaction (to be applied during the next JTA TX). The Container-managed extended persistence context can only be injected into a stateful session bean.&nbsp;    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">@PersistenceContext(type = PersistenceContextType.EXTENDED, unitName = &quot;inventoryPU&quot;)
EntityManager em;</pre>
        </div>
    </div>
    <div class="section-3"  id="80873200_JPAReferenceGuide-ExtendedPersistenceContextInheritance"  >
        <h3>Extended Persistence Context Inheritance</h3>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">JPA 2.0 specification section 7.6.2.1

If a stateful session bean instantiates a stateful session bean (executing in the same EJB container instance) which also has such an extended persistence context, the extended persistence context of the first stateful session bean is inherited by the second stateful session bean and bound to it, and this rule recursively applies&mdash;independently of whether transactions are active or not at the point of the creation of the stateful session beans.</pre>
        </div>
    </div>
    <p>
By default, the current stateful session bean being created, will (<strong class=" ">deeply</strong>) inherit the extended persistence context from any stateful session bean executing in the current Java thread.&nbsp; The <strong class=" ">deep</strong> inheritance of extended persistence context includes walking multiple levels up the stateful bean call stack (inheriting from parent beans).&nbsp; The <strong class=" ">deep</strong> inheritance of extended persistence context includes sibling beans.&nbsp; For example, parentA references child beans beanBwithXPC &amp;&nbsp; beanCwithXPC.&nbsp; Even though parentA doesn't have an extended persistence context, beanBwithXPC &amp; beanCwithXPC will share the same extended persistence context.&nbsp;    </p>
    <p>
Some other EE application servers, use <strong class=" ">shallow</strong> inheritance, where stateful session bean only inherit from the parent stateful session bean (if there is a parent bean).&nbsp; Sibling beans do not share the same extended persistence context unless their (common) parent bean also has the same extended persistence context.    </p>
    <p>
Applications can include a (top-level) <strong class=" ">jboss-all.xml</strong> deployment descriptor that specifies either the (default) <strong class=" ">DEEP</strong> extended persistence context inheritance or <strong class=" ">SHALLOW</strong>.    </p>
    <p>
The AS/docs/schema/jboss-jpa_1_0.xsd describes the <strong class=" ">jboss-jpa</strong> deployment descriptor that may be included in the <strong class=" ">jboss-all.xml</strong>.&nbsp; Below is an example of using <strong class=" ">SHALLOW</strong> extended persistence context inheritance:    </p>
    <blockquote>
    <p>
&lt;jboss&gt;<br/>&nbsp;&nbsp;&nbsp; &lt;jboss-jpa xmlns=&quot;http://www.jboss.com/xml/ns/javaee&quot;&gt;<br/>&nbsp;&nbsp;&nbsp; &lt;extended-persistence inheritance=&quot;SHALLOW&quot;/&gt;<br/>&nbsp; &nbsp; &lt;/jboss-jpa&gt;<br/>&lt;/jboss&gt;&nbsp;    </p>
        </blockquote>
    <p>
Below is an example of using <strong class=" ">DEEP</strong> extended persistence inheritance:    </p>
    <blockquote>
    <p>
&lt;jboss&gt;<br/>&nbsp;&nbsp;&nbsp; &lt;jboss-jpa xmlns=&quot;http://www.jboss.com/xml/ns/javaee&quot;&gt;<br/>&nbsp;&nbsp;&nbsp; &lt;extended-persistence inheritance=&quot;DEEP&quot;/&gt;<br/>&nbsp;&nbsp;&nbsp; &lt;/jboss-jpa&gt;<br/>&lt;/jboss&gt;    </p>
        </blockquote>
    <p>
The AS console/cli can change the <strong class=" ">default</strong> extended persistence context setting (DEEP or SHALLOW).&nbsp; The following cli commands will read the current JPA settings and enable SHALLOW extended persistence context inheritance for applications that do not include the <strong class=" ">jboss-jpa</strong> deployment descriptor:    </p>
    <blockquote>
    <p>
./jboss-cli.sh<br/>cd subsystem=jpa<br/>:read-resource<br/>:write-attribute(name=default-extended-persistence-inheritance,value=&quot;SHALLOW&quot;)    </p>
        </blockquote>
    </div>
    
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-Entities"  >
        <h2>Entities</h2>
    
    <p>
JPA 2.0 makes it easy to use your (pojo) plain old Java class to represent a database table row.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">@PersistenceContext EntityManager em;
Integer bomPk = getIndexKeyValue();
BillOfMaterials bom = em.find(BillOfMaterials.class, bomPk); // read existing table row into BillOfMaterials class

BillOfMaterials createdBom = new BillOfMaterials(&quot;...&quot;);     // create new entity
em.persist(createdBom);  // createdBom is now managed and will be saved to database when the current JTA transaction completes</pre>
        </div>
    </div>
    <p>
The entity lifecycle is managed by the underlying persistence provider.    </p>
<ul class=" "><li class=" ">    <p>
New (transient): an entity is new if it has just been instantiated using the new operator, and it is not associated with a persistence context. It has no persistent representation in the database and no identifier value has been assigned.    </p>
</li><li class=" ">    <p>
Managed (persistent): a managed entity instance is an instance with a persistent identity that is currently associated with a persistence context.    </p>
</li><li class=" ">    <p>
Detached: the entity instance is an instance with a persistent identity that is no longer associated with a persistence context, usually because the persistence context was closed or the instance was evicted from the context.    </p>
</li><li class=" ">    <p>
Removed: a removed entity instance is an instance with a persistent identity, associated with a persistence context, but scheduled for removal from the database.    </p>
</li></ul>    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-Deployment"  >
        <h2>Deployment</h2>
    
    <p>
The persistence.xml contains the persistence unit configuration (e.g. datasource name) and as described in the JPA 2.0 spec (section 8.2), the jar file or directory whose META-INF directory contains the persistence.xml file is termed the root of the persistence unit. In Java EE environments, the root of a persistence unit must be one of the following (quoted directly from the JPA 2.0 specification):    </p>
    <p>
&quot;    </p>
<ul class=" "><li class=" ">    <p>
an EJB-JAR file    </p>
</li><li class=" ">    <p>
the WEB-INF/classes directory of a WAR file    </p>
</li><li class=" ">    <p>
a jar file in the WEB-INF/lib directory of a WAR file    </p>
</li><li class=" ">    <p>
a jar file in the EAR library directory    </p>
</li><li class=" ">    <p>
an application client jar file    </p>
</li></ul>    <p>
The persistence.xml can specify either a JTA datasource or a non-JTA datasource. The JTA datasource is expected to be used within the EE environment (even when reading data without an active transaction). If a datasource is not specified, the default-datasource will instead be used (must be configured).    </p>
    <p>
NOTE: Java Persistence 1.0 supported use of a jar file in the root of the EAR as the root of a persistence unit. This use is no longer supported. Portable applications should use the EAR library directory for this case instead.    </p>
    <p>
&quot;    </p>
    <p>
Question: Can you have a EAR/META-INF/persistence.xml?    </p>
    <p>
Answer: No, the above may deploy but it could include other archives  also in the EAR, so you may have deployment issues for other reasons.&nbsp;  Better to put the persistence.xml in an EAR/lib/somePuJar.jar.    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-Troubleshooting"  >
        <h2>Troubleshooting</h2>
    
    <p>
The <strong class=" ">org.jboss.as.jpa</strong> logging can be enabled to get the following information:    </p>
<ul class=" "><li class=" ">    <p>
INFO - when persistence.xml has been parsed, starting of persistence unit service (per deployed persistence.xml), stopping of persistence unit service    </p>
</li><li class=" ">    <p>
DEBUG - informs about entity managers being injected, creating/reusing transaction scoped entity manager for active transaction    </p>
</li><li class=" ">    <p>
TRACE - shows how long each entity manager operation took in milliseconds, application searches for a persistence unit, parsing of persistence.xml    </p>
</li></ul>    <p>
To enable TRACE, open the as/standalone/configuration/standalone.xml (or as/domain/configuration/domain.xml) file. Search for <strong class=" ">&lt;subsystem xmlns=&quot;urn:jboss:domain:logging:1.0&quot;&gt;</strong> and add the <strong class=" ">org.jboss.as.jpa</strong> category.&nbsp; You need to change the console-handler level from <strong class=" ">INFO</strong> to <strong class=" ">TRACE</strong>.&nbsp;    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:logging:1.0&quot;&gt;
     &lt;console-handler name=&quot;CONSOLE&quot;&gt;
      &lt;level name=&quot;TRACE&quot; /&gt;
    &nbsp; ...
     &lt;/console-handler&gt;

     &lt;/periodic-rotating-file-handler&gt;
     &lt;logger category=&quot;com.arjuna&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;    &lt;level name=&quot;WARN&quot; /&gt;
 &nbsp;&nbsp;&nbsp; &lt;/logger&gt;

     &lt;logger category=&quot;org.jboss.as.jpa&quot;&gt;
   &nbsp;&nbsp;&nbsp;&nbsp; &lt;level name=&quot;TRACE&quot; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/logger&gt;

     &lt;logger category=&quot;org.apache.tomcat.util.modeler&quot;&gt;
   &nbsp;&nbsp;&nbsp;&nbsp; &lt;level name=&quot;WARN&quot; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/logger&gt;
     ...</pre>
        </div>
    </div>
    <p>
To see what is going on at the JDBC level,  enable <strong class=" ">jboss.jdbc.spy</strong> TRACE and add spy=&quot;true&quot; to the datasource.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;datasource jndi-name=&quot;java:jboss/datasources/...&quot; pool-name=&quot;...&quot; enabled=&quot;true&quot; spy=&quot;true&quot;&gt;
&lt;logger category=&quot;jboss.jdbc.spy&quot;&gt;
&nbsp; &lt;level name=&quot;TRACE&quot;/&gt;
&lt;/logger&gt;</pre>
        </div>
    </div>
    <p>
To troubleshoot issues with the Hibernate second level cache, try enabling trace for <strong class=" ">org.hibernate.SQL + org.hibernate.cache.infinispan + org.infinispan:</strong>    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:logging:1.0&quot;&gt;
     &lt;console-handler name=&quot;CONSOLE&quot;&gt;
      &lt;level name=&quot;TRACE&quot; /&gt;
    &nbsp; ...
     &lt;/console-handler&gt;

     &lt;/periodic-rotating-file-handler&gt;
     &lt;logger category=&quot;com.arjuna&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;    &lt;level name=&quot;WARN&quot; /&gt;
 &nbsp;&nbsp;&nbsp; &lt;/logger&gt;

     &lt;logger category=&quot;org.hibernate.SQL&quot;&gt;
   &nbsp;&nbsp;&nbsp;&nbsp; &lt;level name=&quot;TRACE&quot; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/logger&gt;

     &lt;logger category=&quot;org.hibernate&quot;&gt;
   &nbsp;&nbsp;&nbsp;&nbsp; &lt;level name=&quot;TRACE&quot; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/logger&gt;
&nbsp;     &lt;logger category=&quot;org.infinispan&quot;&gt;
   &nbsp;&nbsp;&nbsp;&nbsp; &lt;level name=&quot;TRACE&quot; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/logger&gt;

     &lt;logger category=&quot;org.apache.tomcat.util.modeler&quot;&gt;
   &nbsp;&nbsp;&nbsp;&nbsp; &lt;level name=&quot;WARN&quot; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/logger&gt;
     ...</pre>
        </div>
    </div>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-BackgroundontheJipijapaproject"  >
        <h2>Background on the Jipijapa project</h2>
    
    <p>
The <a href="https://github.com/jipijapa/jipijapa">Jipijapa</a> project goal is to improve application platform integration with JPA persistence providers.&nbsp; Jipijapa provides additional integration that makes it easier to use various persistence providers.&nbsp; For example, look <a href="https://github.com/jipijapa/jipijapa/blob/master/hibernate4_3/src/main/java/org/jboss/as/jpa/hibernate4/HibernatePersistenceProviderAdaptor.java#L85">here at how the Hibernate environment</a> is setup automatically (so that JPA deployments can just work).&nbsp; Also, application persistence unit definitions (persistence.xml) can override most settings.    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-PackagingpersistenceproviderswithyourapplicationandwhichJipijapaartifactstoinclude"  >
        <h2>Packaging persistence providers with your application and which Jipijapa artifacts to include</h2>
    
    <p>
Applications that include a copy of a persistence provider, should include one of the following Jipijapa integration jars, so that WildFly can easily deploy your application.&nbsp; The alternative to including persistence providers with your application, is to instead use the persistence provider as a static module (each of the below providers already have a placeholder static module that you can copy provider jars into).    </p>
    <div class="tablewrap">
        <table>
<thead class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
Persistence Provider    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
WildFly Version    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Group ID    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Artifact ID    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Version    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
Hibernate ORM 4.3.x    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
8.1.0.Final    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
org.jipijapa    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
jipijapa-hibernate4-3    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
1.1.0.Final    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
Hibernate ORM 4.0.x, 4.1.x, 4.2.x    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
8.1.0.Final    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
org.jipijapa    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
jipijapa-hibernate4-1    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
1.1.0.Final    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
Hibernate ORM version 3.x    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
8.1.0.Final    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
org.jipijapa    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
jipijapa-hibernate3    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
1.1.0.Final    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
EclipseLink    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
8.1.0.Final    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
org.jipijapa    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
jipijapa-eclipselink    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
1.1.0.Final    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
OpenJPA    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
8.1.0.Final    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
org.jipijapa    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
jipijapa-openjpa    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
1.1.0.Final    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-UsingtheHibernate4.3.xJPApersistenceprovider"  >
        <h2>Using the Hibernate 4.3.x JPA persistence provider</h2>
    
    <p>
Hibernate 4.3.x is packaged with WildFly&nbsp;and is the default persistence provider.    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-UsingtheInfinispansecondlevelcache"  >
        <h2>Using the Infinispan second level cache</h2>
    
    <p>
To enable the second level cache with Hibernate 4, just set the <strong class=" ">hibernate.cache.use_second_level_cache</strong> property to true, as is done in the following example (also set the <a href="http://docs.oracle.com/javaee/6/api/javax/persistence/SharedCacheMode.html">shared-cache-mode</a> accordingly). By default the application server uses Infinispan as the cache provider for <strong class=" ">JPA applications</strong>, so you don't need specify anything on top of that:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; version=&quot;1.0&quot;&gt;
&lt;persistence-unit name=&quot;2lc_example_pu&quot;&gt;
   &lt;description&gt;example of enabling the second level cache.&lt;/description&gt;
   &lt;jta-data-source&gt;java:jboss/datasources/mydatasource&lt;/jta-data-source&gt;
   &lt;shared-cache-mode&gt;ENABLE_SELECTIVE&lt;/shared-cache-mode&gt;
   &lt;properties&gt;
      &lt;property name=&quot;hibernate.cache.use_second_level_cache&quot; value=&quot;true&quot;/&gt;
   &lt;/properties&gt;
&lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre>
        </div>
    </div>
    <p>
Here is an example of enabling the second level cache for a Hibernate native API hibernate.cfg.xml file:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;property name=&quot;hibernate.cache.region.factory_class&quot; value=&quot;org.jboss.as.jpa.hibernate4.infinispan.InfinispanRegionFactory&quot;/&gt;
&lt;property name=&quot;hibernate.cache.infinispan.cachemanager&quot; value=&quot;java:jboss/infinispan/container/hibernate&quot;/&gt;
&lt;property name=&quot;hibernate.transaction.manager_lookup_class&quot; value=&quot;org.hibernate.transaction.JBossTransactionManagerLookup&quot;/&gt;
&lt;property name=&quot;hibernate.cache.use_second_level_cache&quot; value=&quot;true&quot;/&gt;</pre>
        </div>
    </div>
    <p>
The Hibernate native API application will also need a MANIFEST.MF:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">Dependencies: org.infinispan,org.hibernate</pre>
        </div>
    </div>
    <p>
<a href="https://docs.jboss.org/author/display/ISPN/Using+Infinispan+as+JPA-Hibernate+Second+Level+Cache+Provider">Infinispan Hibernate/JPA second level cache provider documentation</a> contains advanced configuration information but you should bear in mind  that when Hibernate runs within WildFly 8, some of  those configuration options, such as region factory, are not needed.  Moreover, the application server providers you with option of selecting a  different cache container for Infinispan via <strong class=" ">hibernate.cache.infinispan.container</strong> persistence property. To reiterate, this property is not mandatory and a  default container is already deployed for by the application server to  host the second level cache.    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-ReplacingthecurrentHibernate4.3.xjarswithanewerversion"  >
        <h2>Replacing the current Hibernate 4.3.x jars with a newer version</h2>
    
    <p>
Just update the current wildfly/modules/system/layers/base/org/hibernate/main folder to contain the newer version (after stopping your WildFly server instance).&nbsp;    </p>
<ol class=" "><li class=" ">    <p>
Delete *.index files in wildfly/modules/system/layers/base/org/hibernate/main and wildfly/modules/system/layers/base/org/hibernate/envers/main folders.    </p>
</li><li class=" ">    <p>
Backup the current contents of wildfly/modules/system/layers/base/org/hibernate in case you make a mistake.    </p>
</li><li class=" ">    <p>
Remove the older jars and copy new Hibernate jars into wildfly/modules/system/layers/base/org/hibernate/main + wildfly/modules/system/layers/base/org/hibernate/envers/main.    </p>
</li><li class=" ">    <p>
Update the wildfly/modules/system/layers/base/org/hibernate/main/module.xml + wildfly/modules/system/layers/base/org/hibernate/envers/main/module.xml to name the jars that you copied in.    </p>
</li></ol>    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-PackagingtheHibernate4.x%28orgreater%29JPApersistenceproviderwithyourapplication"  >
        <h2>Packaging the Hibernate 4.x (or greater) JPA persistence provider with your application</h2>
    
    <p>
WildFly 8&nbsp;allows the packaging of Hibernate 4.x (or greater)  persistence provider jars with the application. The JPA deployer will  detect the presence of a persistence provider in the application and <strong class=" ">jboss.as.jpa.providerModule</strong> needs to be set to <strong class=" ">application</strong>.&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br/>&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; version=&quot;1.0&quot;&gt;<br/>&lt;persistence-unit name=&quot;myOwnORMVersion_pu&quot;&gt;<br/>&lt;description&gt;Hibernate 4 Persistence Unit.&lt;/description&gt;<br/>&lt;jta-data-source&gt;java:jboss/datasources/PlannerDS&lt;/jta-data-source&gt;<br/>&lt;properties&gt;<br/>&nbsp;&nbsp;&nbsp; &lt;property name=&quot;jboss.as.jpa.providerModule&quot; value=&quot;application&quot; /&gt;<br/>&lt;/properties&gt;<br/>&lt;/persistence-unit&gt;<br/>&lt;/persistence&gt;    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-PackagingtheHibernate3.5orgreater3.xJPApersistenceproviderwithyourapplication"  >
        <h2>Packaging the Hibernate 3.5 or greater 3.x JPA persistence provider with your application</h2>
    
    <p>
WildFly 8&nbsp;allows the packaging of Hibernate 3.5 (or greater) persistence provider jars with the application. The JPA deployer will detect the presence of a persistence provider in the application and <strong class=" ">jboss.as.jpa.providerModule</strong> needs to be set to <strong class=" ">hibernate3-bundled</strong>.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; version=&quot;1.0&quot;&gt;
    &lt;persistence-unit name=&quot;plannerdatasource_pu&quot;&gt;
        &lt;description&gt;Hibernate 3 Persistence Unit.&lt;/description&gt;
        &lt;jta-data-source&gt;java:jboss/datasources/PlannerDS&lt;/jta-data-source&gt;
        &lt;properties&gt;
&nbsp;&nbsp;&nbsp;         &lt;property name=&quot;hibernate.show_sql&quot; value=&quot;false&quot; /&gt;
        &nbsp;&nbsp;&nbsp; &lt;property name=&quot;jboss.as.jpa.providerModule&quot; value=&quot;hibernate3-bundled&quot; /&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre>
        </div>
    </div>
    <p>
The WildFly testsuite contains a test that packages jars from the Hibernate 3.6.5.Final jars in the ear lib.    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-SharingtheHibernate3.5orgreaterJPApersistenceproviderbetweenmultipleapplications"  >
        <h2>Sharing the Hibernate 3.5 or greater JPA persistence provider between multiple applications</h2>
    
    <p>
Applications can share the same Hibernate3 (for Hibernate 3.5 or greater) persistence provider by manually creating an <strong class=" ">org.hibernate:3</strong> module (in the AS/modules folder). Steps to create the Hibernate3 module:    </p>
<ol class=" "><li class=" ">    <p>
In a command shell, go to the AS installation and change into the modules/org folder.<br/><strong class=" ">cd WF\modules\modules\system\layers\base\org\hibernate\3</strong>    </p>
</li><li class=" ">    <p>
Copy the Hibernate3 jars into this folder<br/>(hibernate3-core.jar, hibernate3-commons-annotations.jar,  hibernate3-entitymanager.jar needed for Hibernate 3.x).    </p>
</li><li class=" ">    <p>
Update the module.xml file to name each jar you copied in as a &quot;resource-root&quot;:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!-- Represents the Hibernate 3.x module&nbsp; --&gt;
&lt;module xmlns=&quot;urn:jboss:module:1.1&quot; name=&quot;org.hibernate&quot; slot=&quot;3&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;resources&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;jipijapa-hibernate3-1.0.1.Final.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;hibernate3-core.jar&quot;/&gt;
        &lt;resource-root path=&quot;hibernate3-commons-annotations.jar&quot;/&gt;
        &lt;resource-root path=&quot;hibernate3-entitymanager.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/resources&gt;

&nbsp;&nbsp;&nbsp; &lt;dependencies&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;asm.asm&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.annotation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.enterprise.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.persistence.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.transaction.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.validation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.xml.bind.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.antlr&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.apache.commons.collections&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.dom4j&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.javassist&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.as.jpa.spi&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.jandex&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.logging&quot;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &lt;module name=&quot;org.slf4j&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.vfs&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/dependencies&gt;
&lt;/module&gt;</pre>
        </div>
    </div>
</li></ol><ol class=" "><li class=" ">    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;"></pre>
        </div>
    </div>
</li></ol>    <p>
In your persistence.xml, you will refer to the Hibernate 3 persistence provider as follows:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; version=&quot;1.0&quot;&gt;
    &lt;persistence-unit name=&quot;crm_pu&quot;&gt;
&nbsp;&nbsp;&nbsp;     &lt;description&gt;CRM Persistence Unit.&lt;/description&gt;
        &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
    &nbsp;&nbsp;&nbsp; &lt;jta-data-source&gt;java:jboss/datasources/CRMDS&lt;/jta-data-source&gt;
    &nbsp;&nbsp;&nbsp; &lt;properties&gt;
&nbsp;&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp; &lt;property name=&quot;jboss.as.jpa.providerModule&quot; value=&quot;org.hibernate:3&quot; /&gt;
    &nbsp;&nbsp;&nbsp; &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre>
        </div>
    </div>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-UsingOpenJPA"  >
        <h2>Using OpenJPA</h2>
    
    <p>
You need to copy the OpenJPA jars (e.g. openjpa-all.jar serp.jar) into the WildFly modules/system/layers/base/org/apache/openjpa/main folder and update modules/system/layers/base/org/apache/openjpa/main/module.xml to include the same jar file names that you copied in.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;"> &lt;module xmlns=&quot;urn:jboss:module:1.1&quot; name=&quot;org.apache.openjpa&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;resources&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;jipijapa-openjpa-1.0.1.Final.jar&quot;/&gt;
        &lt;resource-root path=&quot;openjpa-all.jar&quot;&gt;
           &lt;filter&gt;
              &lt;exclude path=&quot;javax/**&quot; /&gt;
           &lt;/filter&gt;
        &lt;/resource-root&gt;
        &lt;resource-root path=&quot;serp.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/resources&gt;

&nbsp;&nbsp;&nbsp; &lt;dependencies&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.annotation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.enterprise.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.persistence.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.transaction.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.validation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.xml.bind.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.apache.commons.collections&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.apache.commons.lang&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.as.jpa.spi&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.logging&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.vfs&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.jandex&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/dependencies&gt;
&lt;/module&gt;</pre>
        </div>
    </div>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-UsingEclipseLink"  >
        <h2>Using EclipseLink</h2>
    
    <p>
You need to copy the EclipseLink jar (e.g. eclipselink-2.5.1.jar or eclipselink.jar as in the example below) into the WildFly modules/system/layers/base/org/eclipse/persistence/main folder and update modules/system/layers/base/org/eclipse/persistence/main/module.xml to include the EclipseLink jar (take care to use the jar name that you copied in).&nbsp; If you happen to leave the EclipseLink version number in the jar name, the module.xml should reflect that.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;"> &lt;module xmlns=&quot;urn:jboss:module:1.1&quot; name=&quot;org.eclipse.persistence&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;resources&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;jipijapa-eclipselink-1.0.1.Final.jar&quot;/&gt;
        &lt;resource-root path=&quot;eclipselink.jar&quot;&gt;           &lt;filter&gt;
              &lt;exclude path=&quot;javax/**&quot; /&gt;
           &lt;/filter&gt;
        &lt;/resource-root&gt;
&nbsp;&nbsp;&nbsp; &lt;/resources&gt;

&nbsp;&nbsp;&nbsp; &lt;dependencies&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;asm.asm&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.annotation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.enterprise.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.persistence.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.transaction.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.validation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.xml.bind.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.antlr&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.apache.commons.collections&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.dom4j&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.javassist&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.as.jpa.spi&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.logging&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.vfs&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/dependencies&gt;
&lt;/module&gt;</pre>
        </div>
    </div>
    <p>
As a workaround for&nbsp; issue<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=414974">id=414974</a>, set (WildFly) system property &quot;eclipselink.archive.factory&quot; to value &quot;org.jipijapa.eclipselink.JBossArchiveFactoryImpl&quot; via jboss-cli.sh command (WildFly server needs to be running when this command is issued):    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">jboss-cli.sh --connect '/system-property=eclipselink.archive.factory:add(value=org.jipijapa.eclipselink.JBossArchiveFactoryImpl)'</pre>
        </div>
    </div>
    <p>
.&nbsp; The following shows what the standalone.xml (or your WildFly configuration you are using) file might look like after updating the system properties:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;system-properties&gt;
   ...
   &lt;property name=&quot;eclipselink.archive.factory&quot; value=&quot;org.jipijapa.eclipselink.JBossArchiveFactoryImpl&quot;/&gt;
&lt;/system-properties&gt;</pre>
        </div>
    </div>
    <p>
You should then be able to deploy applications with persistence.xml that include;    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;</pre>
        </div>
    </div>
    <p>
Also refer to page <a href="https://community.jboss.org/wiki/HowToUseEclipseLinkWithAS7">how to use EclipseLink with WildFly guide here</a>.    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-UsingDataNucleus"  >
        <h2>Using DataNucleus</h2>
    
    <p>
Read the <a href="http://www.datanucleus.org/servlet/wiki/pages/viewpage.action?pageId=27688962">how to use DataNucleus with WildFly guide here</a>.    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-UsingHibernateOGM"  >
        <h2>Using Hibernate OGM</h2>
    
    <p>
This section is a work in progress.    </p>
    <p>
Example persistence.xml:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; version=&quot;1.0&quot;&gt;
&nbsp; &lt;persistence-unit name=&quot;MINIMAL&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;provider&gt;org.hibernate.ogm.jpa.HibernateOgmPersistence&lt;/provider&gt;

&nbsp;&nbsp;&nbsp; &lt;properties&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;property name=&quot;jboss.as.jpa.classtransformer&quot; value=&quot;false&quot; /&gt;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;property name=&quot;jboss.as.jpa.adapterModule&quot; value=&quot;org.jboss.as.jpa.hibernate:4&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/properties&gt;
&nbsp; &lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre>
        </div>
    </div>
    <p>
The Hibernate ORM module needs to depend on OGM.&nbsp; Change AS7/modules/org/hibernate/main/module.xml to:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;module xmlns=&quot;urn:jboss:module:1.1&quot; name=&quot;org.hibernate&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;resources&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;hibernate-core-4.1.6.Final.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;hibernate-entitymanager-4.1.6.Final.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;hibernate-infinispan-4.1.6.Final.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- Insert resources here --&gt;
&nbsp;&nbsp;&nbsp; &lt;/resources&gt;

&nbsp;&nbsp;&nbsp; &lt;dependencies&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;asm.asm&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.persistence.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.transaction.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.validation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.antlr&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.apache.commons.collections&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.dom4j&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.infinispan&quot; optional=&quot;true&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.javassist&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.as.jpa.hibernate&quot; slot=&quot;4&quot; optional=&quot;true&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.logging&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.hibernate.envers&quot; services=&quot;import&quot; optional=&quot;true&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.hibernate&quot; slot=&quot;ogm&quot; services=&quot;import&quot;/&gt;
&nbsp;&nbsp; &nbsp;&lt;module name=&quot;org.hibernate.commons-annotations&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/dependencies&gt;
&lt;/module&gt;</pre>
        </div>
    </div>
    <p>
The AS7/modules/org/hibernate/ogm folder should contain the OGM jars and the following module.xml:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;module xmlns=&quot;urn:jboss:module:1.1&quot; name=&quot;org.hibernate&quot; slot=&quot;ogm&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;resources&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;hibernate-ogm-core-4.0.0-SNAPSHOT.jar&quot;/&gt;
&nbsp;&nbsp; &nbsp;&lt;resource-root path=&quot;hibernate-ogm-infinispan-4.0.0-SNAPSHOT.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- Insert resources here --&gt;
&nbsp;&nbsp;&nbsp; &lt;/resources&gt;

&nbsp;&nbsp;&nbsp; &lt;dependencies&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.persistence.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.transaction.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.validation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.dom4j&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.infinispan&quot; optional=&quot;true&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.as.jpa.hibernate&quot; slot=&quot;4&quot; optional=&quot;true&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.logging&quot;/&gt;
&nbsp;&nbsp; &nbsp;&lt;module name=&quot;org.hibernate.commons-annotations&quot;/&gt;
&nbsp;&nbsp; &nbsp;&lt;module name=&quot;org.hibernate&quot; export=&quot;true&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/dependencies&gt;
&lt;/module&gt;</pre>
        </div>
    </div>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-NativeHibernateuse"  >
        <h2>Native Hibernate use</h2>
    
    <p>
Applications that use the Hibernate API directly, are referred to here as native Hibernate applications. Native Hibernate applications, can choose to use the Hibernate jars included with WildFly 8&nbsp;or they can package their own copy of the Hibernate jars. Applications that utilize JPA will automatically have the JBoss AS  Hibernate injected onto the application deployment classpath. Meaning that JPA applications,  should expect to use the Hibernate jars included in WildFly.    </p>
    <p>
Example MANIFEST.MF entry to add Hibernate dependency:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">Manifest-Version: 1.0
...
Dependencies: org.hibernate</pre>
        </div>
    </div>
    <p>
If you use the Hibernate native api in your application and also use the JPA api to access the same entities (from the same Hibernate session/EntityManager), you could get surprising results&nbsp; (e.g. HibernateSession.saveOrUpdate(entity) is different than EntityManager.merge(entity).&nbsp; Each entity should be managed by either Hibernate native API or JPA code.    </p>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-InjectionofHibernateSessionandSessionFactoryInjectionofHibernateSessionandSessionFactory"  >
        <h2>Injection of Hibernate Session and SessionFactoryInjection of Hibernate Session and SessionFactory</h2>
    
    <p>
You can inject a org.hibernate.Session and org.hibernate.SessionFactory directly, just as you can do with EntityManagers and EntityManagerFactorys.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">import org.hibernate.Session;
import org.hibernate.SessionFactory;
@Stateful public class MyStatefulBean ... {
&nbsp;&nbsp; @PersistenceContext(unitName=&quot;crm&quot;) Session session1;
&nbsp;&nbsp; @PersistenceContext(unitName=&quot;crm2&quot;, type=EXTENDED) Session extendedpc;
&nbsp;&nbsp; @PersistenceUnit(unitName=&quot;crm&quot;) SessionFactory factory;
}</pre>
        </div>
    </div>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-Hibernateproperties"  >
        <h2>Hibernate properties</h2>
    
    <p>
WildFly automatically sets the following Hibernate (4.x) properties (if not already set in persistence unit definition):    </p>
    <div class="tablewrap">
        <table>
<thead class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
Property    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Purpose    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
    <span style="color: #555555;">
<strong class=" ">hibernate.id.new_generator_mappings</strong>    </span>
    <span style="color: #555555;">
=true    </span>
    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
New applications should let this default to true, older applications with existing data might need to set to false (see note below).&nbsp; It really depends on whether your application uses the @GeneratedValue(AUTO) which will generates new key values for newly created entities.&nbsp; The application can override this value (in the persistence.xml).    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">hibernate.transaction.jta.platform</strong>= instance of org.hibernate.service.jta.platform.spi.JtaPlatform interface    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
The transaction manager, user transaction and transaction synchronization registry is passed into Hibernate via this class.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">hibernate.ejb.resource_scanner</strong> = instance of org.hibernate.ejb.packaging.Scanner interface    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Instance of entity scanning class is passed in that knows how to use the AS annotation indexer (for faster deployment).    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">hibernate.transaction.manager_lookup_class</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
This property is removed if found in the persistence.xml (could conflict with JtaPlatform)    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">hibernate.session_factory_name</strong> = qualified persistence unit name    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Is set to the application name + persistence unit name (application can specify a different value but it needs to be unique across all application deployments on the AS instance).    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">hibernate.session_factory_name_is_jndi</strong> = false    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
only set if the application didn't specify a value for hibernate.session_factory_name.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">hibernate.ejb.entitymanager_factory_name =&nbsp;</strong> qualified persistence unit name    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Is set to the application name + persistence unit name (application can specify a different value but it needs to be unique across all application deployments on the AS instance).    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    <p>
In Hibernate 4.x, if <strong class=" ">new_generator_mappings</strong> is <strong class=" ">true</strong>:    </p>
<ul class=" "><li class=" ">    <p>
@GeneratedValue(AUTO) maps to org.hibernate.id.enhanced.SequenceStyleGenerator    </p>
</li><li class=" ">    <p>
@GeneratedValue(TABLE) maps to org.hibernate.id.enhanced.TableGenerator    </p>
</li><li class=" ">    <p>
@GeneratedValue(SEQUENCE) maps to org.hibernate.id.enhanced.SequenceStyleGenerator    </p>
</li></ul>    <p>
In Hibernate 4.x, if <strong class=" ">new_generator_mappings</strong> is <strong class=" ">false</strong>:    </p>
<ul class=" "><li class=" ">    <p>
@GeneratedValue(AUTO) maps to Hibernate &quot;native&quot;    </p>
</li><li class=" ">    <p>
@GeneratedValue(TABLE) maps to org.hibernate.id.MultipleHiLoPerTableGenerator    </p>
</li><li class=" ">    <p>
@GeneratedValue(SEQUENCE) to Hibernate &quot;seqhilo&quot;    </p>
</li></ul>    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-Persistenceunitproperties"  >
        <h2>Persistence unit properties</h2>
    
    <p>
The following properties are supported in the persistence unit definition (in the persistence.xml file):    </p>
    <div class="tablewrap">
        <table>
<thead class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
Property    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Purpose    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">jboss.as.jpa.providerModule</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
name of the persistence provider module (default is <strong class=" ">org.hibernate</strong>). Should be <strong class=" ">hibernate3-bundled</strong> if Hibernate 3 jars are in the application archive (adapterModule and adapterClass will automatically be set for <strong class=" ">hibernate3-bundled</strong>).&nbsp; Should be <strong class=" ">application</strong>, if a persistence provider is packaged with the application.&nbsp; See note below about some module names that are built in (based on the <strong class=" ">provider</strong>).    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">jboss.as.jpa.adapterModule</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
name of the integration classes that help WildFly&nbsp;to work with the persistence provider. Current valid values are <strong class=" ">org.jboss.as.jpa.hibernate:4</strong> (Hibernate 4 integration classes) and <strong class=" ">org.jboss.as.jpa.hibernate:3</strong> (Hibernate 3 integration classes). Other integration adapter modules are expected to be added.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">jboss.as.jpa.adapterClass</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
class name of the integration adapter. Current valid values are <strong class=" ">org.jboss.as.jpa.hibernate3.HibernatePersistenceProviderAdaptor</strong> and <strong class=" ">org.jboss.as.jpa.hibernate4.HibernatePersistenceProviderAdaptor</strong>.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">jboss.as.jpa.managed</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
set to <strong class=" ">false</strong> to disable container managed JPA access to the persistence unit.&nbsp; The default is <strong class=" ">true</strong>, which enables container managed JPA access to the persistence unit.&nbsp; This is typically set to <strong class=" ">false</strong> for Seam 2.x + Spring applications.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">jboss.as.jpa.classtransformer</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
set to <strong class=" ">false</strong> to disable class transformers for the persistence unit.&nbsp; The default is <strong class=" ">true</strong>, which allows class enhancing/rewriting.&nbsp; Hibernate also needs persistence unit property <strong class=" ">hibernate.ejb.use_class_enhancer</strong> to be true, for class enhancing to be enabled.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">wildfly.jpa.default-unit</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
set to <strong class=" ">true</strong> to choose the default persistence unit in an application.&nbsp; This is useful if you inject a persistence context without specifying the unitName (@PersistenceContext EntityManager em) but have multiple persistence units specified in your persistence.xml.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">wildfly.jpa.twophasebootstrap</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
persistence providers (like Hibernate ORM 4.3.x via EntityManagerFactoryBuilder), allow a two phase persistence unit bootstrap, which improves JPA integration with CDI.&nbsp; Setting the <strong class=" ">wildfly.jpa.twophasebootstrap</strong> hint to false, disables the two phase bootstrap (for the persistence unit that contains the hint).    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">wildfly.jpa.allowdefaultdatasourceuse</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
set to false to prevent persistence unit from using the default data source.&nbsp; Defaults to true.&nbsp; This is only important for persistence units that do not specify a datasource.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">jboss.as.jpa.deferdetach</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Controls whether transaction scoped persistence context used in non-JTA transaction thread, will detach loaded entities after each EntityManager invocation or when the persistence context is closed (e.g. business method ends).&nbsp; Defaults to false (entities are cleared after EntityManager invocation) and if set to true, the detach is deferred until the context is closed.    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-Determinethepersistenceprovidermodule"  >
        <h2>Determine the persistence provider module</h2>
    
    <p>
As mentioned above, if the <strong class=" ">jboss.as.jpa.providerModule</strong> property is not specified, the provider module name is determined by the <strong class=" ">provider</strong> name specified in the persistence.xml.&nbsp; The mapping is:    </p>
    <div class="tablewrap">
        <table>
<thead class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
Provider Name    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Module name    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
blank    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.hibernate</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.hibernate.ejb.HibernatePersistence</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.hibernate</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.hibernate.ogm.jpa.HibernateOgmPersistence</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.hibernate:ogm</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">oracle.toplink.essentials.PersistenceProvider</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">oracle.toplink</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">oracle.toplink.essentials.ejb.cmp3.EntityManagerFactoryProvider</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">oracle.toplink</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.eclipse.persistence.jpa.PersistenceProvider</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.eclipse.persistence</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.datanucleus.api.jpa.PersistenceProviderImpl</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.datanucleus</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.datanucleus.store.appengine.jpa.DatastorePersistenceProvider</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.datanucleus:appengine</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.apache.openjpa.persistence.PersistenceProviderImpl</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.apache.openjpa</strong>    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-BindingEntityManagerFactory%2FEntityManagertoJNDI"  >
        <h2>Binding EntityManagerFactory/EntityManager to JNDI</h2>
    
    <p>
By default WildFly does <strong class=" ">not</strong> bind the entity manager factory to JNDI. However, you can explicitly configure this in the persistence.xml of your application by setting the <tt class=" ">jboss.entity.manager.factory.jndi.name</tt> <tt class=" ">hint. The value of that property should be the JNDI name to which the entity manager factory should be bound.</tt>    </p>
    <p>
<tt class=" ">You can also bind a container managed (transaction scoped) entity manager to JNDI as well,&nbsp;}}via hint</tt> <tt class=" ">jboss.entity.manager.jndi.name</tt>{<tt class=" ">}{{.&nbsp; As a reminder, a transaction scoped entity manager (persistence context), acts as a proxy that always gets an unique underlying entity manager (at the persistence provider level).</tt>    </p>
    <p>
<tt class=" ">Here's an example:</tt>    </p>
    <div class="confbox programlisting">
                    <div class="title">persistence.xml</div>
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence version=&quot;2.0&quot;
&nbsp;&nbsp; xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
&nbsp;&nbsp; xsi:schemaLocation=&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; http://java.sun.com/xml/ns/persistence
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;&gt;
&nbsp;&nbsp; &lt;persistence-unit name=&quot;myPU&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- If you are running in a production environment, add a managed
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data source, the example data source is just for proofs of concept! --&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;jta-data-source&gt;java:jboss/datasources/ExampleDS&lt;/jta-data-source&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;properties&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- Bind entity manager factory to JNDI at java:jboss/myEntityManagerFactory --&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;property name=&quot;jboss.entity.manager.factory.jndi.name&quot; value=&quot;java:jboss/myEntityManagerFactory&quot; /&gt;
         &lt;property name=&quot;jboss.entity.manager.jndi.name&quot; value=&quot;java:/myEntityManager&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/properties&gt;
&nbsp;&nbsp; &lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre>
        </div>
    </div>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">@Stateful
public class ExampleSFSB {
  public void createSomeEntityWithTransactionScopedEM(String name) {
    Context context = new InitialContext();
    javax.persistence.EntityManager entityManager = (javax.persistence.EntityManager) context.lookup(&quot;java:/myEntityManager&quot;);
    SomeEntity someEntity = new SomeEntity();
   &nbsp;someEntity.setName(name);    entityManager.persist(name);
  }
}
</pre>
        </div>
    </div>
    </div>
    
    <div class="section-2"  id="80873200_JPAReferenceGuide-Community"  >
        <h2>Community</h2>
    
    <p>
Many thanks to the community, for reporting issues, solutions and code changes. A number of people have been answering Wildfly forum questions related to JPA usage. I would like to thank them for this, as well as those reporting issues. For those of you that haven't downloaded the AS source code and started hacking patches together. I would like to encourage you to start by reading <a href="https://community.jboss.org/wiki/HackingOnWildFly">Hacking on WildFly</a>. You will find that it easy very easy to find your way around the WildFly/JPA/* source tree and make changes. Also, new for WildFly, is the JipiJapa project that contains additional integration code that makes EE JPA application deployments work better.&nbsp; The following list of contributors should grow over time, I hope to see more of you listed here.    </p>
    <div class="section-3"  id="80873200_JPAReferenceGuide-PeoplewhohavecontributedtotheWildFlyJPAlayer%3A"  >
        <h3>People who have contributed to the WildFly JPA layer:</h3>
    
<ul class=" "><li class=" ">    <p>
<a href="https://community.jboss.org/people/wolfc">Carlo de Wolf</a> (lead of the EJB3 project)    </p>
</li><li class=" ">    <p>
<strong class=" "><a href="http://in.relation.to/Bloggers/Steve">Steve Ebersole</a></strong> (lead of the Hibernate ORM project)    </p>
</li><li class=" ">    <p>
<strong class=" "><a href="https://community.jboss.org/people/swd847">Stuart Douglas</a></strong> (lead of the Seam Persistence project, WildFly project team member/committer)    </p>
</li><li class=" ">    <p>
<a href="https://community.jboss.org/people/jaikiran">Jaikiran Pai</a> (Active member of JBoss forums and JBoss EJB3 project team member)    </p>
</li><li class=" ">    <p>
<a href="http://relation.to/Bloggers/StrongLiu">Strong Liu</a> (leads the productization effort of Hibernate in the EAP product)    </p>
</li><li class=" ">    <p>
<strong class=" "><a href="https://community.jboss.org/people/smarlow">Scott Marlow</a></strong> (lead of the WildFly container JPA sub-project)    </p>
</li><li class=" ">    <p>
<strong class=" "><a href="https://community.jboss.org/people/alaisi">Antti Laisi</a></strong> <strong class=" ">(OpenJPA integration changes)</strong>    </p>
</li><li class=" ">    <p>
<a href="https://docs.jboss.org/author/display/~galder.zamarreno">Galder Zamarre&ntilde;o</a> (Infinispan 2lc documentation)    </p>
</li><li class=" ">    <p>
<a href="https://docs.jboss.org/author/display/~sannegrinovero">Sanne Grinovero</a> (Infinispan 2lc documentation)    </p>
</li><li class=" ">    <p>
<a href="https://issues.jboss.org/secure/ViewProfile.jspa?name=pferraro">Paul Ferraro</a> (Infinispan 2lc integration)    </p>
</li></ul>    <p>
&nbsp; &lt;!-- p, li    </p>
<div class=" error"></div>    <p>
--&gt;    <span style="color: #000000;">
jboss.as.jpa.deferdetach    </span>
    </p>
    </div>
    
    </div>
    
        </div>
              <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <li class="previous"><a accesskey="p" href="Remote_JNDI_Reference_Update_Draft.html"><strong>Prev</strong>Remote JNDI Reference Update Draft</a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li>
          <li class="home"><a accesskey="h" href="Documentation.html"><strong>Front page</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <li class="next"><a accesskey="n" href="OSGi.html"><strong>Next</strong>OSGi</a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </ul>
          </div>
    <script type="text/javascript">
      SyntaxHighlighter.all()
    </script>
</body>
</html>
