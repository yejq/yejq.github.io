<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Security Realms - WildFly 9</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
    <meta content="Scroll Wiki Publisher" name="generator"/>

    <link type="text/css" rel="stylesheet" href="css/blueprint/liquid.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/blueprint/print.css" media="print"/>
    <!--[if lt IE 8]><link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection"/><![endif]-->

    <link type="text/css" rel="stylesheet" href="css/content-style.css" media="screen, projection, print"/>
    <link type="text/css" rel="stylesheet" href="css/screen.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/print.css" media="print"/>
    
    <link type="text/css" rel="stylesheet" href="css/jbossorg.css"/>
    <link type="text/css" rel="stylesheet" href="css/docnav.css"/>    
    
    <link type="text/css" rel="stylesheet" href="sh/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="sh/shCoreDefault.css"/>
    <script type="text/javascript" src="sh/shCore.js"></script>
    <script type="text/javascript" src="sh/shBrushAppleScript.js"></script>
    <script type="text/javascript" src="sh/shBrushAS3.js"></script>
    <script type="text/javascript" src="sh/shBrushBash.js"></script>
    <script type="text/javascript" src="sh/shBrushCpp.js"></script>
    <script type="text/javascript" src="sh/shBrushCSharp.js"></script>
    <script type="text/javascript" src="sh/shBrushCss.js"></script>
    <script type="text/javascript" src="sh/shBrushDiff.js"></script>
    <script type="text/javascript" src="sh/shBrushErlang.js"></script>
    <script type="text/javascript" src="sh/shBrushGroovy.js"></script>
    <script type="text/javascript" src="sh/shBrushJava.js"></script>
    <script type="text/javascript" src="sh/shBrushJavaFX.js"></script>
    <script type="text/javascript" src="sh/shBrushJScript.js"></script>
    <script type="text/javascript" src="sh/shBrushPerl.js"></script>
    <script type="text/javascript" src="sh/shBrushPhp.js"></script>
    <script type="text/javascript" src="sh/shBrushPlain.js"></script>
    <script type="text/javascript" src="sh/shBrushPython.js"></script>
    <script type="text/javascript" src="sh/shBrushRuby.js"></script>
    <script type="text/javascript" src="sh/shBrushScala.js"></script>
    <script type="text/javascript" src="sh/shBrushSql.js"></script>
    <script type="text/javascript" src="sh/shBrushVb.js"></script>
    <script type="text/javascript" src="sh/shBrushXml.js"></script>
    
</head>
<body>
    <div class="container" style="min-width: 760px;">
        <div class="block header">
          <p id="title">
            <a class="site_href" href="http://www.jboss.org"><strong>JBoss.org</strong></a>
            <a class="doc_href" href="http://docs.jboss.org"><strong>Community Documentation</strong></a>
          </p>
                  <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <li class="previous"><a accesskey="p" href="RBAC.html"><strong>Prev</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="next"><a accesskey="n" href="add-user_utility.html"><strong>Next</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </ul>
                    <div>
            <h1>Security Realms</h1>
          </div>          
          </div>

        <div class="block content">
    <p>
Within WildFly 8 we make use of security realms to secure access to the management interfaces, these same realms are used to secure inbound access as exposed by JBoss Remoting such as remote JNDI and EJB access, the realms are also used to define an identity for the server - this identity can be used for both inbound connections to the server and outbound connections being established by the server.    </p>
    <div class="section-2"  id="80873170_SecurityRealms-GeneralStructure"  >
        <h2>General Structure</h2>
    
    <p>
The general structure of a management realm definition is: -    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;security-realm name=&quot;ManagementRealm&quot;&gt;
   &lt;plug-ins&gt;&lt;/plug-ins&gt;
   &lt;server-identities&gt;&lt;/server-identities&gt;
   &lt;authentication&gt;&lt;/authentication&gt;
   &lt;authorization&gt;&lt;/authorization&gt;
&lt;/security-realm&gt;</pre>
        </div>
    </div>
<ul class=" "><li class=" ">    <p>
<tt class=" ">plug-ins</tt> - This is an optional element that is used to define modules what will be searched for security realm PlugInProviders to extend the capabilities of the security realms.    </p>
</li><li class=" ">    <p>
<tt class=" ">server-identities</tt> - An optional element to define the identity of the server as visible to the outside world, this applies to both inbound connection to a resource secured by the realm and to outbound connections also associated with the realm.    </p>
</li></ul>    <p>
One example is the SSL identity of the server, for inbound connections this will control the identity of the server as the SSL connection is established, for outbound connections this same identity can be used where CLIENT-CERT style authentication is being performed.    </p>
    <p>
A second example is where the server is establishing an outbound connection that requires username / password authentication - this element can be used to define that password.    </p>
<ul class=" "><li class=" ">    <p>
<tt class=" ">authentication</tt> - This is probably the most important element that will be used within a security realm definition and mostly applies to inbound connections to the server, this element defines which backing stores will be used to provide the verification of the inbound connection.    </p>
</li></ul>    <p>
This element is optional as there are some scenarios where it will not be required such as if a realm is being defined for an outbound connection using a username and password.    </p>
<ul class=" "><li class=" ">    <p>
<tt class=" ">authorization</tt> - This is the final optional element and is used to define how roles are loaded for an authenticated identity.  At the moment this is more applicable for realms used for access to EE deployments such as web applications or EJBs but this will also become relevant as we add role based authorization checks to the management model.    </p>
</li></ul>    </div>
    
    <div class="section-2"  id="80873170_SecurityRealms-UsingaRealm"  >
        <h2>Using a Realm</h2>
    
    <p>
After a realm has been defined it needs to be associated with an inbound or outbound connection for it to be used, the following are some examples where these associations are used within the WildFly 8&nbsp;configuration.    </p>
    <div class="section-3"  id="80873170_SecurityRealms-InboundConnections"  >
        <h3>Inbound Connections</h3>
    
    <div class="section-4"  id="80873170_SecurityRealms-ManagementInterfaces"  >
        <h4>Management Interfaces</h4>
    
    <p>
Either within the <tt class=" ">standalone.xml</tt> or <tt class=" ">host.xml</tt> configurations the security realms can be associated with the management interfaces as follows: -    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;native-interface security-realm=&quot;ManagementRealm&quot;&gt;...&lt;/native-interface&gt;
&lt;http-interface security-realm=&quot;ManagementRealm&quot;&gt;...&lt;/http-interface&gt;</pre>
        </div>
    </div>
    <p>
If the <tt class=" ">security-realm</tt> attribute is omitted or removed from the interface definition it means that access to that interface will be unsecured    </p>
    <div class="confbox admonition admonition-note">
        
    <p>
By default we do bind these interfaces to the loopback address so that the interfaces are not accessible remotely out of the box, however do be aware that if these interfaces are then unsecured any other local user will be able to control and administer the WildFly 8&nbsp;installation.    </p>
    </div>
    
    <div class="confbox admonition admonition-tip">
        
    <p>
Also do note that the <tt class=" ">security-realm</tt> attribute is defined on each interface independently, this means that you could define a different security realm for each - this may be applicable if say you want the administrators to only access over the HTTP interface and leave only local users to access the native interface.    </p>
    </div>
    
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-RemotingSubsystem"  >
        <h4>Remoting Subsystem</h4>
    
    <p>
The Remoting subsystem exposes a connector to allow for inbound comunications with JNDI and the EJB subsystem by default we associate the <tt class=" ">ApplicationRealm</tt> with this connection.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:remoting:1.1&quot;&gt;
  &lt;connector name=&quot;remoting-connector&quot; socket-binding=&quot;remoting&quot; security-realm=&quot;ApplicationRealm&quot;/&gt;
&lt;/subsystem&gt;</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-OutboundConnections"  >
        <h3>Outbound Connections</h3>
    
    <div class="section-4"  id="80873170_SecurityRealms-RemotingSubsystem2"  >
        <h4>Remoting Subsystem</h4>
    
    <p>
Outbound connections can also be defined within the Remoting subsystem, these are typically used for remote EJB invocations from one AS server to another, in this scenario the security realm is used to obtain the server identity either it's password for X.509 certificate and possibly a trust store to verify the certificate of the remote host.    </p>
    <div class="confbox admonition admonition-note">
        
    <p>
Even if the referenced realm contains username and password authentication configuration the client side of the connection will NOT use this to verify the remote server.    </p>
    </div>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;remote-outbound-connection name=&quot;remote-ejb-connection&quot;
                            outbound-socket-binding-ref=&quot;binding-remote-ejb-connection&quot;
                            username=&quot;user1&quot;
                            security-realm=&quot;PasswordRealm&quot;&gt;</pre>
        </div>
    </div>
    <div class="confbox admonition admonition-info">
        
    <p>
The security realm is only used to obtain the password for this example, as you can see here the username is specified separately.    </p>
    </div>
    
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-SlaveHostController"  >
        <h4>Slave Host Controller</h4>
    
    <p>
When running in domain mode slave host controllers need to establish a connection to the native interface of the master domain controller so these also need a realm for the identity of the slave.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;domain-controller&gt;
  &lt;remote host=&quot;${jboss.domain.master.address}&quot; port=&quot;${jboss.domain.master.port:9999}&quot; security-realm=&quot;ManagementRealm&quot;/&gt;
&lt;/domain-controller&gt;</pre>
        </div>
    </div>
    <div class="confbox admonition admonition-tip">
        
    <p>
By default when a slave host controller authenticates against the master domain controller it uses its configured name as its username. If you want to override the username used for authentication a <tt class=" ">username</tt> attribute can be added to the <tt class=" ">&lt;remote /&gt;</tt> element.    </p>
    </div>
    
    </div>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="80873170_SecurityRealms-Authentication"  >
        <h2>Authentication</h2>
    
    <p>
One of the primary functions of the security realms is to define the user stores that will be used to verify the identity of inbound connections, the actual approach taken at the transport level is based on the capabilities of these backing store definitions.  The security realms are used to secure inbound connections for both the http management interface and for inbound remoting connections for both the native management interface and to access other services exposed over remoting - because of this there are some small differences between how the realm is used for each of these.    </p>
    <p>
At the transport level we support the following authentication mechanisms.    </p>
    <div class="tablewrap">
        <table>
<thead class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
HTTP    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Remoting (SASL)    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
None    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Anonymous    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
N/A    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
JBoss Local User    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
Digest    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Digest    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
Basic    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Plain    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
Client Cert    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Client Cert    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    <p>
The most notable are the first two in this list as they need some additional explanation - the final 3 are fairly standard mechanisms.    </p>
    <p>
If either the http interface, the native interface or a remoting connection are difined <strong class=" ">without</strong> a security realm reference then they are effectively unsecured, in the case of the http interface this means that no authentication will be performed on the incoming connection - for the remoting connections however we make use of SASL so require at least one authentication mechanism so make use of the anonymous mechanism to allow a user in without requiring a validated authentication process.    </p>
    <p>
The next mechanism 'JBoss Local User' is specific to the remoting connections - as we ship WildFly 8 secured by default we wanted a way to allow users to connect to their own AS installation after it is started without mandating that they define a user with a password - to accomplish this we have added the 'JBoss Local User' mechanism.  This mechanism makes the use of tokens exchanged on the filesystem to prove that the client is local to the AS installation and has the appropriate file permissions to read a token written by the AS to file.  As this mechanism is dependent on both server and client implementation details it is only supported for the remoting connections and not the http connections - at some point we may review if we can add support for this to the http interface but we would need to explore the options available with the commony used web browsers that are used to communicate with the http interface.    </p>
    <p>
The Digest mechanism is simply the HTTP Digest / SASL Digest mechanism that authenticates the user by making use of md5 hashed including nonces to avoid sending passwords in plain text over the network - this is the preferred mechanism for username / password authentication.    </p>
    <p>
The HTTP Basic / SASL Plain mechanism is made available for times that Digest can not be used but effectively this means that the users password will be sent over the network in the clear unless SSL is enabled.    </p>
    <p>
The final mechanism Client-Cert allows X.509 certificates to be used to verify the identity of the remote client.    </p>
    <div class="confbox admonition admonition-info">
        
    <p>
One point bearing in mind is that it is possible that an association with a realm can mean that a single incoming connection has the ability to choose between one or more authentication mechanisms.  As an example it is possible that an incoming remoting connection could choose between 'Client Cert', A username password mechanism or 'JBoss Local User' for authentication - this would allow say a local user to use the local mechanism, a remote user to supply their username and password whilst a remote script could make a call and authenticate using a certificate.    </p>
    </div>
    
    </div>
    
    <div class="section-2"  id="80873170_SecurityRealms-Authorization"  >
        <h2>Authorization</h2>
    
    <p>
The actual security realms are not involved in any authorization decisions however they can be configured to load a users roles which will subsequently be used to make authorization decisions - when references to authorization are seen in the context of security realms it is this loading of roles that is being referred to.    </p>
    <p>
For the loading of roles the process is split out to occur after the authentication step so after a user has been authenticated a second step will occur to load the roles based on the username they used to authenticate with.    </p>
    </div>
    
    <div class="section-2"  id="80873170_SecurityRealms-OutOfTheBoxConfiguration"  >
        <h2>Out Of The Box Configuration</h2>
    
    <p>
Before describing the complete set of configuration options available within the realms we will look at the default configuration as for most users that is going to be the starting point before customising further.    </p>
    <div class="confbox admonition admonition-info">
        
    <p>
The examples here are taken from the standalone configuration however the descriptions are equally applicable to domain mode, one point worth noting is that all security realms defined in the <tt class=" ">host.xml</tt> are available to be referenced within the domain configuration for the servers running on that host controller.    </p>
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-ManagementRealm"  >
        <h3>Management Realm</h3>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;security-realm name=&quot;ManagementRealm&quot;&gt;
  &lt;authentication&gt;
    &lt;local default-user=&quot;$local&quot;/&gt;
    &lt;properties path=&quot;mgmt-users.properties&quot; relative-to=&quot;jboss.server.config.dir&quot;/&gt;
  &lt;/authentication&gt;
&lt;/security-realm&gt;</pre>
        </div>
    </div>
    <p>
The realm <tt class=" ">ManagementRealm</tt> is the simplest realm within the default configuration, this realm simply enables two authentication mechanisms, the local mechanism and username/password authentication which will be using Digest authentication.    </p>
<ul class=" "><li class=" ">    <p>
local    </p>
</li></ul>    <p>
When using the local mechanism it is optional for remote clients to send a username to the server, this configuration specifies that where clients do not send a username it will be assumed that the clients username is <tt class=" ">$local</tt> - the <tt class=" ">&lt;local /&gt;</tt> element can also be configured to allow other usernames to be specified by remote clients however for the default configuration this is not enabled so is not supported.    </p>
<ul class=" "><li class=" ">    <p>
properties    </p>
</li></ul>    <p>
For username / password authentication the users details will be loaded from the file <tt class=" ">mgmt-users.properties</tt> which is located in {<tt class=" ">jboss.home}/standalone/configuration</tt> or {<tt class=" ">jboss.home}/domain/configuration</tt> depending on the running mode of the server.    </p>
    <p>
Each user is represented on their own line and the format of each line is <tt class=" ">username=</tt><tt class=" ">HASH</tt> where <tt class=" ">HASH</tt> is a pre-prepared hash of the users password along with their username and the name of the realm which in this case is <tt class=" ">ManagementRealm</tt>.    </p>
    <div class="confbox admonition admonition-tip">
        
    <p>
You do not need to worry about generating the entries within the properties file as we provide a utility <tt class=" ">add-user.sh</tt> or <tt class=" ">add-user.bat</tt> to add the users, this utility is described in more detail below.    </p>
    </div>
    
    <div class="confbox admonition admonition-warning">
        
    <p>
By pre-hashing the passwords in the properties file it does mean that if the user has used the same password on different realms then the contents of the file falling into the wrong hands does not nescesarily mean all accounts are compromised. <strong class=" ">HOWEVER</strong> the contents of the files do still need to be protected as they can be used to access any server where the realm name is the same and the user has the same username and password pair.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-ApplicationRealm"  >
        <h3>Application Realm</h3>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;security-realm name=&quot;ApplicationRealm&quot;&gt;
  &lt;authentication&gt;
    &lt;local default-user=&quot;$local&quot; allowed-users=&quot;*&quot;/&gt;
    &lt;properties path=&quot;application-users.properties&quot; relative-to=&quot;jboss.server.config.dir&quot;/&gt;
  &lt;/authentication&gt;
  &lt;authorization&gt;
    &lt;properties path=&quot;application-roles.properties&quot; relative-to=&quot;jboss.server.config.dir&quot;/&gt;
  &lt;/authorization&gt;
&lt;/security-realm&gt;</pre>
        </div>
    </div>
    <p>
The realm <tt class=" ">ApplicationRealm</tt> is a slightly more complex realm as this is used for both    </p>
    <div class="section-4"  id="80873170_SecurityRealms-Authentication2"  >
        <h4>Authentication</h4>
    
    <p>
The authentication configuration is very similar to the <tt class=" ">ManagementRealm</tt> in that it enabled both the local mechanism and a username/password based Digest mechanism.    </p>
<ul class=" "><li class=" ">    <p>
local    </p>
</li></ul>    <p>
The local configuration is similar to the <tt class=" ">ManagementRealm</tt> in that where the remote user does not supply a username it will be assumed that the username is <tt class=" ">$local</tt>, however in addition to this there is now an <tt class=" ">allowed-users</tt> attribute with a value of <tt class=" ">'*'</tt> - this means that the remote user can specify any username and it will be accepted over the local mechanism provided that the local verification is a success.    </p>
    <div class="confbox admonition admonition-info">
        
    <p>
To restrict the usernames that can be specified by the remote user a comma separated list of usernames can be specified instead within the <tt class=" ">allowed-users</tt> attribute.    </p>
    </div>
    
<ul class=" "><li class=" ">    <p>
properties    </p>
</li></ul>    <p>
The properties definition works in exactly the same way as the definition for <tt class=" ">ManagementRealm</tt> except now the properties file is called <tt class=" ">application-users.properties</tt>.    </p>
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-Authorization2"  >
        <h4>Authorization</h4>
    
    <p>
The contents of the <tt class=" ">Authorization</tt> element are specific to the <tt class=" ">ApplicationRealm</tt>, in this case a properties file is used to load a users roles.    </p>
    <p>
The properties file is called <tt class=" ">application-roles.properties</tt> and is located in {<tt class=" ">jboss.home}/standalone/configuration</tt> or {<tt class=" ">jboss.home}/domain/configuration</tt> depending on the running mode of the server.  The format of this file is <tt class=" ">username=</tt><tt class=" ">ROLES</tt> where <i class=" ">ROLES</i> is a comma separated list of the users roles.    </p>
    <div class="confbox admonition admonition-tip">
        
    <p>
As the loading of a users roles is a second step this is where it may be desirable to restrict which users can use the local mechanism so that some users still require username and password authentication for their roles to be loaded.    </p>
    </div>
    
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-othersecuritydomain"  >
        <h4>other security domain</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;security-domain name=&quot;other&quot; cache-type=&quot;default&quot;&gt;
  &lt;authentication&gt;
    &lt;login-module code=&quot;Remoting&quot; flag=&quot;optional&quot;&gt;
      &lt;module-option name=&quot;password-stacking&quot; value=&quot;useFirstPass&quot;/&gt;
    &lt;/login-module&gt;
    &lt;login-module code=&quot;RealmDirect&quot; flag=&quot;required&quot;&gt;
      &lt;module-option name=&quot;password-stacking&quot; value=&quot;useFirstPass&quot;/&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
&lt;/security-domain&gt;</pre>
        </div>
    </div>
    <p>
When applications are deployed to the application server they are associated with a security domain within the security subsystem, the <tt class=" ">other</tt> security domain is provided to work with the <tt class=" ">ApplicationRealm</tt>, this domain is defined with a pair of login modules Remoting and RealmDirect.    </p>
<ul class=" "><li class=" ">    <p>
Remoting    </p>
</li></ul>    <p>
The <tt class=" ">Remoting</tt> login module is used to check if the request currently being authenticated is a request received over a Remoting connection, if so the identity that was created during the authentication process is used and associated with the current request.    </p>
    <p>
If the request did not arrive over a Remoting connection this module does nothing and allows the JAAS based login to continue to the next module.    </p>
<ul class=" "><li class=" ">    <p>
RealmDirect    </p>
</li></ul>    <p>
The <tt class=" ">RealmDirect</tt> login module makes use of a security realm to authenticate the current request if that did not occur in the <tt class=" ">Remoting</tt> login module and then use the realm to load the users roles, by default this login module assumes the realm to use is called <tt class=" ">ApplicationRealm</tt> although other names can be overridden using the &quot;realm&quot; module-option.    </p>
    <p>
The advantage of this approach is that all of the backing store configuration can be left within the realm with the security domain just delegating to the realm.    </p>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="80873170_SecurityRealms-adduser.sh"  >
        <h2>user.sh</h2>
    
    <p>
For use with the default configuration we supply a utility <tt class=" ">add-user</tt> which can be used to manage the properties files for the default realms used to store the users and their roles.    </p>
    <p>
The add-user utility can be used to manage both the users in the <tt class=" ">ManagementRealm</tt> and the users in the <tt class=" ">ApplicationRealm</tt>, changes made apply to the properties file used both for domain mode and standalone mode.    </p>
    <div class="confbox admonition admonition-tip">
        
    <p>
After you have installed your application server and decided if you are going to run in standalone mode or domain mode you can delete the parent folder for the mode you are not using, the add-user utility will then only be managing the properties file for the mode in use.    </p>
    </div>
    
    <p>
The add-user utility is a command line utility however it can be run in both interactive and non-interactive mode.  Depending on your platform the script to run the add-user utility is either <tt class=" ">add-user.sh</tt> or <tt class=" ">add-user.bat</tt> which can be found in {<tt class=" ">jboss.home}/bin</tt>.    </p>
    <p>
This guide now contains a couple of examples of this utility in use to accomplish the most common tasks.    </p>
    <div class="section-3"  id="80873170_SecurityRealms-AddingaUser"  >
        <h3>Adding a User</h3>
    
    <p>
Adding users to the properties files is the primary purpose of this utility.    </p>
    <div class="confbox admonition admonition-note">
        
    <p>
The server caches the contents of the properties files in memory, however the server does check the modified time of the properties files on each authentication request and re-load if the time has been updated - this means all changes made by this utility are immediately applied to any running server.    </p>
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-AManagementUser"  >
        <h4>A Management User</h4>
    
    <div class="confbox admonition admonition-note">
        
    <p>
The default name of the realm for management users is <tt class=" ">ManagementRealm</tt>, when the utility prompts for the realm name just accept the default unless you have switched to a different realm.    </p>
    </div>
    
    <div class="section-5"  id="80873170_SecurityRealms-InteractiveMode"  >
        <h5>Interactive Mode</h5>
    
    <p>
    <img src="images/author/download/attachments/80873171/add-mgmt-user-interactive.png" alt="images/author/download/attachments/80873171/add-mgmt-user-interactive.png" />
        </p>
    <p>
Here we have added a new Management User called <tt class=" ">adminUser</tt>, as you can see some of the questions offer default responses so you can just press enter without repeating the default value.    </p>
    <p>
For now just answer <tt class=" ">n</tt> or <tt class=" ">no</tt> to the final question, adding users to be used by processes is described in more detail in the domain management chapter.    </p>
    </div>
    
    <div class="section-5"  id="80873170_SecurityRealms-NonInteractiveMode"  >
        <h5>Interactive Mode</h5>
    
    <p>
To add a user in non-interactive mode the command <tt class=" ">./add-user.sh {username} {password</tt>} can be used.    </p>
    <p>
    <img src="images/author/download/attachments/80873171/add-mgmt-user-non-interactive.png" alt="images/author/download/attachments/80873171/add-mgmt-user-non-interactive.png" />
        </p>
    <div class="confbox admonition admonition-warning">
        
    <p>
If you add users using this approach there is a risk that any other user that can view the list of running process may see the arguments including the password of the user being added, there is also the risk that the username / password combination will be cached in the history file of the shell you are currently using.    </p>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-AnApplicationUser"  >
        <h4>An Application User</h4>
    
    <p>
When adding application users in addition to adding the user with their pre-hashed password it is also now possible to define the roles of the user.    </p>
    <div class="section-5"  id="80873170_SecurityRealms-InteractiveMode2"  >
        <h5>Interactive Mode</h5>
    
    <p>
    <img src="images/author/download/attachments/80873171/add-app-user-interactive.png" alt="images/author/download/attachments/80873171/add-app-user-interactive.png" />
        </p>
    <p>
Here a new user called <tt class=" ">appUser</tt> has been added, in this case a comma separated list of roles has also been specified.    </p>
    <p>
As with adding a management user just answer <tt class=" ">n</tt> or <tt class=" ">no</tt> to the final question until you know you are adding a user that will be establishing a connection from one server to another.    </p>
    </div>
    
    <div class="section-5"  id="80873170_SecurityRealms-NonInteractiveMode2"  >
        <h5>Interactive Mode</h5>
    
    <p>
To add an application user non-interactively use the command <tt class=" ">./add-user.sh -a {username} {password</tt>}.    </p>
    <p>
    <img src="images/author/download/attachments/80873171/add-app-user-non-interactive.png" alt="images/author/download/attachments/80873171/add-app-user-non-interactive.png" />
        </p>
    <div class="confbox admonition admonition-note">
        
    <p>
Non-interactive mode does not support defining a list of users, to associate a user with a set of roles you will need to manually edit the <tt class=" ">application-roles.properties</tt> file by hand.    </p>
    </div>
    
    </div>
    
    </div>
    
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-UpdatingaUser"  >
        <h3>Updating a User</h3>
    
    <p>
Within the add-user utility it is also possible to update existing users, in interactive mode you will be prompted to confirm if this is your intention.    </p>
    <div class="section-4"  id="80873170_SecurityRealms-AManagementUser2"  >
        <h4>A Management User</h4>
    
    <div class="section-5"  id="80873170_SecurityRealms-InteractiveMode3"  >
        <h5>Interactive Mode</h5>
    
    <p>
    <img src="images/author/download/attachments/80873171/update-mgmt-user-interactive.png" alt="images/author/download/attachments/80873171/update-mgmt-user-interactive.png" />
        </p>
    </div>
    
    <div class="section-5"  id="80873170_SecurityRealms-NonInteractiveMode3"  >
        <h5>Interactive Mode</h5>
    
    <p>
In non-interactive mode if a user already exists the update is automatic with no confirmation prompt.    </p>
    </div>
    
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-AnApplicationUser2"  >
        <h4>An Application User</h4>
    
    <div class="section-5"  id="80873170_SecurityRealms-InteractiveMode4"  >
        <h5>Interactive Mode</h5>
    
    <p>
    <img src="images/author/download/attachments/80873171/update-app-user-interactive.png" alt="images/author/download/attachments/80873171/update-app-user-interactive.png" />
        </p>
    <div class="confbox admonition admonition-note">
        
    <p>
On updating a user with roles you will need to re-enter the list of roles assigned to the user.    </p>
    </div>
    
    </div>
    
    <div class="section-5"  id="80873170_SecurityRealms-NonInteractiveMode4"  >
        <h5>Interactive Mode</h5>
    
    <p>
In non-interactive mode if a user already exists the update is automatic with no confirmation prompt.    </p>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-CommunityContributions"  >
        <h3>Community Contributions</h3>
    
    <p>
There are still a few features to add to the add-user utility such as removing users or adding application users with roles in non-interactive mode, if you are interested in contributing to WildFly development the add-user utility is a good place to start as it is a stand alone utility, however it is a part of the AS build so you can become familiar with the AS development processes without needing to delve straight into the internals of the application server.    </p>
    </div>
    
    </div>
    
    <div class="section-2"  id="80873170_SecurityRealms-JMXSecurity"  >
        <h2>JMX Security</h2>
    
    <p>
When configuring the security realms remote access to the server's MBeanServer needs a special mention. When running in standalone mode the following is the default configuration: -    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;native-interface security-realm=&quot;ManagementRealm&quot;&gt;...&lt;/native-interface&gt;</pre>
        </div>
    </div>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:jmx:1.1&quot;&gt;
  ...
  &lt;remoting-connector/&gt;
&lt;/subsystem&gt;</pre>
        </div>
    </div>
    <p>
With this configuration remote access to JMX is provided over the native management interface, this is secured using the realm <tt class=" ">ManagementRealm</tt>, this means that any user that can connect to the native interface can also use this interface to access the MBeanServer - to disable this just remove the <tt class=" ">&lt;remoting-connector /&gt;</tt> element.    </p>
    <p>
In domain mode it is slightly more complicates as the native interface is exposed by the host controller process however each application server is running in it's own process so by default remote access to JMX is disabled.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:remoting:1.1&quot;&gt;
  &lt;connector name=&quot;remoting-connector&quot; socket-binding=&quot;remoting&quot; security-realm=&quot;ApplicationRealm&quot;/&gt;
&lt;/subsystem&gt;</pre>
        </div>
    </div>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:jmx:1.1&quot;&gt;
  ...
  &lt;!--&lt;remoting-connector use-management-endpoint=&quot;false&quot;/&gt;--&gt;
&lt;/subsystem&gt;</pre>
        </div>
    </div>
    <p>
To enable remote access to JMX uncomment the <tt class=" ">&lt;remoting-connector /&gt;</tt> element however be aware that this will make the MBeanServer accessible over the same Remoting connector used for remote JNDI and EJB access - this means that any user that can authenticate against the realm <tt class=" ">ApplicationRealm</tt> will be able to access the MBeanServer.    </p>
    <div class="confbox admonition admonition-info">
        
    <p>
The following Jira issue is currently outstanding to allow access to the individual MBeanServers by proxying through the host controllers native interface <a href="https://issues.jboss.org/browse/AS7-4009">AS7-4009</a>, if this is a feature you would use please add your vote to the issue.    </p>
    </div>
    
    </div>
    
    <div class="section-2"  id="80873170_SecurityRealms-DetailedConfiguration"  >
        <h2>Detailed Configuration</h2>
    
    <p>
This section of the documentation describes the various configuration options when defining realms, plug-ins are a slightly special case so the configuration options for plug-ins is within it's own section.    </p>
    <p>
Within a security realm definition there are four optional elements <tt class=" ">&lt;plug-ins /&gt;</tt>, <tt class=" ">&lt;server-identities /&gt;</tt>, <tt class=" ">&lt;authentication /&gt;</tt>, and <tt class=" ">&lt;authorization /&gt;</tt>, as mentioned above plug-ins is defined within it's own section below so we will begin by looking at the <tt class=" ">&lt;server-identities /&gt;</tt> element.    </p>
    <div class="section-3"  id="80873170_SecurityRealms-%7B%7B%3Cserveridentities%2F%3E%7D%7D"  >
        <h3>&lt;server-identities /&gt;</h3>
    
    <p>
The server identities section of a realm definition is used to define how a server appears to the outside world, currently this element can be used to configure a password to be used when establishing a remote outbound connection and also how to load a X.509 key which can be used for both inbound and outbound SSL connections.    </p>
    <div class="section-4"  id="80873170_SecurityRealms-%7B%7B%3Cssl%2F%3E%7D%7D"  >
        <h4>&lt;ssl /&gt;</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;server-identities&gt;
  &lt;ssl protocol=&quot;...&quot;&gt;
    &lt;keystore path=&quot;...&quot; relative-to=&quot;...&quot; keystore-password=&quot;...&quot; alias=&quot;...&quot; key-password=&quot;...&quot; /&gt;
  &lt;/ssl&gt;
&lt;/server-identities&gt;</pre>
        </div>
    </div>
<ul class=" "><li class=" ">    <p>
<strong class=" ">protocol</strong> - By default this is set to TLS and in general does not need to be set.    </p>
</li></ul>    <p>
The SSL element then contains the nested <tt class=" ">&lt;keystore /&gt;</tt> element, this is used to define how to load the key from the file based (JKS) keystore.    </p>
<ul class=" "><li class=" ">    <p>
<strong class=" ">path</strong> (mandatory) - This is the path to the keystore, this can be an absolute path or relative to the next attribute.    </p>
</li><li class=" ">    <p>
<strong class=" ">relative-to</strong> (optional) - The name of a service representing a path the keystore is relative to.    </p>
</li><li class=" ">    <p>
<strong class=" ">keystore-password</strong> (mandatory) - The password required to open the keystore.    </p>
</li><li class=" ">    <p>
<strong class=" ">alias</strong> (optional) - The alias of the entry to use from the keystore - for a keystore with multiple entries in practice the first usable entry is used but this should not be relied on and the alias should be set to guarantee which entry is used.    </p>
</li><li class=" ">    <p>
<strong class=" ">key-password</strong> (optional) - The password to load the key entry, if omitted the keystore-password will be used instead.    </p>
</li></ul>    <div class="confbox admonition admonition-tip">
        
    <p>
If you see the error <tt class=" ">UnrecoverableKeyException: Cannot recover key</tt> the most likely cause that you need to specify a <tt class=" ">key-password</tt> and possible even an <tt class=" ">alias</tt> as well to ensure only one key is loaded.    </p>
    </div>
    
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-%7B%7B%3Csecret%2F%3E%7D%7D"  >
        <h4>&lt;secret /&gt;</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;server-identities&gt;
  &lt;secret value=&quot;...&quot; /&gt;
&lt;/server-identities&gt;</pre>
        </div>
    </div>
<ul class=" "><li class=" ">    <p>
<strong class=" ">value</strong> (mandatory) - The password to use for outbound connections encoded as Base64, this field also supports a vault expression should stronger protection be required.    </p>
</li></ul>    <div class="confbox admonition admonition-note">
        
    <p>
The username for the outbound connection is specified at the point the outbound connection is defined.    </p>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-%7B%7B%3Cauthentication%2F%3E%7D%7D"  >
        <h3>&lt;authentication /&gt;</h3>
    
    <p>
The authentication element is predominantly used to configure the authentication that is performed on an inbound connection, however there is one exception and that is if a trust store is defined - on negotiating an outbound SSL connection the trust store will be used to verify the remote server.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;authentication&gt;
  &lt;truststore /&gt;
  &lt;local /&gt;
  &lt;jaas /&gt;
  &lt;ldap /&gt;
  &lt;properties /&gt;
  &lt;users /&gt;
  &lt;plug-in /&gt;
&lt;/authentication&gt;</pre>
        </div>
    </div>
    <p>
An authentication definition can have zero or one <tt class=" ">&lt;truststore /&gt;</tt>, it can also have zero or one <tt class=" ">&lt;local /&gt;</tt> and it can also have one of <tt class=" ">&lt;jaas /&gt;</tt>, <tt class=" ">&lt;ldap /&gt;</tt>, <tt class=" ">&lt;properties /&gt;</tt>, <tt class=" ">&lt;users /&gt;</tt>, and <tt class=" ">&lt;plug-in /&gt;</tt> i.e. the local mechanism and a truststore for certificate verification can be independent switched on and off and a single username / password store can be defined.    </p>
    <div class="section-4"  id="80873170_SecurityRealms-%7B%7B%3Ctruststore%2F%3E%7D%7D"  >
        <h4>&lt;truststore /&gt;</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;authentication&gt;
  &lt;truststore path=&quot;...&quot; relative-to=&quot;...&quot; keystore-password=&quot;...&quot;/&gt; 
&lt;/authentication&gt;</pre>
        </div>
    </div>
    <p>
This element is used to define how to load a key store file that can be used as the trust store within the SSLContext we create internally, the store is then used to verify the certificates of the remote side of the connection be that inbound or outbound.    </p>
<ul class=" "><li class=" ">    <p>
<strong class=" ">path</strong> (mandatory) - This is the path to the keystore, this can be an absolute path or relative to the next attribute.    </p>
</li><li class=" ">    <p>
<strong class=" ">relative-to</strong> (optional) - The name of a service representing a path the keystore is relative to.    </p>
</li><li class=" ">    <p>
<strong class=" ">keystore-password</strong> (mandatory) - The password required to open the keystore.    </p>
</li></ul>    <div class="confbox admonition admonition-note">
        
    <p>
Although this is a definition of a trust store the attribute for the password is <tt class=" ">keystore-password</tt>, this is because the underlying file being opened is still a key store.    </p>
    </div>
    
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-%7B%7B%3Clocal%2F%3E%7D%7D"  >
        <h4>&lt;local /&gt;</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;authentication&gt;
  &lt;local default-user=&quot;...&quot; allowed-users=&quot;...&quot; /&gt;
&lt;/authentication&gt;</pre>
        </div>
    </div>
    <p>
This element switches on the local authentication mechanism that allows clients to the server to verify that they are local to the server, at the protocol level it is optional for the remote client to send a user name in the authentication response.    </p>
<ul class=" "><li class=" ">    <p>
<strong class=" ">default-user</strong> (optional) - If the client does not pass in a username this is the assumed username, this value is also automatically added to the list of allowed-users.    </p>
</li><li class=" ">    <p>
<strong class=" ">allowed-users</strong> (optional) - This attribute is used to specify a comma separated list of users allowed to authenticate using the local mechanism, alternatively '<tt class=" ">*</tt>' can be specified to allow any username to be specified.    </p>
</li></ul>    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-%7B%7B%3Cjaas%2F%3E%7D%7D"  >
        <h4>&lt;jaas /&gt;</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;authentication&gt;
  &lt;jaas name=&quot;...&quot; /&gt;
&lt;/authentication&gt;</pre>
        </div>
    </div>
    <p>
The jaas element is used to enable username and password based authentication where the supplied username and password are verified by making use of a configured jaas domain.    </p>
<ul class=" "><li class=" ">    <p>
<strong class=" ">name</strong> (mandatory) - The name of the jaas domain to use to verify the supplied username and password.    </p>
</li></ul>    <div class="confbox admonition admonition-warning">
        
    <p>
As JAAS authentication works by taking a username and password and verifying these the use of this element means that at the transport level authentication will be forced to send the password in plain text, any interception of the messages exchanged between the client and server without SSL enabled will reveal the users password.    </p>
    </div>
    
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-%7B%7B%3Cldap%2F%3E%7D%7D"  >
        <h4>&lt;ldap /&gt;</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;authentication&gt;
  &lt;ldap connection=&quot;...&quot; base-dn=&quot;...&quot; recursive=&quot;...&quot; user-dn=&quot;...&quot;&gt;
    &lt;username-filter attribute=&quot;...&quot; /&gt;
    &lt;advanced-filter filter=&quot;...&quot; /&gt;
  &lt;/ldap&gt;
&lt;/authentication&gt;</pre>
        </div>
    </div>
    <p>
The ldap element is used to define how LDAP searches will be used to authenticate a user, this works by first connecting to LDAP and performing a search using the supplied user name to identity the distinguished name of the user and then a subsequent connection is made to the server using the password supplied by the user - if this second connection is a success then authentication succeeds.    </p>
    <div class="confbox admonition admonition-warning">
        
    <p>
Due to the verification approach used this configuration causes the authentication mechanisms selected for the protocol to cause the password to be sent from the client in plain text, the following Jira issue is to investigating proxying a Digest authentication with the LDAP server so no plain text password is needed  <a href="https://issues.jboss.org/browse/AS7-4195">AS7-4195</a>.    </p>
    </div>
    
<ul class=" "><li class=" ">    <p>
<strong class=" ">connection</strong> (mandatory) - The name of the connection to use to connect to LDAP.    </p>
</li><li class=" ">    <p>
<strong class=" ">base-dn</strong> (mandatory) - The distinguished name of the context to use to begin the search from.    </p>
</li><li class=" ">    <p>
<strong class=" ">recursive</strong> (optional) - Should the filter be executed recursively? Defaults to false.    </p>
</li><li class=" ">    <p>
<strong class=" ">user-dn</strong> (optional) - After the user has been found specifies which attribute to read for the users distinguished name, defaults to '<tt class=" ">dn</tt>'.    </p>
</li></ul>    <p>
Within the ldap element only one of <tt class=" ">&lt;username-filter /&gt;</tt> or <tt class=" ">&lt;advanced-filter /&gt;</tt> can be specified.    </p>
    <div class="section-5"  id="80873170_SecurityRealms-%7B%7B%3Cusernamefilter%2F%3E%7D%7D"  >
        <h5>&lt;username-filter /&gt;</h5>
    
    <p>
This element is used for a simple filter to match the username specified by the remote user against a single attribute, as an example with Active Directory the match is most likely to be against the '<tt class=" ">sAMAccountName</tt>' attribute.    </p>
<ul class=" "><li class=" ">    <p>
<strong class=" ">attribute</strong> (mandatory) - The name of the field to match the users supplied username against.    </p>
</li></ul>    </div>
    
    <div class="section-5"  id="80873170_SecurityRealms-%7B%7B%3Cadvancedfilter%2F%3E%7D%7D"  >
        <h5>&lt;advanced-filter /&gt;</h5>
    
    <p>
This element is used where a more advanced filter is required, one example use of this filter is to exclude certain matches by specifying some additional criteria for the filter.    </p>
<ul class=" "><li class=" ">    <p>
<strong class=" ">filter</strong> (mandatory) - The filter to execute to locate the user, this filter should contain '{<tt class=" ">0</tt>}' as a place holder for the username supplied by the user authenticating.    </p>
</li></ul>    </div>
    
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-%7B%7B%3Cproperties%2F%3E%7D%7D"  >
        <h4>&lt;properties /&gt;</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;authentication&gt;
  &lt;properties path=&quot;...&quot; relative-to=&quot;...&quot; plain-text=&quot;...&quot; /&gt;
&lt;/authentication&gt;</pre>
        </div>
    </div>
    <p>
The properties element is used to reference a properties file to load to read a users password or pre-prepared digest for the authentication process.    </p>
<ul class=" "><li class=" ">    <p>
<strong class=" ">path</strong> (mandatory) - The path to the properties file, either absolute or relative to the path referenced by the relative-to attribute.    </p>
</li><li class=" ">    <p>
<strong class=" ">relative-to</strong> (optional) - The name of a path service that the defined path will be relative to.    </p>
</li><li class=" ">    <p>
<strong class=" ">plain-text</strong> (optional) - Setting to specify if the passwords are stored as plain text within the properties file, defaults to false.    </p>
</li></ul>    <div class="confbox admonition admonition-note">
        
    <p>
By default the properties files are expected to store a pre-prepared hash of the users password in the form HEX( MD5( username ':' realm ':' password))    </p>
    </div>
    
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-%7B%7B%3Cusers%2F%3E%7D%7D"  >
        <h4>&lt;users /&gt;</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;authentication&gt;
  &lt;users&gt;
    &lt;user username=&quot;...&quot;&gt;
      &lt;password&gt;...&lt;/password&gt;
    &lt;/user&gt;
  &lt;/users&gt;
&lt;/authentication&gt;</pre>
        </div>
    </div>
    <p>
This is a very simple store of a username and password that stores both of these within the domain model, this is only really provided for the provision of simple examples.    </p>
<ul class=" "><li class=" ">    <p>
<strong class=" ">username</strong> (mandatory) - A users username.    </p>
</li></ul>    <p>
The <tt class=" ">&lt;password/&gt;</tt> element is then used to define the password for the user.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-%7B%7B%3Cauthorization%2F%3E%7D%7D"  >
        <h3>&lt;authorization /&gt;</h3>
    
    <p>
The authorization element is used to define how a users roles can be loaded after the authentication process completes, these roles may then be used for subsequent authorization decisions based on the service being accessed.  At the moment only a properties file approach or a custom plug-in are supported - support for loading roles from LDAP or from a database are planned for a subsequent release.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;authorization&gt;
  &lt;properties /&gt;
  &lt;plug-in /&gt;
&lt;/authorization&gt;</pre>
        </div>
    </div>
    <div class="section-4"  id="80873170_SecurityRealms-%7B%7B%3Cproperties%2F%3E%7D%7D2"  >
        <h4>&lt;properties /&gt;</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;authorization&gt;
  &lt;properties path=&quot;...&quot; relative-to=&quot;...&quot; /&gt;
&lt;/authorization&gt;</pre>
        </div>
    </div>
    <p>
The format of the properties file is <tt class=" ">username={ROLES</tt>} where {<tt class=" ">ROLES</tt>} is a comma separated list of the users roles.    </p>
<ul class=" "><li class=" ">    <p>
<strong class=" ">path</strong> (mandatory) - The path to the properties file, either absolute or relative to the path referenced by the relative-to attribute.    </p>
</li><li class=" ">    <p>
<strong class=" ">relative-to</strong> (optional) - The name of a path service that the defined path will be relative to.    </p>
</li></ul>    </div>
    
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-%7B%7B%3Coutboundconnection%2F%3E%7D%7D"  >
        <h3>&lt;outbound-connection /&gt;</h3>
    
    <p>
Strictly speaking these are not a part of the security realm definition, however at the moment they are only used by security realms so the definition of outbound connection is described here.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;management&gt;
  &lt;security-realms /&gt;
  &lt;outbound-connections&gt;
    &lt;ldap /&gt;
  &lt;/outbound-connections&gt;
&lt;/management&gt;</pre>
        </div>
    </div>
    <div class="section-4"  id="80873170_SecurityRealms-%7B%7B%3Cldap%2F%3E%7D%7D2"  >
        <h4>&lt;ldap /&gt;</h4>
    
    <p>
At the moment we only support outbound connections to ldap servers for the authentication process - this will later be expanded when we add support for database based authentication.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;outbound-connections&gt;
  &lt;ldap name=&quot;...&quot; url=&quot;...&quot; search-dn=&quot;...&quot; search-credential=&quot;...&quot; initial-context-factory=&quot;...&quot; /&gt;
&lt;/outbound-connections&gt;</pre>
        </div>
    </div>
    <p>
The outbound connections are defined in this section and then referenced by name from the configuration that makes use of them.    </p>
<ul class=" "><li class=" ">    <p>
<strong class=" ">name</strong> (mandatory) - The unique name used to reference this connection.    </p>
</li><li class=" ">    <p>
<strong class=" ">url</strong> (mandatory) - The URL use to establish the LDAP connection.    </p>
</li><li class=" ">    <p>
<strong class=" ">search-dn</strong> (mandatory) - The distinguished name of the user to authenticate as to perform the searches.    </p>
</li><li class=" ">    <p>
<strong class=" ">search-credential</strong> (mandatory) - The password required to connect to LDAP as the search-dn.    </p>
</li><li class=" ">    <p>
<strong class=" ">initial-context-factory</strong> (optional) - Allows overriding the initial context factory, defaults to '<tt class=" ">com.sun.jndi.ldap.LdapCtxFactory</tt>'    </p>
</li></ul>    </div>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="80873170_SecurityRealms-PlugIns"  >
        <h2>Plug Ins</h2>
    
    <p>
Within WildFly 8 for communication with the management interfaces and for other services exposed using Remoting where username / password authentication is used the use of Digest authentication is preferred over the use of HTTP Basic or SASL Plain so that we can avoid the sending of password in the clear over the network.  For validation of the digests to work on the server we either need to be able to retrieve a users plain text password or we need to be able to obtain a ready prepared hash of their password along with the username and realm.    </p>
    <p>
Previously to allow the addition of custom user stores we have added an option to the realms to call out to a JAAS domain to validate a users username and password, the problem with this approach is that to call JAAS we need the remote user to send in their plain text username and password so that a JAAS LoginModule can perform the validation, this forces us down to use either the HTTP Basic authentication mechanism or the SASL Plain mechanism depending on the transport used which is undesirable as we can not longer use Digest.    </p>
    <p>
To overcome this we now support plugging in custom user stores to support loading a users password, hash and roles from a custom store to allow different stores to be implemented without forcing the authentication back to plain text variant, this article describes the requirements for a plug in and shows a simple example plug-in for use with WildFly 8.    </p>
    <p>
When implementing a plug in there are two steps to the authentication process, the first step is to load the users identity and credential from the relevant store - this is then used to verify the user attempting to connect is valid.  After the remote user is validated we then load the users roles in a second step.  For this reason the support for plug-ins is split into the two stages, when providing a plug-in either of these two steps can be implemented but there is no requirement to implement the other side.    </p>
    <p>
When implementing a plug-in the following interfaces are the bare minimum that need to be implemented so depending on if a plug-in to load a users identity or a plug-in to load a users roles is being implemented you will be implementing one of these interfaces.    </p>
    <p>
<strong class=" "><i class=" ">Note</i></strong> <i class=" ">- All classes and interfaces of the SPI to be implemented are in the 'org.jboss.as.domain.management.plugin' package which is a part of the 'org.jboss.as.domain-management' module but for simplicity for the rest of this section only the short names will be shown.</i>    </p>
    <div class="section-3"  id="80873170_SecurityRealms-AuthenticationPlugIn"  >
        <h3>AuthenticationPlugIn</h3>
    
    <p>
To implement an <tt class=" ">AuthenticationPlugIn</tt> the following interface needs to be implemened: -    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">public interface AuthenticationPlugIn&lt;T extends Credential&gt; {
    Identity&lt;T&gt; loadIdentity(final String userName, final String realm) throws IOException;
}</pre>
        </div>
    </div>
    <p>
During the authentication process this method will be called with the user name supplied by the remote user and the name of the realm they are authenticating against, this method call represents that an authentication attempt is occurring but it is the Identity instance that is returned that will be used for the actual authentication to verify the remote user.    </p>
    <p>
The Identity interface is also an interface you will implement: -    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">public interface Identity&lt;T extends Credential&gt; {
    String getUserName();
    T getCredential();
}</pre>
        </div>
    </div>
    <p>
Additional information can be contained within the Identity implementation although it will not currently be used, the key piece of information here is the Credential that will be returned - this needs to be one of the following: -    </p>
    <div class="section-4"  id="80873170_SecurityRealms-PasswordCredential"  >
        <h4>PasswordCredential</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">public final class PasswordCredential implements Credential {
    public PasswordCredential(final char[] password);
    public char[] getPassword();
    void clear();
}</pre>
        </div>
    </div>
    <p>
The <tt class=" ">PasswordCredential</tt> is already implemented so use this class if you have the plain text password of the remote user, by using this the secured interfaces will be able to continue using the Digest mechanism for authentication.    </p>
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-DigestCredential"  >
        <h4>DigestCredential</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">public final class DigestCredential implements Credential {
    public DigestCredential(final String hash);
    public String getHash();
}</pre>
        </div>
    </div>
    <p>
This class is also already implemented and should be returned if instead of the plain text password you already have a pre-prepared hash of the username, realm and password.    </p>
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-ValidatePasswordCredential"  >
        <h4>ValidatePasswordCredential</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">public interface ValidatePasswordCredential extends Credential {
    boolean validatePassword(final char[] password);
}</pre>
        </div>
    </div>
    <p>
This is a special Credential type to use when it is not possible to obtain either a plain text representation of the password or a pre-prepared hash - this is an interface as you will need to provide an implementation to verify a supplied password.  The down side of using this type of Credential is that the authentication mechanism used at the transport level will need to drop down from Digest to either HTTP Basic or SASL Plain which will now mean that the remote client is sending their credential across the network in the clear.    </p>
    <p>
If you use this type of credential be sure to force the mechanism choice to Plain as described in the configuration section below.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-AuthorizationPlugIn"  >
        <h3>AuthorizationPlugIn</h3>
    
    <p>
If you are implementing a custom mechanism to load a users roles you need to implement the <tt class=" ">AuthorizationPlugIn</tt>    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">public interface AuthorizationPlugIn {
    String[] loadRoles(final String userName, final String realm) throws IOException;
}</pre>
        </div>
    </div>
    <p>
As with the <tt class=" ">AuthenticationPlugIn</tt> this has a single method that takes a users userName and realm - the return type is an array of Strings with each entry representing a role the user is a member of.    </p>
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-PlugInConfigurationSupport"  >
        <h3>PlugInConfigurationSupport</h3>
    
    <p>
In addition to the specific interfaces above there is an additional interface that a plug-in can implement to receive configuration information before the plug-in is used and also to receive a Map instance that can be used to share state between the plug-in instance used for the authentication step of the call and the plug-in instance used for the authorization step.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">public interface PlugInConfigurationSupport {
    void init(final Map&lt;String, String&gt; configuration, final Map&lt;String, Object&gt; sharedState) throws IOException;
}</pre>
        </div>
    </div>
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-InstallingandConfiguringaPlugIn"  >
        <h3>Installing and Configuring a Plug-In</h3>
    
    <p>
The next step of this article describes the steps to implement a plug-in provider and how to make it available within WildFly 8&nbsp;and how to configure it.  Example configuration and an example implementation are shown to illustrate this.    </p>
    <p>
The following is an example security realm definition which will be used to illustrate this: -    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;security-realm name=&quot;PlugInRealm&quot;&gt;
   &lt;plug-ins&gt;
      &lt;plug-in module=&quot;org.jboss.as.sample.plugin&quot;/&gt;
   &lt;/plug-ins&gt;
   &lt;authentication&gt;
      &lt;plug-in name=&quot;Sample&quot;&gt;
         &lt;properties&gt;
            &lt;property name=&quot;darranl.password&quot; value=&quot;dpd&quot;/&gt;
            &lt;property name=&quot;darranl.roles&quot; value=&quot;Admin,Banker,User&quot;/&gt;
         &lt;/properties&gt;
      &lt;/plug-in&gt;
   &lt;/authentication&gt;
   &lt;authorization&gt;
      &lt;plug-in name=&quot;Delegate&quot; /&gt;
   &lt;/authorization&gt;
&lt;/security-realm&gt;</pre>
        </div>
    </div>
    <p>
Before looking closely at the packaging and configuration there is one more interface to implement and that is the <tt class=" ">PlugInProvider</tt> interface, that interface is responsible for making PlugIn instances available at runtime to handle the requests.    </p>
    <div class="section-4"  id="80873170_SecurityRealms-PlugInProvider"  >
        <h4>PlugInProvider</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">public interface PlugInProvider {
    AuthenticationPlugIn&lt;Credential&gt; loadAuthenticationPlugIn(final String name);
    AuthorizationPlugIn loadAuthorizationPlugIn(final String name);
}</pre>
        </div>
    </div>
    <p>
These methods are called with the name that is supplied in the plug-in elements that are contained within the authentication and authorization elements of the configuration, based on the sample configuration above the loadAuthenticationPlugIn method will be called with a parameter of 'Sample' and the loadAuthorizationPlugIn method will be called with a parameter of 'Delegate'.    </p>
    <p>
Multiple plug-in providers may be available to the application server so if a <tt class=" ">PlugInProvider</tt> implementation does not recognise a name then it should just return null and the server will continue searching the other providers.  If a <tt class=" ">PlugInProvider</tt> does recognise a name but fails to instantiate the PlugIn then a <tt class=" ">RuntimeException</tt> can be thrown to indicate the failure.    </p>
    <p>
As a server could have many providers registered it is recommended that a naming convention including some form of hierarchy is used e.g. use package style names to avoid conflicts.    </p>
    <p>
For the example the implementation is as follows: -    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">public class SamplePluginProvider implements PlugInProvider {

    public AuthenticationPlugIn&lt;Credential&gt; loadAuthenticationPlugIn(String name) {
        if (&quot;Sample&quot;.equals(name)) {
            return new SampleAuthenticationPlugIn();
        }
        return null;
    }

    public AuthorizationPlugIn loadAuthorizationPlugIn(String name) {
        if (&quot;Sample&quot;.equals(name)) {
            return new SampleAuthenticationPlugIn();
        } else if (&quot;Delegate&quot;.equals(name)) {
            return new DelegateAuthorizationPlugIn();
        }
        return null;
    }
}</pre>
        </div>
    </div>
    <p>
The load methods are called for each authentication attempt but it will be an implementation detail of the provider if it decides to return a new instance of the provider each time - in this scenario as we also use configuration and shared state then new instances of the implementations make sense.    </p>
    <p>
To load the provider use a ServiceLoader so within the META-INF/services folder of the jar this project adds a file called '<tt class=" ">org.jboss.as.domain.management.plugin.PlugInProvider</tt>' - this contains a single entry which is the fully qualified class name of the PlugInProvider implementation class.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">org.jboss.as.sample.SamplePluginProvider</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-PackageasaModule"  >
        <h4>Package as a Module</h4>
    
    <p>
To make the <tt class=" ">PlugInProvider</tt> available to the application it is bundled as a module and added to the modules already shipped with WildFly 8.    </p>
    <p>
To add as a module we first need a <tt class=" ">module.xml</tt>: -    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;module xmlns=&quot;urn:jboss:module:1.1&quot; name=&quot;org.jboss.as.sample.plugin&quot;&gt;
    &lt;properties&gt;
    &lt;/properties&gt;

    &lt;resources&gt;
        &lt;resource-root path=&quot;SamplePlugIn.jar&quot;/&gt;
    &lt;/resources&gt;

    &lt;dependencies&gt;
        &lt;module name=&quot;org.jboss.as.domain-management&quot; /&gt;
    &lt;/dependencies&gt;
&lt;/module&gt;</pre>
        </div>
    </div>
    <p>
The interfaces being implemented are in the '<tt class=" ">org.jboss.as.domain-management</tt>' module so a dependency on that module is defined, this <tt class=" ">module.xml</tt> is then placed in the '{<tt class=" ">jboss.home}/modules/org/jboss/as/sample/plugin/main</tt>'.    </p>
    <p>
The compiled classed and <tt class=" ">META-INF/services</tt> as described above are assembled into a jar called <tt class=" ">SamplePlugIn.jar</tt> and also placed into this folder.    </p>
    <p>
Looking back at the sample configuration at the top of the realm definition the following element was added: -    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">   &lt;plug-ins&gt;
      &lt;plug-in module=&quot;org.jboss.as.sample.plugin&quot;/&gt;
   &lt;/plug-ins&gt;</pre>
        </div>
    </div>
    <p>
This element is used to list the modules that should be searched for plug-ins.  As plug-ins are loaded during the server start up this search is a lazy search so don't expect a definition to a non existant module or to a module that does not contain a plug-in to report an error.    </p>
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-TheAuthenticationPlugIn"  >
        <h4>The AuthenticationPlugIn</h4>
    
    <p>
The example <tt class=" ">AuthenticationPlugIn</tt> is implemented as: -    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">public class SampleAuthenticationPlugIn extends AbstractPlugIn {

    private static final String PASSWORD_SUFFIX = &quot;.password&quot;;
    private static final String ROLES_SUFFIX = &quot;.roles&quot;;
    private Map&lt;String, String&gt; configuration;

    public void init(Map&lt;String, String&gt; configuration, Map&lt;String, Object&gt; sharedState) throws IOException {
        this.configuration = configuration;
        // This will allow an AuthorizationPlugIn to delegate back to this instance.
        sharedState.put(AuthorizationPlugIn.class.getName(), this);
    }

    public Identity loadIdentity(String userName, String realm) throws IOException {
        String passwordKey = userName + PASSWORD_SUFFIX;
        if (configuration.containsKey(passwordKey)) {
            return new SampleIdentity(userName, configuration.get(passwordKey));
        }
        throw new IOException(&quot;Identity not found.&quot;);
    }

    public String[] loadRoles(String userName, String realm) throws IOException {
        String rolesKey = userName + ROLES_SUFFIX;
        if (configuration.containsKey(rolesKey)) {
            String roles = configuration.get(rolesKey);
            return roles.split(&quot;,&quot;);
        } else {
            return new String[0];
        }
    }

    private static class SampleIdentity implements Identity {
        private final String userName;
        private final Credential credential;

        private SampleIdentity(final String userName, final String password) {
            this.userName = userName;
            this.credential = new PasswordCredential(password.toCharArray());
        }

        public String getUserName() {
            return userName;
        }

        public Credential getCredential() {
            return credential;
        }
    }
}</pre>
        </div>
    </div>
    <p>
As you can see from this implementation there is also an additional class being extended <tt class=" ">AbstractPlugIn</tt> - that is simply an abstract class that implements the <tt class=" ">AuthenticationPlugIn</tt>, <tt class=" ">AuthorizationPlugIn</tt>, and <tt class=" ">PlugInConfigurationSupport</tt> interfaces already.  The properties that were defined in the configuration are passed in as a Map and importantly for this sample the plug-in adds itself to the shared state map.    </p>
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-TheAuthorizationPlugIn"  >
        <h4>The AuthorizationPlugIn</h4>
    
    <p>
The example implementation of the authentication plug in is as follows: -    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">public class DelegateAuthorizationPlugIn extends AbstractPlugIn {

    private AuthorizationPlugIn authorizationPlugIn;

    public void init(Map&lt;String, String&gt; configuration, Map&lt;String, Object&gt; sharedState) throws IOException {
        authorizationPlugIn = (AuthorizationPlugIn) sharedState.get(AuthorizationPlugIn.class.getName());
    }

    public String[] loadRoles(String userName, String realm) throws IOException {
        return authorizationPlugIn.loadRoles(userName, realm);
    }

}</pre>
        </div>
    </div>
    <p>
This plug-in illustrates how two plug-ins can work together, by the <tt class=" ">AuthenticationPlugIn</tt> placing itself in the shared state map it is possible for the authorization plug-in to make use of it for the loadRoles implementation.    </p>
    <p>
Another option to consider to achieve similar behaviour could be to provide an Identity implementation that also contains the roles and place this in the shared state map - the <tt class=" ">AuthorizationPlugIn</tt> can retrieve this and return the roles.    </p>
    </div>
    
    <div class="section-4"  id="80873170_SecurityRealms-ForcingPlainTextAuthentication"  >
        <h4>Forcing Plain Text Authentication</h4>
    
    <p>
As mentioned earlier in this article if the <tt class=" ">ValidatePasswordCredential</tt> is going to be used then the authentication used at the transport level needs to be forced from Digest authentication to plain text authentication, this can be achieved by adding a mechanism attribute to the plug-in definition within the authentication element i.e.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">  &lt;authentication&gt;
    &lt;plug-in name=&quot;Sample&quot; mechanism=&quot;PLAIN&quot;&gt;</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="80873170_SecurityRealms-ExampleConfigurations"  >
        <h2>Example Configurations</h2>
    
    <p>
This section of the document contains a couple of examples for the most common scenarios likely to be used with the security realms, please feel free to raise Jira issues requesting additional scenarios or if you have configured something not covered here please feel free to add your own examples - this document is editable after all     <img src="images/author/images/icons/emoticons/wink.gif" alt="images/author/images/icons/emoticons/wink.gif" />
    </p>
    <p>
At the moment these examples are making use of the '<tt class=" ">ManagementRealm</tt>' however the same can apply to the '<tt class=" ">ApplicationRealm</tt>' or any custom realm you create for yourselves.    </p>
    <div class="section-3"  id="80873170_SecurityRealms-LDAPAuthentication"  >
        <h3>LDAP Authentication</h3>
    
    <p>
The following example demonstrates an example configuration making use of Active Directory to verify the users username and password.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;management&gt;
  &lt;security-realms&gt;
    &lt;security-realm name=&quot;ManagementRealm&quot;&gt;
      &lt;authentication&gt;
        &lt;ldap connection=&quot;EC2&quot; base-dn=&quot;CN=Users,DC=darranl,DC=jboss,DC=org&quot;&gt;
          &lt;username-filter attribute=&quot;sAMAccountName&quot; /&gt;
        &lt;/ldap&gt;
      &lt;/authentication&gt;
    &lt;/security-realm&gt;

  &lt;/security-realms&gt;

  &lt;outbound-connections&gt;
    &lt;ldap name=&quot;EC2&quot; url=&quot;ldap://127.0.0.1:9797&quot; search-dn=&quot;CN=wf8,CN=Users,DC=darranl,DC=jboss,DC=org&quot; search-credential=&quot;password&quot;/&gt;
  &lt;/outbound-connections&gt;

  ...

&lt;/management&gt;</pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
        
    <p>
For simplicity the <tt class=" ">&lt;local/&gt;</tt> configuration has been removed from this example, however there it is fine to leave that in place for local authentication to remain possible.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-EnableSSL"  >
        <h3>Enable SSL</h3>
    
    <p>
The first step is the creation of the key, by default this is going to be used for both the native management interface and the http management interface - to create the key we can use the <tt class=" ">keyTool</tt>, the following example will create a key valid for one year.    </p>
    <p>
Open a terminal window in the folder {<tt class=" ">jboss.home}/standalone/configuration</tt> and enter the following command: -    </p>
    <p>
<tt class=" ">keytool -genkey -alias server -keyalg RSA -keystore server.keystore -validity 365</tt>    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">Enter keystore password:
Re-enter new password:</pre>
        </div>
    </div>
    <p>
In this example I choose '<tt class=" ">keystore_password</tt>'.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">What is your first and last name?
  [Unknown]:  localhost</pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
        
    <p>
Of all of the questions asked this is the most important and should match the host name that will be entered into the web browser to connect to the admin console.    </p>
    </div>
    
    <p>
Answer the remaining questions as you see fit and at the end for the purpose of this example I set the key password to '<tt class=" ">key_password</tt>'.    </p>
    <p>
The following example shows how this newly created keystore will be referenced to enable SSL.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;security-realm name=&quot;ManagementRealm&quot;&gt;
  &lt;server-identities&gt;
    &lt;ssl&gt;
      &lt;keystore path=&quot;server.keystore&quot; relative-to=&quot;jboss.server.config.dir&quot; keystore-password=&quot;keystore_password&quot; alias=&quot;server&quot; key-password=&quot;key_password&quot; /&gt;
    &lt;/ssl&gt;
  &lt;/server-identities&gt;
  &lt;authentication&gt;
    ...
  &lt;/authentication&gt;
&lt;/security-realm&gt;</pre>
        </div>
    </div>
    <p>
The contents of the <tt class=" ">&lt;authentication /&gt;</tt> have not been changed in this example so authentication still occurs using either the local mechanism or username/password authentication using Digest.    </p>
    </div>
    
    <div class="section-3"  id="80873170_SecurityRealms-AddClientCerttoSSL"  >
        <h3>Add Client-Cert to SSL</h3>
    
    <p>
To enable Client-Cert style authentication we just now need to add a <tt class=" ">&lt;truststore /&gt;</tt> element to the <tt class=" ">&lt;authentication /&gt;</tt> element referencing a trust store that has had the certificates or trusted clients imported.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;security-realm name=&quot;ManagementRealm&quot;&gt;
  &lt;server-identities&gt;
    &lt;ssl&gt;
      &lt;keystore path=&quot;server.keystore&quot; relative-to=&quot;jboss.server.config.dir&quot; keystore-password=&quot;keystore_password&quot; alias=&quot;server&quot; key-password=&quot;key_password&quot; /&gt;
    &lt;/ssl&gt;
  &lt;/server-identities&gt;
  &lt;authentication&gt;
    &lt;truststore path=&quot;server.truststore&quot; relative-to=&quot;jboss.server.config.dir&quot; keystore-password=&quot;truststore_password&quot; /&gt;
    &lt;local default-user=&quot;$local&quot;/&gt;
    &lt;properties path=&quot;mgmt-users.properties&quot; relative-to=&quot;jboss.server.config.dir&quot;/&gt;
  &lt;/authentication&gt;
&lt;/security-realm&gt;</pre>
        </div>
    </div>
    <p>
In this scenario if Client-Cert authentication does not occur clients can fall back to use either the local mechanism or username/password authentication.  To make Client-Cert based authentication mandatory just remove the <tt class=" ">&lt;local /&gt;</tt> and <tt class=" ">&lt;properties /&gt;</tt> elements.    </p>
    </div>
    
    </div>
    
        </div>
              <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="previous"><a accesskey="p" href="RBAC.html"><strong>Prev</strong>RBAC</a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li>
          <li class="home"><a accesskey="h" href="Documentation.html"><strong>Front page</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <li class="next"><a accesskey="n" href="add-user_utility.html"><strong>Next</strong>user utility</a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </ul>
          </div>
    <script type="text/javascript">
      SyntaxHighlighter.all()
    </script>
</body>
</html>
