<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Before you add a test - WildFly 9</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
    <meta content="Scroll Wiki Publisher" name="generator"/>

    <link type="text/css" rel="stylesheet" href="css/blueprint/liquid.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/blueprint/print.css" media="print"/>
    <!--[if lt IE 8]><link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection"/><![endif]-->

    <link type="text/css" rel="stylesheet" href="css/content-style.css" media="screen, projection, print"/>
    <link type="text/css" rel="stylesheet" href="css/screen.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/print.css" media="print"/>
    
    <link type="text/css" rel="stylesheet" href="css/jbossorg.css"/>
    <link type="text/css" rel="stylesheet" href="css/docnav.css"/>    
    
    <link type="text/css" rel="stylesheet" href="sh/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="sh/shCoreDefault.css"/>
    <script type="text/javascript" src="sh/shCore.js"></script>
    <script type="text/javascript" src="sh/shBrushAppleScript.js"></script>
    <script type="text/javascript" src="sh/shBrushAS3.js"></script>
    <script type="text/javascript" src="sh/shBrushBash.js"></script>
    <script type="text/javascript" src="sh/shBrushCpp.js"></script>
    <script type="text/javascript" src="sh/shBrushCSharp.js"></script>
    <script type="text/javascript" src="sh/shBrushCss.js"></script>
    <script type="text/javascript" src="sh/shBrushDiff.js"></script>
    <script type="text/javascript" src="sh/shBrushErlang.js"></script>
    <script type="text/javascript" src="sh/shBrushGroovy.js"></script>
    <script type="text/javascript" src="sh/shBrushJava.js"></script>
    <script type="text/javascript" src="sh/shBrushJavaFX.js"></script>
    <script type="text/javascript" src="sh/shBrushJScript.js"></script>
    <script type="text/javascript" src="sh/shBrushPerl.js"></script>
    <script type="text/javascript" src="sh/shBrushPhp.js"></script>
    <script type="text/javascript" src="sh/shBrushPlain.js"></script>
    <script type="text/javascript" src="sh/shBrushPython.js"></script>
    <script type="text/javascript" src="sh/shBrushRuby.js"></script>
    <script type="text/javascript" src="sh/shBrushScala.js"></script>
    <script type="text/javascript" src="sh/shBrushSql.js"></script>
    <script type="text/javascript" src="sh/shBrushVb.js"></script>
    <script type="text/javascript" src="sh/shBrushXml.js"></script>
    
</head>
<body>
    <div class="container" style="min-width: 760px;">
        <div class="block header">
          <p id="title">
            <a class="site_href" href="http://www.jboss.org"><strong>JBoss.org</strong></a>
            <a class="doc_href" href="http://docs.jboss.org"><strong>Community Documentation</strong></a>
          </p>
                  <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </ul>
                    <div>
            <h1>Before you add a test</h1>
          </div>          
          </div>

        <div class="block content">
    <p>
Every added test, whether ported or new should follow the same guidelines:    </p>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-VerifythetestbelongsinWildFly8"  >Verify the test belongs in WildFly 8</h5>
    </p>
</li></ul>    <p>
AS6 has a lot of tests for things that are discontinued. For example the<br/>legacy JBoss Transaction Manager which was replaced by Arjuna. Also we<br/>had tests for SPIs that no longer exist. None of these things should be<br/>migrated.    </p>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-OnlyaddCORRECTandUNDERSTANDABLEtests"  >Only add CORRECT and UNDERSTANDABLE tests</h5>
    </p>
</li></ul>    <p>
If you don't understand what a test is doing (perhaps too complex), or<br/>it's going about things in a strange way that might not be correct, THEN<br/>DO NOT PORT IT. Instead we should have a simpler, understandable, and<br/>correct test. Write a new one, ping the author, or skip it altogether.    </p>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Donotaddduplicatetests"  >Do not add duplicate tests</h5>
    </p>
</li></ul>    <p>
Always check that the test you are adding doesn't have coverage<br/>elsewhere (try using &quot;git grep&quot;). As mentioned above we have some<br/>overlap between 6 and 7. The 7 test version will likely be better.    </p>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Don%27tnametestsafterJIRAs"  >Don&apos;t name tests after JIRAs</h5>
    </p>
</li></ul>    <p>
A JIRA number is useless without an internet connection, and they are<br/>hard to read. If I get a test failure thats XDGR-843534578 I have to dig<br/>to figure out the context. It's perfectly fine though to link to a JIRA<br/>number in the comments of the test. Also the commit log is always available.    </p>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Testsshouldcontainjavadocthatexplainswhatisbeingtested"  >Tests should contain javadoc that explains what is being tested</h5>
    </p>
</li></ul>    <p>
This is especially critical if the test is non-trivial    </p>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-PreferexpandinganEXISTINGtestoveranewtestclass"  >Prefer expanding an EXISTING test over a new test class</h5>
    </p>
</li></ul>    <p>
If you are looking at migrating or creating a test with similar<br/>functionality to an exiting test, it is better to<br/>expand upon the existing one by adding more test methods, rather than<br/>creating a whole new test. In general each<br/>new test class adds at least 300ms to execution time, so as long as it<br/>makes sense it is better to add it to an<br/>existing test case.    </p>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Organizetestsbysubsystem"  >Organize tests by subsystem</h5>
    </p>
</li></ul>    <p>
Integration tests should be packaged in subpackages under the relevant<br/>subsystem (e.g org.jboss.as.test.integration.ejb.async). When a test<br/>impacts multiple subsystems this is a bit of a judgement call, but in<br/>general the tests should go into the package of<br/>the spec that defines the functionality (e.g. CDI based constructor<br/>injection into an EJB, even though this involves CDI and EJB,<br/>the CDI spec defines this behaviour)    </p>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Explainnonobviousspecbehaviorincomments"  >Explain non-obvious spec behavior in comments</h5>
    </p>
</li></ul>    <p>
The EE spec is full of odd requirements. If the test is covering<br/>behavior that is not obvious then please add something like &quot;Verifies EE<br/>X.T.Z - The widget can't have a foobar if it is declared like blah&quot;    </p>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Putintegrationtestresourcesinthesourcedirectoryofthetest"  >Put integration test resources in the source directory of the test</h5>
    </p>
</li></ul>    <p>
At the moment there is not real organization of these files. It makes<br/>sense for most apps to have this separation, however the testsuite is<br/>different. e.g. most apps will have a single deployment descriptor of a<br/>given type, for the testsuite will have hundreds, and maintaining mirroring<br/>package structures is error prone.<br/>This also makes the tests easier to understand, as all the artifacts in<br/>the deployment are in one place, and that place tends to be small (only<br/>a handful of files).    </p>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Donothardcodevalueslikelytoneedconfiguration%28URLs%2Cports%2C...%29"  >Do not hard-code values likely to need configuration (URLs, ports, ...)</h5>
    </p>
</li></ul>    <p>
URLs hardcoded to certain address (localhost) or port (like the default 8080 for web) prevent running the test against different address or with IPv6 adress.<br/>Always use the configurable values provided by Arquillian or as a system property.<br/>If you come across a value which is not configurable but you think it should be, file an WildFly 8 jira issue with component &quot;Test suite&quot;.<br/>See <a href="https://github.com/arquillian/arquillian/blob/master/examples/junit/src/test/java/com/acme/web/LocalRunServletTestCase.java">@ArquillianResourrce usage example</a>.    </p>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Followbestcommittingpractices"  >Follow best committing practices</h5>
    </p>
<ul class=" "><li class=" ">    <p>
Only do changes related to the topic of the jira/pull request.    </p>
</li><li class=" ">    <p>
Do not clutter your pull request with e.g. reformatting, fixing typos spotted along the way - do another pull request for such.    </p>
</li><li class=" ">    <p>
Prefer smaller changes in more pull request over one big pull request which are difficult to merge.    </p>
</li><li class=" ">    <p>
Keep the code consistent across commits - e.g. when renaming something, be sure to update all references to it.    </p>
</li><li class=" ">    <p>
Describe your commits properly as they will appear in master's linear history.    </p>
</li><li class=" ">    <p>
If you're working on a jira issue, include it's ID in the commit message(s).    </p>
</li></ul></li></ul><ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Donotuseblindtimeouts"  >Do not use blind timeouts</h5>
    </p>
</li></ul>    <p>
Do not use Thread.sleep() without checking for the actual condition you need to be fulfilled.<br/>You may use active waiting with a timeout, but prefer using timeouts of the API/SPI you test where available.    </p>
    <p>
Make the timeouts configurable: For a group of similar test, use a configurable timeout value with a default if not set.    </p>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Providemessagesinassert%28%29andfail%28%29calls"  >Provide messages in assert*() and fail() calls</h5>
    </p>
</li></ul>    <p>
Definitely, it's better to see&nbsp; &quot;File x/y/z.xml not found&quot; instead of:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">junit.framework.AssertionFailedError
     at junit.framework.Assert.fail(Assert.java:48) [arquillian-service:]
     at junit.framework.Assert.assertTrue(Assert.java:20) [arquillian-service:]
     at junit.framework.Assert.assertTrue(Assert.java:27) [arquillian-service:]
     at org.jboss.as.test.smoke.embedded.parse.ParseAndMarshalModelsTestCase.getOriginalStandaloneXml(ParseAndMarshalModelsTestCase.java:554) [bogus.jar:]</pre>
        </div>
    </div>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Provideconfigurationpropertieshintsinexceptions"  >Provide configuration properties hints in exceptions</h5>
    </p>
</li></ul>    <p>
If your test uses some configuration property and it fails possibly due to misconfiguration, note the property and it's value in the exception:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">File jdbcJar = new File( System.getProperty(&quot;jbossas.ts.dir&quot;, &quot;.&quot;),
       &quot;integration/src/test/resources/mysql-connector-java-5.1.15.jar&quot;);
    if( !jdbcJar.exists() )
        throw new IllegalStateException(&quot;Can't find &quot; + jdbcJar + &quot; using $\{jbossas.ts.dir} == &quot; + System.getProperty(&quot;jbossas.ts.dir&quot;) );</pre>
        </div>
    </div>
<ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Cleanup"  >Clean up</h5>
    </p>
</li></ul><ul class=" "><li class=" "><ul class=" "><li class=" ">    <p>
Close sockets, connections, file descriptors;    </p>
</li><li class=" ">    <p>
Don't put much data to static fields, or clean them in a finaly {...} block.    </p>
</li><li class=" ">    <p>
Don't alter AS config (unless you are absolutely sure that it will reload in a final {...} block or an @After* method)    </p>
</li></ul></li></ul><ul class=" "><li class=" ">    <p>
    <h5  id="80873464_Pre-requisites-testqualitystandards-Keepthetestsconfigurable"  >Keep the tests configurable</h5>
    </p>
    <p>
Keep these things in properties, set them at the beginning of the test:    </p>
<ul class=" "><li class=" ">    <p>
Timeouts    </p>
</li><li class=" ">    <p>
Paths    </p>
</li><li class=" ">    <p>
URLs    </p>
</li><li class=" ">    <p>
Numbers (of whatever)    </p>
</li></ul></li></ul>    <p>
They either will be or already are provided in form of system properties, or a simple testsuite until API (soon to come).    </p>
        </div>
              <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li>
          <li class="home"><a accesskey="h" href="Documentation.html"><strong>Front page</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </ul>
          </div>
    <script type="text/javascript">
      SyntaxHighlighter.all()
    </script>
</body>
</html>
