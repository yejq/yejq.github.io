<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>OnBehalfOf WS-Trust Scenario - WildFly 9</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
    <meta content="Scroll Wiki Publisher" name="generator"/>

    <link type="text/css" rel="stylesheet" href="css/blueprint/liquid.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/blueprint/print.css" media="print"/>
    <!--[if lt IE 8]><link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection"/><![endif]-->

    <link type="text/css" rel="stylesheet" href="css/content-style.css" media="screen, projection, print"/>
    <link type="text/css" rel="stylesheet" href="css/screen.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/print.css" media="print"/>
    
    <link type="text/css" rel="stylesheet" href="css/jbossorg.css"/>
    <link type="text/css" rel="stylesheet" href="css/docnav.css"/>    
    
    <link type="text/css" rel="stylesheet" href="sh/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="sh/shCoreDefault.css"/>
    <script type="text/javascript" src="sh/shCore.js"></script>
    <script type="text/javascript" src="sh/shBrushAppleScript.js"></script>
    <script type="text/javascript" src="sh/shBrushAS3.js"></script>
    <script type="text/javascript" src="sh/shBrushBash.js"></script>
    <script type="text/javascript" src="sh/shBrushCpp.js"></script>
    <script type="text/javascript" src="sh/shBrushCSharp.js"></script>
    <script type="text/javascript" src="sh/shBrushCss.js"></script>
    <script type="text/javascript" src="sh/shBrushDiff.js"></script>
    <script type="text/javascript" src="sh/shBrushErlang.js"></script>
    <script type="text/javascript" src="sh/shBrushGroovy.js"></script>
    <script type="text/javascript" src="sh/shBrushJava.js"></script>
    <script type="text/javascript" src="sh/shBrushJavaFX.js"></script>
    <script type="text/javascript" src="sh/shBrushJScript.js"></script>
    <script type="text/javascript" src="sh/shBrushPerl.js"></script>
    <script type="text/javascript" src="sh/shBrushPhp.js"></script>
    <script type="text/javascript" src="sh/shBrushPlain.js"></script>
    <script type="text/javascript" src="sh/shBrushPython.js"></script>
    <script type="text/javascript" src="sh/shBrushRuby.js"></script>
    <script type="text/javascript" src="sh/shBrushScala.js"></script>
    <script type="text/javascript" src="sh/shBrushSql.js"></script>
    <script type="text/javascript" src="sh/shBrushVb.js"></script>
    <script type="text/javascript" src="sh/shBrushXml.js"></script>
    
</head>
<body>
    <div class="container" style="min-width: 760px;">
        <div class="block header">
          <p id="title">
            <a class="site_href" href="http://www.jboss.org"><strong>JBoss.org</strong></a>
            <a class="doc_href" href="http://docs.jboss.org"><strong>Community Documentation</strong></a>
          </p>
                  <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <li class="previous"><a accesskey="p" href="ActAs_WS-Trust_Scenario.html"><strong>Prev</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="next"><a accesskey="n" href="SAML_Bearer_Assertion_Scenario.html"><strong>Next</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </ul>
                    <div>
            <h1>OnBehalfOf WS-Trust Scenario</h1>
          </div>          
          </div>

        <div class="block content">
<ul class=" "><li class=" ">    <p>
<a href="OnBehalfOf_WS-Trust_Scenario.html#90439851_OnBehalfOfWS-TrustScenario-OnBehalfOfWSTrustScenario">OnBehalfOf WS-Trust Scenario</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="OnBehalfOf_WS-Trust_Scenario.html#90439851_OnBehalfOfWS-TrustScenario-Webserviceprovider">Web service provider</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="OnBehalfOf_WS-Trust_Scenario.html#90439851_OnBehalfOfWS-TrustScenario-WebserviceproviderWSDL">Web service provider WSDL</a>    </p>
</li><li class=" ">    <p>
<a href="OnBehalfOf_WS-Trust_Scenario.html#90439851_OnBehalfOfWS-TrustScenario-WebServiceInterface">Web Service Interface</a>    </p>
</li><li class=" ">    <p>
<a href="OnBehalfOf_WS-Trust_Scenario.html#90439851_OnBehalfOfWS-TrustScenario-WebServiceImplementation">Web Service Implementation</a>    </p>
</li><li class=" ">    <p>
<a href="OnBehalfOf_WS-Trust_Scenario.html#90439851_OnBehalfOfWS-TrustScenario-OnBehalfOfCallbackHandler">OnBehalfOfCallbackHandler</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="OnBehalfOf_WS-Trust_Scenario.html#90439851_OnBehalfOfWS-TrustScenario-Webservicerequester">Web service requester</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="OnBehalfOf_WS-Trust_Scenario.html#90439851_OnBehalfOfWS-TrustScenario-WebservicerequesterImplementation">Web service requester Implementation</a>    </p>
</li></ul></li></ul></li></ul>    <div class="section-2"  id="90439851_OnBehalfOfWS-TrustScenario-OnBehalfOfWSTrustScenario"  >
        <h2>OnBehalfOf WS-Trust Scenario</h2>
    
    <p>
The OnBehalfOf feature is used in scenarios that use the proxy  pattern.&nbsp; In such scenarios, the client cannot access the STS directly,  instead it communicates through a proxy gateway. The proxy gateway  authenticates the caller and puts information about the caller into the  OnBehalfOf element of the RequestSecurityToken (RST) sent to the real  STS for processing. The resulting token contains only claims related to  the client of the proxy, making the proxy completely transparent to the  receiver of the issued token.    </p>
    <p>
OnBehalfOf  is nothing more than a new sub-element in the RST.&nbsp; It provides  additional information about the original caller when a token is  negotiated with the STS.&nbsp; The OnBehalfOf element usually takes the form  of a token with identity claims such as name, role, and authorization  code, for the client to access the service.    </p>
    <p>
The OnBehalfOf scenario is an extension of <a href="OnBehalfOf_WS-Trust_Scenario.html#90439851_OnBehalfOfWS-TrustScenario-ABasicWSTrustScenario">the basic WS-Trust scenario</a>.&nbsp;  In this example the OnBehalfOf service calls the ws-service on behalf  of a user.&nbsp; There are only a couple of additions to the basic scenario's  code.&nbsp; An OnBehalfOf web service provider and callback handler have  been added.&nbsp; The OnBehalfOf web services' WSDL&nbsp; imposes the same  security policies as the ws-provider. UsernameTokenCallbackHandler is a  utility shared with ActAs.&nbsp; It generates the content for the OnBehalfOf  element.&nbsp; And lastly there are code additions in the STS that both  OnBehalfOf and ActAs share in common.    </p>
    <p>
Infor here [<a href="http://coheigea.blogspot.it/2012/01/apache-cxf-251-sts-updates.html">Open Source Security: Apache CXF 2.5.1 STS updates</a> ]    </p>
    <div class="section-3"  id="90439851_OnBehalfOfWS-TrustScenario-Webserviceprovider"  >
        <h3>Web service provider</h3>
    
    <p>
This section examines the web service elements from the basic  WS-Trust scenario that have been changed to address the needs of the  OnBehalfOf example.&nbsp; The components are.    </p>
<ul class=" "><li class=" ">    <p>
web service provider's WSDL    </p>
</li><li class=" ">    <p>
web service provider's Interface and Implementation classes.    </p>
</li><li class=" ">    <p>
OnBehalfOfCallbackHandler class    </p>
</li></ul>    <div class="section-4"  id="90439851_OnBehalfOfWS-TrustScenario-WebserviceproviderWSDL"  >
        <h4>Web service provider WSDL</h4>
    
    <p>
The OnBehalfOf web service provider's WSDL is a clone of the  ws-provider's WSDL.&nbsp; The wsp:Policy section is the same. There are&nbsp;  changes to the service endpoint,&nbsp; targetNamespace, portType, binding  name, and service.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;definitions targetNamespace=&quot;http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy&quot; name=&quot;OnBehalfOfService&quot;
             xmlns:tns=&quot;http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy&quot;
             xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;
             xmlns:soap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot;
             xmlns=&quot;http://schemas.xmlsoap.org/wsdl/&quot;
             xmlns:wsp=&quot;http://www.w3.org/ns/ws-policy&quot;
             xmlns:wsam=&quot;http://www.w3.org/2007/05/addressing/metadata&quot;
             xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;
             xmlns:wsaws=&quot;http://www.w3.org/2005/08/addressing&quot;
             xmlns:sp=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702&quot;
             xmlns:t=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512&quot;&gt;
    &lt;types&gt;
        &lt;xsd:schema&gt;
            &lt;xsd:import namespace=&quot;http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy&quot;
                  schemaLocation=&quot;OnBehalfOfService_schema1.xsd&quot;/&gt;
        &lt;/xsd:schema&gt;
    &lt;/types&gt;
    &lt;message name=&quot;sayHello&quot;&gt;
        &lt;part name=&quot;parameters&quot; element=&quot;tns:sayHello&quot;/&gt;
    &lt;/message&gt;
    &lt;message name=&quot;sayHelloResponse&quot;&gt;
        &lt;part name=&quot;parameters&quot; element=&quot;tns:sayHelloResponse&quot;/&gt;
    &lt;/message&gt;
    &lt;portType name=&quot;OnBehalfOfServiceIface&quot;&gt;
        &lt;operation name=&quot;sayHello&quot;&gt;
            &lt;input message=&quot;tns:sayHello&quot;/&gt;
            &lt;output message=&quot;tns:sayHelloResponse&quot;/&gt;
        &lt;/operation&gt;
    &lt;/portType&gt;
    &lt;binding name=&quot;OnBehalfOfServicePortBinding&quot; type=&quot;tns:OnBehalfOfServiceIface&quot;&gt;
        &lt;wsp:PolicyReference URI=&quot;#AsymmetricSAML2Policy&quot; /&gt;
        &lt;soap:binding transport=&quot;http://schemas.xmlsoap.org/soap/http&quot; style=&quot;document&quot;/&gt;
        &lt;operation name=&quot;sayHello&quot;&gt;
            &lt;soap:operation soapAction=&quot;&quot;/&gt;
            &lt;input&gt;
                &lt;soap:body use=&quot;literal&quot;/&gt;
                &lt;wsp:PolicyReference URI=&quot;#Input_Policy&quot; /&gt;
            &lt;/input&gt;
            &lt;output&gt;
                &lt;soap:body use=&quot;literal&quot;/&gt;
                &lt;wsp:PolicyReference URI=&quot;#Output_Policy&quot; /&gt;
            &lt;/output&gt;
        &lt;/operation&gt;
    &lt;/binding&gt;
    &lt;service name=&quot;OnBehalfOfService&quot;&gt;
        &lt;port name=&quot;OnBehalfOfServicePort&quot; binding=&quot;tns:OnBehalfOfServicePortBinding&quot;&gt;
            &lt;soap:address location=&quot;http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-onbehalfof/OnBehalfOfService&quot;/&gt;
        &lt;/port&gt;
    &lt;/service&gt;
&lt;/definitions&gt;</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439851_OnBehalfOfWS-TrustScenario-WebServiceInterface"  >
        <h4>Web Service Interface</h4>
    
    <p>
The web service provider interface class, OnBehalfOfServiceIface, is a simple web service definition.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof;

import javax.jws.WebMethod;
import javax.jws.WebService;

@WebService
(
   targetNamespace = &quot;http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy&quot;
)
public interface OnBehalfOfServiceIface
{
   @WebMethod
   String sayHello();
}</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439851_OnBehalfOfWS-TrustScenario-WebServiceImplementation"  >
        <h4>Web Service Implementation</h4>
    
    <p>
The web service provider implementation class, OnBehalfOfServiceImpl, is a  simple POJO.&nbsp; It uses the standard WebService annotation to define the  service endpoint&nbsp; and two Apache WSS4J annotations, EndpointProperties  and EndpointProperty used for configuring the endpoint for the CXF  runtime.&nbsp;&nbsp; The WSS4J configuration information provided is for WSS4J's  Crypto Merlin implementation.    </p>
    <p>
OnBehalfOfServiceImpl  is calling the ServiceImpl acting on behalf of the user.&nbsp; Method  setupService performs the requisite configuration setup.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof;

import org.apache.cxf.Bus;
import org.apache.cxf.BusFactory;
import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;
import org.apache.cxf.ws.security.SecurityConstants;
import org.apache.cxf.ws.security.trust.STSClient;
import org.jboss.test.ws.jaxws.samples.wsse.policy.trust.service.ServiceIface;
import org.jboss.test.ws.jaxws.samples.wsse.policy.trust.shared.WSTrustAppUtils;

import javax.jws.WebService;
import javax.xml.namespace.QName;
import javax.xml.ws.BindingProvider;
import javax.xml.ws.Service;
import java.net.*;
import java.util.Map;

@WebService
(
   portName = &quot;OnBehalfOfServicePort&quot;,
   serviceName = &quot;OnBehalfOfService&quot;,
   wsdlLocation = &quot;WEB-INF/wsdl/OnBehalfOfService.wsdl&quot;,
   targetNamespace = &quot;http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy&quot;,
   endpointInterface = &quot;org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof.OnBehalfOfServiceIface&quot;
)

@EndpointProperties(value = {
      @EndpointProperty(key = &quot;ws-security.signature.username&quot;, value = &quot;myactaskey&quot;),
      @EndpointProperty(key = &quot;ws-security.signature.properties&quot;, value =  &quot;actasKeystore.properties&quot;),
      @EndpointProperty(key = &quot;ws-security.encryption.properties&quot;, value = &quot;actasKeystore.properties&quot;),
      @EndpointProperty(key = &quot;ws-security.callback-handler&quot;, value = &quot;org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof.OnBehalfOfCallbackHandler&quot;)
})

public class OnBehalfOfServiceImpl implements OnBehalfOfServiceIface
{
   public String sayHello() {
      try {

         ServiceIface proxy = setupService();
         return &quot;OnBehalfOf &quot; + proxy.sayHello();

      } catch (MalformedURLException e) {
         e.printStackTrace();
      }
      return null;
   }

   /**
    *
    * @return
    * @throws MalformedURLException
    */
   private  ServiceIface setupService()throws MalformedURLException {
      ServiceIface proxy = null;
      Bus bus = BusFactory.newInstance().createBus();

      try {
         BusFactory.setThreadDefaultBus(bus);

         final String serviceURL = &quot;http://&quot; + WSTrustAppUtils.getServerHost() + &quot;:8080/jaxws-samples-wsse-policy-trust/SecurityService&quot;;
         final QName serviceName = new QName(&quot;http://www.jboss.org/jbossws/ws-extensions/wssecuritypolicy&quot;, &quot;SecurityService&quot;);
         final URL wsdlURL = new URL(serviceURL + &quot;?wsdl&quot;);
         Service service = Service.create(wsdlURL, serviceName);
         proxy = (ServiceIface) service.getPort(ServiceIface.class);

         Map&lt;String, Object&gt; ctx = ((BindingProvider) proxy).getRequestContext();
         ctx.put(SecurityConstants.CALLBACK_HANDLER, new OnBehalfOfCallbackHandler());

         ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource(
            &quot;actasKeystore.properties&quot; ));
         ctx.put(SecurityConstants.SIGNATURE_USERNAME, &quot;myactaskey&quot; );
         ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource(
            &quot;../../META-INF/clientKeystore.properties&quot; ));
         ctx.put(SecurityConstants.ENCRYPT_USERNAME, &quot;myservicekey&quot;);

         STSClient stsClient = new STSClient(bus);
         Map&lt;String, Object&gt; props = stsClient.getProperties();
         props.put(SecurityConstants.USERNAME, &quot;bob&quot;);
         props.put(SecurityConstants.ENCRYPT_USERNAME, &quot;mystskey&quot;);
         props.put(SecurityConstants.STS_TOKEN_USERNAME, &quot;myactaskey&quot; );
         props.put(SecurityConstants.STS_TOKEN_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource(
            &quot;actasKeystore.properties&quot; ));
         props.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO, &quot;true&quot;);

         ctx.put(SecurityConstants.STS_CLIENT, stsClient);

      } finally {
         bus.shutdown(true);
      }

      return proxy;
   }

}</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439851_OnBehalfOfWS-TrustScenario-OnBehalfOfCallbackHandler"  >
        <h4>OnBehalfOfCallbackHandler</h4>
    
    <p>
OnBehalfOfCallbackHandler is a callback handler for the WSS4J Crypto API.&nbsp;  It is used to obtain the password for the private key in the keystore.&nbsp;  This class enables CXF to retrieve the password of the user name to use  for the message signature.&nbsp; This class has been revised to return the passwords for this service, myactaskey and the &quot;OnBehalfOf&quot; user, alice.&nbsp;    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;"> package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof;

import org.jboss.wsf.stack.cxf.extensions.security.PasswordCallbackHandler;
import java.util.HashMap;
import java.util.Map;

public class OnBehalfOfCallbackHandler extends PasswordCallbackHandler {

   public OnBehalfOfCallbackHandler()
   {
      super(getInitMap());
   }

   private static Map&lt;String, String&gt; getInitMap()
   {
      Map&lt;String, String&gt; passwords = new HashMap&lt;String, String&gt;();
      passwords.put(&quot;myactaskey&quot;, &quot;aspass&quot;);
      passwords.put(&quot;alice&quot;, &quot;clarinet&quot;);
      passwords.put(&quot;bob&quot;, &quot;trombone&quot;);
      return passwords;
   }

}</pre>
        </div>
    </div>
    <p>
&nbsp;&nbsp; &nbsp;<br/>&nbsp;&nbsp;&nbsp;    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="90439851_OnBehalfOfWS-TrustScenario-Webservicerequester"  >
        <h3>Web service requester</h3>
    
    <p>
This section examines the ws-requester elements from the basic WS-Trust  scenario that have been changed to address the needs of the OnBehalfOf  example.&nbsp; The component is    </p>
<ul class=" "><li class=" ">    <p>
OnBehalfOf web service requester implementation class    </p>
</li></ul>    <div class="section-4"  id="90439851_OnBehalfOfWS-TrustScenario-WebservicerequesterImplementation"  >
        <h4>Web service requester Implementation</h4>
    
    <p>
The OnBehalfOf ws-requester, the client, uses standard procedures for creating a reference to the web service in the first four lines.&nbsp; To address the endpoint security requirements, the web service's &quot;Request Context&quot; is configured via the BindingProvider. Information needed in the message generation is provided through it.&nbsp; The OnBehalfOf user, alice, is declared in this section and the callbackHandler, UsernameTokenCallbackHandler is provided to the STSClient for generation of the contents for the OnBehalfOf message element.&nbsp; In this example a STSClient object is created and provided to the proxy's request context. The alternative is to provide keys tagged with the &quot;.it&quot; suffix as was done in <a href="OnBehalfOf_WS-Trust_Scenario.html#90439851_OnBehalfOfWS-TrustScenario-WebservicerequesterImplementation">the Basic Scenario client </a>.&nbsp; The use of OnBehalfOf is configured by the method call stsClient.setOnBehalfOf.&nbsp; The alternative is to use the key SecurityConstants.STS_TOKEN_ON_BEHALF_OF and a value in the props map.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">final QName serviceName = new QName(&quot;http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy&quot;, &quot;OnBehalfOfService&quot;);
final URL wsdlURL = new URL(serviceURL + &quot;?wsdl&quot;);
Service service = Service.create(wsdlURL, serviceName);
OnBehalfOfServiceIface proxy = (OnBehalfOfServiceIface) service.getPort(OnBehalfOfServiceIface.class);


Bus bus = BusFactory.newInstance().createBus();
try {

    BusFactory.setThreadDefaultBus(bus);

    Map&lt;String, Object&gt; ctx = proxy.getRequestContext();

    ctx.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
    ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        &quot;META-INF/clientKeystore.properties&quot;));
    ctx.put(SecurityConstants.ENCRYPT_USERNAME, &quot;myactaskey&quot;);
    ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        &quot;META-INF/clientKeystore.properties&quot;));
    ctx.put(SecurityConstants.SIGNATURE_USERNAME, &quot;myclientkey&quot;);

    // user and password OnBehalfOf user
    // UsernameTokenCallbackHandler will extract this information when called
    ctx.put(SecurityConstants.USERNAME,&quot;alice&quot;);
    ctx.put(SecurityConstants.PASSWORD, &quot;clarinet&quot;);

    STSClient stsClient = new STSClient(bus);

    // Providing the STSClient the mechanism to create the claims contents for OnBehalfOf
    stsClient.setOnBehalfOf(new UsernameTokenCallbackHandler());

    Map&lt;String, Object&gt; props = stsClient.getProperties();
    props.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
    props.put(SecurityConstants.ENCRYPT_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        &quot;META-INF/clientKeystore.properties&quot;));
    props.put(SecurityConstants.ENCRYPT_USERNAME, &quot;mystskey&quot;);
    props.put(SecurityConstants.STS_TOKEN_USERNAME, &quot;myclientkey&quot;);
    props.put(SecurityConstants.STS_TOKEN_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        &quot;META-INF/clientKeystore.properties&quot;));
    props.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO, &quot;true&quot;);

    ctx.put(SecurityConstants.STS_CLIENT, stsClient);

} finally {
    bus.shutdown(true);
}
proxy.sayHello();</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    </div>
    
        </div>
              <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <li class="previous"><a accesskey="p" href="ActAs_WS-Trust_Scenario.html"><strong>Prev</strong>ActAs WS-Trust Scenario</a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li>
          <li class="home"><a accesskey="h" href="Documentation.html"><strong>Front page</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="next"><a accesskey="n" href="SAML_Bearer_Assertion_Scenario.html"><strong>Next</strong>SAML Bearer Assertion Scenario</a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </ul>
          </div>
    <script type="text/javascript">
      SyntaxHighlighter.all()
    </script>
</body>
</html>
