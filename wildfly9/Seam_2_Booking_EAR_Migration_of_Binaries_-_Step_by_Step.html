<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Seam 2 Booking Application - Migration of Binaries from EAP5.1 to&nbsp;WildFly - WildFly 9</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
    <meta content="Scroll Wiki Publisher" name="generator"/>

    <link type="text/css" rel="stylesheet" href="css/blueprint/liquid.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/blueprint/print.css" media="print"/>
    <!--[if lt IE 8]><link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection"/><![endif]-->

    <link type="text/css" rel="stylesheet" href="css/content-style.css" media="screen, projection, print"/>
    <link type="text/css" rel="stylesheet" href="css/screen.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/print.css" media="print"/>
    
    <link type="text/css" rel="stylesheet" href="css/jbossorg.css"/>
    <link type="text/css" rel="stylesheet" href="css/docnav.css"/>    
    
    <link type="text/css" rel="stylesheet" href="sh/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="sh/shCoreDefault.css"/>
    <script type="text/javascript" src="sh/shCore.js"></script>
    <script type="text/javascript" src="sh/shBrushAppleScript.js"></script>
    <script type="text/javascript" src="sh/shBrushAS3.js"></script>
    <script type="text/javascript" src="sh/shBrushBash.js"></script>
    <script type="text/javascript" src="sh/shBrushCpp.js"></script>
    <script type="text/javascript" src="sh/shBrushCSharp.js"></script>
    <script type="text/javascript" src="sh/shBrushCss.js"></script>
    <script type="text/javascript" src="sh/shBrushDiff.js"></script>
    <script type="text/javascript" src="sh/shBrushErlang.js"></script>
    <script type="text/javascript" src="sh/shBrushGroovy.js"></script>
    <script type="text/javascript" src="sh/shBrushJava.js"></script>
    <script type="text/javascript" src="sh/shBrushJavaFX.js"></script>
    <script type="text/javascript" src="sh/shBrushJScript.js"></script>
    <script type="text/javascript" src="sh/shBrushPerl.js"></script>
    <script type="text/javascript" src="sh/shBrushPhp.js"></script>
    <script type="text/javascript" src="sh/shBrushPlain.js"></script>
    <script type="text/javascript" src="sh/shBrushPython.js"></script>
    <script type="text/javascript" src="sh/shBrushRuby.js"></script>
    <script type="text/javascript" src="sh/shBrushScala.js"></script>
    <script type="text/javascript" src="sh/shBrushSql.js"></script>
    <script type="text/javascript" src="sh/shBrushVb.js"></script>
    <script type="text/javascript" src="sh/shBrushXml.js"></script>
    
</head>
<body>
    <div class="container" style="min-width: 760px;">
        <div class="block header">
          <p id="title">
            <a class="site_href" href="http://www.jboss.org"><strong>JBoss.org</strong></a>
            <a class="doc_href" href="http://docs.jboss.org"><strong>Community Documentation</strong></a>
          </p>
                  <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </ul>
                    <div>
            <h1>Seam 2 Booking Application - Migration of Binaries from EAP5.1 to&nbsp;WildFly</h1>
          </div>          
          </div>

        <div class="block content">
    <p>
This is a step-by-step how-to guide on porting the Seam Booking  application binaries from EAP5.1 to WildFly 8. Although there are better  approaches for migrating applications, the purpose of this document is to show the types of issues you might encounter when  migrating an application and how to debug and resolve those issues.    </p>
    <p>
For  this example, the application EAR is deployed to the  JBOSS_HOME/standalone/deployments directory with no changes other than  extracting the archives so we can modify the XML files contained within  them.    </p>
    <div class="section-2"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Step1%3ABuildanddeploytheEAP5.1versionoftheSeamBookingapplication"  >
        <h2>Step 1: Build and deploy the EAP5.1 version of the Seam Booking application</h2>
    
<ol class=" "><li class=" ">    <p>
Build the EAR    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">    cd /EAP5_HOME/jboss-eap5.1/seam/examples/booking
    ~/tools/apache-ant-1.8.2/bin/ant explode</pre>
        </div>
    </div>
</li><li class=" ">    <p>
Copy the EAR to the JBOSS_HOME deployments directory:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">    cp -r EAP5_HOME/jboss-eap-5.1/seam/examples/booking/exploded-archives/jboss-seam-booking.ear AS7_HOME/standalone/deployments/
    cp -r EAP5_HOME/jboss-eap-5.1/seam/examples/booking/exploded-archives/jboss-seam-booking.war AS7_HOME/standalone/deployments/jboss-seam.ear
    cp -r EAP5_HOME/jboss-eap-5.1/seam/examples/booking/exploded-archives/jboss-seam-booking.jar AS7_HOME/standalone/deployments/jboss-seam.ear</pre>
        </div>
    </div>
</li><li class=" ">    <p>
Start the WildFly&nbsp;server and check the log. You will see:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">    INFO [org.jboss.as.deployment] (DeploymentScanner-threads - 1) Found jboss-seam-booking.ear in deployment directory. To trigger deployment create a file called jboss-seam-booking.ear.dodeploy</pre>
        </div>
    </div>
</li><li class=" ">    <p>
Create an empty file with the name <tt class=" ">jboss-seam-booking.ear.dodeploy</tt> and copy it into the deployments  directory. In the log, you will now see the following, indicating that  it is deploying:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">    INFO [org.jboss.as.server.deployment] (MSC service thread 1-1) Starting deployment of &quot;jboss-seam-booking.ear&quot;
    INFO [org.jboss.as.server.deployment] (MSC service thread 1-3) Starting deployment of &quot;jboss-seam-booking.jar&quot;
    INFO [org.jboss.as.server.deployment] (MSC service thread 1-6) Starting deployment of &quot;jboss-seam.jar&quot;
    INFO [org.jboss.as.server.deployment] (MSC service thread 1-2) Starting deployment of &quot;jboss-seam-booking.war&quot;</pre>
        </div>
    </div>
</li></ol>    <p>
At this point, you will first encounter your first deployment error. In the next section, we will step through each issue and how to debug and resolve it.    </p>
    </div>
    
    <div class="section-2"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Step2%3ADebugandresolvedeploymenterrorsandexceptions"  >
        <h2>Step 2: Debug and resolve deployment errors and exceptions</h2>
    
    <div class="section-3"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-FirstIssue%3Ajava.lang.ClassNotFoundException%3Ajavax.faces.FacesException"  >
        <h3>First Issue: java.lang.ClassNotFoundException: javax.faces.FacesException</h3>
    
    <p>
When you deploy the application, the log contains the following error:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">ERROR \[org.jboss.msc.service.fail\] (MSC service thread 1-1) MSC00001: Failed to start service jboss.deployment.subunit.&quot;jboss-seam-booking.ear&quot;.&quot;jboss-seam-booking.war&quot;.POST_MODULE:
org.jboss.msc.service.StartException in service jboss.deployment.subunit.&quot;jboss-seam-booking.ear&quot;.&quot;jboss-seam-booking.war&quot;.POST_MODULE:
Failed to process phase POST_MODULE of subdeployment &quot;jboss-seam-booking.war&quot; of deployment &quot;jboss-seam-booking.ear&quot;
    (.. additional logs removed ...)
Caused by: java.lang.ClassNotFoundException: javax.faces.FacesException from \[Module &quot;deployment.jboss-seam-booking.ear:main&quot; from Service Module Loader\]
    at org.jboss.modules.ModuleClassLoader.findClass(ModuleClassLoader.java:191)</pre>
        </div>
    </div>
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Whatitmeans%3A"  >
        <h4>What it means:</h4>
    
    <p>
The ClassNotFoundException indicates a missing dependency. In this case, it can not find the class <tt class=" ">javax.faces.FacesException</tt> and you need to explicitly add the dependency.    </p>
    </div>
    
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Howtoresolveit%3A"  >
        <h4>How to resolve it:</h4>
    
    <p>
Find the module name for that class in the <tt class=" ">AS7_HOME/modules</tt> directory by looking for a path that matches the missing class. In this case, you will find 2 modules that match:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">    javax/faces/api/main
    javax/faces/api/1.2</pre>
        </div>
    </div>
    <p>
Both modules have the same module name: &ldquo;javax.faces.api&rdquo; but one in the main directory is for JSF 2.0 and the one located in the 1.2 directory is for JSF 1.2. If there was only one module available, we could simply create a&nbsp; <tt class=" ">MANIFEST.MF</tt> file and added the module dependency. But in this case, we want to use the JSF 1.2 version and not the 2.0 version in main, so we need to be able to specify one and exclude the other. To do this, we create a <tt class=" ">jboss-deployment-structure.xml</tt> file in the EAR <tt class=" ">META-INF/</tt> directory that contains the following data:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;jboss-deployment-structure xmlns=&quot;urn:jboss:deployment-structure:1.0&quot;&gt;
  &lt;deployment&gt;
  	  &lt;dependencies&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;1.2&quot; export=&quot;true&quot;/&gt;
	    &lt;/dependencies&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=&quot;jboss-seam-booking.war&quot;&gt;
  	&lt;exclusions&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;main&quot;/&gt;
	    &lt;/exclusions&gt;
	    &lt;dependencies&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;1.2&quot;/&gt;
	    &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre>
        </div>
    </div>
    <p>
In the &quot;deployment&quot; section, we add the dependency for the <tt class=" ">javax.faces.api</tt> for the JSF 1.2 module. We also add the dependency for the JSF 1.2 module in the sub-deployment section for the WAR and exclude the module for JSF 2.0.    </p>
    <p>
Redeploy the application by deleting the <tt class=" ">standalone/deployments/jboss-seam-booking.ear.failed</tt> file and creating a blank <tt class=" ">jboss-seam-booking.ear.dodeploy</tt> file in the same directory.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-NextIssue%3Ajava.lang.ClassNotFoundException%3Aorg.apache.commons.logging.Log"  >
        <h3>Next Issue: java.lang.ClassNotFoundException: org.apache.commons.logging.Log</h3>
    
    <p>
When you deploy the application, the log contains the following error:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">ERROR [org.jboss.msc.service.fail] (MSC service thread 1-8) MSC00001: Failed to start service jboss.deployment.unit.&quot;jboss-seam-booking.ear&quot;.INSTALL:
org.jboss.msc.service.StartException in service jboss.deployment.unit.&quot;jboss-seam-booking.ear&quot;.INSTALL:
Failed to process phase INSTALL of deployment &quot;jboss-seam-booking.ear&quot;
    (.. additional logs removed ...)
Caused by: java.lang.ClassNotFoundException: org.apache.commons.logging.Log from [Module &quot;deployment.jboss-seam-booking.ear.jboss-seam-booking.war:main&quot; from Service Module Loader]</pre>
        </div>
    </div>
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Whatitmeans%3A2"  >
        <h4>What it means:</h4>
    
    <p>
The ClassNotFoundException indicates a missing dependency. In this case, it can not find the class <tt class=" ">org.apache.commons.logging.Log</tt> and you need to explicitly add the dependency.    </p>
    </div>
    
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Howtoresolveit%3A2"  >
        <h4>How to resolve it:</h4>
    
    <p>
Find the module name for that class in the <tt class=" ">JBOSS_HOME/modules/</tt> directory by looking for a path that matches the missing class. In this case, you will find one module that matches the path <tt class=" ">org/apache/commons/logging/</tt>. The module name is &ldquo;org.apache.commons.logging&rdquo;.    </p>
    <p>
Modify the <tt class=" ">jboss-deployment-structure.xml</tt> to add the module dependency to the deployment section of the file.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;module name=&quot;org.apache.commons.logging&quot; export=&quot;true&quot;/&gt;</pre>
        </div>
    </div>
    <p>
The <tt class=" ">jboss-deployment-structure.xml</tt> should now look like this:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;jboss-deployment-structure xmlns=&quot;urn:jboss:deployment-structure:1.0&quot;&gt;
  &lt;deployment&gt;
  	  &lt;dependencies&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;1.2&quot; export=&quot;true&quot;/&gt;
	      &lt;module name=&quot;org.apache.commons.logging&quot; export=&quot;true&quot;/&gt;
	    &lt;/dependencies&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=&quot;jboss-seam-booking.war&quot;&gt;
  	&lt;exclusions&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;main&quot;/&gt;
	    &lt;/exclusions&gt;
	    &lt;dependencies&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;1.2&quot;/&gt;
	    &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre>
        </div>
    </div>
    <p>
Redeploy the application by deleting the <tt class=" ">standalone/deployments/jboss-seam-booking.ear.failed</tt> file and creating a blank <tt class=" ">jboss-seam-booking.ear.dodeploy file</tt> in the same directory.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-NextIssue%3Ajava.lang.ClassNotFoundException%3Aorg.dom4j.DocumentException"  >
        <h3>Next Issue: java.lang.ClassNotFoundException: org.dom4j.DocumentException</h3>
    
    <p>
When you deploy the application, the log contains the following error:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">ERROR [org.apache.catalina.core.ContainerBase.[jboss.web].[default-host].[/seam-booking]] (MSC service thread 1-3) Exception sending context initialized event to listener instance of class org.jboss.seam.servlet.SeamListener: java.lang.NoClassDefFoundError: org/dom4j/DocumentException
    (... additional logs removed ...)
Caused by: java.lang.ClassNotFoundException: org.dom4j.DocumentException from [Module &quot;deployment.jboss-seam-booking.ear.jboss-seam.jar:main&quot; from Service Module Loader]</pre>
        </div>
    </div>
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Whatitmeans%3A3"  >
        <h4>What it means:</h4>
    
    <p>
Again, the ClassNotFoundException indicates a missing dependency. In this case, it can not find the class <tt class=" ">org.dom4j.DocumentException</tt>.    </p>
    </div>
    
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Howtoresolveit%3A3"  >
        <h4>How to resolve it:</h4>
    
    <p>
Find the module name in the <tt class=" ">JBOSS_HOME/modules/</tt> directory by looking for the <tt class=" ">org/dom4j/DocumentException</tt>. The module name is &ldquo;org.dom4j&rdquo;.    </p>
    <p>
Modify the <tt class=" ">jboss-deployment-structure.xml</tt> to add the module dependency to the deployment section of the file.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;module name=&quot;org.dom4j&quot; export=&quot;true&quot;/&gt;</pre>
        </div>
    </div>
    <p>
The <tt class=" ">jboss-deployment-structure.xml</tt> file should now look like this:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;jboss-deployment-structure xmlns=&quot;urn:jboss:deployment-structure:1.0&quot;&gt;
  &lt;deployment&gt;
  	  &lt;dependencies&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;1.2&quot; export=&quot;true&quot;/&gt;
	      &lt;module name=&quot;org.apache.commons.logging&quot; export=&quot;true&quot;/&gt;
    	      &lt;module name=&quot;org.dom4j&quot; export=&quot;true&quot;/&gt;
          &lt;/dependencies&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=&quot;jboss-seam-booking.war&quot;&gt;
  	&lt;exclusions&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;main&quot;/&gt;
	    &lt;/exclusions&gt;
	    &lt;dependencies&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;1.2&quot;/&gt;
	    &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre>
        </div>
    </div>
    <p>
Redeploy the application by deleting the <tt class=" ">standalone/deployments/jboss-seam-booking.ear.failed</tt> file and creating a blank <tt class=" ">jboss-seam-booking.ear.dodeploy file</tt> in the same directory.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-NextIssue%3Ajava.lang.ClassNotFoundException%3Aorg.hibernate.validator.InvalidValue"  >
        <h3>Next Issue: java.lang.ClassNotFoundException: org.hibernate.validator.InvalidValue</h3>
    
    <p>
When you deploy the application, the log contains the following error:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">ERROR [org.apache.catalina.core.ContainerBase.[jboss.web].[default-host].[/seam-booking]] (MSC service thread 1-6) Exception sending context initialized event to listener instance of class org.jboss.seam.servlet.SeamListener: java.lang.RuntimeException: Could not create Component: org.jboss.seam.international.statusMessages
    (... additional logs removed ...)
Caused by: java.lang.ClassNotFoundException: org.hibernate.validator.InvalidValue from [Module &quot;deployment.jboss-seam-booking.ear.jboss-seam.jar:main&quot; from Service Module Loader]</pre>
        </div>
    </div>
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Whatitmeans%3A4"  >
        <h4>What it means:</h4>
    
    <p>
Again, the ClassNotFoundException indicates a missing dependency. In this case, it can not find the class <tt class=" ">org.hibernate.validator.InvalidValue</tt>.    </p>
    </div>
    
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Howtoresolveit%3A4"  >
        <h4>How to resolve it:</h4>
    
    <p>
There is a module &ldquo;org.hibernate.validator&rdquo;, but the JAR does not contain the <tt class=" ">org.hibernate.validator.InvalidValue</tt> class, so adding the module dependency will not resolve this issue.    </p>
    <p>
In this case, the JAR containing the class was part of the EAP 5.1 deployment. We will look for the JAR that contains the missing class in the <tt class=" ">EAP5_HOME/jboss-eap-5.1/seam/lib/</tt> directory. To do this, open a console and type the following:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">cd EAP5_HOME/jboss-eap-5.1/seam/lib
grep 'org.hibernate.validator.InvalidValue' `find . -name '*.jar'`</pre>
        </div>
    </div>
    <p>
The result shows:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">Binary file ./hibernate-validator.jar matches
Binary file ./test/hibernate-all.jar matches</pre>
        </div>
    </div>
    <p>
In this case, we need to copy the <tt class=" ">hibernate-validator.jar</tt> to the <tt class=" ">jboss-seam-booking.ear/lib/</tt> directory:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">cp EAP5_HOME/jboss-eap-5.1/seam/lib/hibernate-validator.jar jboss-seam-booking.ear/lib</pre>
        </div>
    </div>
    <p>
Redeploy the application by deleting the <tt class=" ">standalone/deployments/jboss-seam-booking.ear.failed</tt> file and creating a blank <tt class=" ">jboss-seam-booking.ear.dodeploy file</tt> in the same directory.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-NextIssue%3Ajava.lang.InstantiationException%3Aorg.jboss.seam.jsf.SeamApplicationFactory"  >
        <h3>Next Issue: java.lang.InstantiationException: org.jboss.seam.jsf.SeamApplicationFactory</h3>
    
    <p>
When you deploy the application, the log contains the following error:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">INFO  [javax.enterprise.resource.webcontainer.jsf.config] (MSC service thread 1-7) Unsanitized stacktrace from failed start...: com.sun.faces.config.ConfigurationException: Factory 'javax.faces.application.ApplicationFactory' was not configured properly.
	at com.sun.faces.config.processor.FactoryConfigProcessor.verifyFactoriesExist(FactoryConfigProcessor.java:296) [jsf-impl-2.0.4-b09-jbossorg-4.jar:2.0.4-b09-jbossorg-4]
	(... additional logs removed ...)
Caused by: javax.faces.FacesException: org.jboss.seam.jsf.SeamApplicationFactory
	at javax.faces.FactoryFinder.getImplGivenPreviousImpl(FactoryFinder.java:606) [jsf-api-1.2_13.jar:1.2_13-b01-FCS]
	(... additional logs removed ...)
	at com.sun.faces.config.processor.FactoryConfigProcessor.verifyFactoriesExist(FactoryConfigProcessor.java:294) [jsf-impl-2.0.4-b09-jbossorg-4.jar:2.0.4-b09-jbossorg-4]
	... 11 more
Caused by: java.lang.InstantiationException: org.jboss.seam.jsf.SeamApplicationFactory
	at java.lang.Class.newInstance0(Class.java:340) [:1.6.0_25]
	at java.lang.Class.newInstance(Class.java:308) [:1.6.0_25]
	at javax.faces.FactoryFinder.getImplGivenPreviousImpl(FactoryFinder.java:604) [jsf-api-1.2_13.jar:1.2_13-b01-FCS]
	... 16 more</pre>
        </div>
    </div>
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Whatitmeans%3A5"  >
        <h4>What it means:</h4>
    
    <p>
The com.sun.faces.config.ConfigurationException and java.lang.InstantiationException indicate a dependency issue. In this case, it is not as obvious.    </p>
    </div>
    
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Howtoresolveit%3A5"  >
        <h4>How to resolve it:</h4>
    
    <p>
We need to find the module that contains the com.sun.faces classes. While there is no com.sun.faces module, there are are two com.sun.jsf-impl modules. A quick check of the jsf-impl-1.2_13.jar in the 1.2 directory shows it contains the com.sun.faces classes.    </p>
    <p>
As we did with the javax.faces.FacesException ClassNotFoundException,  we want to use the JSF 1.2 version and not the JSF 2.0 version in main, so we need to be able to specify one and exclude the other. We need to modify the jboss-deployment-structure.xml to add the module dependency to the deployment section of the file. We also need to add it to the WAR subdeployment and exclude the JSF 2.0 module. The file should now look like this:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;jboss-deployment-structure xmlns=&quot;urn:jboss:deployment-structure:1.0&quot;&gt;
  &lt;deployment&gt;
  	  &lt;dependencies&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;1.2&quot; export=&quot;true&quot;/&gt;
              &lt;module name=&quot;com.sun.jsf-impl&quot; slot=&quot;1.2&quot; export=&quot;true&quot;/&gt;
	      &lt;module name=&quot;org.apache.commons.logging&quot; export=&quot;true&quot;/&gt;
	      &lt;module name=&quot;org.dom4j&quot; export=&quot;true&quot;/&gt;
	    &lt;/dependencies&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=&quot;jboss-seam-booking.war&quot;&gt;
  	&lt;exclusions&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;main&quot;/&gt;
	      &lt;module name=&quot;com.sun.jsf-impl&quot; slot=&quot;main&quot;/&gt;
	    &lt;/exclusions&gt;
	    &lt;dependencies&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;1.2&quot;/&gt;
              &lt;module name=&quot;com.sun.jsf-impl&quot; slot=&quot;1.2&quot;/&gt;
	    &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre>
        </div>
    </div>
    <p>
Redeploy the application by deleting the <tt class=" ">standalone/deployments/jboss-seam-booking.ear.failed</tt> file and creating a blank <tt class=" ">jboss-seam-booking.ear.dodeploy file</tt> in the same directory.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-NextIssue%3Ajava.lang.ClassNotFoundException%3Aorg.apache.commons.collections.ArrayStack"  >
        <h3>Next Issue: java.lang.ClassNotFoundException: org.apache.commons.collections.ArrayStack</h3>
    
    <p>
When you deploy the application, the log contains the following error:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">ERROR [org.apache.catalina.core.ContainerBase.[jboss.web].[default-host].[/seam-booking]] (MSC service thread 1-1) Exception sending context initialized event to listener instance of class com.sun.faces.config.ConfigureListener: java.lang.RuntimeException: com.sun.faces.config.ConfigurationException: CONFIGURATION FAILED! org.apache.commons.collections.ArrayStack from [Module &quot;deployment.jboss-seam-booking.ear:main&quot; from Service Module Loader]
    (... additional logs removed ...)
Caused by: java.lang.ClassNotFoundException: org.apache.commons.collections.ArrayStack from [Module &quot;deployment.jboss-seam-booking.ear:main&quot; from Service Module Loader] </pre>
        </div>
    </div>
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Whatitmeans%3A6"  >
        <h4>What it means:</h4>
    
    <p>
Again, the ClassNotFoundException indicates a missing dependency. In this case, it can not find the class <tt class=" ">org.apache.commons.collections.ArrayStack</tt>.    </p>
    </div>
    
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Howtoresolveit%3A6"  >
        <h4>How to resolve it:</h4>
    
    <p>
Find the module name in the <tt class=" ">JBOSS_HOME/modules/</tt> directory by looking for the <tt class=" ">org/apache/commons/collections</tt> path. The module name is &ldquo;org.apache.commons.collections&rdquo;.    </p>
    <p>
Modify the <tt class=" ">jboss-deployment-structure.xml</tt> to add the module dependency to the deployment section of the file.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;module name=&quot;org.apache.commons.collections&quot; export=&quot;true&quot;/&gt;</pre>
        </div>
    </div>
    <p>
The <tt class=" ">jboss-deployment-structure.xml</tt> file should now look like this:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;jboss-deployment-structure xmlns=&quot;urn:jboss:deployment-structure:1.0&quot;&gt;
  &lt;deployment&gt;
  	  &lt;dependencies&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;1.2&quot; export=&quot;true&quot;/&gt;
              &lt;module name=&quot;com.sun.jsf-impl&quot; slot=&quot;1.2&quot; export=&quot;true&quot;/&gt;
	      &lt;module name=&quot;org.apache.commons.logging&quot; export=&quot;true&quot;/&gt;
	      &lt;module name=&quot;org.dom4j&quot; export=&quot;true&quot;/&gt;
	      &lt;module name=&quot;org.apache.commons.collections&quot; export=&quot;true&quot;/&gt;
	  &lt;/dependencies&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=&quot;jboss-seam-booking.war&quot;&gt;
  	&lt;exclusions&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;main&quot;/&gt;
	      &lt;module name=&quot;com.sun.jsf-impl&quot; slot=&quot;main&quot;/&gt;
	    &lt;/exclusions&gt;
	    &lt;dependencies&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;1.2&quot;/&gt;
              &lt;module name=&quot;com.sun.jsf-impl&quot; slot=&quot;1.2&quot;/&gt;
	    &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre>
        </div>
    </div>
    <p>
Redeploy the application by deleting the <tt class=" ">standalone/deployments/jboss-seam-booking.ear.failed</tt> file and creating a blank <tt class=" ">jboss-seam-booking.ear.dodeploy file</tt> in the same directory.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-NextIssue%3AServiceswithmissing%2Funavailabledependencies"  >
        <h3>Next Issue: Services with missing/unavailable dependencies</h3>
    
    <p>
When you deploy the application, the log contains the following error:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">ERROR [org.jboss.as.deployment] (DeploymentScanner-threads - 2) {&quot;Composite operation failed and was rolled back. Steps that failed:&quot; =&gt; {&quot;Operation step-2&quot; =&gt; {&quot;Services with missing/unavailable dependencies&quot; =&gt; [&quot;jboss.deployment.subunit.\&quot;jboss-seam-booking.ear\&quot;.\&quot;jboss-seam-booking.jar\&quot;.component.AuthenticatorAction.START missing [ jboss.naming.context.java.comp.jboss-seam-booking.\&quot;jboss-seam-booking.jar\&quot;.AuthenticatorAction.\&quot;env/org.jboss.seam.example.booking.AuthenticatorAction/em\&quot; ]&quot;,&quot;jboss.deployment.subunit.\&quot;jboss-seam-booking.ear\&quot;.\&quot;jboss-seam-booking.jar\&quot;.component.HotelSearchingAction.START missing [ jboss.naming.context.java.comp.jboss-seam-booking.\&quot;jboss-seam-booking.jar\&quot;.HotelSearchingAction.\&quot;env/org.jboss.seam.example.booking.HotelSearchingAction/em\&quot; ]&quot;,&quot;
&lt;... additional logs removed ...&gt;
&quot;jboss.deployment.subunit.\&quot;jboss-seam-booking.ear\&quot;.\&quot;jboss-seam-booking.jar\&quot;.component.BookingListAction.START missing [ jboss.naming.context.java.comp.jboss-seam-booking.\&quot;jboss-seam-booking.jar\&quot;.BookingListAction.\&quot;env/org.jboss.seam.example.booking.BookingListAction/em\&quot; ]&quot;,&quot;jboss.persistenceunit.\&quot;jboss-seam-booking.ear/jboss-seam-booking.jar#bookingDatabase\&quot; missing [ jboss.naming.context.java.bookingDatasource ]&quot;]}}}</pre>
        </div>
    </div>
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Whatitmeans%3A7"  >
        <h4>What it means:</h4>
    
    <p>
When you get a &ldquo;Services with missing/unavailable dependencies&rdquo; error, look that the text within the brackets after &ldquo;missing&rdquo;.    </p>
    <p>
In this case you see:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">missing [ jboss.naming.context.java.comp.jboss-seam-booking.\&quot;jboss-seam-booking.jar\&quot;.AuthenticatorAction.\&quot;env/org.jboss.seam.example.booking.AuthenticatorAction/em\&quot; ]</pre>
        </div>
    </div>
    <p>
The &ldquo;/em&rdquo; indicates an Entity Manager and datasource issue.    </p>
    </div>
    
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Howtoresolveit%3A7"  >
        <h4>How to resolve it:</h4>
    
    <p>
In WildFly 8, datasource configuration has changed and needs to be defined in the <tt class=" ">standalone/configuration/standalone.xml</tt> file. Since WildFly&nbsp;ships with an example database that is already defined in the standalone.xml file, we will modify the <tt class=" ">persistence.xml</tt> file to use that example database. Looking in the <tt class=" ">standalone.xml</tt> file, you can see that the jndi-name for the example database is &quot;java:jboss/datasources/ExampleDS&quot;.    </p>
    <p>
Modify the <tt class=" ">jboss-seam-booking.jar/META-INF/persistence.xml</tt> file to comment the existing jta-data-source element and replace it as follows:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;!-- &lt;jta-data-source&gt;java:/bookingDatasource&lt;/jta-data-source&gt; --&gt;
&lt;jta-data-source&gt;java:jboss/datasources/ExampleDS&lt;/jta-data-source&gt;</pre>
        </div>
    </div>
    <p>
Redeploy the application by deleting the <tt class=" ">standalone/deployments/jboss-seam-booking.ear.failed</tt> file and creating a blank <tt class=" ">jboss-seam-booking.ear.dodeploy file</tt> in the same directory.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-NextIssue%3Ajava.lang.ClassNotFoundException%3Aorg.hibernate.cache.HashtableCacheProvider"  >
        <h3>Next Issue: java.lang.ClassNotFoundException:  org.hibernate.cache.HashtableCacheProvider</h3>
    
    <p>
When you deploy the application, the log contains the following error:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">ERROR [org.jboss.msc.service.fail] (MSC service thread 1-4) MSC00001: Failed to start service jboss.persistenceunit.&quot;jboss-seam-booking.ear/jboss-seam-booking.jar#bookingDatabase&quot;: org.jboss.msc.service.StartException in service jboss.persistenceunit.&quot;jboss-seam-booking.ear/jboss-seam-booking.jar#bookingDatabase&quot;: Failed to start service
	at org.jboss.msc.service.ServiceControllerImpl$StartTask.run(ServiceControllerImpl.java:1786)
	(... log messages removed ...)
Caused by: javax.persistence.PersistenceException: [PersistenceUnit: bookingDatabase] Unable to build EntityManagerFactory
	at org.hibernate.ejb.Ejb3Configuration.buildEntityManagerFactory(Ejb3Configuration.java:903)
	{... log messages removed ...)
Caused by: org.hibernate.HibernateException: could not instantiate RegionFactory [org.hibernate.cache.internal.bridge.RegionFactoryCacheProviderBridge]
	at org.hibernate.cfg.SettingsFactory.createRegionFactory(SettingsFactory.java:355)
	(... log messages removed ...)
Caused by: java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) [:1.6.0_25]
	(... log messages removed ...)
Caused by: org.hibernate.cache.CacheException: could not instantiate CacheProvider [org.hibernate.cache.HashtableCacheProvider]
	at org.hibernate.cache.internal.bridge.RegionFactoryCacheProviderBridge.&lt;init&gt;(RegionFactoryCacheProviderBridge.java:68)
	... 20 more
Caused by: java.lang.ClassNotFoundException: org.hibernate.cache.HashtableCacheProvider from [Module &quot;org.hibernate:main&quot; from local module loader @12a3793 (roots: /home/sgilda/tools/jboss7/modules)]
	at org.jboss.modules.ModuleClassLoader.findClass(ModuleClassLoader.java:191)
	(... log messages removed ...)</pre>
        </div>
    </div>
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Whatitmeans%3A8"  >
        <h4>What it means:</h4>
    
    <p>
The ClassNotFoundException indicates a missing dependency. In this case, it can not find the class   org.hibernate.cache.HashtableCacheProvider.    </p>
    </div>
    
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Howtoresolveit%3A8"  >
        <h4>How to resolve it:</h4>
    
    <p>
There is no module for &ldquo;org.hibernate.cache&rdquo;. In this case, the JAR containing the class was part of the EAP 5.1 deployment. We will look for the JAR that contains the missing class in the <tt class=" ">EAP5_HOME/jboss-eap-5.1/seam/lib/</tt> directory.    </p>
    <p>
To do this, open a console and type the following:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">cd EAP5_HOME/jboss-eap-5.1/seam/lib
grep 'org.hibernate.validator.InvalidValue' `find . -name '*.jar'`</pre>
        </div>
    </div>
    <p>
The result shows:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">Binary file ./hibernate-core.jar matches
Binary file ./test/hibernate-all.jar matches</pre>
        </div>
    </div>
    <p>
In this case, we need to copy the <tt class=" ">hibernate-core.jar</tt> to the <tt class=" ">jboss-seam-booking.ear/lib/</tt> directory:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">cp EAP5_HOME/jboss-eap-5.1/seam/lib/hibernate-core.jar jboss-seam-booking.ear/lib</pre>
        </div>
    </div>
    <p>
Redeploy the application by deleting the <tt class=" ">standalone/deployments/jboss-seam-booking.ear.failed</tt> file and creating a blank <tt class=" ">jboss-seam-booking.ear.dodeploy file</tt> in the same directory.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-NextIssue%3Ajava.lang.ClassCastException%3Aorg.hibernate.cache.HashtableCacheProvider"  >
        <h3>Next Issue:  java.lang.ClassCastException: org.hibernate.cache.HashtableCacheProvider</h3>
    
    <p>
When you deploy the application, the log contains the following error:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">ERROR [org.jboss.msc.service.fail] (MSC service thread 1-2) MSC00001: Failed to start service jboss.persistenceunit.&quot;jboss-seam-booking.ear/jboss-seam-booking.jar#bookingDatabase&quot;: org.jboss.msc.service.StartException in service jboss.persistenceunit.&quot;jboss-seam-booking.ear/jboss-seam-booking.jar#bookingDatabase&quot;: Failed to start service
	at org.jboss.msc.service.ServiceControllerImpl$StartTask.run(ServiceControllerImpl.java:1786)
	(... log messages removed ...)
Caused by: javax.persistence.PersistenceException: [PersistenceUnit: bookingDatabase] Unable to build EntityManagerFactory
	at org.hibernate.ejb.Ejb3Configuration.buildEntityManagerFactory(Ejb3Configuration.java:903)
	(... log messages removed ...)
Caused by: org.hibernate.HibernateException: could not instantiate RegionFactory [org.hibernate.cache.internal.bridge.RegionFactoryCacheProviderBridge]
	at org.hibernate.cfg.SettingsFactory.createRegionFactory(SettingsFactory.java:355)
	(... log messages removed ...)
Caused by: java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) [:1.6.0_25]
	(... log messages removed ...)
Caused by: org.hibernate.cache.CacheException: could not instantiate CacheProvider [org.hibernate.cache.HashtableCacheProvider]
	at org.hibernate.cache.internal.bridge.RegionFactoryCacheProviderBridge.&lt;init&gt;(RegionFactoryCacheProviderBridge.java:68)
	... 20 more
Caused by: java.lang.ClassCastException: org.hibernate.cache.HashtableCacheProvider cannot be cast to org.hibernate.cache.spi.CacheProvider
	at org.hibernate.cache.internal.bridge.RegionFactoryCacheProviderBridge.&lt;init&gt;(RegionFactoryCacheProviderBridge.java:65)
	... 20 more</pre>
        </div>
    </div>
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Whatitmeans%3A9"  >
        <h4>What it means:</h4>
    
    <p>
A ClassCastException can be a result of many problems. If you look at this exception in the log, it appears the class org.hibernate.cache.HashtableCacheProvider extends org.hibernate.cache.spi.CacheProvider and is being loaded by a different class loader than the class it extends. The org.hibernate.cache.HashtableCacheProvider class is in in the hibernate-core.jar and is being loaded by the application class loader. The class it extends, org.hibernate.cache.spi.CacheProvider, is in the org/hibernate/main/hibernate-core-4.0.0.Beta1.jar and is implicitly loaded by that module.    </p>
    <p>
This is not obvious, but due to changes in Hibernate 4, this problem is caused by a backward compatibility issue due moving the HashtableCacheProvider class into another package. This class was moved from the org.hibernate.cache package to the org.hibernate.cache.internal package. If you don't remove the hibernate.cache.provider_class property from the persistence.xml file, it will force the Seam application to bundle the old Hibernate libraries, resulting in ClassCastExceptions, In WildFly, you should move away from using HashtableCacheProvider and use Infinispan instead.    </p>
    </div>
    
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Howtoresolveit%3A9"  >
        <h4>How to resolve it:</h4>
    
    <p>
In WildFly, you need to comment out the hibernate.cache.provider_class property in the <tt class=" ">jboss-seam-booking.jar/META-INF persistence.xml</tt> file as follows:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;!-- &lt;property name=&quot;hibernate.cache.provider_class&quot; value=&quot;org.hibernate.cache.HashtableCacheProvider&quot;/&gt; --&gt;</pre>
        </div>
    </div>
    <p>
Redeploy the application by deleting the <tt class=" ">standalone/deployments/jboss-seam-booking.ear.failed</tt> file and creating a blank <tt class=" ">jboss-seam-booking.ear.dodeploy file</tt> in the same directory.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Nomoreissues%3ADeploymenterrorsshouldberesolved"  >
        <h3>No more issues: Deployment errors should be resolved</h3>
    
    <p>
At this point, the application should deploy without errors, but when you access the URL &ldquo;<a href="http://localhost:8080/seam-booking/">http://localhost:8080/seam-booking/</a>&rdquo; in a browser and attempt &quot;Account Login&quot;, you will get a runtime error &ldquo;The page isn't redirecting properly&rdquo;. In the next section, we will step through each runtime issue and how to debug and resolve it.    </p>
    </div>
    
    </div>
    
    <div class="section-2"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Step3%3ADebugandresolveruntimeerrorsandexceptions"  >
        <h2>Step 3:   Debug and resolve runtime errors and exceptions</h2>
    
    <div class="section-3"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-FirstIssue%3Ajavax.naming.NameNotFoundException%3AName%27jbossseambooking%27notfoundincontext%27%27"  >
        <h3>First Issue: javax.naming.NameNotFoundException: Name 'jboss-seam-booking' not found in context ''</h3>
    
    <p>
The application deploys successfully, but when you access the URL &ldquo;<a href="http://localhost:8080/seam-booking/">http://localhost:8080/seam-booking/</a>&rdquo; in a browser, you get &ldquo;The page isn't redirecting properly&rdquo; and the log contains the following error:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">SEVERE [org.jboss.seam.jsf.SeamPhaseListener] (http--127.0.0.1-8080-1) swallowing exception: java.lang.IllegalStateException: Could not start transaction
	at org.jboss.seam.jsf.SeamPhaseListener.begin(SeamPhaseListener.java:598) [jboss-seam.jar:]
	(... log messages removed ...)
Caused by: org.jboss.seam.InstantiationException: Could not instantiate Seam component: org.jboss.seam.transaction.synchronizations
	at org.jboss.seam.Component.newInstance(Component.java:2170) [jboss-seam.jar:]
	(... log messages removed ...)
Caused by: javax.naming.NameNotFoundException: Name 'jboss-seam-booking' not found in context ''
	at org.jboss.as.naming.util.NamingUtils.nameNotFoundException(NamingUtils.java:109)
	(... log messages removed ...)</pre>
        </div>
    </div>
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Whatitmeans%3A10"  >
        <h4>What it means:</h4>
    
    <p>
A NameNotFoundException indications a JNDI naming issue. JNDI naming rules have changed in WildFly&nbsp;and we need to modify the lookup names to follow the new rules.    </p>
    </div>
    
    <div class="section-4"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Howtoresolveit%3A10"  >
        <h4>How to resolve it:</h4>
    
    <p>
To debug this, look earlier in the server log trace to what JNDI binding were used. Looking at the server log we see this:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">15:01:16,138 INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread 1-1) JNDI bindings for session bean named RegisterAction in deployment unit subdeployment &quot;jboss-seam-booking.jar&quot; of deployment &quot;jboss-seam-booking.ear&quot; are as follows:

	java:global/jboss-seam-booking/jboss-seam-booking.jar/RegisterAction!org.jboss.seam.example.booking.Register
	java:app/jboss-seam-booking.jar/RegisterAction!org.jboss.seam.example.booking.Register
	java:module/RegisterAction!org.jboss.seam.example.booking.Register
	java:global/jboss-seam-booking/jboss-seam-booking.jar/RegisterAction
	java:app/jboss-seam-booking.jar/RegisterAction
	java:module/RegisterAction

15:01:16,138 INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread 1-1) JNDI bindings for session bean named BookingListAction in deployment unit subdeployment &quot;jboss-seam-booking.jar&quot; of deployment &quot;jboss-seam-booking.ear&quot; are as follows:

	java:global/jboss-seam-booking/jboss-seam-booking.jar/BookingListAction!org.jboss.seam.example.booking.BookingList
	java:app/jboss-seam-booking.jar/BookingListAction!org.jboss.seam.example.booking.BookingList
	java:module/BookingListAction!org.jboss.seam.example.booking.BookingList
	java:global/jboss-seam-booking/jboss-seam-booking.jar/BookingListAction
	java:app/jboss-seam-booking.jar/BookingListAction
	java:module/BookingListAction

15:01:16,138 INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread 1-1) JNDI bindings for session bean named HotelBookingAction in deployment unit subdeployment &quot;jboss-seam-booking.jar&quot; of deployment &quot;jboss-seam-booking.ear&quot; are as follows:

	java:global/jboss-seam-booking/jboss-seam-booking.jar/HotelBookingAction!org.jboss.seam.example.booking.HotelBooking
	java:app/jboss-seam-booking.jar/HotelBookingAction!org.jboss.seam.example.booking.HotelBooking
	java:module/HotelBookingAction!org.jboss.seam.example.booking.HotelBooking
	java:global/jboss-seam-booking/jboss-seam-booking.jar/HotelBookingAction
	java:app/jboss-seam-booking.jar/HotelBookingAction
	java:module/HotelBookingAction

15:01:16,138 INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread 1-1) JNDI bindings for session bean named AuthenticatorAction in deployment unit subdeployment &quot;jboss-seam-booking.jar&quot; of deployment &quot;jboss-seam-booking.ear&quot; are as follows:

	java:global/jboss-seam-booking/jboss-seam-booking.jar/AuthenticatorAction!org.jboss.seam.example.booking.Authenticator
	java:app/jboss-seam-booking.jar/AuthenticatorAction!org.jboss.seam.example.booking.Authenticator
	java:module/AuthenticatorAction!org.jboss.seam.example.booking.Authenticator
	java:global/jboss-seam-booking/jboss-seam-booking.jar/AuthenticatorAction
	java:app/jboss-seam-booking.jar/AuthenticatorAction
	java:module/AuthenticatorAction

15:01:16,139 INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread 1-1) JNDI bindings for session bean named ChangePasswordAction in deployment unit subdeployment &quot;jboss-seam-booking.jar&quot; of deployment &quot;jboss-seam-booking.ear&quot; are as follows:

	java:global/jboss-seam-booking/jboss-seam-booking.jar/ChangePasswordAction!org.jboss.seam.example.booking.ChangePassword
	java:app/jboss-seam-booking.jar/ChangePasswordAction!org.jboss.seam.example.booking.ChangePassword
	java:module/ChangePasswordAction!org.jboss.seam.example.booking.ChangePassword
	java:global/jboss-seam-booking/jboss-seam-booking.jar/ChangePasswordAction
	java:app/jboss-seam-booking.jar/ChangePasswordAction
	java:module/ChangePasswordAction

15:01:16,139 INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread 1-1) JNDI bindings for session bean named HotelSearchingAction in deployment unit subdeployment &quot;jboss-seam-booking.jar&quot; of deployment &quot;jboss-seam-booking.ear&quot; are as follows:

	java:global/jboss-seam-booking/jboss-seam-booking.jar/HotelSearchingAction!org.jboss.seam.example.booking.HotelSearching
	java:app/jboss-seam-booking.jar/HotelSearchingAction!org.jboss.seam.example.booking.HotelSearching
	java:module/HotelSearchingAction!org.jboss.seam.example.booking.HotelSearching
	java:global/jboss-seam-booking/jboss-seam-booking.jar/HotelSearchingAction
	java:app/jboss-seam-booking.jar/HotelSearchingAction
	java:module/HotelSearchingAction

15:01:16,140 INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread 1-6) JNDI bindings for session bean named EjbSynchronizations in deployment unit subdeployment &quot;jboss-seam.jar&quot; of deployment &quot;jboss-seam-booking.ear&quot; are as follows:

	java:global/jboss-seam-booking/jboss-seam/EjbSynchronizations!org.jboss.seam.transaction.LocalEjbSynchronizations
	java:app/jboss-seam/EjbSynchronizations!org.jboss.seam.transaction.LocalEjbSynchronizations
	java:module/EjbSynchronizations!org.jboss.seam.transaction.LocalEjbSynchronizations
	java:global/jboss-seam-booking/jboss-seam/EjbSynchronizations
	java:app/jboss-seam/EjbSynchronizations
	java:module/EjbSynchronizations

15:01:16,140 INFO  [org.jboss.as.ejb3.deployment.processors.EjbJndiBindingsDeploymentUnitProcessor] (MSC service thread 1-6) JNDI bindings for session bean named TimerServiceDispatcher in deployment unit subdeployment &quot;jboss-seam.jar&quot; of deployment &quot;jboss-seam-booking.ear&quot; are as follows:

	java:global/jboss-seam-booking/jboss-seam/TimerServiceDispatcher!org.jboss.seam.async.LocalTimerServiceDispatcher
	java:app/jboss-seam/TimerServiceDispatcher!org.jboss.seam.async.LocalTimerServiceDispatcher
	java:module/TimerServiceDispatcher!org.jboss.seam.async.LocalTimerServiceDispatcher
	java:global/jboss-seam-booking/jboss-seam/TimerServiceDispatcher
	java:app/jboss-seam/TimerServiceDispatcher
	java:module/TimerServiceDispatcher</pre>
        </div>
    </div>
    <p>
We need to modify the WAR's lib/components.xml file to use the new JNDI bindings. In the log, note the EJB JNDI bindings all start with &quot;java:app/jboss-seam-booking.jar&quot;    </p>
    <p>
Replace the &lt;core:init&gt; element as follows:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;!--     &lt;core:init jndi-pattern=&quot;jboss-seam-booking/#{ejbName}/local&quot; debug=&quot;true&quot; distributable=&quot;false&quot;/&gt; --&gt;
&lt;core:init jndi-pattern=&quot;java:app/jboss-seam-booking.jar/#{ejbName}&quot; debug=&quot;true&quot; distributable=&quot;false&quot;/&gt;</pre>
        </div>
    </div>
    <p>
Next, we need to add the EjbSynchronizations and TimerServiceDispatcher JNDI bindings. Add the following component elements to the file:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;component class=&quot;org.jboss.seam.transaction.EjbSynchronizations&quot; jndi-name=&quot;java:app/jboss-seam/EjbSynchronizations&quot;/&gt;
&lt;component class=&quot;org.jboss.seam.async.TimerServiceDispatcher&quot; jndi-name=&quot;java:app/jboss-seam/TimerServiceDispatcher&quot;/&gt;</pre>
        </div>
    </div>
    <p>
The components.xml file should now look like this:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;components xmlns=&quot;http://jboss.com/products/seam/components&quot;
            xmlns:core=&quot;http://jboss.com/products/seam/core&quot;
            xmlns:security=&quot;http://jboss.com/products/seam/security&quot;
            xmlns:transaction=&quot;http://jboss.com/products/seam/transaction&quot;
            xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
            xsi:schemaLocation=
                &quot;http://jboss.com/products/seam/core http://jboss.com/products/seam/core-2.2.xsd
                 http://jboss.com/products/seam/transaction http://jboss.com/products/seam/transaction-2.2.xsd
                 http://jboss.com/products/seam/security http://jboss.com/products/seam/security-2.2.xsd
                 http://jboss.com/products/seam/components http://jboss.com/products/seam/components-2.2.xsd&quot;&gt;

    &lt;!-- &lt;core:init jndi-pattern=&quot;jboss-seam-booking/#{ejbName}/local&quot; debug=&quot;true&quot; distributable=&quot;false&quot;/&gt; --&gt;
    &lt;core:init jndi-pattern=&quot;java:app/jboss-seam-booking.jar/#{ejbName}&quot; debug=&quot;true&quot; distributable=&quot;false&quot;/&gt;

    &lt;core:manager conversation-timeout=&quot;120000&quot;
                  concurrent-request-timeout=&quot;500&quot;
                  conversation-id-parameter=&quot;cid&quot;/&gt;

    &lt;transaction:ejb-transaction/&gt;

    &lt;security:identity authenticate-method=&quot;#{authenticator.authenticate}&quot;/&gt;

    &lt;component class=&quot;org.jboss.seam.transaction.EjbSynchronizations&quot;
            jndi-name=&quot;java:app/jboss-seam/EjbSynchronizations&quot;/&gt;
    &lt;component class=&quot;org.jboss.seam.async.TimerServiceDispatcher&quot;
            jndi-name=&quot;java:app/jboss-seam/TimerServiceDispatcher&quot;/&gt;
&lt;/components&gt;</pre>
        </div>
    </div>
    <p>
Redeploy the application by deleting the <tt class=" ">standalone/deployments/jboss-seam-booking.ear.failed</tt> file and creating a blank <tt class=" ">jboss-seam-booking.ear.dodeploy</tt> file in the same directory.    </p>
    <p>
At this point, the application should deploy and run without error. When you access the URL &ldquo;<a href="http://localhost:8080/seam-booking/">http://localhost:8080/seam-booking/</a>&rdquo; in a browser, you will be able to login successfully.    </p>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-Step4%3AAccesstheapplication"  >
        <h2>Step 4: Access the application</h2>
    
    <p>
Access the URL &ldquo;<a href="http://localhost:8080/seam-booking/">http://localhost:8080/seam-booking/</a>&rdquo; in a browser and login with demo/demo. You should the Booking welcome page.    </p>
    </div>
    
    <div class="section-2"  id="80873207_Seam2BookingEARMigrationofBinaries-StepbyStep-SummaryofChanges"  >
        <h2>Summary of Changes</h2>
    
    <p>
Although it would be much more efficient to determine dependencies in advance and add the implicit dependencies in one step, this exercise shows how problems appear in the log and provides some information on how to debug and resolve them.    </p>
    <p>
The following is a summary of changes made to the application when migrating it to WildFly:    </p>
<ol class=" "><li class=" ">    <p>
We created a <tt class=" ">jboss-deployment-structure.xml</tt> file in the EAR's <tt class=" ">META-INF/</tt> directory. We added &quot;dependencies&quot; and &quot;exclusions&quot; to resolve ClassNotFoundExceptions. This file contains the following data:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;jboss-deployment-structure xmlns=&quot;urn:jboss:deployment-structure:1.0&quot;&gt;
  &lt;deployment&gt;
  	  &lt;dependencies&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;1.2&quot; export=&quot;true&quot;/&gt;
	      &lt;module name=&quot;com.sun.jsf-impl&quot; slot=&quot;1.2&quot; export=&quot;true&quot;/&gt;
	      &lt;module name=&quot;org.apache.commons.logging&quot; export=&quot;true&quot;/&gt;
    	      &lt;module name=&quot;org.dom4j&quot; export=&quot;true&quot;/&gt;
	      &lt;module name=&quot;org.apache.commons.collections&quot; export=&quot;true&quot;/&gt;
	    &lt;/dependencies&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=&quot;jboss-seam-booking.war&quot;&gt;
  	&lt;exclusions&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;main&quot;/&gt;
	      &lt;module name=&quot;com.sun.jsf-impl&quot; slot=&quot;main&quot;/&gt;
	    &lt;/exclusions&gt;
	    &lt;dependencies&gt;
	      &lt;module name=&quot;javax.faces.api&quot; slot=&quot;1.2&quot;/&gt;
	      &lt;module name=&quot;com.sun.jsf-impl&quot; slot=&quot;1.2&quot;/&gt;
	    &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre>
        </div>
    </div>
</li><li class=" ">    <p>
We copied the following JARs from the <tt class=" ">EAP5_HOME/jboss-eap-5.1/seam/lib/</tt> directory to the <tt class=" ">jboss-seam-booking.ear/lib/</tt> directory to resolve ClassNotFoundExceptions:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">hibernate-core.jar
hibernate-validator.jar</pre>
        </div>
    </div>
</li><li class=" ">    <p>
We modified the {{jboss-seam-booking.jar/META-INF/persistence.xml} file as follows.    </p>
<ol class=" "><li class=" ">    <p>
First, we changed the  jta-data-source element to use the Example database that ships with AS7:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;!-- &lt;jta-data-source&gt;java:/bookingDatasource&lt;/jta-data-source&gt; --&gt;
&lt;jta-data-source&gt;java:jboss/datasources/ExampleDS&lt;/jta-data-source&gt;</pre>
        </div>
    </div>
</li><li class=" ">    <p>
Next, we commented out the hibernate.cache.provider_class property:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;!-- &lt;property name=&quot;hibernate.cache.provider_class&quot; value=&quot;org.hibernate.cache.HashtableCacheProvider&quot;/&gt; --&gt;</pre>
        </div>
    </div>
</li></ol></li><li class=" ">    <p>
We modified the WAR's lib/components.xml file to use the new JNDI bindings    </p>
<ol class=" "><li class=" ">    <p>
We replaced the &lt;core:init&gt; existing element as follows:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;!-- &lt;core:init jndi-pattern=&quot;jboss-seam-booking/#{ejbName}/local&quot; debug=&quot;true&quot; distributable=&quot;false&quot;/&gt; --&gt;
&lt;core:init jndi-pattern=&quot;java:app/jboss-seam-booking.jar/#{ejbName}&quot; debug=&quot;true&quot; distributable=&quot;false&quot;/&gt;</pre>
        </div>
    </div>
</li><li class=" ">    <p>
We added component elements for the &quot;EjbSynchronizations&quot; and &quot;TimerServiceDispatcher&quot; JNDI bindings    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;"> &lt;component class=&quot;org.jboss.seam.transaction.EjbSynchronizations&quot; jndi-name=&quot;java:app/jboss-seam/EjbSynchronizations&quot;/&gt;
 &lt;component class=&quot;org.jboss.seam.async.TimerServiceDispatcher&quot; jndi-name=&quot;java:app/jboss-seam/TimerServiceDispatcher&quot;/&gt;</pre>
        </div>
    </div>
</li></ol></li></ol>    <p>
The unmodified EAR from EAP 5.1 (jboss-seam-booking-eap51.ear.tar.gz) and the EAR as modified to run on AS7 (jboss-seam-booking-as7.ear.tar.gz) are attached to this document.    </p>
    </div>
    
        </div>
              <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li>
          <li class="home"><a accesskey="h" href="Documentation.html"><strong>Front page</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </ul>
          </div>
    <script type="text/javascript">
      SyntaxHighlighter.all()
    </script>
</body>
</html>
