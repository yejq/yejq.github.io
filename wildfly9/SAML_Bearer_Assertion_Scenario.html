<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>SAML Bearer Assertion Scenario - WildFly 9</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
    <meta content="Scroll Wiki Publisher" name="generator"/>

    <link type="text/css" rel="stylesheet" href="css/blueprint/liquid.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/blueprint/print.css" media="print"/>
    <!--[if lt IE 8]><link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection"/><![endif]-->

    <link type="text/css" rel="stylesheet" href="css/content-style.css" media="screen, projection, print"/>
    <link type="text/css" rel="stylesheet" href="css/screen.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/print.css" media="print"/>
    
    <link type="text/css" rel="stylesheet" href="css/jbossorg.css"/>
    <link type="text/css" rel="stylesheet" href="css/docnav.css"/>    
    
    <link type="text/css" rel="stylesheet" href="sh/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="sh/shCoreDefault.css"/>
    <script type="text/javascript" src="sh/shCore.js"></script>
    <script type="text/javascript" src="sh/shBrushAppleScript.js"></script>
    <script type="text/javascript" src="sh/shBrushAS3.js"></script>
    <script type="text/javascript" src="sh/shBrushBash.js"></script>
    <script type="text/javascript" src="sh/shBrushCpp.js"></script>
    <script type="text/javascript" src="sh/shBrushCSharp.js"></script>
    <script type="text/javascript" src="sh/shBrushCss.js"></script>
    <script type="text/javascript" src="sh/shBrushDiff.js"></script>
    <script type="text/javascript" src="sh/shBrushErlang.js"></script>
    <script type="text/javascript" src="sh/shBrushGroovy.js"></script>
    <script type="text/javascript" src="sh/shBrushJava.js"></script>
    <script type="text/javascript" src="sh/shBrushJavaFX.js"></script>
    <script type="text/javascript" src="sh/shBrushJScript.js"></script>
    <script type="text/javascript" src="sh/shBrushPerl.js"></script>
    <script type="text/javascript" src="sh/shBrushPhp.js"></script>
    <script type="text/javascript" src="sh/shBrushPlain.js"></script>
    <script type="text/javascript" src="sh/shBrushPython.js"></script>
    <script type="text/javascript" src="sh/shBrushRuby.js"></script>
    <script type="text/javascript" src="sh/shBrushScala.js"></script>
    <script type="text/javascript" src="sh/shBrushSql.js"></script>
    <script type="text/javascript" src="sh/shBrushVb.js"></script>
    <script type="text/javascript" src="sh/shBrushXml.js"></script>
    
</head>
<body>
    <div class="container" style="min-width: 760px;">
        <div class="block header">
          <p id="title">
            <a class="site_href" href="http://www.jboss.org"><strong>JBoss.org</strong></a>
            <a class="doc_href" href="http://docs.jboss.org"><strong>Community Documentation</strong></a>
          </p>
                  <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <li class="previous"><a accesskey="p" href="OnBehalfOf_WS-Trust_Scenario.html"><strong>Prev</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <li class="next"><a accesskey="n" href="SAML_Holder-Of-Key_Assertion_Scenario.html"><strong>Next</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </ul>
                    <div>
            <h1>SAML Bearer Assertion Scenario</h1>
          </div>          
          </div>

        <div class="block content">
<ul class=" "><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-SAMLBearerAssertionScenario">SAML Bearer Assertion Scenario</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-WebserviceProvider">Web service Provider</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-WebserviceproviderWSDL">Web service provider WSDL</a>    </p>
</li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-SSLconfiguration">SSL configuration</a>    </p>
</li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-WebserviceInterface">Web service Interface</a>    </p>
</li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-WebserviceImplementation">Web service Implementation</a>    </p>
</li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-Cryptopropertiesandkeystorefiles">Crypto properties and keystore files</a>    </p>
</li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-MANIFEST.MF">MANIFEST.MF</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-BearerSecurityTokenService">Bearer Security Token Service</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-SecurityDomain">Security Domain</a>    </p>
</li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-STS%27sWSDL">STS's WSDL</a>    </p>
</li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-STS%27simplementationclass">STS's implementation class</a>    </p>
</li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-STSBearerCallbackHandler">STSBearerCallbackHandler</a>    </p>
</li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-Cryptopropertiesandkeystorefiles">Crypto properties and keystore files</a>    </p>
</li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-MANIFEST.MF">MANIFEST.MF</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-Webservicerequester">Web service requester</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-WebservicerequesterImplementation">Web service requester Implementation</a>    </p>
</li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-ClientCallbackHandler">ClientCallbackHandler</a>    </p>
</li><li class=" ">    <p>
<a href="SAML_Bearer_Assertion_Scenario.html#90439853_SAMLBearerAssertionScenario-Cryptopropertiesandkeystorefiles">Crypto properties and keystore files</a>    </p>
</li></ul></li></ul></li></ul>    <div class="section-2"  id="90439853_SAMLBearerAssertionScenario-SAMLBearerAssertionScenario"  >
        <h2>SAML Bearer Assertion Scenario</h2>
    
    <p>
WS-Trust deals with managing software security tokens.&nbsp; A SAML  assertion is a type of security token.&nbsp; In the SAML Bearer scenario, the  service provider automatically trusts that the incoming SOAP request  came from the subject defined in the SAML token after the service  verifies the tokens signature.    </p>
    <p>
Implementation of this scenario has the following requirements.    </p>
<ul class=" "><li class=" ">    <p>
SAML  tokens with a Bearer subject confirmation method must be protected so  the token can not be snooped.&nbsp; In most cases, a bearer token combined  with HTTPS is sufficient to prevent &quot;a man in the middle&quot; getting  possession of the token.&nbsp; This means a security policy that uses a  sp:TransportBinding and sp:HttpsToken.    </p>
</li><li class=" ">    <p>
A bearer token has no  encryption or signing keys associated with it, therefore a  sp:IssuedToken of bearer keyType should be used with a  sp:SupportingToken or a sp:SignedSupportingTokens.    </p>
</li></ul>    <div class="section-3"  id="90439853_SAMLBearerAssertionScenario-WebserviceProvider"  >
        <h3>Web service Provider</h3>
    
    <p>
This section examines the web service elements for the SAML Bearer scenario.&nbsp; The components are    </p>
<ul class=" "><li class=" ">    <p>
Bearer web service provider's WSDL    </p>
</li><li class=" ">    <p>
SSL configuration    </p>
</li><li class=" ">    <p>
Bearer web service provider's Interface and Implementation classes.    </p>
</li><li class=" ">    <p>
Crypto properties and keystore files    </p>
</li><li class=" ">    <p>
MANIFEST.MF    </p>
</li></ul>    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-WebserviceproviderWSDL"  >
        <h4>Web service provider WSDL</h4>
    
    <p>
The web service provider is a contract-first endpoint.&nbsp; All the WS-trust  and security policies for it are declared in WSDL, BearerService.wsdl.&nbsp;  For this scenario a ws-requester is required to present a SAML 2.0  Bearer token issued from a designed STS. The address of the STS is  provided in the WSDL.&nbsp; HTTPS, a TransportBinding and HttpsToken policy  are used to protect the SOAP body of messages that pass back and forth  between ws-requester and ws-provider.&nbsp; A detailed explanation of the  security settings are provided in the comments in the listing below.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;definitions targetNamespace=&quot;http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy&quot;
             name=&quot;BearerService&quot;
             xmlns:tns=&quot;http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy&quot;
             xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;
             xmlns:soap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot;
             xmlns=&quot;http://schemas.xmlsoap.org/wsdl/&quot;
             xmlns:wsp=&quot;http://www.w3.org/ns/ws-policy&quot;
             xmlns:wsam=&quot;http://www.w3.org/2007/05/addressing/metadata&quot;
             xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;
             xmlns:wsaws=&quot;http://www.w3.org/2005/08/addressing&quot;
             xmlns:wsx=&quot;http://schemas.xmlsoap.org/ws/2004/09/mex&quot;
             xmlns:sp=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702&quot;
             xmlns:t=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512&quot;&gt;

  &lt;types&gt;
    &lt;xsd:schema&gt;
      &lt;xsd:import namespace=&quot;http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy&quot;
                  schemaLocation=&quot;BearerService_schema1.xsd&quot;/&gt;
    &lt;/xsd:schema&gt;
  &lt;/types&gt;
  &lt;message name=&quot;sayHello&quot;&gt;
    &lt;part name=&quot;parameters&quot; element=&quot;tns:sayHello&quot;/&gt;
  &lt;/message&gt;
  &lt;message name=&quot;sayHelloResponse&quot;&gt;
    &lt;part name=&quot;parameters&quot; element=&quot;tns:sayHelloResponse&quot;/&gt;
  &lt;/message&gt;
  &lt;portType name=&quot;BearerIface&quot;&gt;
    &lt;operation name=&quot;sayHello&quot;&gt;
      &lt;input message=&quot;tns:sayHello&quot;/&gt;
      &lt;output message=&quot;tns:sayHelloResponse&quot;/&gt;
    &lt;/operation&gt;
  &lt;/portType&gt;

&lt;!--
        The wsp:PolicyReference binds the security requirments on all the endpoints.
        The wsp:Policy wsu:Id=&quot;#TransportSAML2BearerPolicy&quot; element is defined later in this file.
--&gt;
  &lt;binding name=&quot;BearerServicePortBinding&quot; type=&quot;tns:BearerIface&quot;&gt;
    &lt;wsp:PolicyReference URI=&quot;#TransportSAML2BearerPolicy&quot; /&gt;
    &lt;soap:binding transport=&quot;http://schemas.xmlsoap.org/soap/http&quot; style=&quot;document&quot;/&gt;
    &lt;operation name=&quot;sayHello&quot;&gt;
      &lt;soap:operation soapAction=&quot;&quot;/&gt;
      &lt;input&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/input&gt;
      &lt;output&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/output&gt;
    &lt;/operation&gt;
  &lt;/binding&gt;

&lt;!--
  The soap:address has been defined to use JBoss's https port, 8443.  This is
  set in conjunction with the sp:TransportBinding policy for https.
--&gt;
  &lt;service name=&quot;BearerService&quot;&gt;
    &lt;port name=&quot;BearerServicePort&quot; binding=&quot;tns:BearerServicePortBinding&quot;&gt;
      &lt;soap:address location=&quot;https://@jboss.bind.address@:8443/jaxws-samples-wsse-policy-trust-bearer/BearerService&quot;/&gt;
    &lt;/port&gt;
  &lt;/service&gt;


  &lt;wsp:Policy wsu:Id=&quot;TransportSAML2BearerPolicy&quot;&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
  &lt;!--
        The wsam:Addressing element, indicates that the endpoints of this
        web service MUST conform to the WS-Addressing specification.  The
        attribute wsp:Optional=&quot;false&quot; enforces this assertion.
  --&gt;
        &lt;wsam:Addressing wsp:Optional=&quot;false&quot;&gt;
          &lt;wsp:Policy /&gt;
        &lt;/wsam:Addressing&gt;

&lt;!--
  The sp:TransportBinding element indicates that security is provided by the
  message exchange transport medium, https.  WS-Security policy specification
  defines the sp:HttpsToken for use in exchanging messages transmitted over HTTPS.
--&gt;
        &lt;sp:TransportBinding
          xmlns:sp=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702&quot;&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:TransportToken&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:HttpsToken&gt;
                  &lt;wsp:Policy/&gt;
                &lt;/sp:HttpsToken&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:TransportToken&gt;
&lt;!--
     The sp:AlgorithmSuite element, requires the TripleDes algorithm suite
     be used in performing cryptographic operations.
--&gt;
            &lt;sp:AlgorithmSuite&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:TripleDes /&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:AlgorithmSuite&gt;
&lt;!--
     The sp:Layout element,  indicates the layout rules to apply when adding
     items to the security header.  The sp:Lax sub-element indicates items
     are added to the security header in any order that conforms to
     WSS: SOAP Message Security.
--&gt;
            &lt;sp:Layout&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:Lax /&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:Layout&gt;
            &lt;sp:IncludeTimestamp /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:TransportBinding&gt;

&lt;!--
  The sp:SignedSupportingTokens element causes the supporting tokens
  to be signed using the primary token that is used to sign the message.
--&gt;
        &lt;sp:SignedSupportingTokens
          xmlns:sp=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702&quot;&gt;
          &lt;wsp:Policy&gt;
&lt;!--
  The sp:IssuedToken element asserts that a SAML 2.0 security token of type
  Bearer is expected from the STS.  The
  sp:IncludeToken=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient&quot;&gt;
  attribute instructs the runtime to include the initiator's public key
  with every message sent to the recipient.

  The sp:RequestSecurityTokenTemplate element directs that all of the
  children of this element will be copied directly into the body of the
  RequestSecurityToken (RST) message that is sent to the STS when the
  initiator asks the STS to issue a token.
--&gt;
            &lt;sp:IssuedToken
              sp:IncludeToken=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient&quot;&gt;
              &lt;sp:RequestSecurityTokenTemplate&gt;
                &lt;t:TokenType&gt;http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0&lt;/t:TokenType&gt;
                &lt;t:KeyType&gt;http://docs.oasis-open.org/ws-sx/ws-trust/200512/Bearer&lt;/t:KeyType&gt;
              &lt;/sp:RequestSecurityTokenTemplate&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:RequireInternalReference /&gt;
              &lt;/wsp:Policy&gt;
&lt;!--
  The sp:Issuer element defines the STS's address and endpoint information
  This information is used by the STSClient.
--&gt;
              &lt;sp:Issuer&gt;
                &lt;wsaws:Address&gt;http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-sts-bearer/SecurityTokenService&lt;/wsaws:Address&gt;
                &lt;wsaws:Metadata
                  xmlns:wsdli=&quot;http://www.w3.org/2006/01/wsdl-instance&quot;
                  wsdli:wsdlLocation=&quot;http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-sts-bearer/SecurityTokenService?wsdl&quot;&gt;
                  &lt;wsaw:ServiceName
                    xmlns:wsaw=&quot;http://www.w3.org/2006/05/addressing/wsdl&quot;
                    xmlns:stsns=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/&quot;
                    EndpointName=&quot;UT_Port&quot;&gt;stsns:SecurityTokenService&lt;/wsaw:ServiceName&gt;
                &lt;/wsaws:Metadata&gt;
              &lt;/sp:Issuer&gt;

            &lt;/sp:IssuedToken&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:SignedSupportingTokens&gt;
&lt;!--
    The sp:Wss11 element declares WSS: SOAP Message Security 1.1 options
    to be supported by the STS.  These particular elements generally refer
    to how keys are referenced within the SOAP envelope.  These are normally
    handled by CXF.
--&gt;
        &lt;sp:Wss11&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportRefIssuerSerial /&gt;
            &lt;sp:MustSupportRefThumbprint /&gt;
            &lt;sp:MustSupportRefEncryptedKey /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Wss11&gt;
&lt;!--
    The sp:Trust13 element declares controls for WS-Trust 1.3 options.
    They are policy assertions related to exchanges specifically with
    client and server challenges and entropy behaviors.  Again these are
    normally handled by CXF.
--&gt;
        &lt;sp:Trust13&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportIssuedTokens /&gt;
            &lt;sp:RequireClientEntropy /&gt;
            &lt;sp:RequireServerEntropy /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Trust13&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

&lt;/definitions&gt;</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-SSLconfiguration"  >
        <h4>SSL configuration</h4>
    
    <p>
This web service is using https, therefore the JBoss server must be configured to provide SSL support in the Web subsystem.&nbsp; There are 2 components to SSL configuration.    </p>
<ul class=" "><li class=" ">    <p>
create a certificate keystore    </p>
</li><li class=" ">    <p>
declare an SSL connector in the Web subsystem of the JBoss server configuration file.    </p>
</li></ul>    <p>
Follow the directions in the, &quot;<i class=" ">Using the pure Java implementation supplied by JSSE</i>&quot; section in the <a href="https://docs.jboss.org/author/display/WFLY8/SSL+setup+guide">SSL Setup Guide</a>.    </p>
    <p>
Here is an example of an SSL connector declaration.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:web:1.4&quot; default-virtual-server=&quot;default-host&quot; native=&quot;false&quot;&gt;
  .....
  &lt;connector name=&quot;jbws-https-connector&quot; protocol=&quot;HTTP/1.1&quot; scheme=&quot;https&quot; socket-binding=&quot;https&quot; secure=&quot;true&quot; enabled=&quot;true&quot;&gt;
    &lt;ssl key-alias=&quot;tomcat&quot; password=&quot;changeit&quot; certificate-key-file=&quot;/myJbossHome/security/test.keystore&quot; verify-client=&quot;false&quot;/&gt;
  &lt;/connector&gt;
  ...</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-WebserviceInterface"  >
        <h4>Web service Interface</h4>
    
    <p>
The web service provider interface class, BearerIface, is a simple straight forward web service definition.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.bearer;

import javax.jws.WebMethod;
import javax.jws.WebService;

@WebService
(
   targetNamespace = &quot;http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy&quot;
)
public interface BearerIface
{
   @WebMethod
   String sayHello();
}</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-WebserviceImplementation"  >
        <h4>Web service Implementation</h4>
    
    <p>
The web service provider implementation class, BearerImpl, is a  simple POJO.&nbsp; It uses the standard WebService annotation to define the  service endpoint. In addition there are two Apache CXF annotations,  EndpointProperties and EndpointProperty used for configuring the  endpoint for the CXF runtime. These annotations come from the <a href="https://ws.apache.org/wss4j/">Apache WSS4J project</a>,  which provides a Java implementation of the primary WS-Security  standards for Web Services. These annotations are programmatically  adding properties to the endpoint. With plain Apache CXF, these properties are often set via the  &lt;jaxws:properties&gt; element on the   &lt;jaxws:endpoint&gt; element  in the Spring config; these   annotations allow the properties to be  configured in the code.    </p>
    <p>
WSS4J  uses the Crypto interface to get keys and certificates for signature  creation/verification, as is asserted by the WSDL for this service.&nbsp; The  WSS4J configuration information being provided by BearerImpl is for  Crypto's Merlin implementation.&nbsp; More information will be provided about  this in the keystore section.    </p>
    <p>
Because the web  service provider automatically trusts that the incoming SOAP request  came from the subject defined in the SAML token there is no need for a  Crypto callbackHandler class or a signature username, unlike in prior  examples, however in order to verify the message signature, the Java  properties file that contains the (Merlin) crypto configuration  information is still required.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.bearer;

import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;

import javax.jws.WebService;

@WebService
(
   portName = &quot;BearerServicePort&quot;,
   serviceName = &quot;BearerService&quot;,
   wsdlLocation = &quot;WEB-INF/wsdl/BearerService.wsdl&quot;,
   targetNamespace = &quot;http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy&quot;,
   endpointInterface = &quot;org.jboss.test.ws.jaxws.samples.wsse.policy.trust.bearer.BearerIface&quot;
)
@EndpointProperties(value = {
   @EndpointProperty(key = &quot;ws-security.signature.properties&quot;, value = &quot;serviceKeystore.properties&quot;)
})
public class BearerImpl implements BearerIface
{
   public String sayHello()
   {
      return &quot;Bearer WS-Trust Hello World!&quot;;
   }
}</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-Cryptopropertiesandkeystorefiles"  >
        <h4>Crypto properties and keystore files</h4>
    
    <p>
WSS4J's Crypto implementation is loaded and configured via a Java   properties file that contains Crypto configuration data.&nbsp; The file   contains implementation-specific properties such as a keystore location,   password, default alias and the like.&nbsp; This application is using the   Merlin implementation. File serviceKeystore.properties contains this   information.    </p>
    <p>
File  servicestore.jks, is a Java KeyStore (JKS) repository.&nbsp; It  contains  self signed certificates for myservicekey and mystskey.&nbsp; <i class=" ">Self signed certificates are not appropriate for production use.</i>    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=sspass
org.apache.ws.security.crypto.merlin.keystore.alias=myservicekey
org.apache.ws.security.crypto.merlin.keystore.file=servicestore.jks</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-MANIFEST.MF"  >
        <h4>MANIFEST.MF</h4>
    
    <p>
When deployed on WildFly this application requires   access to the JBossWs and CXF APIs provided in module   org.jboss.ws.cxf.jbossws-cxf-client.&nbsp; The dependency statement directs  the server to provide them at deployment.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">Manifest-Version: 1.0  
Ant-Version: Apache Ant 1.8.2  
Created-By: 1.7.0_25-b15 (Oracle Corporation)  
Dependencies: org.jboss.ws.cxf.jbossws-cxf-client</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-3"  id="90439853_SAMLBearerAssertionScenario-BearerSecurityTokenService"  >
        <h3>Bearer Security Token Service</h3>
    
    <p>
This section examines the crucial elements in providing the Security  Token Service functionality for providing a SAML Bearer token.&nbsp; The  components that will be discussed are.    </p>
<ul class=" "><li class=" ">    <p>
Security Domain    </p>
</li><li class=" ">    <p>
STS's WSDL    </p>
</li><li class=" ">    <p>
STS's implementation class    </p>
</li><li class=" ">    <p>
STSBearerCallbackHandler    </p>
</li><li class=" ">    <p>
Crypto properties and keystore files    </p>
</li><li class=" ">    <p>
MANIFEST.MF    </p>
</li></ul>    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-SecurityDomain"  >
        <h4>Security Domain</h4>
    
    <p>
The STS requires a JBoss security domain be configured.&nbsp; The  jboss-web.xml descriptor declares a named security  domain,&quot;JBossWS-trust-sts&quot; to be used by this service for  authentication.&nbsp; This security domain requires two properties files and  the addition of a security-domain declaration in the JBoss server  configuration file.    </p>
    <p>
For this scenario the domain needs to contain user <i class=" ">alice</i>, password <i class=" ">clarinet</i>, and role <i class=" ">friend</i>.  See the listings below for jbossws-users.properties and  jbossws-roles.properties.&nbsp; In addition the following XML must be added  to the JBoss security subsystem in the server configuration file.&nbsp;  Replace &quot;<strong class=" ">SOME_PATH</strong>&quot; with appropriate information.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;security-domain name=&quot;JBossWS-trust-sts&quot;&gt;
  &lt;authentication&gt;
    &lt;login-module code=&quot;UsersRoles&quot; flag=&quot;required&quot;&gt;
      &lt;module-option name=&quot;usersProperties&quot; value=&quot;/SOME_PATH/jbossws-users.properties&quot;/&gt;
      &lt;module-option name=&quot;unauthenticatedIdentity&quot; value=&quot;anonymous&quot;/&gt;
      &lt;module-option name=&quot;rolesProperties&quot; value=&quot;/SOME_PATH/jbossws-roles.properties&quot;/&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
&lt;/security-domain&gt;</pre>
        </div>
    </div>
    <p>
jboss-web.xml    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;  
&lt;!DOCTYPE jboss-web PUBLIC &quot;-//JBoss//DTD Web Application 2.4//EN&quot; &quot;&gt;  
&lt;jboss-web&gt;  
  &lt;security-domain&gt;java:/jaas/JBossWS-trust-sts&lt;/security-domain&gt;  
&lt;/jboss-web&gt;</pre>
        </div>
    </div>
    <p>
jbossws-users.properties    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;"># A sample users.properties file for use with the UsersRolesLoginModule  
alice=clarinet</pre>
        </div>
    </div>
    <p>
jbossws-roles.properties    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;"># A sample roles.properties file for use with the UsersRolesLoginModule  
alice=friend</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-STS%27sWSDL"  >
        <h4>STS's WSDL</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;wsdl:definitions
  targetNamespace=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/&quot;
  xmlns:tns=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/&quot;
  xmlns:wstrust=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/&quot;
  xmlns:wsdl=&quot;http://schemas.xmlsoap.org/wsdl/&quot;
  xmlns:soap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot;
  xmlns:wsap10=&quot;http://www.w3.org/2006/05/addressing/wsdl&quot;
  xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;
  xmlns:wsp=&quot;http://www.w3.org/ns/ws-policy&quot;
  xmlns:wst=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512&quot;
  xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;
  xmlns:wsam=&quot;http://www.w3.org/2007/05/addressing/metadata&quot;&gt;

  &lt;wsdl:types&gt;
    &lt;xs:schema elementFormDefault=&quot;qualified&quot;
               targetNamespace='http://docs.oasis-open.org/ws-sx/ws-trust/200512'&gt;

      &lt;xs:element name='RequestSecurityToken'
                  type='wst:AbstractRequestSecurityTokenType'/&gt;
      &lt;xs:element name='RequestSecurityTokenResponse'
                  type='wst:AbstractRequestSecurityTokenType'/&gt;

      &lt;xs:complexType name='AbstractRequestSecurityTokenType'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:any namespace='##any' processContents='lax' minOccurs='0'
                  maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attribute name='Context' type='xs:anyURI' use='optional'/&gt;
        &lt;xs:anyAttribute namespace='##other' processContents='lax'/&gt;
      &lt;/xs:complexType&gt;
      &lt;xs:element name='RequestSecurityTokenCollection'
                  type='wst:RequestSecurityTokenCollectionType'/&gt;
      &lt;xs:complexType name='RequestSecurityTokenCollectionType'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name='RequestSecurityToken'
                      type='wst:AbstractRequestSecurityTokenType' minOccurs='2'
                      maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:complexType&gt;

      &lt;xs:element name='RequestSecurityTokenResponseCollection'
                  type='wst:RequestSecurityTokenResponseCollectionType'/&gt;
      &lt;xs:complexType name='RequestSecurityTokenResponseCollectionType'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element ref='wst:RequestSecurityTokenResponse' minOccurs='1'
                      maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:anyAttribute namespace='##other' processContents='lax'/&gt;
      &lt;/xs:complexType&gt;

    &lt;/xs:schema&gt;
  &lt;/wsdl:types&gt;

  &lt;!-- WS-Trust defines the following GEDs --&gt;
  &lt;wsdl:message name=&quot;RequestSecurityTokenMsg&quot;&gt;
    &lt;wsdl:part name=&quot;request&quot; element=&quot;wst:RequestSecurityToken&quot;/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name=&quot;RequestSecurityTokenResponseMsg&quot;&gt;
    &lt;wsdl:part name=&quot;response&quot;
               element=&quot;wst:RequestSecurityTokenResponse&quot;/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name=&quot;RequestSecurityTokenCollectionMsg&quot;&gt;
    &lt;wsdl:part name=&quot;requestCollection&quot;
               element=&quot;wst:RequestSecurityTokenCollection&quot;/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name=&quot;RequestSecurityTokenResponseCollectionMsg&quot;&gt;
    &lt;wsdl:part name=&quot;responseCollection&quot;
               element=&quot;wst:RequestSecurityTokenResponseCollection&quot;/&gt;
  &lt;/wsdl:message&gt;

  &lt;!-- This portType an example of a Requestor (or other) endpoint that
  Accepts SOAP-based challenges from a Security Token Service --&gt;
  &lt;wsdl:portType name=&quot;WSSecurityRequestor&quot;&gt;
    &lt;wsdl:operation name=&quot;Challenge&quot;&gt;
      &lt;wsdl:input message=&quot;tns:RequestSecurityTokenResponseMsg&quot;/&gt;
      &lt;wsdl:output message=&quot;tns:RequestSecurityTokenResponseMsg&quot;/&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:portType&gt;

  &lt;!-- This portType is an example of an STS supporting full protocol --&gt;
  &lt;!--
      The wsdl:portType and data types are XML elements defined by the
      WS_Trust specification.  The wsdl:portType defines the endpoints
      supported in the STS implementation.  This WSDL defines all operations
      that an STS implementation can support.
  --&gt;
  &lt;wsdl:portType name=&quot;STS&quot;&gt;
    &lt;wsdl:operation name=&quot;Cancel&quot;&gt;
      &lt;wsdl:input
        wsam:Action=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Cancel&quot;
        message=&quot;tns:RequestSecurityTokenMsg&quot;/&gt;
      &lt;wsdl:output
        wsam:Action=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/CancelFinal&quot;
        message=&quot;tns:RequestSecurityTokenResponseMsg&quot;/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name=&quot;Issue&quot;&gt;
      &lt;wsdl:input
        wsam:Action=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Issue&quot;
        message=&quot;tns:RequestSecurityTokenMsg&quot;/&gt;
      &lt;wsdl:output
        wsam:Action=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTRC/IssueFinal&quot;
        message=&quot;tns:RequestSecurityTokenResponseCollectionMsg&quot;/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name=&quot;Renew&quot;&gt;
      &lt;wsdl:input
        wsam:Action=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Renew&quot;
        message=&quot;tns:RequestSecurityTokenMsg&quot;/&gt;
      &lt;wsdl:output
        wsam:Action=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/RenewFinal&quot;
        message=&quot;tns:RequestSecurityTokenResponseMsg&quot;/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name=&quot;Validate&quot;&gt;
      &lt;wsdl:input
        wsam:Action=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Validate&quot;
        message=&quot;tns:RequestSecurityTokenMsg&quot;/&gt;
      &lt;wsdl:output
        wsam:Action=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/ValidateFinal&quot;
        message=&quot;tns:RequestSecurityTokenResponseMsg&quot;/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name=&quot;KeyExchangeToken&quot;&gt;
      &lt;wsdl:input
        wsam:Action=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/KET&quot;
        message=&quot;tns:RequestSecurityTokenMsg&quot;/&gt;
      &lt;wsdl:output
        wsam:Action=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/KETFinal&quot;
        message=&quot;tns:RequestSecurityTokenResponseMsg&quot;/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name=&quot;RequestCollection&quot;&gt;
      &lt;wsdl:input message=&quot;tns:RequestSecurityTokenCollectionMsg&quot;/&gt;
      &lt;wsdl:output message=&quot;tns:RequestSecurityTokenResponseCollectionMsg&quot;/&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:portType&gt;

  &lt;!-- This portType is an example of an endpoint that accepts
  Unsolicited RequestSecurityTokenResponse messages --&gt;
  &lt;wsdl:portType name=&quot;SecurityTokenResponseService&quot;&gt;
    &lt;wsdl:operation name=&quot;RequestSecurityTokenResponse&quot;&gt;
      &lt;wsdl:input message=&quot;tns:RequestSecurityTokenResponseMsg&quot;/&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:portType&gt;

  &lt;!--
      The wsp:PolicyReference binds the security requirments on all the STS endpoints.
      The wsp:Policy wsu:Id=&quot;UT_policy&quot; element is later in this file.
  --&gt;
  &lt;wsdl:binding name=&quot;UT_Binding&quot; type=&quot;wstrust:STS&quot;&gt;
    &lt;wsp:PolicyReference URI=&quot;#UT_policy&quot;/&gt;
    &lt;soap:binding style=&quot;document&quot;
                  transport=&quot;http://schemas.xmlsoap.org/soap/http&quot;/&gt;
    &lt;wsdl:operation name=&quot;Issue&quot;&gt;
      &lt;soap:operation
        soapAction=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Issue&quot;/&gt;
      &lt;wsdl:input&gt;
        &lt;wsp:PolicyReference
          URI=&quot;#Input_policy&quot;/&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;wsp:PolicyReference
          URI=&quot;#Output_policy&quot;/&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name=&quot;Validate&quot;&gt;
      &lt;soap:operation
        soapAction=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Validate&quot;/&gt;
      &lt;wsdl:input&gt;
        &lt;wsp:PolicyReference
          URI=&quot;#Input_policy&quot;/&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;wsp:PolicyReference
          URI=&quot;#Output_policy&quot;/&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name=&quot;Cancel&quot;&gt;
      &lt;soap:operation
        soapAction=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Cancel&quot;/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name=&quot;Renew&quot;&gt;
      &lt;soap:operation
        soapAction=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Renew&quot;/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name=&quot;KeyExchangeToken&quot;&gt;
      &lt;soap:operation
        soapAction=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/KeyExchangeToken&quot;/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name=&quot;RequestCollection&quot;&gt;
      &lt;soap:operation
        soapAction=&quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/RequestCollection&quot;/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use=&quot;literal&quot;/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:binding&gt;

  &lt;wsdl:service name=&quot;SecurityTokenService&quot;&gt;
    &lt;wsdl:port name=&quot;UT_Port&quot; binding=&quot;tns:UT_Binding&quot;&gt;
      &lt;soap:address location=&quot;http://localhost:8080/SecurityTokenService/UT&quot;/&gt;
    &lt;/wsdl:port&gt;
  &lt;/wsdl:service&gt;


  &lt;wsp:Policy wsu:Id=&quot;UT_policy&quot;&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
        &lt;!--
            The sp:UsingAddressing element, indicates that the endpoints of this
            web service conforms to the WS-Addressing specification.  More detail
            can be found here: [http://www.w3.org/TR/2006/CR-ws-addr-wsdl-20060529]
        --&gt;
        &lt;wsap10:UsingAddressing/&gt;
        &lt;!--
            The sp:SymmetricBinding element indicates that security is provided
            at the SOAP layer and any initiator must authenticate itself by providing
            WSS UsernameToken credentials.
        --&gt;
        &lt;sp:SymmetricBinding
          xmlns:sp=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702&quot;&gt;
          &lt;wsp:Policy&gt;
            &lt;!--
                In a symmetric binding, the keys used for encrypting and signing in both
                directions are derived from a single key, the one specified by the
                sp:ProtectionToken element.  The sp:X509Token sub-element declares this
                key to be a X.509 certificate and the
                IncludeToken=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never&quot;
                attribute adds the requirement that the token MUST NOT be included in
                any messages sent between the initiator and the recipient; rather, an
                external reference to the token should be used.  Lastly the WssX509V3Token10
                sub-element declares that the Username token presented by the initiator
                should be compliant with Web Services Security UsernameToken Profile
                1.0 specification. [ http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0.pdf ]
            --&gt;
            &lt;sp:ProtectionToken&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:X509Token
                  sp:IncludeToken=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never&quot;&gt;
                  &lt;wsp:Policy&gt;
                    &lt;sp:RequireDerivedKeys/&gt;
                    &lt;sp:RequireThumbprintReference/&gt;
                    &lt;sp:WssX509V3Token10/&gt;
                  &lt;/wsp:Policy&gt;
                &lt;/sp:X509Token&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:ProtectionToken&gt;
            &lt;!--
                The sp:AlgorithmSuite element, requires the Basic256 algorithm suite
                be used in performing cryptographic operations.
            --&gt;
            &lt;sp:AlgorithmSuite&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:Basic256/&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:AlgorithmSuite&gt;
            &lt;!--
                The sp:Layout element,  indicates the layout rules to apply when adding
                items to the security header.  The sp:Lax sub-element indicates items
                are added to the security header in any order that conforms to
                WSS: SOAP Message Security.
            --&gt;
            &lt;sp:Layout&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:Lax/&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:Layout&gt;
            &lt;sp:IncludeTimestamp/&gt;
            &lt;sp:EncryptSignature/&gt;
            &lt;sp:OnlySignEntireHeadersAndBody/&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:SymmetricBinding&gt;

        &lt;!--
            The sp:SignedSupportingTokens element declares that the security header
            of messages must contain a sp:UsernameToken and the token must be signed.
            The attribute IncludeToken=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient&quot;
            on sp:UsernameToken indicates that the token MUST be included in all
            messages sent from initiator to the recipient and that the token MUST
            NOT be included in messages sent from the recipient to the initiator.
            And finally the element sp:WssUsernameToken10 is a policy assertion
            indicating the Username token should be as defined in  Web Services
            Security UsernameToken Profile 1.0
        --&gt;
        &lt;sp:SignedSupportingTokens
          xmlns:sp=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702&quot;&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:UsernameToken
              sp:IncludeToken=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient&quot;&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:WssUsernameToken10/&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:UsernameToken&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:SignedSupportingTokens&gt;
        &lt;!--
            The sp:Wss11 element declares WSS: SOAP Message Security 1.1 options
            to be supported by the STS.  These particular elements generally refer
            to how keys are referenced within the SOAP envelope.  These are normally
            handled by CXF.
        --&gt;
        &lt;sp:Wss11
          xmlns:sp=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702&quot;&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportRefKeyIdentifier/&gt;
            &lt;sp:MustSupportRefIssuerSerial/&gt;
            &lt;sp:MustSupportRefThumbprint/&gt;
            &lt;sp:MustSupportRefEncryptedKey/&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Wss11&gt;
        &lt;!--
            The sp:Trust13 element declares controls for WS-Trust 1.3 options.
            They are policy assertions related to exchanges specifically with
            client and server challenges and entropy behaviors.  Again these are
            normally handled by CXF.
        --&gt;
        &lt;sp:Trust13
          xmlns:sp=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702&quot;&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportIssuedTokens/&gt;
            &lt;sp:RequireClientEntropy/&gt;
            &lt;sp:RequireServerEntropy/&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Trust13&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

  &lt;wsp:Policy wsu:Id=&quot;Input_policy&quot;&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
        &lt;sp:SignedParts
          xmlns:sp=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702&quot;&gt;
          &lt;sp:Body/&gt;
          &lt;sp:Header Name=&quot;To&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
          &lt;sp:Header Name=&quot;From&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
          &lt;sp:Header Name=&quot;FaultTo&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
          &lt;sp:Header Name=&quot;ReplyTo&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
          &lt;sp:Header Name=&quot;MessageID&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
          &lt;sp:Header Name=&quot;RelatesTo&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
          &lt;sp:Header Name=&quot;Action&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
        &lt;/sp:SignedParts&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

  &lt;wsp:Policy wsu:Id=&quot;Output_policy&quot;&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
        &lt;sp:SignedParts
          xmlns:sp=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702&quot;&gt;
          &lt;sp:Body/&gt;
          &lt;sp:Header Name=&quot;To&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
          &lt;sp:Header Name=&quot;From&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
          &lt;sp:Header Name=&quot;FaultTo&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
          &lt;sp:Header Name=&quot;ReplyTo&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
          &lt;sp:Header Name=&quot;MessageID&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
          &lt;sp:Header Name=&quot;RelatesTo&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
          &lt;sp:Header Name=&quot;Action&quot;
                     Namespace=&quot;http://www.w3.org/2005/08/addressing&quot;/&gt;
        &lt;/sp:SignedParts&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

&lt;/wsdl:definitions&gt;</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-STS%27simplementationclass"  >
        <h4>STS's implementation class</h4>
    
    <p>
The Apache CXF's STS, SecurityTokenServiceProvider, is a web service   provider that is compliant with the protocols and functionality defined   by the WS-Trust specification.&nbsp; It has a modular architecture. Many of   its components are configurable or replaceable and there are many   optional features that are enabled by implementing and configuring   plug-ins.&nbsp; Users can customize their own STS by extending from   SecurityTokenServiceProvider and overriding the default settings.&nbsp;   Extensive information about the CXF's STS configurable and pluggable   components can be found <a href="http://coheigea.blogspot.com/2011/11/apache-cxf-sts-documentation-part-viii_10.html">here</a>.    </p>
    <p>
This STS implementation class, SampleSTSBearer, is a POJO that extends from   SecurityTokenServiceProvider.&nbsp; Note that the class is defined with a   WebServiceProvider annotation and not a WebService  annotation.&nbsp; This  annotation defines the service as a Provider-based  endpoint, meaning it  supports a more messaging-oriented approach to Web  services.&nbsp; In  particular, it signals that the exchanged messages will be  XML  documents of some type.&nbsp; SecurityTokenServiceProvider is an   implementation of the javax.xml.ws.Provider interface.&nbsp; In comparison   the WebService annotation defines a (service endpoint interface)   SEI-based endpoint which supports message exchange via SOAP envelopes.    </p>
    <p>
As was  done in the BearerImpl class, the WSS4J annotations  EndpointProperties  and EndpointProperty are providing endpoint  configuration  for the CXF runtime.&nbsp; The first EndpointProperty statement in the listing is declaring the  user's name to use for the message  signature.&nbsp; It is used as the alias  name in the keystore to get the  user's cert and private key for  signature.&nbsp; The next two EndpointProperty statements declares the Java  properties file that contains the (Merlin)  crypto configuration  information.&nbsp; In this case both for signing and  encrypting the  messages.&nbsp; WSS4J reads this file and extra required  information for  message handling.&nbsp; The last EndpointProperty statement declares the STSBearerCallbackHandler implementation class.&nbsp; It is used  to obtain the  user's password for the certificates in the keystore  file.    </p>
    <p>
In this implementation we are customizing the operations of token issuance, token validation and their static properties.    </p>
    <p>
StaticSTSProperties is used to set select properties for configuring  resources  in the STS.&nbsp; You may think this is a duplication of the  settings made  with the WSS4J annotations.&nbsp; The values are the same but  the underlaying  structures being set are different, thus this  information must be  declared in both places.    </p>
    <p>
The  setIssuer setting is important because it uniquely identifies   the issuing STS.&nbsp; The issuer string is embedded in issued tokens and,   when validating tokens, the STS checks the issuer string value.   Consequently, it is important to use the issuer string in a consistent   way, so that the STS can recognize the tokens that it has issued.    </p>
    <p>
The setEndpoints call allows the declaration of a set  of allowed  token recipients by address.&nbsp; The addresses are specified  as reg-ex  patterns.    </p>
    <p>
TokenIssueOperation has a modular  structure.&nbsp;  This allows custom behaviors to be injected into the  processing of  messages.&nbsp; In this case we are overriding the   SecurityTokenServiceProvider's default behavior and performing SAML   token processing.&nbsp; CXF provides an implementation of a   SAMLTokenProvider which we are using rather than   writing our own.    </p>
    <p>
Learn more about the SAMLTokenProvider <a href="http://coheigea.blogspot.it/2011/10/apache-cxf-sts-documentation-part-iv.html">here</a>.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.stsbearer;

import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;
import org.apache.cxf.sts.StaticSTSProperties;
import org.apache.cxf.sts.operation.TokenIssueOperation;
import org.apache.cxf.sts.service.ServiceMBean;
import org.apache.cxf.sts.service.StaticService;
import org.apache.cxf.sts.token.provider.SAMLTokenProvider;
import org.apache.cxf.ws.security.sts.provider.SecurityTokenServiceProvider;

import javax.xml.ws.WebServiceProvider;
import java.util.Arrays;
import java.util.LinkedList;
import java.util.List;

@WebServiceProvider(serviceName = &quot;SecurityTokenService&quot;,
      portName = &quot;UT_Port&quot;,
      targetNamespace = &quot;http://docs.oasis-open.org/ws-sx/ws-trust/200512/&quot;,
      wsdlLocation = &quot;WEB-INF/wsdl/bearer-ws-trust-1.4-service.wsdl&quot;)
//be sure to have dependency on org.apache.cxf module when on AS7, otherwise Apache CXF annotations are ignored
@EndpointProperties(value = {
      @EndpointProperty(key = &quot;ws-security.signature.username&quot;, value = &quot;mystskey&quot;),
      @EndpointProperty(key = &quot;ws-security.signature.properties&quot;, value = &quot;stsKeystore.properties&quot;),
      @EndpointProperty(key = &quot;ws-security.callback-handler&quot;, value = &quot;org.jboss.test.ws.jaxws.samples.wsse.policy.trust.stsbearer.STSBearerCallbackHandler&quot;)
})
public class SampleSTSBearer extends SecurityTokenServiceProvider
{

   public SampleSTSBearer() throws Exception
   {
      super();

      StaticSTSProperties props = new StaticSTSProperties();
      props.setSignatureCryptoProperties(&quot;stsKeystore.properties&quot;);
      props.setSignatureUsername(&quot;mystskey&quot;);
      props.setCallbackHandlerClass(STSBearerCallbackHandler.class.getName());
      props.setEncryptionCryptoProperties(&quot;stsKeystore.properties&quot;);
      props.setEncryptionUsername(&quot;myservicekey&quot;);
      props.setIssuer(&quot;DoubleItSTSIssuer&quot;);

      List&lt;ServiceMBean&gt; services = new LinkedList&lt;ServiceMBean&gt;();
      StaticService service = new StaticService();
      service.setEndpoints(Arrays.asList(
         &quot;https://localhost:(\\d)*/jaxws-samples-wsse-policy-trust-bearer/BearerService&quot;,
         &quot;https://\\[::1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-bearer/BearerService&quot;,
         &quot;https://\\[0:0:0:0:0:0:0:1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-bearer/BearerService&quot;
      ));
      services.add(service);

      TokenIssueOperation issueOperation = new TokenIssueOperation();
      issueOperation.getTokenProviders().add(new SAMLTokenProvider());
      issueOperation.setServices(services);
      issueOperation.setStsProperties(props);
      this.setIssueOperation(issueOperation);
   }
}</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-STSBearerCallbackHandler"  >
        <h4>STSBearerCallbackHandler</h4>
    
    <p>
STSBearerCallbackHandler is a callback handler for the WSS4J Crypto API.&nbsp; It   is used to obtain the password for the private key in the keystore.&nbsp;   This class enables CXF to retrieve the password of the user name to use   for the message signature.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.stsbearer;

import org.jboss.wsf.stack.cxf.extensions.security.PasswordCallbackHandler;

import java.util.HashMap;
import java.util.Map;

public class STSBearerCallbackHandler extends PasswordCallbackHandler
{
   public STSBearerCallbackHandler()
   {
      super(getInitMap());
   }

   private static Map&lt;String, String&gt; getInitMap()
   {
      Map&lt;String, String&gt; passwords = new HashMap&lt;String, String&gt;();
      passwords.put(&quot;mystskey&quot;, &quot;stskpass&quot;);
      passwords.put(&quot;alice&quot;, &quot;clarinet&quot;);
      return passwords;
   }
}</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-Cryptopropertiesandkeystorefiles2"  >
        <h4>Crypto properties and keystore files</h4>
    
    <p>
WSS4J's Crypto implementation is loaded and configured via a Java   properties file that contains Crypto configuration data.&nbsp; The file   contains implementation-specific properties such as a keystore location,   password, default alias and the like.&nbsp; This application is using the   Merlin implementation. File stsKeystore.properties contains this   information.    </p>
    <p>
File  servicestore.jks, is a Java KeyStore (JKS) repository.&nbsp; It  contains  self signed certificates for myservicekey and mystskey.&nbsp; <i class=" ">Self signed certificates are not appropriate for production use.</i>    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin  
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=stsspass
org.apache.ws.security.crypto.merlin.keystore.file=stsstore.jks</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-MANIFEST.MF2"  >
        <h4>MANIFEST.MF</h4>
    
    <p>
When deployed on WildFly, this application requires   access to the JBossWs and CXF APIs provided in modules   org.jboss.ws.cxf.jbossws-cxf-client and org.apache.cxf.&nbsp; The Apache CXF  internals,  org.apache.cxf.impl,&nbsp; are needed to build the STS  configuration in  the <tt class=" ">SampleSTS</tt> constructor.&nbsp; The dependency statement directs the server to provide them at deployment.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">Manifest-Version: 1.0  
Ant-Version: Apache Ant 1.8.2  
Created-By: 1.7.0_25-b15 (Oracle Corporation)  
Dependencies: org.jboss.ws.cxf.jbossws-cxf-client,org.apache.cxf.impl</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-3"  id="90439853_SAMLBearerAssertionScenario-Webservicerequester"  >
        <h3>Web service requester</h3>
    
    <p>
This section examines the crucial elements in calling a web service   that implements endpoint security as described in the SAML Bearer   scenario.&nbsp; The components that will be discussed are.    </p>
<ul class=" "><li class=" ">    <p>
Web service requester's implementation    </p>
</li><li class=" ">    <p>
ClientCallbackHandler    </p>
</li><li class=" ">    <p>
Crypto properties and keystore files    </p>
</li></ul>    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-WebservicerequesterImplementation"  >
        <h4>Web service requester Implementation</h4>
    
    <p>
The ws-requester, the client, uses standard procedures for creating a   reference to the web service.&nbsp; To address the  endpoint  security requirements, the web service's &quot;Request Context&quot; is  configured with the information needed in message generation.&nbsp; In   addition, the STSClient that communicates with the STS is configured   with similar values.&nbsp; Note the key strings ending with a  &quot;.it&quot; suffix.&nbsp;  This suffix flags these settings as belonging to the  STSClient.&nbsp; The  internal CXF code assigns this information to the  STSClient that is  auto-generated for this service call.    </p>
    <p>
There  is an alternate method of setting up the STSCLient.&nbsp; The user  may  provide their own instance of the STSClient.&nbsp; The CXF code will use  this  object and not auto-generate one.&nbsp; When providing the  STSClient in this way, the  user must provide a org.apache.cxf.Bus for it  and the configuration  keys must not have the &quot;.it&quot; suffix.&nbsp; This is used in the ActAs and OnBehalfOf examples.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">  String serviceURL = &quot;https://&quot; + getServerHost() + &quot;:8443/jaxws-samples-wsse-policy-trust-bearer/BearerService&quot;;

  final QName serviceName = new QName(&quot;http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy&quot;, &quot;BearerService&quot;);
  Service service = Service.create(new URL(serviceURL + &quot;?wsdl&quot;), serviceName);
  BearerIface proxy = (BearerIface) service.getPort(BearerIface.class);

  Map&lt;String, Object&gt; ctx = ((BindingProvider)proxy).getRequestContext();

  // set the security related configuration information for the service &quot;request&quot;
  ctx.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
  ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
    Thread.currentThread().getContextClassLoader().getResource(
    &quot;META-INF/clientKeystore.properties&quot;));
  ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
    Thread.currentThread().getContextClassLoader().getResource(
    &quot;META-INF/clientKeystore.properties&quot;));
  ctx.put(SecurityConstants.SIGNATURE_USERNAME, &quot;myclientkey&quot;);
  ctx.put(SecurityConstants.ENCRYPT_USERNAME, &quot;myservicekey&quot;);

  //-- Configuration settings that will be transfered to the STSClient
  // &quot;alice&quot; is the name provided for the WSS Username. Her password will
  // be retreived from the ClientCallbackHander by the STSClient.
  ctx.put(SecurityConstants.USERNAME + &quot;.it&quot;, &quot;alice&quot;);
  ctx.put(SecurityConstants.CALLBACK_HANDLER + &quot;.it&quot;, new ClientCallbackHandler());
  ctx.put(SecurityConstants.ENCRYPT_PROPERTIES + &quot;.it&quot;,
    Thread.currentThread().getContextClassLoader().getResource(
    &quot;META-INF/clientKeystore.properties&quot;));
  ctx.put(SecurityConstants.ENCRYPT_USERNAME + &quot;.it&quot;, &quot;mystskey&quot;);
  ctx.put(SecurityConstants.STS_TOKEN_USERNAME + &quot;.it&quot;, &quot;myclientkey&quot;);
  ctx.put(SecurityConstants.STS_TOKEN_PROPERTIES + &quot;.it&quot;,
    Thread.currentThread().getContextClassLoader().getResource(
    &quot;META-INF/clientKeystore.properties&quot;));
  ctx.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO + &quot;.it&quot;, &quot;true&quot;);

  proxy.sayHello();
</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-ClientCallbackHandler"  >
        <h4>ClientCallbackHandler</h4>
    
    <p>
<a href="https://docs.jboss.org/author/display/JBWS/WS-Trust+and+STS#WS-TrustandSTS-ClientCallbackHandler">https://docs.jboss.org/author/display/JBWS/WS-Trust+and+STS#WS-TrustandSTS-ClientCallbackHandler</a>    </p>
    <p>
ClientCallbackHandler is a callback handler for the WSS4J Crypto API.&nbsp;   It is used to obtain the password for the private key in the keystore.&nbsp;   This class enables CXF to retrieve the password of the user name to use   for the message signature.&nbsp; Note that &quot;alice&quot; and her password have  been  provided here.&nbsp; This information is not in the (JKS)&nbsp; keystore but   provided in the WildFly security domain.&nbsp; It was   declared in file jbossws-users.properties.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.shared;

import java.io.IOException;
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.CallbackHandler;
import javax.security.auth.callback.UnsupportedCallbackException;
import org.apache.ws.security.WSPasswordCallback;

public class ClientCallbackHandler implements CallbackHandler {

    public void handle(Callback[] callbacks) throws IOException,
            UnsupportedCallbackException {
        for (int i = 0; i &lt; callbacks.length; i++) {
            if (callbacks[i] instanceof WSPasswordCallback) {
                WSPasswordCallback pc = (WSPasswordCallback) callbacks[i];
                if (&quot;myclientkey&quot;.equals(pc.getIdentifier())) {
                    pc.setPassword(&quot;ckpass&quot;);
                    break;
                } else if (&quot;alice&quot;.equals(pc.getIdentifier())) {
                    pc.setPassword(&quot;clarinet&quot;);
                    break;
                } else if (&quot;bob&quot;.equals(pc.getIdentifier())) {
                    pc.setPassword(&quot;trombone&quot;);
                    break;
                } else if (&quot;myservicekey&quot;.equals(pc.getIdentifier())) {  // rls test  added for bearer test
                   pc.setPassword(&quot;skpass&quot;);
                   break;
                }
            }
        }
    }
}</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="90439853_SAMLBearerAssertionScenario-Cryptopropertiesandkeystorefiles3"  >
        <h4>Crypto properties and keystore files</h4>
    
    <p>
<a href="https://docs.jboss.org/author/display/JBWS/WS-Trust+and+STS#WS-TrustandSTS-RequesterCryptopropertiesandkeystorefiles">https://docs.jboss.org/author/display/JBWS/WS-Trust+and+STS#WS-TrustandSTS-RequesterCryptopropertiesandkeystorefiles</a>    </p>
    <p>
WSS4J's Crypto implementation is loaded and configured via a Java   properties file that contains Crypto configuration data.&nbsp; The file   contains implementation-specific properties such as a keystore location,   password, default alias and the like.&nbsp; This application is using the   Merlin implementation. File clientKeystore.properties contains this   information.    </p>
    <p>
File  clientstore.jks, is a Java KeyStore (JKS) repository.&nbsp; It  contains self  signed certificates for myservicekey and mystskey.&nbsp; <i class=" ">Self signed certificates are not appropriate for production use.</i>    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=cspass
org.apache.ws.security.crypto.merlin.keystore.alias=myclientkey
org.apache.ws.security.crypto.merlin.keystore.file=META-INF/clientstore.jks</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    </div>
    
        </div>
              <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <li class="previous"><a accesskey="p" href="OnBehalfOf_WS-Trust_Scenario.html"><strong>Prev</strong>OnBehalfOf WS-Trust Scenario</a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li>
          <li class="home"><a accesskey="h" href="Documentation.html"><strong>Front page</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <li class="next"><a accesskey="n" href="SAML_Holder-Of-Key_Assertion_Scenario.html"><strong>Next</strong>SAML Holder-Of-Key Assertion Scenario</a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </ul>
          </div>
    <script type="text/javascript">
      SyntaxHighlighter.all()
    </script>
</body>
</html>
