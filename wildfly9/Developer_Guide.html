<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Developer Guide - WildFly 9</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
    <meta content="Scroll Wiki Publisher" name="generator"/>

    <link type="text/css" rel="stylesheet" href="css/blueprint/liquid.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/blueprint/print.css" media="print"/>
    <!--[if lt IE 8]><link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection"/><![endif]-->

    <link type="text/css" rel="stylesheet" href="css/content-style.css" media="screen, projection, print"/>
    <link type="text/css" rel="stylesheet" href="css/screen.css" media="screen, projection"/>
    <link type="text/css" rel="stylesheet" href="css/print.css" media="print"/>
    
    <link type="text/css" rel="stylesheet" href="css/jbossorg.css"/>
    <link type="text/css" rel="stylesheet" href="css/docnav.css"/>    
    
    <link type="text/css" rel="stylesheet" href="sh/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="sh/shCoreDefault.css"/>
    <script type="text/javascript" src="sh/shCore.js"></script>
    <script type="text/javascript" src="sh/shBrushAppleScript.js"></script>
    <script type="text/javascript" src="sh/shBrushAS3.js"></script>
    <script type="text/javascript" src="sh/shBrushBash.js"></script>
    <script type="text/javascript" src="sh/shBrushCpp.js"></script>
    <script type="text/javascript" src="sh/shBrushCSharp.js"></script>
    <script type="text/javascript" src="sh/shBrushCss.js"></script>
    <script type="text/javascript" src="sh/shBrushDiff.js"></script>
    <script type="text/javascript" src="sh/shBrushErlang.js"></script>
    <script type="text/javascript" src="sh/shBrushGroovy.js"></script>
    <script type="text/javascript" src="sh/shBrushJava.js"></script>
    <script type="text/javascript" src="sh/shBrushJavaFX.js"></script>
    <script type="text/javascript" src="sh/shBrushJScript.js"></script>
    <script type="text/javascript" src="sh/shBrushPerl.js"></script>
    <script type="text/javascript" src="sh/shBrushPhp.js"></script>
    <script type="text/javascript" src="sh/shBrushPlain.js"></script>
    <script type="text/javascript" src="sh/shBrushPython.js"></script>
    <script type="text/javascript" src="sh/shBrushRuby.js"></script>
    <script type="text/javascript" src="sh/shBrushScala.js"></script>
    <script type="text/javascript" src="sh/shBrushSql.js"></script>
    <script type="text/javascript" src="sh/shBrushVb.js"></script>
    <script type="text/javascript" src="sh/shBrushXml.js"></script>
    
</head>
<body>
    <div class="container" style="min-width: 760px;">
        <div class="block header">
          <p id="title">
            <a class="site_href" href="http://www.jboss.org"><strong>JBoss.org</strong></a>
            <a class="doc_href" href="http://docs.jboss.org"><strong>Community Documentation</strong></a>
          </p>
                  <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <li class="previous"><a accesskey="p" href="Target_Audience.html"><strong>Prev</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="next"><a accesskey="n" href="Application_Client_Reference.html"><strong>Next</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </ul>
                    <div>
            <h1>Developer Guide</h1>
          </div>          
          </div>

        <div class="block content">
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-WildFly8DeveloperGuide">WildFly 8 Developer Guide</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-TargetAudience">Target Audience</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Prerequisites">Prerequisites</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-ClassloadinginWildFly8">Class loading in WildFly 8</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-DeploymentModuleNames">Deployment Module Names</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-AutomaticDependencies">Automatic Dependencies</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-ClassLoading%26nbsp%3BPrecedence">Class Loading&nbsp;Precedence</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-WARClassLoading">WAR Class Loading</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-EARClassLoading">EAR Class Loading</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-ClassPathEntries">Class Path Entries</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-GlobalModules">Global Modules</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-JBossDeploymentStructureFile">JBoss Deployment Structure File</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-AccessingJDKclasses">Accessing JDK classes</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Implicitmoduledependenciesfordeployments">Implicit module dependencies for deployments</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-What%27sanimplicitmoduledependency%3F">What's an implicit module dependency?</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Howandwhenisanimplicitmoduledependencyadded%3F">How and when is an implicit module dependency added?</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Whicharetheimplicitmoduledependencies%3F">Which are the implicit module dependencies?</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-HowdoImigratemyapplicationfromJBossAS5orAS6toWildFly8%3F">How do I migrate my application from JBoss AS 5 or AS 6 to WildFly 8?</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-EJBinvocationsfromaremotestandaloneclientusingJNDI">EJB invocations from a remote standalone client using JNDI</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-DeployingyourEJBsontheserverside%3A">Deploying your EJBs on the server side:</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-WritingaremoteclientapplicationforaccessingandinvokingtheEJBsdeployedontheserver">Writing a remote client application for accessing and invoking the EJBs deployed on the server</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-SettingupEJBclientcontextproperties">Setting up EJB client context properties</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingadifferentfileforsettingupEJBclientcontext">Using a different file for setting up EJB client context</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Settinguptheclientclasspathwiththejarsthatarerequiredtoruntheclientapplication">Setting up the client classpath with the jars that are required to run the client application</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Summary">Summary</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-EJBinvocationsfromaremoteserver">EJB invocations from a remote server</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Applicationpackaging">Application packaging</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Beans">Beans</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Security">Security</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Configuringauseronthe%22DestinationServer%22">Configuring a user on the &quot;Destination Server&quot;</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Startthe%22DestinationServer%22">Start the &quot;Destination Server&quot;</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Deployingtheapplication">Deploying the application</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Configuringthe%22ClientServer%22topointtotheEJBremotingconnectoronthe%22DestinationServer%22">Configuring the &quot;Client Server&quot; to point to the EJB remoting connector on the &quot;Destination Server&quot;</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Startthe%22ClientServer%22">Start the &quot;Client Server&quot;</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Createasecurityrealmontheclientserver">Create a security realm on the client server</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Createaoutboundsocketbindingonthe%22ClientServer%22">Create a outbound-socket-binding on the &quot;Client Server&quot;</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Createa%22remoteoutboundconnection%22whichusesthisnewlycreated%22outboundsocketbinding%22">Create a &quot;remote-outbound-connection&quot; which uses this newly created &quot;outbound-socket-binding&quot;</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Packagingtheclientapplicationonthe%22ClientServer%22">Packaging the client application on the &quot;Client Server&quot;</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Contentsonjbossejbclient.xml">Contents on jboss-ejb-client.xml</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Deploytheclientapplication">Deploy the client application</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Clientcodeinvokingthebean">Client code invoking the bean</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-RemoteEJBinvocationsviaJNDIWhichapproachtouse%3F">Remote EJB invocations via JNDI - Which approach to use?</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-JBossEJB3referenceguide">JBoss EJB 3 reference guide</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-ResourceAdapterforMessageDrivenBeans">Resource Adapter for Message Driven Beans</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-SpecificationofResourceAdapterusingMetadataAnnotations">Specification of Resource Adapter using Metadata Annotations</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-RunasPrincipal">Run-as Principal</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-SpecificationofRunasPrincipalusingMetadataAnnotations">Specification of Run-as Principal using Metadata Annotations</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-SecurityDomain">Security Domain</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-SpecificationofSecurityDomainusingMetadataAnnotations">Specification of Security Domain using Metadata Annotations</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-TransactionTimeout">Transaction Timeout</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-SpecificationofTransactionTimeoutwithMetadataAnnotations">Specification of Transaction Timeout with Metadata Annotations</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-SpecificationofTransactionTimeoutintheDeploymentDescriptor">Specification of Transaction Timeout in the Deployment Descriptor</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Exampleof%7B%7Btranstimeout%7D%7D">Example of <tt class=" ">trans-timeout</tt></a>    </p>
</li></ul></li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Timerservice">Timer service</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Singleeventtimer">Single event timer</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Recurringtimer">Recurring timer</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Calendartimer">Calendar timer</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Programmaticcalendartimer">Programmatic calendar timer</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Annotatedcalendartimer">Annotated calendar timer</a>    </p>
</li></ul></li></ul></li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-JPAreferenceguide">JPA reference guide</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Introduction">Introduction</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UpdateyourPersistence.xmlforHibernate4.3.0">Update your Persistence.xml for Hibernate 4.3.0</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Entitymanager">Entity manager</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Applicationmanagedentitymanager">Application-managed entity manager</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Containermanagedentitymanager">Container-managed entity manager</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-PersistenceContext">Persistence Context</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-TransactionscopedPersistenceContext">Transaction-scoped Persistence Context</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-ExtendedPersistenceContext">Extended Persistence Context</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-ExtendedPersistenceContextInheritance">Extended Persistence Context Inheritance</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Entities">Entities</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Deployment">Deployment</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Troubleshooting">Troubleshooting</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-BackgroundontheJipijapaproject">Background on the Jipijapa project</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-PackagingpersistenceproviderswithyourapplicationandwhichJipijapaartifactstoinclude">Packaging persistence providers with your application and which Jipijapa artifacts to include</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingtheHibernate4.3.xJPApersistenceprovider">Using the Hibernate 4.3.x JPA persistence provider</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingtheInfinispansecondlevelcache">Using the Infinispan second level cache</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-ReplacingthecurrentHibernate4.3.xjarswithanewerversion">Replacing the current Hibernate 4.3.x jars with a newer version</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-PackagingtheHibernate4.x%28orgreater%29JPApersistenceproviderwithyourapplication">Packaging the Hibernate 4.x (or greater) JPA persistence provider with your application</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-PackagingtheHibernate3.5orgreater3.xJPApersistenceproviderwithyourapplication">Packaging the Hibernate 3.5 or greater 3.x JPA persistence provider with your application</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-SharingtheHibernate3.5orgreaterJPApersistenceproviderbetweenmultipleapplications">Sharing the Hibernate 3.5 or greater JPA persistence provider between multiple applications</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingOpenJPA">Using OpenJPA</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingEclipseLink">Using EclipseLink</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingDataNucleus">Using DataNucleus</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingHibernateOGM">Using Hibernate OGM</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-NativeHibernateuse">Native Hibernate use</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-InjectionofHibernateSessionandSessionFactoryInjectionofHibernateSessionandSessionFactory">Injection of Hibernate Session and SessionFactoryInjection of Hibernate Session and SessionFactory</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Hibernateproperties">Hibernate properties</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Persistenceunitproperties">Persistence unit properties</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Determinethepersistenceprovidermodule">Determine the persistence provider module</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-BindingEntityManagerFactory%2FEntityManagertoJNDI">Binding EntityManagerFactory/EntityManager to JNDI</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Community">Community</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-PeoplewhohavecontributedtotheWildFlyJPAlayer%3A">People who have contributed to the WildFly JPA layer:</a>    </p>
</li></ul></li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-OSGideveloperguide">OSGi developer guide</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-JNDIreferenceguide">JNDI reference guide</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Overview">Overview</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-LocalJNDI">Local JNDI</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-BindingentriestoJNDI">Binding entries to JNDI</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Usingadeploymentdescriptor">Using a deployment descriptor</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Programatically">Programatically</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-JavaEEApplications">Java EE Applications</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-"></a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-WildFlyModulesandExtensions">WildFly Modules and Extensions</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-"></a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-NamingSubsystemConfiguration">Naming Subsystem Configuration</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-RetrievingentriesfromJNDI">Retrieving entries from JNDI</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-ResourceInjection">Resource Injection</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-StandardJavaSEJNDIAPI">Standard Java SE JNDI API</a>    </p>
</li></ul></li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-RemoteJNDI">Remote JNDI</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-remote%3A">remote:</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-ejb%3A">ejb:</a>    </p>
</li></ul></li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Springapplicationsdevelopmentandmigrationguide">Spring applications development and migration guide</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-DependenciesandModularity">Dependencies and Modularity</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Persistenceusageguide">Persistence usage guide</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-NativeSpring%2FHibernateapplications">Native Spring/Hibernate applications</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-JPAbasedapplications">JPA-based applications</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Usingserverdeployedpersistenceunits">Using server-deployed persistence units</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingSpringmanagedpersistenceunits">Using Spring-managed persistence units</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Placementofthepersistenceunitdefinitions">Placement of the persistence unit definitions</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Managingdependencies">Managing dependencies</a>    </p>
</li></ul></li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-AllWildFly8documentation">All WildFly 8 documentation</a>    </p>
</li></ul>    <div class="section-2"  id="80873187_DeveloperGuide-WildFly8DeveloperGuide"  >
        <h2>WildFly 8 Developer Guide</h2>
    
    <div class="section-3"  id="80873187_DeveloperGuide-TargetAudience"  >
        <h3>Target Audience</h3>
    
    <p>
Java Developers    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Prerequisites"  >
        <h3>Prerequisites</h3>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="80873187_DeveloperGuide-ClassloadinginWildFly8"  >
        <h2>Class loading in WildFly 8</h2>
    
    <p>
Since WildFly 8,&nbsp;Class loading is considerably different to previous versions of JBoss AS. Class loading is based on the <a href="https://docs.jboss.org/author/display/MODULES">JBoss Modules</a> project. Instead of the more familiar hierarchical class loading environment, WildFly's class loading is based on modules that have to define explicit dependencies on other modules. Deployments in WildFly&nbsp;are also modules, and do not have access to classes that are defined in jars in the application server unless an explicit dependency on those classes is defined.    </p>
    <div class="section-3"  id="80873187_DeveloperGuide-DeploymentModuleNames"  >
        <h3>Deployment Module Names</h3>
    
    <p>
Module names for top level deployments follow the format <tt class=" ">deployment.myarchive.war</tt> while sub deployments are named like <tt class=" ">deployment.myear.ear.mywar.war</tt>.&nbsp;    </p>
    <p>
This means that it is possible for a deployment to import classes from another deployment using the other deployments module name, the details of how to add an explicit module dependency are explained below.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-AutomaticDependencies"  >
        <h3>Automatic Dependencies</h3>
    
    <p>
Even though in WildFly&nbsp;modules are isolated by default, as part of the deployment process some dependencies on modules defined by the application server are set up for you automatically. For instance, if you are deploying a Java EE application a dependency on the Java EE API's will be added to your module automatically. Similarly if your module contains a beans.xml file a dependency on <a href="http://seamframework.org/Weld">Weld </a>will be added automatically, along with any supporting modules that weld needs to operate.    </p>
    <p>
For a complete list of the automatic dependencies that are added, please see <a href="Implicit_module_dependencies_for_deployments.html">Implicit module dependencies for deployments</a>.    </p>
    <p>
Automatic dependencies can be excluded through the use of <tt class=" ">jboss-deployment-structure.xml</tt>.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-ClassLoading%26nbsp%3BPrecedence"  >
        <h3>Class Loading&nbsp;Precedence</h3>
    
    <p>
A common source of errors in Java applications is including API classes in a deployment that are also provided by the container. This can result in multiple versions of the class being created and the deployment failing to deploy properly. To prevent this in WildFly, module dependencies are added in a specific order that should prevent this situation from occurring.&nbsp;    </p>
    <p>
In order of highest priority to lowest priority    </p>
<ol class=" "><li class=" ">    <p>
System Dependencies - These are dependencies that are added to the module automatically by the container, including the Java EE api's.    </p>
</li><li class=" ">    <p>
User Dependencies - These are dependencies that are added through&nbsp;<tt class=" ">jboss-deployment-structure.xml</tt>&nbsp;or through the&nbsp;<tt class=" ">Dependencies:</tt>&nbsp;manifest entry.    </p>
</li><li class=" ">    <p>
Local Resource - Class files packaged up inside the deployment itself, e.g. class files from <tt class=" ">WEB-INF/classes</tt> or <tt class=" ">WEB-INF/lib</tt> of a war.    </p>
</li><li class=" ">    <p>
Inter deployment dependencies - These are dependencies on other deployments in an ear deployment. This can include classes in an ear's lib directory, or classes defined in other ejb jars.&nbsp;    </p>
</li></ol>    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-WARClassLoading"  >
        <h3>WAR Class Loading</h3>
    
    <p>
The war is considered to be a single module, so classes defined in <tt class=" ">WEB-INF/lib</tt> are treated the same as classes in <tt class=" ">WEB-INF/classes</tt>. All classes packaged in the war will be loaded with the same class loader.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-EARClassLoading"  >
        <h3>EAR Class Loading</h3>
    
    <p>
Ear deployments are multi-module deployments. This means that not all classes inside an ear will necessarily have access to all other classes in the ear, unless explicit dependencies have been defined. By default the <tt class=" ">EAR/lib</tt> directory is a single module, and every WAR or EJB jar deployment is also a separate module. Sub deployments (wars and ejb-jars) always have a dependency on the parent module, which gives them access to classes in <tt class=" ">EAR/lib</tt>, however they do not always have an automatic dependency on each other. This behaviour is controlled via the <tt class=" ">ear-subdeployments-isolated</tt>&nbsp;setting in the ee subsystem configuration:&nbsp;    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:ee:1.0&quot; &gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
  &lt;ear-subdeployments-isolated&gt;false&lt;/ear-subdeployments-isolated&gt;
&lt;/subsystem&gt;</pre>
        </div>
    </div>
    <p>
By default this is set to false, which allows the sub-deployments to see classes belonging to other sub-deployments within the .ear.    </p>
    <p>
For example, consider the following .ear deployment:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">myapp.ear
 |
 |--- web.war
 |
 |--- ejb1.jar
 |
 |--- ejb2.jar</pre>
        </div>
    </div>
    <p>
If the ear-subdeployments-isolated is set to false, then the classes in web.war can access classes belonging to ejb1.jar and ejb2.jar. Similarly, classes from ejb1.jar can access classes from ejb2.jar (and vice-versa).    </p>
    <div class="confbox admonition admonition-note">
        
    <p>
The ear-subdeployments-isolated element value has no effect on the isolated classloader of the .war file(s). i.e. irrespective of whether this flag is set to true or false, the .war within a .ear will have a isolated classloader and other sub-deployments within that .ear will not be able to access classes from that .war. This is as per spec.    </p>
    </div>
    
    <p>
If the ear-subdeployments-isolated is set to true then no automatic module dependencies between the sub-deployments are set up. User must manually setup the dependency with <tt class=" ">Class-Path</tt> entries, or by setting up explicit module dependencies.    </p>
    <div class="confbox admonition admonition-tip">
            <div class="title">Portability</div>
        
    <p>
The  Java EE specification says that portable applications should not rely  on sub deployments having access to other sub deployments unless an  explicit Class-Path entry is set in the MANIFEST.MF. So portable  applications should always use Class-Path entry to explicitly state  their dependencies.    </p>
    </div>
    
    <div class="confbox admonition admonition-info">
        
    <p>
It is also possible to override the ear-subdeployments-isolated element value at a per deployment level. See the section on jboss-deployment-structure.xml below.    </p>
    </div>
    
    <p>
<tt class=" ">Dependencies:</tt><strong class=" ">&nbsp;Manifest Entries</strong>    </p>
    <p>
Deployments (or more correctly modules within a deployment) may set up dependencies on other modules by adding a <tt class=" ">Dependencies:</tt> manifest entry. This entry consists of a comma separated list of module names that the deployment requires. The&nbsp;available&nbsp;modules can be seen under the <tt class=" ">modules</tt> directory in the application server distribution. For example to add a dependency on javassist and apache velocity you can add a manifest entry as follows:    </p>
    <p>
<tt class=" ">Dependencies: org.javassist export,org.apache.velocity export services,org.antlr</tt>    </p>
    <p>
Each dependency entry may also specify some of the following parameters by adding them after the module name:    </p>
<ul class=" "><li class=" ">    <p>
<tt class=" ">export</tt> This means that the dependencies will be exported, so any module that depends on this module will also get access to the dependency.    </p>
</li><li class=" ">    <p>
<tt class=" ">services</tt> By default items in META-INF of a dependency are not accessible, this makes items from <tt class=" ">META-INF/services</tt> accessible so <a href="http://download.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html">services </a> in the modules can be loaded.    </p>
</li><li class=" ">    <p>
<tt class=" ">optional</tt> If this is specified the deployment will not fail if the module is not available.    </p>
</li><li class=" ">    <p>
<tt class=" ">meta-inf</tt> This will make the contents of the <tt class=" ">META-INF</tt> directory available (unlike <tt class=" ">services</tt>, which just makes <tt class=" ">META-INF/services</tt> available). In general this will not cause any deployment descriptors in META-INF to be processed, with the exception of <tt class=" ">beans.xml</tt>. If a <tt class=" ">beans.xml</tt> file is present this module will be scanned by Weld and any resulting beans will be available to the application.    </p>
</li><li class=" ">    <p>
<tt class=" ">annotations</tt> If a jandex index has be created for the module these annotations will be merged into the deployments annotation index. The <a href="https://github.com/jbossas/jandex">Jandex</a> index can be generated using the <a href="https://github.com/jbossas/jandex/blob/master/src/main/java/org/jboss/jandex/JandexAntTask.java">Jandex ant task </a>, and must be named <tt class=" ">META-INF/jandex.idx</tt>. Note that it is not necessary to break open the jar being indexed to add this to the modules class path, a better approach is to create a jar containing just this index, and adding it as an additional resource root in the <tt class=" ">module.xml</tt> file.    </p>
</li></ul>    <div class="confbox admonition admonition-info">
            <div class="title">Adding a dependency to all modules in an EAR</div>
        
    <p>
Using the <tt class=" ">export</tt> parameter it is possible to add a dependency to all sub deployments in an ear. If a module is exported from a <tt class=" ">Dependencies:</tt> entry in the top level of the ear (or by a jar in the <tt class=" ">ear/lib</tt> directory) it will be available to all sub deployments as well.    </p>
    </div>
    
    <div class="confbox admonition admonition-tip">
        
    <p>
To generate a MANIFEST.MF entry when using maven put the following in your pom.xml:    </p>
    <div class="confbox programlisting">
                    <div class="title">pom.xml</div>
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;build&gt;
   ...
   &lt;plugins&gt;
     &lt;plugin&gt;
       &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
       &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
       &lt;configuration&gt;
          &lt;archive&gt;
             &lt;manifestEntries&gt;
                &lt;Dependencies&gt;org.slf4j&lt;/Dependencies&gt;
             &lt;/manifestEntries&gt;
          &lt;/archive&gt;
       &lt;/configuration&gt;
     &lt;/plugin&gt;
   &lt;/plugins&gt;
&lt;/build&gt;</pre>
        </div>
    </div>
    <p>
If your deployment is a jar you must use the <tt class=" ">maven-jar-plugin</tt> rather than the <tt class=" ">maven-war-plugin</tt>.    </p>
    </div>
    
    <div class="section-4"  id="80873187_DeveloperGuide-ClassPathEntries"  >
        <h4>Class Path Entries</h4>
    
    <p>
It is also possible to add module&nbsp;dependencies&nbsp;on other modules inside the deployment using the <tt class=" ">Class-Path</tt> manifest entry. This can be used within an ear to set up dependencies between sub deployments, and also to allow modules access to additional jars deployed in an ear that are not sub deployments and are not in the <tt class=" ">EAR/lib</tt> directory. If a jar in the <tt class=" ">EAR/lib</tt> directory references a jar via <tt class=" ">Class-Path:</tt> then this additional jar is merged into the parent ear's module, and is accessible to all sub deployments in the ear.&nbsp;    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-GlobalModules"  >
        <h3>Global Modules</h3>
    
    <p>
It is also possible to set up global modules, that are accessible to all deployments. This is done by modifying the configuration file (standalone/domain.xml).    </p>
    <p>
For example, to add javassist to all deployments you can use the following XML:    </p>
    <div class="confbox programlisting">
                    <div class="title">standalone.xml/domain.xml</div>
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:ee:1.0&quot; &gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
  &lt;global-modules&gt;
    &lt;module name=&quot;org.javassist&quot; slot=&quot;main&quot; /&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
  &lt;/global-modules&gt;&nbsp;
&lt;/subsystem&gt;</pre>
        </div>
    </div>
    <p>
Note that the <tt class=" ">slot</tt> field is optional and defaults to <tt class=" ">main</tt>.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-JBossDeploymentStructureFile"  >
        <h3>JBoss Deployment Structure File</h3>
    
    <p>
<tt class=" ">jboss-deployment-structure.xml</tt> is a JBoss specific deployment descriptor that can be used to control class loading in a fine grained manner. It should be placed in the top level deployment, in <tt class=" ">META-INF</tt> (or <tt class=" ">WEB-INF</tt> for web deployments). It can do the following:    </p>
<ul class=" "><li class=" ">    <p>
Prevent automatic dependencies from being added    </p>
</li><li class=" ">    <p>
Add additional dependencies    </p>
</li><li class=" ">    <p>
Define additional modules&nbsp;    </p>
</li><li class=" ">    <p>
Change an EAR deployments isolated class loading behaviour    </p>
</li><li class=" ">    <p>
Add additional resource roots to a module    </p>
</li></ul>    <p>
An example of a complete <tt class=" ">jboss-deployment-structure.xml</tt> file for an ear deployment is as follows:    </p>
    <p>
    <div class="confbox programlisting">
                    <div class="title">jboss-deployment-structure.xml</div>
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;jboss-deployment-structure&gt;
  &lt;!-- Make sub deployments isolated by default, so they cannot see each others classes without a Class-Path entry --&gt;
  &lt;ear-subdeployments-isolated&gt;true&lt;/ear-subdeployments-isolated&gt;
  &lt;!-- This corresponds to the top level deployment. For a war this is the war's module, for an ear --&gt;
  &lt;!-- This is the top level ear module, which contains all the classes in the EAR's lib folder     --&gt;
  &lt;deployment&gt;
     &lt;!-- exclude-subsystem prevents a subsystems deployment unit processors running on a deployment --&gt;
     &lt;!-- which gives basically the same effect as removing the subsystem, but it only affects single deployment --&gt;
     &lt;exclude-subsystems&gt;
        &lt;subsystem name=&quot;resteasy&quot; /&gt;
    &lt;/exclude-subsystems&gt;
    &lt;!-- Exclusions allow you to prevent the server from automatically adding some dependencies     --&gt;
    &lt;exclusions&gt;
        &lt;module name=&quot;org.javassist&quot; /&gt;
    &lt;/exclusions&gt;
    &lt;!-- This allows you to define additional dependencies, it is the same as using the Dependencies: manifest attribute --&gt;
    &lt;dependencies&gt;
      &lt;module name=&quot;deployment.javassist.proxy&quot; /&gt;
      &lt;module name=&quot;deployment.myjavassist&quot; /&gt;
      &lt;!-- Import META-INF/services for ServiceLoader impls as well --&gt;
      &lt;module name=&quot;myservicemodule&quot; services=&quot;import&quot;/&gt;
    &lt;/dependencies&gt;
    &lt;!-- These add additional classes to the module. In this case it is the same as including the jar in the EAR's lib directory --&gt;
    &lt;resources&gt;
      &lt;resource-root path=&quot;my-library.jar&quot; /&gt;
    &lt;/resources&gt;
  &lt;/deployment&gt;
  &lt;sub-deployment name=&quot;myapp.war&quot;&gt;
    &lt;!-- This corresponds to the module for a web deployment --&gt;
    &lt;!-- it can use all the same tags as the &lt;deployment&gt; entry above --&gt;
    &lt;dependencies&gt;
      &lt;!-- Adds a dependency on a ejb jar. This could also be done with a Class-Path entry --&gt;
      &lt;module name=&quot;deployment.myear.ear.myejbjar.jar&quot; /&gt;
    &lt;/dependencies&gt;
    &lt;!-- Set's local resources to have the lowest priority --&gt;
    &lt;!-- If the same class is both in the sub deployment and in another sub deployment that --&gt;
    &lt;!-- is visible to the war, then the Class from the other deployment will be loaded,  --&gt;
    &lt;!-- rather than the class actually packaged in the war. --&gt;
    &lt;!-- This can be used to resolve ClassCastExceptions  if the same class is in multiple sub deployments--&gt;
    &lt;local-last value=&quot;true&quot; /&gt;
  &lt;/sub-deployment&gt;
  &lt;!-- Now we are going to define two additional modules --&gt;
  &lt;!-- This one is a different version of javassist that we have packaged --&gt;
  &lt;module name=&quot;deployment.myjavassist&quot; &gt;
    &lt;resources&gt;
     &lt;resource-root path=&quot;javassist.jar&quot; &gt;
       &lt;!-- We want to use the servers version of javassist.util.proxy.* so we filter it out--&gt;
       &lt;filter&gt;
         &lt;exclude path=&quot;javassist/util/proxy&quot; /&gt;
       &lt;/filter&gt;
     &lt;/resource-root&gt;
    &lt;/resources&gt;
  &lt;/module&gt;
  &lt;!-- This is a module that re-exports the containers version of javassist.util.proxy --&gt;
  &lt;!-- This means that there is only one version of the Proxy classes defined          --&gt;
  &lt;module name=&quot;deployment.javassist.proxy&quot; &gt;
    &lt;dependencies&gt;
      &lt;module name=&quot;org.javassist&quot; &gt;
        &lt;imports&gt;
          &lt;include path=&quot;javassist/util/proxy&quot; /&gt;
          &lt;exclude path=&quot;/**&quot; /&gt;
        &lt;/imports&gt;
      &lt;/module&gt;
    &lt;/dependencies&gt;
  &lt;/module&gt;
&lt;/jboss-deployment-structure&gt;</pre>
        </div>
    </div>
    </p>
    <div class="confbox admonition admonition-info">
        
    <p>
The xsd for jboss-deployment-structure.xml is available at <a href="https://github.com/wildfly/wildfly/blob/master/build/src/main/resources/docs/schema/jboss-deployment-structure-1_2.xsd">https://github.com/wildfly/wildfly/blob/master/build/src/main/resources/docs/schema/jboss-deployment-structure-1_2.xsd</a>    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-AccessingJDKclasses"  >
        <h3>Accessing JDK classes</h3>
    
    <p>
Not all JDK classes are exposed to a deployment by default. If your deployment uses JDK classes that are not exposed you can get access to them using jboss-deployment-structure.xml with system dependencies:    </p>
    <div class="confbox programlisting">
                    <div class="title">Using jboss-deployment-structure.xml to access JDK classes</div>
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;jboss-deployment-structure xmlns=&quot;urn:jboss:deployment-structure:1.1&quot;&gt;
    &lt;deployment&gt;
        &lt;dependencies&gt;
            &lt;system export=&quot;true&quot;&gt;
                &lt;paths&gt;
                    &lt;path name=&quot;com/sun/corba/se/spi/legacy/connection&quot;/&gt;
                &lt;/paths&gt;
            &lt;/system&gt;
        &lt;/dependencies&gt;
    &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-2"  id="80873187_DeveloperGuide-Implicitmoduledependenciesfordeployments"  >
        <h2>Implicit module dependencies for deployments</h2>
    
    <p>
As explained in the&nbsp;<a href="Class_Loading_in_WildFly.html">Class Loading in WildFly</a> article, WildFly 8&nbsp;is based on module classloading. A class within a module B isn't visible to a class within a module A, unless module B adds a dependency on module A. Module dependencies can be explicitly (as explained in that classloading article) or can be &quot;implicit&quot;. This article will explain what implicit module dependencies mean and how, when and which modules are added as implicit dependencies.    </p>
    <div class="section-3"  id="80873187_DeveloperGuide-What%27sanimplicitmoduledependency%3F"  >
        <h3>What's an implicit module dependency?</h3>
    
    <p>
Consider an application deployment which contains EJBs. EJBs typically need access to classes from the javax.ejb.* package and other Java EE API packages. The jars containing these packages are already shipped in WildFly&nbsp;and are available as &quot;modules&quot;. The module which contains the javax.ejb.* classes has a specific name and so does the module which contains all the Java EE API classes. For an application to be able to use these classes, it has to add a dependency on the relevant modules. Forcing the application developers to add module dependencies like these (i.e. dependencies which can be &quot;inferred&quot;) isn't a productive approach. Hence, whenever an application is being deployed, the deployers within the server, which are processing this deployment &quot;implicitly&quot; add these module dependencies to the deployment so that these classes are visible to the deployment at runtime. This way the application developer doesn't have to worry about adding them explicitly. How and when these implicit dependencies are added is explained in the next section.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Howandwhenisanimplicitmoduledependencyadded%3F"  >
        <h3>How and when is an implicit module dependency added?</h3>
    
    <p>
When a deployment is being processed by the server, it goes through a chain of &quot;deployment processors&quot;. Each of these processors will have a way to check if the deployment meets a certain criteria and if it does, the deployment processor adds a implicit module dependency to that deployment. Let's take an example - Consider (again) an EJB3 deployment which has the following class:    </p>
    <div class="confbox programlisting">
                    <div class="title">MySuperDuperBean.java</div>
                <div class="content">
        <pre class="brush: java; gutter: false;">@Stateless
public class MySuperDuperBean {

...

}</pre>
        </div>
    </div>
    <p>
As can be seen, we have a simple @Stateless EJB. When the deployment containing this class is being processed, the EJB deployment processor will see that the deployment contains a class with the @Stateless annotation and thus identifies this as a EJB deployment. <strong class=" "><u class=" ">This is just one of the several ways, various deployment processors can identify a deployment of some specific type.</u></strong> The EJB deployment processor will then add an implicit dependency on the Java EE API module, so that all the Java EE API classes are visible to the deployment.    </p>
    <p>
Some subsystems will always add a API classes, even if the trigger condition is not met. These are listed&nbsp;separately&nbsp;below.&nbsp;    </p>
    <p>
In the next section, we'll list down the implicit module dependencies that are added to a deployment, by various deployers within WildFly.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Whicharetheimplicitmoduledependencies%3F"  >
        <h3>Which are the implicit module dependencies?</h3>
    
    <div class="tablewrap">
        <table>
<thead class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
    <span style="color: #333333;">
Subsystem responsible for adding the implicit dependency    </span>
    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
    <span style="color: #333333;">
Dependencies that are always added    </span>
    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
    <span style="color: #333333;">
Dependencies that are added if a trigger condition is met    </span>
    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
    <span style="color: #333333;">
Trigger which leads to the implicit module dependency being added    </span>
    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
Core Server    </p>
            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
javax.api&nbsp;    </p>
</li><li class=" ">    <p>
sun.jdk    </p>
</li><li class=" ">    <p>
org.jboss.vfs    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
EE Subsystem    </p>
            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
javaee.api    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
EJB3 subsystem    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
javaee.api    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
        <p>
The presence of ejb-jar.xml (in valid locations in the deployment, as specified by spec) or the presence of annotation based EJBs (ex: @Stateless, @Stateful, @MessageDriven etc)    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
JAX-RS (Resteasy) subsystem    </p>
            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
javax.xml.bind.api    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
org.jboss.resteasy.resteasy-atom-provider&nbsp;    </p>
</li><li class=" ">    <p>
org.jboss.resteasy.resteasy-cdi&nbsp;    </p>
</li><li class=" ">    <p>
org.jboss.resteasy.resteasy-jaxrs&nbsp;    </p>
</li><li class=" ">    <p>
org.jboss.resteasy.resteasy-jaxb-provider&nbsp;    </p>
</li><li class=" ">    <p>
org.jboss.resteasy.resteasy-jackson-provider&nbsp;    </p>
</li><li class=" ">    <p>
org.jboss.resteasy.resteasy-jsapi&nbsp;    </p>
</li><li class=" ">    <p>
org.jboss.resteasy.resteasy-multipart-provider&nbsp;    </p>
</li><li class=" ">    <p>
org.jboss.resteasy.async-http-servlet-30    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
        <p>
The presence of JAX-RS annotations in the deployment    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
JCA sub-system    </p>
            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
javax.resource.api    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
javax.jms.api&nbsp;    </p>
</li><li class=" ">    <p>
javax.validation.api&nbsp;    </p>
</li><li class=" ">    <p>
org.jboss.logging&nbsp;    </p>
</li><li class=" ">    <p>
org.jboss.ironjacamar.api&nbsp;    </p>
</li><li class=" ">    <p>
org.jboss.ironjacamar.impl&nbsp;    </p>
</li><li class=" ">    <p>
org.hibernate.validator    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
        <p>
If the deployment is a resource adaptor (RAR) deployment.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
JPA (Hibernate) subsystem    </p>
            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
javax.persistence.api    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
javaee.api    </p>
</li><li class=" ">    <p>
org.jboss.as.jpa    </p>
</li><li class=" ">    <p>
org.hibernate    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
        <p>
The presence of an @PersistenceUnit or @PersistenceContext annotation, or a &lt;persistence-unit-ref&gt; or &lt;persistence-context-ref&gt; in a deployment descriptor.<br/>.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
Logging Subsystem    </p>
            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
org.jboss.logging    </p>
</li><li class=" ">    <p>
org.apache.commons.logging    </p>
</li><li class=" ">    <p>
org.apache.log4j    </p>
</li><li class=" ">    <p>
org.slf4j    </p>
</li><li class=" ">    <p>
org.jboss.logging.jul-to-slf4j-stub    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
SAR Subsystem    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
org.jboss.logging    </p>
</li><li class=" ">    <p>
org.jboss.modules    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
        <p>
The deployment is a SAR archive    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
Security Subsystem    </p>
            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
org.picketbox    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
Web Subsystem    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
javaee.api    </p>
</li><li class=" ">    <p>
com.sun.jsf-impl    </p>
</li><li class=" ">    <p>
org.hibernate.validator    </p>
</li><li class=" ">    <p>
org.jboss.as.web    </p>
</li><li class=" ">    <p>
org.jboss.logging    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
        <p>
The deployment is a WAR archive. JSF is only added if used. Multiple version options exist for mojarra.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
Web Services Subsystem    </p>
            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
org.jboss.ws.api    </p>
</li><li class=" ">    <p>
org.jboss.ws.spi    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
Weld (CDI) Subsystem    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
&nbsp;    </p>
            </td>
                <td rowspan="1" colspan="1">
    <ul class=" "><li class=" ">    <p>
javax.persistence.api    </p>
</li><li class=" ">    <p>
javaee.api    </p>
</li><li class=" ">    <p>
org.javassist    </p>
</li><li class=" ">    <p>
org.jboss.interceptor    </p>
</li><li class=" ">    <p>
org.jboss.as.weld    </p>
</li><li class=" ">    <p>
org.jboss.logging    </p>
</li><li class=" ">    <p>
org.jboss.weld.core    </p>
</li><li class=" ">    <p>
org.jboss.weld.api    </p>
</li><li class=" ">    <p>
org.jboss.weld.spi    </p>
</li></ul>            </td>
                <td rowspan="1" colspan="1">
        <p>
If a beans.xml file is detected in the deployment    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    
    </div>
    
    <div class="section-2"  id="80873187_DeveloperGuide-HowdoImigratemyapplicationfromJBossAS5orAS6toWildFly8%3F"  >
        <h2>How do I migrate my application from JBoss AS 5 or AS 6 to WildFly 8?</h2>
    
<div class=" error">    <p>
Couldn't find a page to include called: How do I migrate my application from AS5 or AS6 to WildFly    </p>
</div>    </div>
    
    <div class="section-2"  id="80873187_DeveloperGuide-EJBinvocationsfromaremotestandaloneclientusingJNDI"  >
        <h2>EJB invocations from a remote standalone client using JNDI</h2>
    
    <p>
This chapter explains how to invoke EJBs from a remote client by using the JNDI API to first lookup the bean proxy and then invoke on that proxy.    </p>
    <div class="confbox admonition admonition-info">
        
    <p>
After you have read this article, do remember to take a look at <a href="https://docs.jboss.org/author/display/WFLY8/Remote+EJB+invocations+via+JNDI+-+EJB+client+API+or+remote-naming+project">Remote EJB invocations via JNDI - EJB client API or remote-naming project</a>    </p>
    </div>
    
    <p>
Before getting into the details, we would like the users to know that we have introduced a new EJB client API, which is a WildFly-specific API and allows invocation on remote EJBs. This client API isn't based on JNDI. So remote clients need not rely on JNDI API to invoke on EJBs. A separate document covering the EJB remote client API will be made available. For now, you can refer to the javadocs of the EJB client project at <a href="http://docs.jboss.org/ejbclient/">http://docs.jboss.org/ejbclient/</a>. In this document, we'll just concentrate on the traditional JNDI based invocation on EJBs. So let's get started:    </p>
    <div class="section-3"  id="80873187_DeveloperGuide-DeployingyourEJBsontheserverside%3A"  >
        <h3>Deploying your EJBs on the server side:</h3>
    
    <div class="confbox admonition admonition-note">
        
    <p>
Users who already have EJBs deployed on the server side can just skip to the next section.    </p>
    </div>
    
    <p>
As a first step, you'll have to deploy your application containing the EJBs on the AS7 server. If you want those EJBs to be remotely invocable, then you'll have to expose atleast one remote view for that bean. In this example, let's consider a simple Calculator stateless bean which exposes a RemoteCalculator remote business interface. We'll also have a simple stateful CounterBean which exposes a RemoteCounter remote business interface. Here's the code:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.jboss.as.quickstarts.ejb.remote.stateless;

/**
 * @author Jaikiran Pai
 */
public interface RemoteCalculator {

    int add(int a, int b);

    int subtract(int a, int b);
}</pre>
        </div>
    </div>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.jboss.as.quickstarts.ejb.remote.stateless;

import javax.ejb.Remote;
import javax.ejb.Stateless;

/**
 * @author Jaikiran Pai
 */
@Stateless
@Remote(RemoteCalculator.class)
public class CalculatorBean implements RemoteCalculator {

    @Override
    public int add(int a, int b) {
        return a + b;
    }

    @Override
    public int subtract(int a, int b) {
        return a - b;
    }
}</pre>
        </div>
    </div>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.jboss.as.quickstarts.ejb.remote.stateful;

/**
 * @author Jaikiran Pai
 */
public interface RemoteCounter {

    void increment();

    void decrement();

    int getCount();
}</pre>
        </div>
    </div>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.jboss.as.quickstarts.ejb.remote.stateful;

import javax.ejb.Remote;
import javax.ejb.Stateful;

/**
 * @author Jaikiran Pai
 */
@Stateful
@Remote(RemoteCounter.class)
public class CounterBean implements RemoteCounter {

    private int count = 0;

    @Override
    public void increment() {
        this.count++;
    }

    @Override
    public void decrement() {
        this.count--;
    }

    @Override
    public int getCount() {
        return this.count;
    }
}</pre>
        </div>
    </div>
    <p>
Let's package this in a jar (how you package it in a jar is out of scope of this chapter) named &quot;jboss-as-ejb-remote-app.jar&quot; and deploy it to the server. Make sure that your deployment has been processed successfully and there aren't any errors.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-WritingaremoteclientapplicationforaccessingandinvokingtheEJBsdeployedontheserver"  >
        <h3>Writing a remote client application for accessing and invoking the EJBs deployed on the server</h3>
    
    <p>
The next step is to write an application which will invoke the EJBs that you deployed on the server. In WildFly, you can either choose to use the WildFly 8&nbsp;specific EJB client API to do the invocation or use JNDI to lookup a proxy for your bean and invoke on that returned proxy. In this chapter we will concentrate on the JNDI lookup and invocation and will leave the EJB client API for a separate chapter.    </p>
    <p>
So let's take a look at what the client code looks like for looking up the JNDI proxy and invoking on it. Here's the entire client code which invokes on a stateless bean:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.jboss.as.quickstarts.ejb.remote.client;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.NamingException;
import java.security.Security;
import java.util.Hashtable;

import org.jboss.as.quickstarts.ejb.remote.stateful.CounterBean;
import org.jboss.as.quickstarts.ejb.remote.stateful.RemoteCounter;
import org.jboss.as.quickstarts.ejb.remote.stateless.CalculatorBean;
import org.jboss.as.quickstarts.ejb.remote.stateless.RemoteCalculator;
import org.jboss.sasl.JBossSaslProvider;

/**
 * A sample program which acts a remote client for a EJB deployed on AS7 server.
 * This program shows how to lookup stateful and stateless beans via JNDI and then invoke on them
 *
 * @author Jaikiran Pai
 */
public class RemoteEJBClient {

    public static void main(String[] args) throws Exception {
        // Invoke a stateless bean
        invokeStatelessBean();

        // Invoke a stateful bean
        invokeStatefulBean();
    }

    /**
     * Looks up a stateless bean and invokes on it
     *
     * @throws NamingException
     */
    private static void invokeStatelessBean() throws NamingException {
        // Let's lookup the remote stateless calculator
        final RemoteCalculator statelessRemoteCalculator = lookupRemoteStatelessCalculator();
        System.out.println(&quot;Obtained a remote stateless calculator for invocation&quot;);
        // invoke on the remote calculator
        int a = 204;
        int b = 340;
        System.out.println(&quot;Adding &quot; + a + &quot; and &quot; + b + &quot; via the remote stateless calculator deployed on the server&quot;);
        int sum = statelessRemoteCalculator.add(a, b);
        System.out.println(&quot;Remote calculator returned sum = &quot; + sum);
        if (sum != a + b) {
            throw new RuntimeException(&quot;Remote stateless calculator returned an incorrect sum &quot; + sum + &quot; ,expected sum was &quot; + (a + b));
        }
        // try one more invocation, this time for subtraction
        int num1 = 3434;
        int num2 = 2332;
        System.out.println(&quot;Subtracting &quot; + num2 + &quot; from &quot; + num1 + &quot; via the remote stateless calculator deployed on the server&quot;);
        int difference = statelessRemoteCalculator.subtract(num1, num2);
        System.out.println(&quot;Remote calculator returned difference = &quot; + difference);
        if (difference != num1 - num2) {
            throw new RuntimeException(&quot;Remote stateless calculator returned an incorrect difference &quot; + difference + &quot; ,expected difference was &quot; + (num1 - num2));
        }
    }

    /**
     * Looks up a stateful bean and invokes on it
     *
     * @throws NamingException
     */
    private static void invokeStatefulBean() throws NamingException {
        // Let's lookup the remote stateful counter
        final RemoteCounter statefulRemoteCounter = lookupRemoteStatefulCounter();
        System.out.println(&quot;Obtained a remote stateful counter for invocation&quot;);
        // invoke on the remote counter bean
        final int NUM_TIMES = 20;
        System.out.println(&quot;Counter will now be incremented &quot; + NUM_TIMES + &quot; times&quot;);
        for (int i = 0; i &lt; NUM_TIMES; i++) {
            System.out.println(&quot;Incrementing counter&quot;);
            statefulRemoteCounter.increment();
            System.out.println(&quot;Count after increment is &quot; + statefulRemoteCounter.getCount());
        }
        // now decrementing
        System.out.println(&quot;Counter will now be decremented &quot; + NUM_TIMES + &quot; times&quot;);
        for (int i = NUM_TIMES; i &gt; 0; i--) {
            System.out.println(&quot;Decrementing counter&quot;);
            statefulRemoteCounter.decrement();
            System.out.println(&quot;Count after decrement is &quot; + statefulRemoteCounter.getCount());
        }
    }

    /**
     * Looks up and returns the proxy to remote stateless calculator bean
     *
     * @return
     * @throws NamingException
     */
    private static RemoteCalculator lookupRemoteStatelessCalculator() throws NamingException {
        final Hashtable jndiProperties = new Hashtable();
        jndiProperties.put(Context.URL_PKG_PREFIXES, &quot;org.jboss.ejb.client.naming&quot;);
        final Context context = new InitialContext(jndiProperties);
        // The app name is the application name of the deployed EJBs. This is typically the ear name
        // without the .ear suffix. However, the application name could be overridden in the application.xml of the
        // EJB deployment on the server.
        // Since we haven't deployed the application as a .ear, the app name for us will be an empty string
        final String appName = &quot;&quot;;
        // This is the module name of the deployed EJBs on the server. This is typically the jar name of the
        // EJB deployment, without the .jar suffix, but can be overridden via the ejb-jar.xml
        // In this example, we have deployed the EJBs in a jboss-as-ejb-remote-app.jar, so the module name is
        // jboss-as-ejb-remote-app
        final String moduleName = &quot;jboss-as-ejb-remote-app&quot;;
        // AS7 allows each deployment to have an (optional) distinct name. We haven't specified a distinct name for
        // our EJB deployment, so this is an empty string
        final String distinctName = &quot;&quot;;
        // The EJB name which by default is the simple class name of the bean implementation class
        final String beanName = CalculatorBean.class.getSimpleName();
        // the remote view fully qualified class name
        final String viewClassName = RemoteCalculator.class.getName();
        // let's do the lookup
        return (RemoteCalculator) context.lookup(&quot;ejb:&quot; + appName + &quot;/&quot; + moduleName + &quot;/&quot; + distinctName + &quot;/&quot; + beanName + &quot;!&quot; + viewClassName);
    }

    /**
     * Looks up and returns the proxy to remote stateful counter bean
     *
     * @return
     * @throws NamingException
     */
    private static RemoteCounter lookupRemoteStatefulCounter() throws NamingException {
        final Hashtable jndiProperties = new Hashtable();
        jndiProperties.put(Context.URL_PKG_PREFIXES, &quot;org.jboss.ejb.client.naming&quot;);
        final Context context = new InitialContext(jndiProperties);
        // The app name is the application name of the deployed EJBs. This is typically the ear name
        // without the .ear suffix. However, the application name could be overridden in the application.xml of the
        // EJB deployment on the server.
        // Since we haven't deployed the application as a .ear, the app name for us will be an empty string
        final String appName = &quot;&quot;;
        // This is the module name of the deployed EJBs on the server. This is typically the jar name of the
        // EJB deployment, without the .jar suffix, but can be overridden via the ejb-jar.xml
        // In this example, we have deployed the EJBs in a jboss-as-ejb-remote-app.jar, so the module name is
        // jboss-as-ejb-remote-app
        final String moduleName = &quot;jboss-as-ejb-remote-app&quot;;
        // AS7 allows each deployment to have an (optional) distinct name. We haven't specified a distinct name for
        // our EJB deployment, so this is an empty string
        final String distinctName = &quot;&quot;;
        // The EJB name which by default is the simple class name of the bean implementation class
        final String beanName = CounterBean.class.getSimpleName();
        // the remote view fully qualified class name
        final String viewClassName = RemoteCounter.class.getName();
        // let's do the lookup (notice the ?stateful string as the last part of the jndi name for stateful bean lookup)
        return (RemoteCounter) context.lookup(&quot;ejb:&quot; + appName + &quot;/&quot; + moduleName + &quot;/&quot; + distinctName + &quot;/&quot; + beanName + &quot;!&quot; + viewClassName + &quot;?stateful&quot;);
    }
}</pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
        
    <p>
The entire server side and client side code is hosted at the github repo here <a href="https://github.com/wildfly/quickstart/tree/9.x/ejb-remote">ejb-remote</a>    </p>
    </div>
    
    <p>
The code has some comments which will help you understand each of those lines. But we'll explain here in more detail what the code does. As a first step in the client code, we'll do a lookup of the EJB using a JNDI name. In AS7, for remote access to EJBs, you use the ejb: namespace with the following syntax:    </p>
    <p>
<strong class=" ">For stateless beans:</strong>    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">ejb:&lt;app-name&gt;/&lt;module-name&gt;/&lt;distinct-name&gt;/&lt;bean-name&gt;!&lt;fully-qualified-classname-of-the-remote-interface&gt;</pre>
        </div>
    </div>
    <p>
<strong class=" ">For stateful beans:</strong>    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">ejb:&lt;app-name&gt;/&lt;module-name&gt;/&lt;distinct-name&gt;/&lt;bean-name&gt;!&lt;fully-qualified-classname-of-the-remote-interface&gt;?stateful</pre>
        </div>
    </div>
    <p>
The ejb: namespace identifies it as a EJB lookup and is a constant (i.e. doesn't change) for doing EJB lookups. The rest of the parts in the jndi name are as follows:    </p>
    <p>
<strong class=" ">app-name</strong> : This is the name of the .ear (without the .ear suffix) that you have deployed on the server and contains your EJBs.    </p>
<ul class=" "><li class=" ">    <p>
Java EE 6 allows you to override the application name, to a name of your choice by setting it in the application.xml. If the deployment uses uses such an override then the app-name used in the JNDI name should match that name.    </p>
</li><li class=" ">    <p>
EJBs can also be deployed in a .war or a plain .jar (like we did in step 1). In such cases where the deployment isn't an .ear file, then the app-name must be an empty string, while doing the lookup.    </p>
</li></ul>    <p>
<strong class=" ">module-name</strong> : This is the name of the .jar (without the .jar suffix) that you have deployed on the server and the contains your EJBs. If the EJBs are deployed in a .war then the module name is the .war name (without the .war suffix).    </p>
<ul class=" "><li class=" ">    <p>
Java EE 6 allows you to override the module name, by setting it in the ejb-jar.xml/web.xml of your deployment. If the deployment uses such an override then the module-name used in the JNDI name should match that name.    </p>
</li><li class=" ">    <p>
Module name part cannot be an empty string in the JNDI name    </p>
</li></ul>    <p>
<strong class=" ">distinct-name</strong> : This is a WildFly-specific name which can be optionally assigned to the deployments that are deployed on the server. More about the purpose and usage of this will be explained in a separate chapter. If a deployment doesn't use distinct-name then, use an empty string in the JNDI name, for distinct-name    </p>
    <p>
<strong class=" ">bean-name</strong> : This is the name of the bean for which you are doing the lookup. The bean name is typically the unqualified classname of the bean implementation class, but can be overriden through either ejb-jar.xml or via annotations. The bean name part cannot be an empty string in the JNDI name.    </p>
    <p>
<strong class=" ">fully-qualified-classname-of-the-remote-interface</strong> : This is the fully qualified class name of the interface for which you are doing the lookup. The interface should be one of the remote interfaces exposed by the bean on the server. The fully qualified class name part cannot be an empty string in the JNDI name.    </p>
    <p>
For stateful beans, the JNDI name expects an additional &quot;?stateful&quot; to be appended after the fully qualified interface name part. This is because for stateful beans, a new session gets created on JNDI lookup and the EJB client API implementation doesn't contact the server during the JNDI lookup to know what kind of a bean the JNDI name represents (we'll come to this in a while). So the JNDI name itself is expected to indicate that the client is looking up a stateful bean, so that an appropriate session can be created.    </p>
    <p>
Now that we know the syntax, let's see our code and check what JNDI name it uses. Since our stateless EJB named CalculatorBean is deployed in a jboss-as-ejb-remote-app.jar (without any ear) and since we are looking up the org.jboss.as.quickstarts.ejb.remote.stateless.RemoteCalculator remote interface, our JNDI name will be:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">ejb:/jboss-as-ejb-remote-app//CalculatorBean!org.jboss.as.quickstarts.ejb.remote.stateless.RemoteCalculator</pre>
        </div>
    </div>
    <p>
That's what the lookupRemoteStatelessCalculator() method in the above client code uses.    </p>
    <p>
For the stateful EJB named CounterBean which is deployed in hte same jboss-as-ejb-remote-app.jar and which exposes the org.jboss.as.quickstarts.ejb.remote.stateful.RemoteCounter, the JNDI name will be:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">ejb:/jboss-as-ejb-remote-app//CounterBean!org.jboss.as.quickstarts.ejb.remote.stateful.RemoteCounter?stateful</pre>
        </div>
    </div>
    <p>
That's what the lookupRemoteStatefulCounter() method in the above client code uses.    </p>
    <p>
Now that we know of the JNDI name, let's take a look at the following piece of code in the lookupRemoteStatelessCalculator():    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">final Hashtable jndiProperties = new Hashtable();
jndiProperties.put(Context.URL_PKG_PREFIXES, &quot;org.jboss.ejb.client.naming&quot;);
final Context context = new InitialContext(jndiProperties);</pre>
        </div>
    </div>
    <p>
Here we are creating a JNDI InitialContext object by passing it some JNDI properties. The Context.URL_PKG_PREFIXES is set to org.jboss.ejb.client.naming. This is necessary because we should let the JNDI API know what handles the ejb: namespace that we use in our JNDI names for lookup. The &quot;org.jboss.ejb.client.naming&quot; has a URLContextFactory implementation which will be used by the JNDI APIs to parse and return an object for ejb: namespace lookups. You can either pass these properties to the constructor of the InitialContext class or have a jndi.properites file in the classpath of the client application, which (atleast) contains the following property:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">java.naming.factory.url.pkgs=org.jboss.ejb.client.naming</pre>
        </div>
    </div>
    <p>
So at this point, we have setup the InitialContext and also have the JNDI name ready to do the lookup. You can now do the lookup and the appropriate proxy which will be castable to the remote interface that you used as the fully qualified class name in the JNDI name, will be returned. Some of you might be wondering, how the JNDI implementation knew which server address to look, for your deployed EJBs. The answer is in AS7, the proxies returned via JNDI name lookup for ejb: namespace do not connect to the server unless an invocation on those proxies is done.    </p>
    <p>
Now let's get to the point where we invoke on this returned proxy:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">// Let's lookup the remote stateless calculator
        final RemoteCalculator statelessRemoteCalculator = lookupRemoteStatelessCalculator();
        System.out.println(&quot;Obtained a remote stateless calculator for invocation&quot;);
        // invoke on the remote calculator
        int a = 204;
        int b = 340;
        System.out.println(&quot;Adding &quot; + a + &quot; and &quot; + b + &quot; via the remote stateless calculator deployed on the server&quot;);
        int sum = statelessRemoteCalculator.add(a, b);</pre>
        </div>
    </div>
    <p>
We can see here that the proxy returned after the lookup is used to invoke the add(...) method of the bean. It's at this point that the JNDI implementation (which is backed by the EJB client API) needs to know the server details. So let's now get to the important part of setting up the EJB client context properties.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-SettingupEJBclientcontextproperties"  >
        <h3>Setting up EJB client context properties</h3>
    
    <p>
A EJB client context is a context which contains contextual information for carrying out remote invocations on EJBs. This is a WildFly-specific API. The EJB client context can be associated with multiple EJB receivers. Each EJB receiver is capable of handling invocations on different EJBs. For example, an EJB receiver &quot;Foo&quot; might be able to handle invocation on a bean identified by app-A/module-A/distinctinctName-A/Bar!RemoteBar, whereas a EJB receiver named &quot;Blah&quot; might be able to handle invocation on a bean identified by app-B/module-B/distinctName-B/BeanB!RemoteBean. Each such EJB receiver knows about what set of EJBs it can handle and each of the EJB receiver knows which server target to use for handling the invocations on the bean. For example, if you have a AS7 server at 10.20.30.40 IP address which has its remoting port opened at 4447 and if that's the server on which you deployed that CalculatorBean, then you can setup a EJB receiver which knows its target address is 10.20.30.40:4447. Such an EJB receiver will be capable enough to communicate to the server via the JBoss specific EJB remote client protocol (details of which will be explained in-depth in a separate chapter).    </p>
    <p>
Now that we know what a EJB client context is and what a EJB receiver is, let's see how we can setup a client context with 1 EJB receiver which can connect to 10.20.30.40 IP address at port 4447. That EJB client context will then be used (internally) by the JNDI implementation to handle invocations on the bean proxy.    </p>
    <p>
The client will have to place a jboss-ejb-client.properties file in the classpath of the application. The jboss-ejb-client.properties can contain the following properties:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">endpoint.name=client-endpoint
remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false

remote.connections=default

remote.connection.default.host=10.20.30.40
remote.connection.default.port = 8080
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false

remote.connection.default.username=appuser
remote.connection.default.password=apppassword</pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
        
    <p>
This file includes a reference to a default password. Be sure to change this as soon as possible.    </p>
    </div>
    
    <p>
The above properties file is just an example. The actual file that was used for this sample program is available here for reference <a href="https://github.com/wildfly/quickstart/blob/master/ejb-remote/client/src/main/resources/jboss-ejb-client.properties">jboss-ejb-client.properties</a>    </p>
    <div class="confbox admonition admonition-note">
        
    <p>
We'll see what each of it means.    </p>
    <p>
First the endpoint.name property. We mentioned earlier that the EJB receivers will communicate with the server for EJB invocations. Internally, they use JBoss&nbsp;Remoting project to carry out the communication. The endpoint.name property represents the name that will be used to create the client side of the enpdoint. The endpoint.name property is optional and if not specified in the jboss-ejb-client.properties file, it will default to &quot;config-based-ejb-client-endpoint&quot; name.    </p>
    <p>
Next is the remote.connectionprovider.create.options.&lt;....&gt; properties:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false</pre>
        </div>
    </div>
    <p>
The &quot;remote.connectionprovider.create.options.&quot; property prefix can be used to pass the options that will be used while create the connection provider which will handle the &quot;remote:&quot; protocol. In this example we use the &quot;remote.connectionprovider.create.options.&quot; property prefix to pass the &quot;org.xnio.Options.SSL_ENABLED&quot; property value as false. That property will then be used during the connection provider creation. Similarly other properties can be passed too, just append it to the &quot;remote.connectionprovider.create.options.&quot; prefix    </p>
    <p>
Next we'll see:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">remote.connections=default</pre>
        </div>
    </div>
    <p>
This is where you define the connections that you want to setup for communication with the remote server. The &quot;remote.connections&quot; property uses a comma separated value of connection &quot;names&quot;. The connection names are just logical and are used grouping together the connection configuration properties later on in the properties file. The example above sets up a single remote connection named &quot;default&quot;. There can be more than one connections that are configured. For example:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">remote.connections=one, two</pre>
        </div>
    </div>
    <p>
Here we are listing 2 connections named &quot;one&quot; and &quot;two&quot;. Ultimately, each of the connections will map to a EJB receiver. So if you have 2 connections, that will setup 2 EJB receivers that will be added to the EJB client context. Each of these connections will be configured with the connection specific properties as follows:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">remote.connection.default.host=10.20.30.40
remote.connection.default.port = 8080
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false</pre>
        </div>
    </div>
    <p>
As you can see we are using the &quot;remote.connection.&lt;connection-name&gt;.&quot; prefix for specifying the connection specific property. The connection name here is &quot;default&quot; and we are setting the &quot;host&quot; property of that connection to point to 10.20.30.40. Similarly we set the &quot;port&quot; for that connection to 4447.    </p>
    </div>
    
    <p>
By default WildFly uses 8080 as the remoting port. The EJB client API uses the http port, with the http-upgrade functionality, for communicating with the server for remote invocations, so that's the port we use in our client programs (unless the server is configured for some other http port)    </p>
    <div class="confbox admonition admonition-note">
        
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">remote.connection.default.username=appuser
remote.connection.default.password=apppassword</pre>
        </div>
    </div>
    <p>
The given user/password must be set by using the command bin/add-user.sh &#65279;(or.bat).<br/>The user and password must be set because the security-realm is enabled for the subsystem remoting (see standalone*.xml or domain.xml) by default.<br/>If you do not need the security for remoting you might remove the attribute security-realm in the configuration.    </p>
    </div>
    
    <p>
security-realm is enabled by default.    </p>
    <div class="confbox admonition admonition-note">
        
    <p>
We then use the &quot;remote.connection.&lt;connection-name&gt;.connect.options.&quot; property prefix to setup options that will be used during the connection creation.    </p>
    <p>
Here's an example of setting up multiple connections with different properties for each of those:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false

remote.connections=one, two

remote.connection.one.host=localhost
remote.connection.one.port=6999
remote.connection.one.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false

remote.connection.two.host=localhost
remote.connection.two.port=7999
remote.connection.two.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false</pre>
        </div>
    </div>
    <p>
As you can see we setup 2 connections &quot;one&quot; and &quot;two&quot; which both point to &quot;localhost&quot; as the &quot;host&quot; but different ports. Each of these connections will internally be used to create the EJB receivers in the EJB client context.    </p>
    <p>
So that's how the jboss-ejb-client.properties file can be setup and placed in the classpath.    <h4  id="80873187_DeveloperGuide-UsingadifferentfileforsettingupEJBclientcontext"  >Using a different file for setting up EJB client context</h4>
    </p>
    <p>
The EJB client code will by default look for jboss-ejb-client.properties in the classpath. However, you can specify a different file of your choice by setting the &quot;jboss.ejb.client.properties.file.path&quot; system property which points to a properties file on your filesystem, containing the client context configurations. An example for that would be &quot;-Djboss.ejb.client.properties.file.path=/home/me/my-client/custom-jboss-ejb-client.properties&quot;    <h4  id="80873187_DeveloperGuide-Settinguptheclientclasspathwiththejarsthatarerequiredtoruntheclientapplication"  >Setting up the client classpath with the jars that are required to run the client application</h4>
    </p>
    <p>
A jboss-client jar is shipped in the distribution. It's available at WILDFLY_HOME/bin/client/jboss-client.jar. Place this jar in the classpath of your client application.    </p>
    </div>
    
    <p>
If you are using Maven to build the client application, then please follow the instructions in the WILDFLY_HOME/bin/client/README.txt to add this jar as a Maven dependency.    </p>
    <div class="confbox admonition admonition-note">
        
    <p>
    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Summary"  >
        <h3>Summary</h3>
    
    <p>
In the above examples, we saw what it takes to invoke a EJB from a remote client. To summarize:    </p>
<ul class=" "><li class=" ">    <p>
On the server side you need to deploy EJBs which expose the remote views.    </p>
</li><li class=" ">    <p>
On the client side you need a client program which:    </p>
<ul class=" "><li class=" ">    <p>
Has a jboss-ejb-client.properties in its classpath to setup the server connection information    </p>
</li><li class=" ">    <p>
Either has a jndi.properties to specify the java.naming.factory.url.pkgs property or passes that as a property to the InitialContext constructor    </p>
</li><li class=" ">    <p>
Setup the client classpath to include the jboss-client jar that's required for remote invocation of the EJBs. The location of the jar is mentioned above. You'll also need to have your application's bean interface jars and other jars that are required by your application, in the client classpath    </p>
</li></ul></li></ul>    </div>
    
    </div>
    
    <div class="section-2"  id="80873187_DeveloperGuide-EJBinvocationsfromaremoteserver"  >
        <h2>EJB invocations from a remote server</h2>
    
    <p>
The purpose of this chapter is to demonstrate how to lookup and invoke on EJBs deployed on an WildFly&nbsp;server instance <strong class=" ">from another</strong> WildFly&nbsp;server instance. This is different from invoking the EJBs <a href="https://docs.jboss.org/author/display/AS71/EJB+invocations+from+a+remote+client+using+JNDI">from a remote standalone client</a>    </p>
    <p>
Let's call the server, from which the invocation happens to the EJB, as   &quot;Client Server&quot; and the server on which the bean is deployed as the   &quot;Destination Server&quot;.    </p>
    <div class="confbox admonition admonition-note">
        
    <p>
Note that this chapter deals with the case where the bean is deployed on the &quot;Destination Server&quot; but <strong class=" ">not</strong> on the &quot;Client Server&quot;.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Applicationpackaging"  >
        <h3>Application packaging</h3>
    
    <p>
In this example, we'll consider a EJB which is packaged in a myejb.jar which is within a myapp.ear. Here's how it would look like:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">myapp.ear
|
|---- myejb.jar
|&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;|
|&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;|---- &lt;org.myapp.ejb.*&gt; // EJB classes</pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
        
    <p>
Note that packaging itself isn't really important in the context of this article. You can deploy the EJBs in any standard way (.ear, .war or .jar).    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Beans"  >
        <h3>Beans</h3>
    
    <p>
In our example, we'll consider a simple stateless session bean which is as follows:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.myapp.ejb;

public interface Greeter {
&nbsp;&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp; String greet(String user);
}</pre>
        </div>
    </div>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">package org.myapp.ejb;

import javax.ejb.Remote;
import javax.ejb.Stateless;

@Stateless
@Remote (Greeter.class)
public class GreeterBean implements Greeter {

&nbsp;&nbsp;&nbsp; @Override
&nbsp;&nbsp;&nbsp; public String greet(String user) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return &quot;Hello &quot; + user + &quot;, have a pleasant day!&quot;;
&nbsp;&nbsp;&nbsp; }
}</pre>
        </div>
    </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Security"  >
        <h3>Security</h3>
    
    <p>
WildFly 8&nbsp;is secure by default. What this means is that no communication can happen with an WildFly&nbsp;instance from a remote client (irrespective of whether it is a standalone client or another server instance) without passing the appropriate credentials. Remember that in this example, our &quot;client server&quot; will be communicating with the &quot;destination server&quot;. So in order to allow this communication to happen successfully, we'll have to configure user credentials which we will be using during this communication. So let's start with the necessary configurations for this.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Configuringauseronthe%22DestinationServer%22"  >
        <h3>Configuring a user on the &quot;Destination Server&quot;</h3>
    
    <p>
As a first step we'll configure a user on the destination server who will be allowed to access the destination server. We create the user using the <tt class=" ">add-user</tt> script that's available in the JBOSS_HOME/bin folder. In this example, we'll be configuring a <tt class=" ">Application User</tt> named <tt class=" ">ejb</tt> and with a password <tt class=" ">test</tt> in the <tt class=" ">ApplicationRealm</tt>. Running the <tt class=" ">add-user</tt> script is an interactive process and you will see questions/output as follows:    </p>
    <div class="confbox programlisting">
                    <div class="title">add-user</div>
                <div class="content">
        <pre class="brush: java; gutter: false;">jpai@jpai-laptop:bin$ ./add-user.sh

What type of user do you wish to add?
&amp;nbsp;a) Management User (mgmt-users.properties)
&amp;nbsp;b) Application User (application-users.properties)
(a): b

Enter the details of the new user to add.
Realm (ApplicationRealm) :
Username : ejb
Password :
Re-enter Password :
What roles do you want this user to belong to? (Please enter a comma separated list, or leave blank for none)\[&amp;nbsp; \]:
About to add user 'ejb' for realm 'ApplicationRealm'
Is this correct yes/no? yes
Added user 'ejb' to file '/jboss-as-7.1.1.Final/standalone/configuration/application-users.properties'
Added user 'ejb' to file '/jboss-as-7.1.1.Final/domain/configuration/application-users.properties'
Added user 'ejb' with roles to file '/jboss-as-7.1.1.Final/standalone/configuration/application-roles.properties'
Added user 'ejb' with roles to file '/jboss-as-7.1.1.Final/domain/configuration/application-roles.properties'</pre>
        </div>
    </div>
    <p>
As you can see in the output above we have now configured a user on the destination server who'll be allowed to access this server. We'll use this user credentials later on in the client server for communicating with this server. The important bits to remember are the user we have created in this example is <tt class=" ">ejb</tt> and the password&nbsp; is <tt class=" ">test.</tt>    </p>
    <div class="confbox admonition admonition-note">
        
    <p>
Note that you can use any username and password combination you want to.    </p>
    </div>
    
    <div class="confbox admonition admonition-note">
        
    <p>
You do <strong class=" ">not</strong> require the server to be started to add a user using the add-user script.    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Startthe%22DestinationServer%22"  >
        <h3>Start the &quot;Destination Server&quot;</h3>
    
    <p>
As a next step towards running this example, we'll start the &quot;Destination Server&quot;. In this example, we'll use the standalone server and use the <i class=" ">standalone-full.xml</i> configuration. The startup command will look like:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">./standalone.sh -server-config=standalone-full.xml</pre>
        </div>
    </div>
    <p>
Ensure that the server has started without any errors.    </p>
    <div class="confbox admonition admonition-note">
        
    <p>
It's very important to note that if you are starting both the server instances on the same machine, then each of those server instances <strong class=" ">must</strong> have a unique <tt class=" ">jboss.node.name</tt> system property. You can do that by passing an appropriate value for <tt class=" ">-Djboss.node.name</tt> system property to the startup script:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">./standalone.sh -server-config=standalone-full.xml -Djboss.node.name=&lt;add appropriate value here&gt;</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Deployingtheapplication"  >
        <h3>Deploying the application</h3>
    
    <p>
The application (<i class=" ">myapp.ear</i> in our case) will be deployed to &quot;Destination Server&quot;. The process of deploying the application is out of scope of this chapter. You can either use the Command Line Interface or the Admin console or any IDE or manually copy it to JBOSS_HOME/standalone/deployments folder (for standalone server). Just ensure that the application has been deployed successfully.    </p>
    <p>
So far, we have built a EJB application and deployed it on the &quot;Destination Server&quot;. Now let's move to the &quot;Client Server&quot; which acts as the client for the deployed EJBs on the &quot;Destination Server&quot;.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Configuringthe%22ClientServer%22topointtotheEJBremotingconnectoronthe%22DestinationServer%22"  >
        <h3>Configuring the &quot;Client Server&quot; to point to the EJB remoting connector on the &quot;Destination Server&quot;</h3>
    
    <p>
As a first step on the &quot;Client Server&quot;, we need to let the server know about the &quot;Destination Server&quot;'s EJB remoting connector, over which it can communicate during the EJB invocations. To do that, we'll have to add a &quot;<i class=" ">remote-outbound-connection</i>&quot; to the remoting subsystem on the &quot;Client Server&quot;. The &quot;<i class=" ">remote-outbound-connection</i>&quot; configuration indicates that a outbound connection will be created to a remote server instance from that server. The &quot;<i class=" ">remote-outbound-connection</i>&quot; will be backed by a &quot;<i class=" ">outbound-socket-binding</i>&quot; which will point to a remote host and a remote port (of the &quot;Destination Server&quot;). So let's see how we create these configurations.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Startthe%22ClientServer%22"  >
        <h3>Start the &quot;Client Server&quot;</h3>
    
    <p>
In this example, we'll start the &quot;Client Server&quot; on the same machine as the &quot;Destination Server&quot;. We have copied the entire server installation to a different folder and while starting the &quot;Client Server&quot; we'll use a port-offset (of 100 in this example) to avoid port conflicts:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">./standalone.sh -server-config=standalone-full.xml -Djboss.socket.binding.port-offset=100</pre>
        </div>
    </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Createasecurityrealmontheclientserver"  >
        <h3>Create a security realm on the client server</h3>
    
    <p>
Remember that we need to communicate with a secure destination server. In order to do that the client server has to pass the user credentials to the destination server. Earlier we created a user on the destination server who'll be allowed to communicate with that server. Now on the &quot;client server&quot; we'll create a security-realm which will be used to pass the user information.    </p>
    <p>
In this example we'll use a security realm which stores a Base64 encoded password and then passes on that credentials when asked for. Earlier we created a user named <tt class=" ">ejb</tt> and password <tt class=" ">test</tt>. So our first task here would be to create the base64 encoded version of the password <tt class=" ">test</tt>. You can use any utility which generates you a base64 version for a string. I used <a href="http://www.base64encode.org/">this online site</a> which generates the base64 encoded string. So for the <tt class=" ">test</tt> password, the base64 encoded version is <tt class=" ">dGVzdA==</tt>    </p>
    <div class="confbox admonition admonition-tip">
        
    <p>
While generating the base64 encoded string make sure that you don't have any trailing or leading spaces for the original password. That can lead to incorrect encoded versions being generated.    </p>
    </div>
    
    <div class="confbox admonition admonition-tip">
        
    <p>
With new versions the add-user script will show the base64 password if you type 'y' if you've been ask    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">Is this new user going to be used for one AS process to connect to another AS process e.g. slave domain controller?</pre>
        </div>
    </div>
    </div>
    
    <p>
Now that we have generated that base64 encoded password, let's use in the in the security realm that we are going to configure on the &quot;client server&quot;. I'll first shutdown the client server and edit the standlaone-full.xml file to add the following in the <tt class=" ">&lt;management&gt;</tt> section    </p>
    <p>
Now let's create a &quot;<i class=" ">security-realm</i>&quot; for the base64 encoded password.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">/core-service=management/security-realm=ejb-security-realm:add()
/core-service=management/security-realm=ejb-security-realm/server-identity=secret:add(value=&quot;dGVzdA==&quot;)</pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
        
    <p>
Notice that the CLI show the message <i class=" ">&quot;process-state&quot; =&gt; &quot;reload-required&quot;</i>, so you have to restart the server before you can use this change.    </p>
    </div>
    
    <p>
upon successful invocation of this command, the following configuration will be created in the <i class=" ">management</i> section:    </p>
    <div class="confbox programlisting">
                    <div class="title">standalone-full.xml</div>
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;management&gt;
        &lt;security-realms&gt;
            ...
            &lt;security-realm name=&quot;ejb-security-realm&quot;&gt;
                &lt;server-identities&gt;
                    &lt;secret value=&quot;dGVzdA==&quot;/&gt;
                &lt;/server-identities&gt;
            &lt;/security-realm&gt;
        &lt;/security-realms&gt;
...</pre>
        </div>
    </div>
    <p>
As you can see I have created a security realm named &quot;ejb-security-realm&quot; (you can name it anything) with the base64 encoded password. So that completes the security realm configuration for the client server. Now let's move on to the next step.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Createaoutboundsocketbindingonthe%22ClientServer%22"  >
        <h3>Create a outbound-socket-binding on the &quot;Client Server&quot;</h3>
    
    <p>
Let's first create a <i class=" ">outbound-socket-binding</i> which points the &quot;Destination Server&quot;'s host and port. We'll use the CLI to create this configuration:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=remote-ejb:add(host=localhost, port=8080)</pre>
        </div>
    </div>
    <p>
The above command will create a outbound-socket-binding named &quot;<i class=" ">remote-ejb</i>&quot; (we can name it anything) which points to &quot;localhost&quot; as the host and port 8080 as the destination port. Note that the host information should match the host/IP of the &quot;Destination Server&quot; (in this example we are running on the same machine so we use &quot;localhost&quot;) and&nbsp; the port information should match the http-remoting connector port used by the EJB subsystem (by default it's 8080). When this command is run successfully, we'll see that the standalone-full.xml (the file which we used to start the server) was updated with the following outbound-socket-binding in the socket-binding-group:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;socket-binding-group name=&quot;standard-sockets&quot; default-interface=&quot;public&quot; port-offset=&quot;${jboss.socket.binding.port-offset:0}&quot;&gt;
        ...
        &lt;outbound-socket-binding name=&quot;remote-ejb&quot;&gt;
            &lt;remote-destination host=&quot;localhost&quot; port=&quot;8080&quot;/&gt;
        &lt;/outbound-socket-binding&gt;
    &lt;/socket-binding-group&gt;</pre>
        </div>
    </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Createa%22remoteoutboundconnection%22whichusesthisnewlycreated%22outboundsocketbinding%22"  >
        <h3>Create a &quot;remote-outbound-connection&quot; which uses this newly created &quot;outbound-socket-binding&quot;</h3>
    
    <p>
Now let's create a &quot;<i class=" ">remote-outbound-connection</i>&quot; which will use the newly created outbound-socket-binding (pointing to the EJB remoting connector of the &quot;Destination Server&quot;). We'll continue to use the CLI to create this configuration:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">/subsystem=remoting/remote-outbound-connection=remote-ejb-connection:add(outbound-socket-binding-ref=remote-ejb, protocol=http-remoting, security-realm=ejb-security-realm, username=ejb)</pre>
        </div>
    </div>
    <p>
The above command creates a remote-outbound-connection, named &quot;<i class=" ">remote-ejb-connection</i>&quot; (we can name it anything), in the remoting subsystem and uses the previously created &quot;<i class=" ">remote-ejb</i>&quot; outbound-socket-binding (notice the outbound-socket-binding-ref in that command) with the http-remoting protocol. Furthermore, we also set the security-realm attribute to point to the security-realm that we created in the previous step. Also notice that we have set the username attribute to use the user name who is allowed to communicate with the destination server.    </p>
    <p>
What this step does is, it creates a outbound connection, on the client server, to the remote destination server and sets up the username to the user who allowed to communicate with that destination server and also sets up the security-realm to a pre-configured security-realm capable of passing along the user credentials (in this case the password). This way when a connection has to be established from the client server to the destination server, the connection creation logic will have the necessary security credentials to pass along and setup a successful secured connection.    </p>
    <p>
Now let's run the following two operations to set some default connection creation options for the outbound connection:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">/subsystem=remoting/remote-outbound-connection=remote-ejb-connection/property=SASL_POLICY_NOANONYMOUS:add(value=false)</pre>
        </div>
    </div>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">/subsystem=remoting/remote-outbound-connection=remote-ejb-connection/property=SSL_ENABLED:add(value=false)</pre>
        </div>
    </div>
    <p>
Ultimately, upon successful invocation of this command, the following configuration will be created in the remoting subsystem:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:remoting:1.1&quot;&gt;
....
            &lt;outbound-connections&gt;
                &lt;remote-outbound-connection name=&quot;remote-ejb-connection&quot; outbound-socket-binding-ref=&quot;remote-ejb&quot; protocol=&quot;http-remoting&quot; security-realm=&quot;ejb-security-realm&quot; username=&quot;ejb&quot;&gt;
                    &lt;properties&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;property name=&quot;SASL_POLICY_NOANONYMOUS&quot; value=&quot;false&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;property name=&quot;SSL_ENABLED&quot; value=&quot;false&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/properties&gt;
                &lt;/remote-outbound-connection&gt;
            &lt;/outbound-connections&gt;
        &lt;/subsystem&gt;</pre>
        </div>
    </div>
    <p>
From a server configuration point of view, that's all we need on the &quot;Client Server&quot;. Our next step is to deploy an application on the &quot;Client Server&quot; which will invoke on the bean deployed on the &quot;Destination Server&quot;.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Packagingtheclientapplicationonthe%22ClientServer%22"  >
        <h3>Packaging the client application on the &quot;Client Server&quot;</h3>
    
    <p>
Like on the &quot;Destination Server&quot;, we'll use .ear packaging for the client application too. But like previously mentioned, that's not mandatory. You can even use a .war or .jar deployments. Here's how our client application packaging will look like:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">client-app.ear
|
|--- META-INF
|&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;|
|&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;|--- jboss-ejb-client.xml
|
|--- web.war
|&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;|
|&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;|--- WEB-INF/classes
|&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;|&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;|
|&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;|&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;|---- &lt;org.myapp.FooServlet&gt; // classes in the web app</pre>
        </div>
    </div>
    <p>
In the client application we'll use a servlet which invokes on the bean deployed on the &quot;Destination Server&quot;. We can even invoke the bean on the &quot;Destination Server&quot; from a EJB on the &quot;Client Server&quot;. The code remains the same (JNDI lookup, followed by invocation on the proxy). The important part to notice in this client application is the file <i class=" ">jboss-ejb-client.xml</i> which is packaged in the META-INF folder of a top level deployment (in this case our client-app.ear). This <i class=" ">jboss-ejb-client.xml</i> contains the EJB client configurations which will be used during the EJB invocations for finding the appropriate destinations (also known as, EJB receivers). The contents of the jboss-ejb-client.xml are explained next.    </p>
    <div class="confbox admonition admonition-note">
        
    <p>
If your application is deployed as a top level .war  deployment, then the jboss-ejb-client.xml is expected to be placed in  .war/WEB-INF/ folder (i.e. the same location where you place any web.xml  file).    </p>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Contentsonjbossejbclient.xml"  >
        <h3>Contents on jboss-ejb-client.xml</h3>
    
    <p>
The jboss-ejb-client.xml will look like:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;jboss-ejb-client xmlns=&quot;urn:jboss:ejb-client:1.0&quot;&gt;
    &lt;client-context&gt;
        &lt;ejb-receivers&gt;
            &lt;remoting-ejb-receiver outbound-connection-ref=&quot;remote-ejb-connection&quot;/&gt;
        &lt;/ejb-receivers&gt;
    &lt;/client-context&gt;
&lt;/jboss-ejb-client&gt;</pre>
        </div>
    </div>
    <p>
You'll notice that we have configured the EJB client context (for this application) to use a remoting-ejb-receiver which points to our earlier created &quot;<i class=" ">remote-outbound-connection</i>&quot; named &quot;<i class=" ">remote-ejb-connection</i>&quot;. This links the EJB client context to use the &quot;<i class=" ">remote-ejb-connection</i>&quot; which ultimately points to the EJB remoting connector on the &quot;Destination Server&quot;.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Deploytheclientapplication"  >
        <h3>Deploy the client application</h3>
    
    <p>
Let's deploy the client application on the &quot;Client Server&quot;. The process of deploying the application is out of scope, of this chapter. You can use either the CLI or the admin console or a IDE or deploy manually to JBOSS_HOME/standalone/deployments folder. Just ensure that the application is deployed successfully.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Clientcodeinvokingthebean"  >
        <h3>Client code invoking the bean</h3>
    
    <p>
We mentioned that we'll be using a servlet to invoke on the bean, but the code to invoke the bean isn't servlet specific and can be used in other components (like EJB) too. So let's see how it looks like:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">import javax.naming.Context;
import java.util.Hashtable;
import javax.naming.InitialContext;

...
public void invokeOnBean() {
        try {
            final Hashtable props = new Hashtable();
            // setup the ejb: namespace URL factory
            props.put(Context.URL_PKG_PREFIXES, &quot;org.jboss.ejb.client.naming&quot;);
            // create the InitialContext
            final Context context = new javax.naming.InitialContext(props);

            // Lookup the Greeter bean using the ejb: namespace syntax which is explained here https://docs.jboss.org/author/display/AS71/EJB+invocations+from+a+remote+client+using+JNDI
            final Greeter bean = (Greeter) context.lookup(&quot;ejb:&quot; + &quot;myapp&quot; + &quot;/&quot; + &quot;myejb&quot; + &quot;/&quot; + &quot;&quot; + &quot;/&quot; + &quot;GreeterBean&quot; + &quot;!&quot; + org.myapp.ejb.Greeter.class.getName());

			// invoke on the bean
			final String greeting = bean.greet(&quot;Tom&quot;);

            System.out.println(&quot;Received greeting: &quot; + greeting);

        } catch (Exception e) {
            throw new RuntimeException(e);
        }
}</pre>
        </div>
    </div>
    <p>
That's it! The above code will invoke on the bean deployed on the &quot;Destination Server&quot; and return the result.    </p>
    </div>
    
    </div>
    
    <div class="section-2"  id="80873187_DeveloperGuide-RemoteEJBinvocationsviaJNDIWhichapproachtouse%3F"  >
        <h2>Remote EJB invocations via JNDI - Which approach to use?</h2>
    
<div class=" error">    <p>
Couldn't find a page to include called: Remote EJB invocations via JNDI - EJB client API or remote-naming project?    </p>
</div>    </div>
    
    <div class="section-2"  id="80873187_DeveloperGuide-JBossEJB3referenceguide"  >
        <h2>JBoss EJB 3 reference guide</h2>
    
    <p>
This chapter details the extensions that are available when developing Enterprise Java Beans <sup class=" ">tm</sup> on WildFly 8.    </p>
    <p>
Currently there is no support for configuring the extensions using an implementation specific descriptor file.    </p>
    <div class="section-3"  id="80873187_DeveloperGuide-ResourceAdapterforMessageDrivenBeans"  >
        <h3>Resource Adapter for Message Driven Beans</h3>
    
    <p>
Each Message Driven Bean must be connected to a resource adapter.    </p>
    <div class="section-4"  id="80873187_DeveloperGuide-SpecificationofResourceAdapterusingMetadataAnnotations"  >
        <h4>Specification of Resource Adapter using Metadata Annotations</h4>
    
    <p>
The <tt class=" ">ResourceAdapter</tt> annotation is used to specify the resource adapter with which the MDB should connect.    </p>
    <p>
The <tt class=" ">value</tt> of the annotation is the name of the deployment unit containing the resource adapter. For example <tt class=" ">jms-ra.rar</tt>.    </p>
    <p>
For example:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">@MessageDriven(messageListenerInterface = PostmanPat.class)
@ResourceAdapter(&quot;ejb3-rar.rar&quot;)</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-RunasPrincipal"  >
        <h3>as Principal</h3>
    
    <p>
Whenever a run-as role is specified for a given method invocation the default anonymous principal is used as the caller principal. This principal can be overridden by specifying a run-as principal.    </p>
    <div class="section-4"  id="80873187_DeveloperGuide-SpecificationofRunasPrincipalusingMetadataAnnotations"  >
        <h4>Specification of Run-as Principal using Metadata Annotations</h4>
    
    <p>
The <tt class=" ">RunAsPrincipal</tt> annotation is used to specify the run-as principal to use for a given method invocation.    </p>
    <p>
The <tt class=" ">value</tt> of the annotation specifies the name of the principal to use. The actual type of the principal is undefined and should not be relied upon.    </p>
    <p>
Using this annotation without specifying a run-as role is considered an error.    </p>
    <p>
For example:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">@RunAs(&quot;admin&quot;)
@RunAsPrincipal(&quot;MyBean&quot;)</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-SecurityDomain"  >
        <h3>Security Domain</h3>
    
    <p>
Each Enterprise Java Bean <sup class=" ">tm</sup> can be associated with a security domain. Only when an EJB is associated with a security domain will authentication and authorization be enforced.    </p>
    <div class="section-4"  id="80873187_DeveloperGuide-SpecificationofSecurityDomainusingMetadataAnnotations"  >
        <h4>Specification of Security Domain using Metadata Annotations</h4>
    
    <p>
The <tt class=" ">SecurityDomain</tt> annotation is used to specify the security domain to associate with the EJB.    </p>
    <p>
The <tt class=" ">value</tt> of the annotation is the name of the security domain to be used.    </p>
    <p>
For example:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">@SecurityDomain(&quot;other&quot;)</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-TransactionTimeout"  >
        <h3>Transaction Timeout</h3>
    
    <p>
For any newly started transaction a transaction timeout can be specified in seconds.    </p>
    <p>
When a transaction timeout of <tt class=" ">0</tt> is used, then the actual transaction timeout will default to the domain configured default.<br/><i class=" ">TODO: add link to tx subsystem</i>    </p>
    <p>
Although this is only applicable when using transaction attribute <tt class=" ">REQUIRED</tt> or <tt class=" ">REQUIRES_NEW</tt> the application server will not detect invalid setups.    </p>
    <div class="confbox admonition admonition-note">
            <div class="title">New Transactions</div>
        
    <p>
Take care that even when transaction attribute <tt class=" ">REQUIRED</tt> is specified, the timeout will only be applicable if a <strong class=" ">new</strong> transaction is started.    </p>
    </div>
    
    <div class="section-4"  id="80873187_DeveloperGuide-SpecificationofTransactionTimeoutwithMetadataAnnotations"  >
        <h4>Specification of Transaction Timeout with Metadata Annotations</h4>
    
    <p>
The <tt class=" ">TransactionTimeout</tt> annotation is used to specify the transaction timeout for a given method.    </p>
    <p>
The <tt class=" ">value</tt> of the annotation is the timeout used in the given <tt class=" ">unit</tt> granularity. It must be a positive integer or 0. Whenever 0 is specified the default domain configured timeout is used.    </p>
    <p>
The <tt class=" ">unit</tt> specifies the granularity of the <tt class=" ">value</tt>. The actual value used is converted to seconds. Specifying a granularity lower than <tt class=" ">SECONDS</tt> is considered an error, even when the computed value will result in an even amount of seconds.    </p>
    <p>
For example:@TransactionTimeout(value = 10, unit = TimeUnit.SECONDS)    </p>
    </div>
    
    <div class="section-4"  id="80873187_DeveloperGuide-SpecificationofTransactionTimeoutintheDeploymentDescriptor"  >
        <h4>Specification of Transaction Timeout in the Deployment Descriptor</h4>
    
    <p>
The <tt class=" ">trans-timeout</tt> element is used to define the transaction  timeout for business, home, component, and message-listener interface  methods; no-interface view methods; web service endpoint methods; and  timeout callback methods.    </p>
    <p>
The <tt class=" ">trans-timeout</tt> element resides in the <tt class=" ">urn:trans-timeout</tt> namespace and is part of the standard <tt class=" ">container-transaction</tt> element as defined in the jboss namespace.    </p>
    <p>
For the rules when a <tt class=" ">container-transaction</tt> is applicable please refer to EJB 3.1 FR 13.3.7.2.1.    </p>
    <div class="section-5"  id="80873187_DeveloperGuide-Exampleof%7B%7Btranstimeout%7D%7D"  >
        <h5>Example of  trans-timeout</h5>
    
    <div class="confbox programlisting">
                    <div class="title">jboss-ejb3.xml</div>
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;jboss:ejb-jar xmlns:jboss=&quot;http://www.jboss.com/xml/ns/javaee&quot;
               xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
               xmlns:tx=&quot;urn:trans-timeout&quot;
               xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
               xsi:schemaLocation=&quot;http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd
urn:trans-timeout http://www.jboss.org/j2ee/schema/trans-timeout-1_0.xsd&quot;
               version=&quot;3.1&quot;
               impl-version=&quot;2.0&quot;&gt;
    &lt;assembly-descriptor&gt;
        &lt;container-transaction&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;BeanWithTimeoutValue&lt;/ejb-name&gt;
                &lt;method-name&gt;*&lt;/method-name&gt;
                &lt;method-intf&gt;Local&lt;/method-intf&gt;
            &lt;/method&gt;
            &lt;tx:trans-timeout&gt;
                &lt;tx:timeout&gt;10&lt;/tx:timeout&gt;
                &lt;tx:unit&gt;Seconds&lt;/tx:unit&gt;
            &lt;/tx:trans-timeout&gt;
        &lt;/container-transaction&gt;
    &lt;/assembly-descriptor&gt;
&lt;/jboss:ejb-jar&gt;</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Timerservice"  >
        <h3>Timer service</h3>
    
    <p>
The service is responsible to call the registered timeout methods of the different session beans.    </p>
    <div class="confbox admonition admonition-info">
        
    <p>
A persistent timer will be identified by the name of the EAR, the name of the sub-deployment JAR and the Bean's name.<br/>If one of those names are changed (e.g. EAR name contain a version) the timer entry became orphaned and the timer event will not longer be fired.    </p>
    </div>
    
    <div class="section-4"  id="80873187_DeveloperGuide-Singleeventtimer"  >
        <h4>Single event timer</h4>
    
    <p>
The timer is will be started once at the specified time.    </p>
    <p>
In case of a server restart the timeout method of a persistent timer will only be called directly if the specified time is elapsed.<br/>If the timer is not persistent (since EJB3.1 see 18.2.3) it will be not longer available if JBoss is restarted or the application is redeployed.    </p>
    </div>
    
    <div class="section-4"  id="80873187_DeveloperGuide-Recurringtimer"  >
        <h4>Recurring timer</h4>
    
    <p>
The timer will be started at the specified first occurrence and after that point at each time if the interval is elapsed.<br/>If the timer will be started during the last execution is not finished the execution will be suppressed with a warning to avoid concurrent execution.    </p>
    <p>
In case of server downtime for a persistent timer, the timeout method will be called only once if one, or more than one, interval is elapsed.<br/>If the timer is not persistent (since EJB3.1 see 18.2.3) it will not longer be active after the server is restarted or the application is redeployed.    </p>
    </div>
    
    <div class="section-4"  id="80873187_DeveloperGuide-Calendartimer"  >
        <h4>Calendar timer</h4>
    
    <p>
The timer will be started if the schedule expression match. It will be automatically deactivated and removed if there will be no next expiration possible, i.e. If you set a specific year.    </p>
    <p>
For example:    </p>
    <blockquote>
    <p>
@Schedule( ... dayOfMonth=&quot;1&quot;, month=&quot;1&quot;, year=&quot;2012&quot;)<br/>// start once at 01-01-2012 00:00:00    </p>
        </blockquote>
    <div class="section-5"  id="80873187_DeveloperGuide-Programmaticcalendartimer"  >
        <h5>Programmatic calendar timer</h5>
    
    <p>
If the timer is persistent it will be fetched at server start and the missed timeouts are called concurrent.<br/>If a persistent timer contains an end date it will be executed once nevertheless how many times the execution was missed. Also a retry will be suppressed if the timeout method throw an Exception.<br/>In case of such expired timer access to the given Timer object might throw a NoMoreTimeoutExcption or NoSuchObjectException.    </p>
    <p>
If the timer is non persistent it will not longer be active after the server is restarted or the application is redeployed.    </p>
    <p>
<strong class=" ">TODO</strong>: clarify whether this should happen concurrently/blocked or even fired only once like a recurring timer!    </p>
    </div>
    
    <div class="section-5"  id="80873187_DeveloperGuide-Annotatedcalendartimer"  >
        <h5>Annotated calendar timer</h5>
    
    <p>
If the timer is non persistent it will not activated for missed events during the server is down. In case of server start the timer is scheduled based on the @Schedule annotation.    </p>
    <p>
If the timer is persistent (default if not deactivated by annotation) all missed events are fetched at server start and the annotated timeout method is called concurrent.    </p>
    <p>
<strong class=" ">TODO</strong>: clarify whether this should happen concurrently/blocked or even fired only once like a recurring timer!    </p>
    </div>
    
    </div>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="80873187_DeveloperGuide-JPAreferenceguide"  >
        <h2>JPA reference guide</h2>
    
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Introduction">Introduction</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UpdateyourPersistence.xmlforHibernate4.3.0">Update your Persistence.xml for Hibernate 4.3.0</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Entitymanager">Entity manager</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Applicationmanagedentitymanager">Application-managed entity manager</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Containermanagedentitymanager">Container-managed entity manager</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-PersistenceContext">Persistence Context</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-TransactionscopedPersistenceContext">Transaction-scoped Persistence Context</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-ExtendedPersistenceContext">Extended Persistence Context</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-ExtendedPersistenceContextInheritance">Extended Persistence Context Inheritance</a>    </p>
</li></ul></li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Entities">Entities</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Deployment">Deployment</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Troubleshooting">Troubleshooting</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-BackgroundontheJipijapaproject">Background on the Jipijapa project</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-PackagingpersistenceproviderswithyourapplicationandwhichJipijapaartifactstoinclude">Packaging persistence providers with your application and which Jipijapa artifacts to include</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingtheHibernate4.3.xJPApersistenceprovider">Using the Hibernate 4.3.x JPA persistence provider</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingtheInfinispansecondlevelcache">Using the Infinispan second level cache</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-ReplacingthecurrentHibernate4.3.xjarswithanewerversion">Replacing the current Hibernate 4.3.x jars with a newer version</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-PackagingtheHibernate4.x%28orgreater%29JPApersistenceproviderwithyourapplication">Packaging the Hibernate 4.x (or greater) JPA persistence provider with your application</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-PackagingtheHibernate3.5orgreater3.xJPApersistenceproviderwithyourapplication">Packaging the Hibernate 3.5 or greater 3.x JPA persistence provider with your application</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-SharingtheHibernate3.5orgreaterJPApersistenceproviderbetweenmultipleapplications">Sharing the Hibernate 3.5 or greater JPA persistence provider between multiple applications</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingOpenJPA">Using OpenJPA</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingEclipseLink">Using EclipseLink</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingDataNucleus">Using DataNucleus</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-UsingHibernateOGM">Using Hibernate OGM</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-NativeHibernateuse">Native Hibernate use</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-InjectionofHibernateSessionandSessionFactoryInjectionofHibernateSessionandSessionFactory">Injection of Hibernate Session and SessionFactoryInjection of Hibernate Session and SessionFactory</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Hibernateproperties">Hibernate properties</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Persistenceunitproperties">Persistence unit properties</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Determinethepersistenceprovidermodule">Determine the persistence provider module</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-BindingEntityManagerFactory%2FEntityManagertoJNDI">Binding EntityManagerFactory/EntityManager to JNDI</a>    </p>
</li><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-Community">Community</a>    </p>
<ul class=" "><li class=" ">    <p>
<a href="Developer_Guide.html#80873187_DeveloperGuide-PeoplewhohavecontributedtotheWildFlyJPAlayer%3A">People who have contributed to the WildFly JPA layer:</a>    </p>
</li></ul></li></ul>    <div class="section-3"  id="80873187_DeveloperGuide-Introduction"  >
        <h3>Introduction</h3>
    
    <p>
The WildFly JPA subsystem implements the JPA 2.1 container-managed requirements. Deploys the persistence unit definitions, the persistence unit/context annotations and persistence unit/context references in the deployment descriptor. JPA Applications use the Hibernate persistence provider, which is included with WildFly. The JPA subsystem uses the standard SPI (javax.persistence.spi.PersistenceProvider) to access the Hibernate persistence provider and some additional extensions as well.    </p>
    <p>
During application deployment, JPA use is detected (e.g. persistence.xml or @PersistenceContext/Unit annotations) and injects Hibernate dependencies into the application deployment. This makes it easy to deploy JPA applications.    </p>
    <p>
In the remainder of this documentation, &rdquo;entity manager&rdquo; refers to an instance of the <i class=" ">javax.persistence.EntityManager</i> class. <a href="http://download.oracle.com/javaee/7/api/javax/persistence/package-summary.html">Javadoc for the JPA interfaces </a> and <a href="https://jcp.org/en/jsr/detail?id=338">JPA 2.1 specification</a>.    </p>
    <p>
The index of the Hibernate documentation is at <a href="http://hibernate.org/orm/documentation/4.3/">http://hibernate.org/orm/documentation/4.3/</a>.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-UpdateyourPersistence.xmlforHibernate4.3.0"  >
        <h3>Update your Persistence.xml for Hibernate 4.3.0</h3>
    
    <p>
The persistence provider class name in Hibernate 4.3.0 is <strong class=" ">org.hibernate.jpa.HibernatePersistenceProvider</strong>.    </p>
    <p>
Instead of specifying:    </p>
    <p>
<strong class=" ">&lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;</strong>    </p>
    <p>
Switch to*:*    </p>
    <p>
<strong class=" ">&lt;provider&gt;org.hibernate.jpa.HibernatePersistenceProvider&lt;/provider&gt;</strong>    </p>
    <p>
Or remove the persistence provider class name from your persistence.xml (so the default provider will be used).    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Entitymanager"  >
        <h3>Entity manager</h3>
    
    <p>
The entity manager is similar to the Hibernate Session class; applications use it to create/read/update/delete data (and related operations). Applications can use application-managed or container-managed entity managers. Keep in mind that the entity manager is not expected to be thread safe (don't inject it into a servlet class variable which is visible to multiple threads).    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Applicationmanagedentitymanager"  >
        <h3>Application-managed entity manager</h3>
    
    <p>
Application-managed entity managers provide direct access to the underlying persistence provider (org.hibernate.ejb.HibernatePersistence). The scope of the application-managed entity manager is from when the application creates it and lasts until the app closes it. Use the <i class=" ">@PersistenceUnit</i> annotation to inject a persistence unit into a <i class=" ">javax.persistence.EntityManagerFactory</i>. The EntityManagerFactory can return an application-managed entity manager.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Containermanagedentitymanager"  >
        <h3>Container-managed entity manager</h3>
    
    <p>
Container-managed entity managers auto-magically manage the underlying persistence provider for the application. Container-managed entity managers may use transaction-scoped persistence contexts or extended persistence contexts. The container-managed entity manager will create instances of the underlying persistence provider as needed. Every time that a new underlying persistence provider (<i class=" ">org.hibernate.ejb.HibernatePersistence</i>) instance is created, a new persistence context is also created (as an implementation detail of the underlying persistence provider).    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-PersistenceContext"  >
        <h3>Persistence Context</h3>
    
    <p>
The JPA persistence context contains the entities managed by the persistence provider. The persistence context acts like a first level (transactional) cache for interacting with the datasource. Loaded entities are placed into the persistence context before being returned to the application. Entities changes are also placed into the persistence context (to be saved in the database when the transaction commits).    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-TransactionscopedPersistenceContext"  >
        <h3>Transaction-scoped Persistence Context</h3>
    
    <p>
The transaction-scoped persistence context coordinates with the (active) JTA transaction.&nbsp; When the transaction commits, the persistence context is flushed to the datasource (entity objects are detached but may still be referenced by application code).&nbsp; All entity changes that are expected to be saved to the datasource, must be made during a transaction.&nbsp; Entities read outside of a transaction will be detached when the entity manager invocation completes.&nbsp; Example transaction-scoped persistence context is below.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">@Stateful  // will use container managed transactions
public class CustomerManager {
  @PersistenceContext(unitName = &quot;customerPU&quot;) // default type is PersistenceContextType.TRANSACTION
  EntityManager em;
  public customer createCustomer(String name, String address) {
    Customer customer = new Customer(name, address);
    em.persist(customer);  // persist new Customer when JTA transaction completes (when method ends).
                           // internally:
                           //    1. Look for existing &quot;customerPU&quot; persistence context in active JTA transaction and use if found.
                           //    2. Else create new &quot;customerPU&quot; persistence context (e.g. instance of org.hibernate.ejb.HibernatePersistence)
                           //       and put in current active JTA transaction.
    return customer;       // return Customer entity (will be detached from the persistence context when caller gets control)
  }  // Transaction.commit will be called, Customer entity will be persisted to the database and &quot;customerPU&quot; persistence context closed</pre>
        </div>
    </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-ExtendedPersistenceContext"  >
        <h3>Extended Persistence Context</h3>
    
    <p>
The (ee container managed) extended persistence context can span multiple transactions and allows data modifications to be queued up (like a shopping cart), without an active JTA transaction (to be applied during the next JTA TX). The Container-managed extended persistence context can only be injected into a stateful session bean.&nbsp;    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">@PersistenceContext(type = PersistenceContextType.EXTENDED, unitName = &quot;inventoryPU&quot;)
EntityManager em;</pre>
        </div>
    </div>
    <div class="section-4"  id="80873187_DeveloperGuide-ExtendedPersistenceContextInheritance"  >
        <h4>Extended Persistence Context Inheritance</h4>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">JPA 2.0 specification section 7.6.2.1

If a stateful session bean instantiates a stateful session bean (executing in the same EJB container instance) which also has such an extended persistence context, the extended persistence context of the first stateful session bean is inherited by the second stateful session bean and bound to it, and this rule recursively applies&mdash;independently of whether transactions are active or not at the point of the creation of the stateful session beans.</pre>
        </div>
    </div>
    <p>
By default, the current stateful session bean being created, will (<strong class=" ">deeply</strong>) inherit the extended persistence context from any stateful session bean executing in the current Java thread.&nbsp; The <strong class=" ">deep</strong> inheritance of extended persistence context includes walking multiple levels up the stateful bean call stack (inheriting from parent beans).&nbsp; The <strong class=" ">deep</strong> inheritance of extended persistence context includes sibling beans.&nbsp; For example, parentA references child beans beanBwithXPC &amp;&nbsp; beanCwithXPC.&nbsp; Even though parentA doesn't have an extended persistence context, beanBwithXPC &amp; beanCwithXPC will share the same extended persistence context.&nbsp;    </p>
    <p>
Some other EE application servers, use <strong class=" ">shallow</strong> inheritance, where stateful session bean only inherit from the parent stateful session bean (if there is a parent bean).&nbsp; Sibling beans do not share the same extended persistence context unless their (common) parent bean also has the same extended persistence context.    </p>
    <p>
Applications can include a (top-level) <strong class=" ">jboss-all.xml</strong> deployment descriptor that specifies either the (default) <strong class=" ">DEEP</strong> extended persistence context inheritance or <strong class=" ">SHALLOW</strong>.    </p>
    <p>
The AS/docs/schema/jboss-jpa_1_0.xsd describes the <strong class=" ">jboss-jpa</strong> deployment descriptor that may be included in the <strong class=" ">jboss-all.xml</strong>.&nbsp; Below is an example of using <strong class=" ">SHALLOW</strong> extended persistence context inheritance:    </p>
    <blockquote>
    <p>
&lt;jboss&gt;<br/>&nbsp;&nbsp;&nbsp; &lt;jboss-jpa xmlns=&quot;http://www.jboss.com/xml/ns/javaee&quot;&gt;<br/>&nbsp;&nbsp;&nbsp; &lt;extended-persistence inheritance=&quot;SHALLOW&quot;/&gt;<br/>&nbsp; &nbsp; &lt;/jboss-jpa&gt;<br/>&lt;/jboss&gt;&nbsp;    </p>
        </blockquote>
    <p>
Below is an example of using <strong class=" ">DEEP</strong> extended persistence inheritance:    </p>
    <blockquote>
    <p>
&lt;jboss&gt;<br/>&nbsp;&nbsp;&nbsp; &lt;jboss-jpa xmlns=&quot;http://www.jboss.com/xml/ns/javaee&quot;&gt;<br/>&nbsp;&nbsp;&nbsp; &lt;extended-persistence inheritance=&quot;DEEP&quot;/&gt;<br/>&nbsp;&nbsp;&nbsp; &lt;/jboss-jpa&gt;<br/>&lt;/jboss&gt;    </p>
        </blockquote>
    <p>
The AS console/cli can change the <strong class=" ">default</strong> extended persistence context setting (DEEP or SHALLOW).&nbsp; The following cli commands will read the current JPA settings and enable SHALLOW extended persistence context inheritance for applications that do not include the <strong class=" ">jboss-jpa</strong> deployment descriptor:    </p>
    <blockquote>
    <p>
./jboss-cli.sh<br/>cd subsystem=jpa<br/>:read-resource<br/>:write-attribute(name=default-extended-persistence-inheritance,value=&quot;SHALLOW&quot;)    </p>
        </blockquote>
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Entities"  >
        <h3>Entities</h3>
    
    <p>
JPA 2.0 makes it easy to use your (pojo) plain old Java class to represent a database table row.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">@PersistenceContext EntityManager em;
Integer bomPk = getIndexKeyValue();
BillOfMaterials bom = em.find(BillOfMaterials.class, bomPk); // read existing table row into BillOfMaterials class

BillOfMaterials createdBom = new BillOfMaterials(&quot;...&quot;);     // create new entity
em.persist(createdBom);  // createdBom is now managed and will be saved to database when the current JTA transaction completes</pre>
        </div>
    </div>
    <p>
The entity lifecycle is managed by the underlying persistence provider.    </p>
<ul class=" "><li class=" ">    <p>
New (transient): an entity is new if it has just been instantiated using the new operator, and it is not associated with a persistence context. It has no persistent representation in the database and no identifier value has been assigned.    </p>
</li><li class=" ">    <p>
Managed (persistent): a managed entity instance is an instance with a persistent identity that is currently associated with a persistence context.    </p>
</li><li class=" ">    <p>
Detached: the entity instance is an instance with a persistent identity that is no longer associated with a persistence context, usually because the persistence context was closed or the instance was evicted from the context.    </p>
</li><li class=" ">    <p>
Removed: a removed entity instance is an instance with a persistent identity, associated with a persistence context, but scheduled for removal from the database.    </p>
</li></ul>    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Deployment"  >
        <h3>Deployment</h3>
    
    <p>
The persistence.xml contains the persistence unit configuration (e.g. datasource name) and as described in the JPA 2.0 spec (section 8.2), the jar file or directory whose META-INF directory contains the persistence.xml file is termed the root of the persistence unit. In Java EE environments, the root of a persistence unit must be one of the following (quoted directly from the JPA 2.0 specification):    </p>
    <p>
&quot;    </p>
<ul class=" "><li class=" ">    <p>
an EJB-JAR file    </p>
</li><li class=" ">    <p>
the WEB-INF/classes directory of a WAR file    </p>
</li><li class=" ">    <p>
a jar file in the WEB-INF/lib directory of a WAR file    </p>
</li><li class=" ">    <p>
a jar file in the EAR library directory    </p>
</li><li class=" ">    <p>
an application client jar file    </p>
</li></ul>    <p>
The persistence.xml can specify either a JTA datasource or a non-JTA datasource. The JTA datasource is expected to be used within the EE environment (even when reading data without an active transaction). If a datasource is not specified, the default-datasource will instead be used (must be configured).    </p>
    <p>
NOTE: Java Persistence 1.0 supported use of a jar file in the root of the EAR as the root of a persistence unit. This use is no longer supported. Portable applications should use the EAR library directory for this case instead.    </p>
    <p>
&quot;    </p>
    <p>
Question: Can you have a EAR/META-INF/persistence.xml?    </p>
    <p>
Answer: No, the above may deploy but it could include other archives  also in the EAR, so you may have deployment issues for other reasons.&nbsp;  Better to put the persistence.xml in an EAR/lib/somePuJar.jar.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Troubleshooting"  >
        <h3>Troubleshooting</h3>
    
    <p>
The <strong class=" ">org.jboss.as.jpa</strong> logging can be enabled to get the following information:    </p>
<ul class=" "><li class=" ">    <p>
INFO - when persistence.xml has been parsed, starting of persistence unit service (per deployed persistence.xml), stopping of persistence unit service    </p>
</li><li class=" ">    <p>
DEBUG - informs about entity managers being injected, creating/reusing transaction scoped entity manager for active transaction    </p>
</li><li class=" ">    <p>
TRACE - shows how long each entity manager operation took in milliseconds, application searches for a persistence unit, parsing of persistence.xml    </p>
</li></ul>    <p>
To enable TRACE, open the as/standalone/configuration/standalone.xml (or as/domain/configuration/domain.xml) file. Search for <strong class=" ">&lt;subsystem xmlns=&quot;urn:jboss:domain:logging:1.0&quot;&gt;</strong> and add the <strong class=" ">org.jboss.as.jpa</strong> category.&nbsp; You need to change the console-handler level from <strong class=" ">INFO</strong> to <strong class=" ">TRACE</strong>.&nbsp;    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:logging:1.0&quot;&gt;
     &lt;console-handler name=&quot;CONSOLE&quot;&gt;
      &lt;level name=&quot;TRACE&quot; /&gt;
    &nbsp; ...
     &lt;/console-handler&gt;

     &lt;/periodic-rotating-file-handler&gt;
     &lt;logger category=&quot;com.arjuna&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;    &lt;level name=&quot;WARN&quot; /&gt;
 &nbsp;&nbsp;&nbsp; &lt;/logger&gt;

     &lt;logger category=&quot;org.jboss.as.jpa&quot;&gt;
   &nbsp;&nbsp;&nbsp;&nbsp; &lt;level name=&quot;TRACE&quot; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/logger&gt;

     &lt;logger category=&quot;org.apache.tomcat.util.modeler&quot;&gt;
   &nbsp;&nbsp;&nbsp;&nbsp; &lt;level name=&quot;WARN&quot; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/logger&gt;
     ...</pre>
        </div>
    </div>
    <p>
To see what is going on at the JDBC level,  enable <strong class=" ">jboss.jdbc.spy</strong> TRACE and add spy=&quot;true&quot; to the datasource.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;datasource jndi-name=&quot;java:jboss/datasources/...&quot; pool-name=&quot;...&quot; enabled=&quot;true&quot; spy=&quot;true&quot;&gt;
&lt;logger category=&quot;jboss.jdbc.spy&quot;&gt;
&nbsp; &lt;level name=&quot;TRACE&quot;/&gt;
&lt;/logger&gt;</pre>
        </div>
    </div>
    <p>
To troubleshoot issues with the Hibernate second level cache, try enabling trace for <strong class=" ">org.hibernate.SQL + org.hibernate.cache.infinispan + org.infinispan:</strong>    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:logging:1.0&quot;&gt;
     &lt;console-handler name=&quot;CONSOLE&quot;&gt;
      &lt;level name=&quot;TRACE&quot; /&gt;
    &nbsp; ...
     &lt;/console-handler&gt;

     &lt;/periodic-rotating-file-handler&gt;
     &lt;logger category=&quot;com.arjuna&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;    &lt;level name=&quot;WARN&quot; /&gt;
 &nbsp;&nbsp;&nbsp; &lt;/logger&gt;

     &lt;logger category=&quot;org.hibernate.SQL&quot;&gt;
   &nbsp;&nbsp;&nbsp;&nbsp; &lt;level name=&quot;TRACE&quot; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/logger&gt;

     &lt;logger category=&quot;org.hibernate&quot;&gt;
   &nbsp;&nbsp;&nbsp;&nbsp; &lt;level name=&quot;TRACE&quot; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/logger&gt;
&nbsp;     &lt;logger category=&quot;org.infinispan&quot;&gt;
   &nbsp;&nbsp;&nbsp;&nbsp; &lt;level name=&quot;TRACE&quot; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/logger&gt;

     &lt;logger category=&quot;org.apache.tomcat.util.modeler&quot;&gt;
   &nbsp;&nbsp;&nbsp;&nbsp; &lt;level name=&quot;WARN&quot; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/logger&gt;
     ...</pre>
        </div>
    </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-BackgroundontheJipijapaproject"  >
        <h3>Background on the Jipijapa project</h3>
    
    <p>
The <a href="https://github.com/jipijapa/jipijapa">Jipijapa</a> project goal is to improve application platform integration with JPA persistence providers.&nbsp; Jipijapa provides additional integration that makes it easier to use various persistence providers.&nbsp; For example, look <a href="https://github.com/jipijapa/jipijapa/blob/master/hibernate4_3/src/main/java/org/jboss/as/jpa/hibernate4/HibernatePersistenceProviderAdaptor.java#L85">here at how the Hibernate environment</a> is setup automatically (so that JPA deployments can just work).&nbsp; Also, application persistence unit definitions (persistence.xml) can override most settings.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-PackagingpersistenceproviderswithyourapplicationandwhichJipijapaartifactstoinclude"  >
        <h3>Packaging persistence providers with your application and which Jipijapa artifacts to include</h3>
    
    <p>
Applications that include a copy of a persistence provider, should include one of the following Jipijapa integration jars, so that WildFly can easily deploy your application.&nbsp; The alternative to including persistence providers with your application, is to instead use the persistence provider as a static module (each of the below providers already have a placeholder static module that you can copy provider jars into).    </p>
    <div class="tablewrap">
        <table>
<thead class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
Persistence Provider    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
WildFly Version    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Group ID    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Artifact ID    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Version    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
Hibernate ORM 4.3.x    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
8.1.0.Final    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
org.jipijapa    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
jipijapa-hibernate4-3    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
1.1.0.Final    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
Hibernate ORM 4.0.x, 4.1.x, 4.2.x    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
8.1.0.Final    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
org.jipijapa    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
jipijapa-hibernate4-1    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
1.1.0.Final    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
Hibernate ORM version 3.x    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
8.1.0.Final    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
org.jipijapa    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
jipijapa-hibernate3    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
1.1.0.Final    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
EclipseLink    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
8.1.0.Final    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
org.jipijapa    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
jipijapa-eclipselink    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
1.1.0.Final    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
OpenJPA    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
8.1.0.Final    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
org.jipijapa    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
jipijapa-openjpa    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
1.1.0.Final    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-UsingtheHibernate4.3.xJPApersistenceprovider"  >
        <h3>Using the Hibernate 4.3.x JPA persistence provider</h3>
    
    <p>
Hibernate 4.3.x is packaged with WildFly&nbsp;and is the default persistence provider.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-UsingtheInfinispansecondlevelcache"  >
        <h3>Using the Infinispan second level cache</h3>
    
    <p>
To enable the second level cache with Hibernate 4, just set the <strong class=" ">hibernate.cache.use_second_level_cache</strong> property to true, as is done in the following example (also set the <a href="http://docs.oracle.com/javaee/6/api/javax/persistence/SharedCacheMode.html">shared-cache-mode</a> accordingly). By default the application server uses Infinispan as the cache provider for <strong class=" ">JPA applications</strong>, so you don't need specify anything on top of that:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; version=&quot;1.0&quot;&gt;
&lt;persistence-unit name=&quot;2lc_example_pu&quot;&gt;
   &lt;description&gt;example of enabling the second level cache.&lt;/description&gt;
   &lt;jta-data-source&gt;java:jboss/datasources/mydatasource&lt;/jta-data-source&gt;
   &lt;shared-cache-mode&gt;ENABLE_SELECTIVE&lt;/shared-cache-mode&gt;
   &lt;properties&gt;
      &lt;property name=&quot;hibernate.cache.use_second_level_cache&quot; value=&quot;true&quot;/&gt;
   &lt;/properties&gt;
&lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre>
        </div>
    </div>
    <p>
Here is an example of enabling the second level cache for a Hibernate native API hibernate.cfg.xml file:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;property name=&quot;hibernate.cache.region.factory_class&quot; value=&quot;org.jboss.as.jpa.hibernate4.infinispan.InfinispanRegionFactory&quot;/&gt;
&lt;property name=&quot;hibernate.cache.infinispan.cachemanager&quot; value=&quot;java:jboss/infinispan/container/hibernate&quot;/&gt;
&lt;property name=&quot;hibernate.transaction.manager_lookup_class&quot; value=&quot;org.hibernate.transaction.JBossTransactionManagerLookup&quot;/&gt;
&lt;property name=&quot;hibernate.cache.use_second_level_cache&quot; value=&quot;true&quot;/&gt;</pre>
        </div>
    </div>
    <p>
The Hibernate native API application will also need a MANIFEST.MF:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">Dependencies: org.infinispan,org.hibernate</pre>
        </div>
    </div>
    <p>
<a href="https://docs.jboss.org/author/display/ISPN/Using+Infinispan+as+JPA-Hibernate+Second+Level+Cache+Provider">Infinispan Hibernate/JPA second level cache provider documentation</a> contains advanced configuration information but you should bear in mind  that when Hibernate runs within WildFly 8, some of  those configuration options, such as region factory, are not needed.  Moreover, the application server providers you with option of selecting a  different cache container for Infinispan via <strong class=" ">hibernate.cache.infinispan.container</strong> persistence property. To reiterate, this property is not mandatory and a  default container is already deployed for by the application server to  host the second level cache.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-ReplacingthecurrentHibernate4.3.xjarswithanewerversion"  >
        <h3>Replacing the current Hibernate 4.3.x jars with a newer version</h3>
    
    <p>
Just update the current wildfly/modules/system/layers/base/org/hibernate/main folder to contain the newer version (after stopping your WildFly server instance).&nbsp;    </p>
<ol class=" "><li class=" ">    <p>
Delete *.index files in wildfly/modules/system/layers/base/org/hibernate/main and wildfly/modules/system/layers/base/org/hibernate/envers/main folders.    </p>
</li><li class=" ">    <p>
Backup the current contents of wildfly/modules/system/layers/base/org/hibernate in case you make a mistake.    </p>
</li><li class=" ">    <p>
Remove the older jars and copy new Hibernate jars into wildfly/modules/system/layers/base/org/hibernate/main + wildfly/modules/system/layers/base/org/hibernate/envers/main.    </p>
</li><li class=" ">    <p>
Update the wildfly/modules/system/layers/base/org/hibernate/main/module.xml + wildfly/modules/system/layers/base/org/hibernate/envers/main/module.xml to name the jars that you copied in.    </p>
</li></ol>    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-PackagingtheHibernate4.x%28orgreater%29JPApersistenceproviderwithyourapplication"  >
        <h3>Packaging the Hibernate 4.x (or greater) JPA persistence provider with your application</h3>
    
    <p>
WildFly 8&nbsp;allows the packaging of Hibernate 4.x (or greater)  persistence provider jars with the application. The JPA deployer will  detect the presence of a persistence provider in the application and <strong class=" ">jboss.as.jpa.providerModule</strong> needs to be set to <strong class=" ">application</strong>.&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br/>&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; version=&quot;1.0&quot;&gt;<br/>&lt;persistence-unit name=&quot;myOwnORMVersion_pu&quot;&gt;<br/>&lt;description&gt;Hibernate 4 Persistence Unit.&lt;/description&gt;<br/>&lt;jta-data-source&gt;java:jboss/datasources/PlannerDS&lt;/jta-data-source&gt;<br/>&lt;properties&gt;<br/>&nbsp;&nbsp;&nbsp; &lt;property name=&quot;jboss.as.jpa.providerModule&quot; value=&quot;application&quot; /&gt;<br/>&lt;/properties&gt;<br/>&lt;/persistence-unit&gt;<br/>&lt;/persistence&gt;    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-PackagingtheHibernate3.5orgreater3.xJPApersistenceproviderwithyourapplication"  >
        <h3>Packaging the Hibernate 3.5 or greater 3.x JPA persistence provider with your application</h3>
    
    <p>
WildFly 8&nbsp;allows the packaging of Hibernate 3.5 (or greater) persistence provider jars with the application. The JPA deployer will detect the presence of a persistence provider in the application and <strong class=" ">jboss.as.jpa.providerModule</strong> needs to be set to <strong class=" ">hibernate3-bundled</strong>.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; version=&quot;1.0&quot;&gt;
    &lt;persistence-unit name=&quot;plannerdatasource_pu&quot;&gt;
        &lt;description&gt;Hibernate 3 Persistence Unit.&lt;/description&gt;
        &lt;jta-data-source&gt;java:jboss/datasources/PlannerDS&lt;/jta-data-source&gt;
        &lt;properties&gt;
&nbsp;&nbsp;&nbsp;         &lt;property name=&quot;hibernate.show_sql&quot; value=&quot;false&quot; /&gt;
        &nbsp;&nbsp;&nbsp; &lt;property name=&quot;jboss.as.jpa.providerModule&quot; value=&quot;hibernate3-bundled&quot; /&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre>
        </div>
    </div>
    <p>
The WildFly testsuite contains a test that packages jars from the Hibernate 3.6.5.Final jars in the ear lib.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-SharingtheHibernate3.5orgreaterJPApersistenceproviderbetweenmultipleapplications"  >
        <h3>Sharing the Hibernate 3.5 or greater JPA persistence provider between multiple applications</h3>
    
    <p>
Applications can share the same Hibernate3 (for Hibernate 3.5 or greater) persistence provider by manually creating an <strong class=" ">org.hibernate:3</strong> module (in the AS/modules folder). Steps to create the Hibernate3 module:    </p>
<ol class=" "><li class=" ">    <p>
In a command shell, go to the AS installation and change into the modules/org folder.<br/><strong class=" ">cd WF\modules\modules\system\layers\base\org\hibernate\3</strong>    </p>
</li><li class=" ">    <p>
Copy the Hibernate3 jars into this folder<br/>(hibernate3-core.jar, hibernate3-commons-annotations.jar,  hibernate3-entitymanager.jar needed for Hibernate 3.x).    </p>
</li><li class=" ">    <p>
Update the module.xml file to name each jar you copied in as a &quot;resource-root&quot;:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!-- Represents the Hibernate 3.x module&nbsp; --&gt;
&lt;module xmlns=&quot;urn:jboss:module:1.1&quot; name=&quot;org.hibernate&quot; slot=&quot;3&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;resources&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;jipijapa-hibernate3-1.0.1.Final.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;hibernate3-core.jar&quot;/&gt;
        &lt;resource-root path=&quot;hibernate3-commons-annotations.jar&quot;/&gt;
        &lt;resource-root path=&quot;hibernate3-entitymanager.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/resources&gt;

&nbsp;&nbsp;&nbsp; &lt;dependencies&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;asm.asm&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.annotation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.enterprise.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.persistence.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.transaction.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.validation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.xml.bind.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.antlr&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.apache.commons.collections&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.dom4j&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.javassist&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.as.jpa.spi&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.jandex&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.logging&quot;/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &lt;module name=&quot;org.slf4j&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.vfs&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/dependencies&gt;
&lt;/module&gt;</pre>
        </div>
    </div>
</li></ol><ol class=" "><li class=" ">    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;"></pre>
        </div>
    </div>
</li></ol>    <p>
In your persistence.xml, you will refer to the Hibernate 3 persistence provider as follows:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; version=&quot;1.0&quot;&gt;
    &lt;persistence-unit name=&quot;crm_pu&quot;&gt;
&nbsp;&nbsp;&nbsp;     &lt;description&gt;CRM Persistence Unit.&lt;/description&gt;
        &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
    &nbsp;&nbsp;&nbsp; &lt;jta-data-source&gt;java:jboss/datasources/CRMDS&lt;/jta-data-source&gt;
    &nbsp;&nbsp;&nbsp; &lt;properties&gt;
&nbsp;&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp; &lt;property name=&quot;jboss.as.jpa.providerModule&quot; value=&quot;org.hibernate:3&quot; /&gt;
    &nbsp;&nbsp;&nbsp; &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre>
        </div>
    </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-UsingOpenJPA"  >
        <h3>Using OpenJPA</h3>
    
    <p>
You need to copy the OpenJPA jars (e.g. openjpa-all.jar serp.jar) into the WildFly modules/system/layers/base/org/apache/openjpa/main folder and update modules/system/layers/base/org/apache/openjpa/main/module.xml to include the same jar file names that you copied in.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;"> &lt;module xmlns=&quot;urn:jboss:module:1.1&quot; name=&quot;org.apache.openjpa&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;resources&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;jipijapa-openjpa-1.0.1.Final.jar&quot;/&gt;
        &lt;resource-root path=&quot;openjpa-all.jar&quot;&gt;
           &lt;filter&gt;
              &lt;exclude path=&quot;javax/**&quot; /&gt;
           &lt;/filter&gt;
        &lt;/resource-root&gt;
        &lt;resource-root path=&quot;serp.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/resources&gt;

&nbsp;&nbsp;&nbsp; &lt;dependencies&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.annotation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.enterprise.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.persistence.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.transaction.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.validation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.xml.bind.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.apache.commons.collections&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.apache.commons.lang&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.as.jpa.spi&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.logging&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.vfs&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.jandex&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/dependencies&gt;
&lt;/module&gt;</pre>
        </div>
    </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-UsingEclipseLink"  >
        <h3>Using EclipseLink</h3>
    
    <p>
You need to copy the EclipseLink jar (e.g. eclipselink-2.5.1.jar or eclipselink.jar as in the example below) into the WildFly modules/system/layers/base/org/eclipse/persistence/main folder and update modules/system/layers/base/org/eclipse/persistence/main/module.xml to include the EclipseLink jar (take care to use the jar name that you copied in).&nbsp; If you happen to leave the EclipseLink version number in the jar name, the module.xml should reflect that.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;"> &lt;module xmlns=&quot;urn:jboss:module:1.1&quot; name=&quot;org.eclipse.persistence&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;resources&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;jipijapa-eclipselink-1.0.1.Final.jar&quot;/&gt;
        &lt;resource-root path=&quot;eclipselink.jar&quot;&gt;           &lt;filter&gt;
              &lt;exclude path=&quot;javax/**&quot; /&gt;
           &lt;/filter&gt;
        &lt;/resource-root&gt;
&nbsp;&nbsp;&nbsp; &lt;/resources&gt;

&nbsp;&nbsp;&nbsp; &lt;dependencies&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;asm.asm&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.annotation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.enterprise.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.persistence.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.transaction.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.validation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.xml.bind.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.antlr&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.apache.commons.collections&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.dom4j&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.javassist&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.as.jpa.spi&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.logging&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.vfs&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/dependencies&gt;
&lt;/module&gt;</pre>
        </div>
    </div>
    <p>
As a workaround for&nbsp; issue<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=414974">id=414974</a>, set (WildFly) system property &quot;eclipselink.archive.factory&quot; to value &quot;org.jipijapa.eclipselink.JBossArchiveFactoryImpl&quot; via jboss-cli.sh command (WildFly server needs to be running when this command is issued):    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">jboss-cli.sh --connect '/system-property=eclipselink.archive.factory:add(value=org.jipijapa.eclipselink.JBossArchiveFactoryImpl)'</pre>
        </div>
    </div>
    <p>
.&nbsp; The following shows what the standalone.xml (or your WildFly configuration you are using) file might look like after updating the system properties:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;system-properties&gt;
   ...
   &lt;property name=&quot;eclipselink.archive.factory&quot; value=&quot;org.jipijapa.eclipselink.JBossArchiveFactoryImpl&quot;/&gt;
&lt;/system-properties&gt;</pre>
        </div>
    </div>
    <p>
You should then be able to deploy applications with persistence.xml that include;    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;</pre>
        </div>
    </div>
    <p>
Also refer to page <a href="https://community.jboss.org/wiki/HowToUseEclipseLinkWithAS7">how to use EclipseLink with WildFly guide here</a>.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-UsingDataNucleus"  >
        <h3>Using DataNucleus</h3>
    
    <p>
Read the <a href="http://www.datanucleus.org/servlet/wiki/pages/viewpage.action?pageId=27688962">how to use DataNucleus with WildFly guide here</a>.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-UsingHibernateOGM"  >
        <h3>Using Hibernate OGM</h3>
    
    <p>
This section is a work in progress.    </p>
    <p>
Example persistence.xml:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; version=&quot;1.0&quot;&gt;
&nbsp; &lt;persistence-unit name=&quot;MINIMAL&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;provider&gt;org.hibernate.ogm.jpa.HibernateOgmPersistence&lt;/provider&gt;

&nbsp;&nbsp;&nbsp; &lt;properties&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;property name=&quot;jboss.as.jpa.classtransformer&quot; value=&quot;false&quot; /&gt;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;property name=&quot;jboss.as.jpa.adapterModule&quot; value=&quot;org.jboss.as.jpa.hibernate:4&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/properties&gt;
&nbsp; &lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre>
        </div>
    </div>
    <p>
The Hibernate ORM module needs to depend on OGM.&nbsp; Change AS7/modules/org/hibernate/main/module.xml to:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;module xmlns=&quot;urn:jboss:module:1.1&quot; name=&quot;org.hibernate&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;resources&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;hibernate-core-4.1.6.Final.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;hibernate-entitymanager-4.1.6.Final.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;hibernate-infinispan-4.1.6.Final.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- Insert resources here --&gt;
&nbsp;&nbsp;&nbsp; &lt;/resources&gt;

&nbsp;&nbsp;&nbsp; &lt;dependencies&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;asm.asm&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.persistence.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.transaction.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.validation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.antlr&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.apache.commons.collections&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.dom4j&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.infinispan&quot; optional=&quot;true&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.javassist&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.as.jpa.hibernate&quot; slot=&quot;4&quot; optional=&quot;true&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.logging&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.hibernate.envers&quot; services=&quot;import&quot; optional=&quot;true&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.hibernate&quot; slot=&quot;ogm&quot; services=&quot;import&quot;/&gt;
&nbsp;&nbsp; &nbsp;&lt;module name=&quot;org.hibernate.commons-annotations&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/dependencies&gt;
&lt;/module&gt;</pre>
        </div>
    </div>
    <p>
The AS7/modules/org/hibernate/ogm folder should contain the OGM jars and the following module.xml:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;module xmlns=&quot;urn:jboss:module:1.1&quot; name=&quot;org.hibernate&quot; slot=&quot;ogm&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;resources&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;resource-root path=&quot;hibernate-ogm-core-4.0.0-SNAPSHOT.jar&quot;/&gt;
&nbsp;&nbsp; &nbsp;&lt;resource-root path=&quot;hibernate-ogm-infinispan-4.0.0-SNAPSHOT.jar&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- Insert resources here --&gt;
&nbsp;&nbsp;&nbsp; &lt;/resources&gt;

&nbsp;&nbsp;&nbsp; &lt;dependencies&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.persistence.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.transaction.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;javax.validation.api&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.dom4j&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.infinispan&quot; optional=&quot;true&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.as.jpa.hibernate&quot; slot=&quot;4&quot; optional=&quot;true&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module name=&quot;org.jboss.logging&quot;/&gt;
&nbsp;&nbsp; &nbsp;&lt;module name=&quot;org.hibernate.commons-annotations&quot;/&gt;
&nbsp;&nbsp; &nbsp;&lt;module name=&quot;org.hibernate&quot; export=&quot;true&quot;/&gt;
&nbsp;&nbsp;&nbsp; &lt;/dependencies&gt;
&lt;/module&gt;</pre>
        </div>
    </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-NativeHibernateuse"  >
        <h3>Native Hibernate use</h3>
    
    <p>
Applications that use the Hibernate API directly, are referred to here as native Hibernate applications. Native Hibernate applications, can choose to use the Hibernate jars included with WildFly 8&nbsp;or they can package their own copy of the Hibernate jars. Applications that utilize JPA will automatically have the JBoss AS  Hibernate injected onto the application deployment classpath. Meaning that JPA applications,  should expect to use the Hibernate jars included in WildFly.    </p>
    <p>
Example MANIFEST.MF entry to add Hibernate dependency:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">Manifest-Version: 1.0
...
Dependencies: org.hibernate</pre>
        </div>
    </div>
    <p>
If you use the Hibernate native api in your application and also use the JPA api to access the same entities (from the same Hibernate session/EntityManager), you could get surprising results&nbsp; (e.g. HibernateSession.saveOrUpdate(entity) is different than EntityManager.merge(entity).&nbsp; Each entity should be managed by either Hibernate native API or JPA code.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-InjectionofHibernateSessionandSessionFactoryInjectionofHibernateSessionandSessionFactory"  >
        <h3>Injection of Hibernate Session and SessionFactoryInjection of Hibernate Session and SessionFactory</h3>
    
    <p>
You can inject a org.hibernate.Session and org.hibernate.SessionFactory directly, just as you can do with EntityManagers and EntityManagerFactorys.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">import org.hibernate.Session;
import org.hibernate.SessionFactory;
@Stateful public class MyStatefulBean ... {
&nbsp;&nbsp; @PersistenceContext(unitName=&quot;crm&quot;) Session session1;
&nbsp;&nbsp; @PersistenceContext(unitName=&quot;crm2&quot;, type=EXTENDED) Session extendedpc;
&nbsp;&nbsp; @PersistenceUnit(unitName=&quot;crm&quot;) SessionFactory factory;
}</pre>
        </div>
    </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Hibernateproperties"  >
        <h3>Hibernate properties</h3>
    
    <p>
WildFly automatically sets the following Hibernate (4.x) properties (if not already set in persistence unit definition):    </p>
    <div class="tablewrap">
        <table>
<thead class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
Property    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Purpose    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
    <span style="color: #555555;">
<strong class=" ">hibernate.id.new_generator_mappings</strong>    </span>
    <span style="color: #555555;">
=true    </span>
    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
New applications should let this default to true, older applications with existing data might need to set to false (see note below).&nbsp; It really depends on whether your application uses the @GeneratedValue(AUTO) which will generates new key values for newly created entities.&nbsp; The application can override this value (in the persistence.xml).    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">hibernate.transaction.jta.platform</strong>= instance of org.hibernate.service.jta.platform.spi.JtaPlatform interface    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
The transaction manager, user transaction and transaction synchronization registry is passed into Hibernate via this class.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">hibernate.ejb.resource_scanner</strong> = instance of org.hibernate.ejb.packaging.Scanner interface    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Instance of entity scanning class is passed in that knows how to use the AS annotation indexer (for faster deployment).    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">hibernate.transaction.manager_lookup_class</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
This property is removed if found in the persistence.xml (could conflict with JtaPlatform)    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">hibernate.session_factory_name</strong> = qualified persistence unit name    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Is set to the application name + persistence unit name (application can specify a different value but it needs to be unique across all application deployments on the AS instance).    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">hibernate.session_factory_name_is_jndi</strong> = false    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
only set if the application didn't specify a value for hibernate.session_factory_name.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">hibernate.ejb.entitymanager_factory_name =&nbsp;</strong> qualified persistence unit name    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Is set to the application name + persistence unit name (application can specify a different value but it needs to be unique across all application deployments on the AS instance).    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    <p>
In Hibernate 4.x, if <strong class=" ">new_generator_mappings</strong> is <strong class=" ">true</strong>:    </p>
<ul class=" "><li class=" ">    <p>
@GeneratedValue(AUTO) maps to org.hibernate.id.enhanced.SequenceStyleGenerator    </p>
</li><li class=" ">    <p>
@GeneratedValue(TABLE) maps to org.hibernate.id.enhanced.TableGenerator    </p>
</li><li class=" ">    <p>
@GeneratedValue(SEQUENCE) maps to org.hibernate.id.enhanced.SequenceStyleGenerator    </p>
</li></ul>    <p>
In Hibernate 4.x, if <strong class=" ">new_generator_mappings</strong> is <strong class=" ">false</strong>:    </p>
<ul class=" "><li class=" ">    <p>
@GeneratedValue(AUTO) maps to Hibernate &quot;native&quot;    </p>
</li><li class=" ">    <p>
@GeneratedValue(TABLE) maps to org.hibernate.id.MultipleHiLoPerTableGenerator    </p>
</li><li class=" ">    <p>
@GeneratedValue(SEQUENCE) to Hibernate &quot;seqhilo&quot;    </p>
</li></ul>    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Persistenceunitproperties"  >
        <h3>Persistence unit properties</h3>
    
    <p>
The following properties are supported in the persistence unit definition (in the persistence.xml file):    </p>
    <div class="tablewrap">
        <table>
<thead class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
Property    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Purpose    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">jboss.as.jpa.providerModule</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
name of the persistence provider module (default is <strong class=" ">org.hibernate</strong>). Should be <strong class=" ">hibernate3-bundled</strong> if Hibernate 3 jars are in the application archive (adapterModule and adapterClass will automatically be set for <strong class=" ">hibernate3-bundled</strong>).&nbsp; Should be <strong class=" ">application</strong>, if a persistence provider is packaged with the application.&nbsp; See note below about some module names that are built in (based on the <strong class=" ">provider</strong>).    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">jboss.as.jpa.adapterModule</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
name of the integration classes that help WildFly&nbsp;to work with the persistence provider. Current valid values are <strong class=" ">org.jboss.as.jpa.hibernate:4</strong> (Hibernate 4 integration classes) and <strong class=" ">org.jboss.as.jpa.hibernate:3</strong> (Hibernate 3 integration classes). Other integration adapter modules are expected to be added.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">jboss.as.jpa.adapterClass</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
class name of the integration adapter. Current valid values are <strong class=" ">org.jboss.as.jpa.hibernate3.HibernatePersistenceProviderAdaptor</strong> and <strong class=" ">org.jboss.as.jpa.hibernate4.HibernatePersistenceProviderAdaptor</strong>.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">jboss.as.jpa.managed</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
set to <strong class=" ">false</strong> to disable container managed JPA access to the persistence unit.&nbsp; The default is <strong class=" ">true</strong>, which enables container managed JPA access to the persistence unit.&nbsp; This is typically set to <strong class=" ">false</strong> for Seam 2.x + Spring applications.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">jboss.as.jpa.classtransformer</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
set to <strong class=" ">false</strong> to disable class transformers for the persistence unit.&nbsp; The default is <strong class=" ">true</strong>, which allows class enhancing/rewriting.&nbsp; Hibernate also needs persistence unit property <strong class=" ">hibernate.ejb.use_class_enhancer</strong> to be true, for class enhancing to be enabled.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">wildfly.jpa.default-unit</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
set to <strong class=" ">true</strong> to choose the default persistence unit in an application.&nbsp; This is useful if you inject a persistence context without specifying the unitName (@PersistenceContext EntityManager em) but have multiple persistence units specified in your persistence.xml.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">wildfly.jpa.twophasebootstrap</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
persistence providers (like Hibernate ORM 4.3.x via EntityManagerFactoryBuilder), allow a two phase persistence unit bootstrap, which improves JPA integration with CDI.&nbsp; Setting the <strong class=" ">wildfly.jpa.twophasebootstrap</strong> hint to false, disables the two phase bootstrap (for the persistence unit that contains the hint).    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">wildfly.jpa.allowdefaultdatasourceuse</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
set to false to prevent persistence unit from using the default data source.&nbsp; Defaults to true.&nbsp; This is only important for persistence units that do not specify a datasource.    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">jboss.as.jpa.deferdetach</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Controls whether transaction scoped persistence context used in non-JTA transaction thread, will detach loaded entities after each EntityManager invocation or when the persistence context is closed (e.g. business method ends).&nbsp; Defaults to false (entities are cleared after EntityManager invocation) and if set to true, the detach is deferred until the context is closed.    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Determinethepersistenceprovidermodule"  >
        <h3>Determine the persistence provider module</h3>
    
    <p>
As mentioned above, if the <strong class=" ">jboss.as.jpa.providerModule</strong> property is not specified, the provider module name is determined by the <strong class=" ">provider</strong> name specified in the persistence.xml.&nbsp; The mapping is:    </p>
    <div class="tablewrap">
        <table>
<thead class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
Provider Name    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
Module name    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td rowspan="1" colspan="1">
        <p>
blank    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.hibernate</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.hibernate.ejb.HibernatePersistence</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.hibernate</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.hibernate.ogm.jpa.HibernateOgmPersistence</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.hibernate:ogm</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">oracle.toplink.essentials.PersistenceProvider</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">oracle.toplink</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">oracle.toplink.essentials.ejb.cmp3.EntityManagerFactoryProvider</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">oracle.toplink</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.eclipse.persistence.jpa.PersistenceProvider</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.eclipse.persistence</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.datanucleus.api.jpa.PersistenceProviderImpl</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.datanucleus</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.datanucleus.store.appengine.jpa.DatastorePersistenceProvider</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.datanucleus:appengine</strong>    </p>
            </td>
        </tr>
    <tr>
            <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.apache.openjpa.persistence.PersistenceProviderImpl</strong>    </p>
            </td>
                <td rowspan="1" colspan="1">
        <p>
<strong class=" ">org.apache.openjpa</strong>    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-BindingEntityManagerFactory%2FEntityManagertoJNDI"  >
        <h3>Binding EntityManagerFactory/EntityManager to JNDI</h3>
    
    <p>
By default WildFly does <strong class=" ">not</strong> bind the entity manager factory to JNDI. However, you can explicitly configure this in the persistence.xml of your application by setting the <tt class=" ">jboss.entity.manager.factory.jndi.name</tt> <tt class=" ">hint. The value of that property should be the JNDI name to which the entity manager factory should be bound.</tt>    </p>
    <p>
<tt class=" ">You can also bind a container managed (transaction scoped) entity manager to JNDI as well,&nbsp;}}via hint</tt> <tt class=" ">jboss.entity.manager.jndi.name</tt>{<tt class=" ">}{{.&nbsp; As a reminder, a transaction scoped entity manager (persistence context), acts as a proxy that always gets an unique underlying entity manager (at the persistence provider level).</tt>    </p>
    <p>
<tt class=" ">Here's an example:</tt>    </p>
    <div class="confbox programlisting">
                    <div class="title">persistence.xml</div>
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence version=&quot;2.0&quot;
&nbsp;&nbsp; xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
&nbsp;&nbsp; xsi:schemaLocation=&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; http://java.sun.com/xml/ns/persistence
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;&gt;
&nbsp;&nbsp; &lt;persistence-unit name=&quot;myPU&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- If you are running in a production environment, add a managed
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data source, the example data source is just for proofs of concept! --&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;jta-data-source&gt;java:jboss/datasources/ExampleDS&lt;/jta-data-source&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;properties&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!-- Bind entity manager factory to JNDI at java:jboss/myEntityManagerFactory --&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;property name=&quot;jboss.entity.manager.factory.jndi.name&quot; value=&quot;java:jboss/myEntityManagerFactory&quot; /&gt;
         &lt;property name=&quot;jboss.entity.manager.jndi.name&quot; value=&quot;java:/myEntityManager&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/properties&gt;
&nbsp;&nbsp; &lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre>
        </div>
    </div>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">@Stateful
public class ExampleSFSB {
  public void createSomeEntityWithTransactionScopedEM(String name) {
    Context context = new InitialContext();
    javax.persistence.EntityManager entityManager = (javax.persistence.EntityManager) context.lookup(&quot;java:/myEntityManager&quot;);
    SomeEntity someEntity = new SomeEntity();
   &nbsp;someEntity.setName(name);    entityManager.persist(name);
  }
}
</pre>
        </div>
    </div>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Community"  >
        <h3>Community</h3>
    
    <p>
Many thanks to the community, for reporting issues, solutions and code changes. A number of people have been answering Wildfly forum questions related to JPA usage. I would like to thank them for this, as well as those reporting issues. For those of you that haven't downloaded the AS source code and started hacking patches together. I would like to encourage you to start by reading <a href="https://community.jboss.org/wiki/HackingOnWildFly">Hacking on WildFly</a>. You will find that it easy very easy to find your way around the WildFly/JPA/* source tree and make changes. Also, new for WildFly, is the JipiJapa project that contains additional integration code that makes EE JPA application deployments work better.&nbsp; The following list of contributors should grow over time, I hope to see more of you listed here.    </p>
    <div class="section-4"  id="80873187_DeveloperGuide-PeoplewhohavecontributedtotheWildFlyJPAlayer%3A"  >
        <h4>People who have contributed to the WildFly JPA layer:</h4>
    
<ul class=" "><li class=" ">    <p>
<a href="https://community.jboss.org/people/wolfc">Carlo de Wolf</a> (lead of the EJB3 project)    </p>
</li><li class=" ">    <p>
<strong class=" "><a href="http://in.relation.to/Bloggers/Steve">Steve Ebersole</a></strong> (lead of the Hibernate ORM project)    </p>
</li><li class=" ">    <p>
<strong class=" "><a href="https://community.jboss.org/people/swd847">Stuart Douglas</a></strong> (lead of the Seam Persistence project, WildFly project team member/committer)    </p>
</li><li class=" ">    <p>
<a href="https://community.jboss.org/people/jaikiran">Jaikiran Pai</a> (Active member of JBoss forums and JBoss EJB3 project team member)    </p>
</li><li class=" ">    <p>
<a href="http://relation.to/Bloggers/StrongLiu">Strong Liu</a> (leads the productization effort of Hibernate in the EAP product)    </p>
</li><li class=" ">    <p>
<strong class=" "><a href="https://community.jboss.org/people/smarlow">Scott Marlow</a></strong> (lead of the WildFly container JPA sub-project)    </p>
</li><li class=" ">    <p>
<strong class=" "><a href="https://community.jboss.org/people/alaisi">Antti Laisi</a></strong> <strong class=" ">(OpenJPA integration changes)</strong>    </p>
</li><li class=" ">    <p>
<a href="https://docs.jboss.org/author/display/~galder.zamarreno">Galder Zamarre&ntilde;o</a> (Infinispan 2lc documentation)    </p>
</li><li class=" ">    <p>
<a href="https://docs.jboss.org/author/display/~sannegrinovero">Sanne Grinovero</a> (Infinispan 2lc documentation)    </p>
</li><li class=" ">    <p>
<a href="https://issues.jboss.org/secure/ViewProfile.jspa?name=pferraro">Paul Ferraro</a> (Infinispan 2lc integration)    </p>
</li></ul>    <p>
&nbsp; &lt;!-- p, li    </p>
<div class=" error"></div>    <p>
--&gt;    <span style="color: #000000;">
jboss.as.jpa.deferdetach    </span>
    </p>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="80873187_DeveloperGuide-OSGideveloperguide"  >
        <h2>OSGi developer guide</h2>
    
<div class=" error">    <p>
Couldn't find a page to include called: OSGi Developer Guide    </p>
</div>    </div>
    
    <div class="section-2"  id="80873187_DeveloperGuide-JNDIreferenceguide"  >
        <h2>JNDI reference guide</h2>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Overview"  >
        <h3>Overview</h3>
    
    <p>
WildFly offers several mechanisms to retrieve components by name. Every WildFly&nbsp;instance has it's own local JNDI namespace (<tt class=" ">java:</tt>) which is unique per JVM. The layout of this namespace is primarily governed by the Java EE specification. Applications which share the same WildFly instance can use this namespace to intercommunicate. In addition to local JNDI, a variety of mechanisms exist to access remote components.    </p>
<ul class=" "><li class=" ">    <p>
Client JNDI - This is a mechanism by which remote components can be accessed using the JNDI APIs, but <strong class=" "><i class=" ">without network round-trips</i></strong>. This approach is the most efficient, and <strong class=" "><i class=" ">removes a potential single point of failure</i></strong>. For this reason, it is highly recommended to use Client JNDI over traditional remote JNDI access. However, to make this possible, it does require that all names follow a strict layout, so user customizations are not possible. Currently only access to remote EJBs is supported via the <tt class=" ">ejb:</tt> namespace. Future revisions will likely add a JMS client JNDI namespace.    </p>
</li><li class=" ">    <p>
Traditional Remote JNDI - This is a more familiar approach to EE application developers, where the client performs a remote component name lookup against a server, and a proxy/stub to the component is serialized as part of the name lookup and returned to the client. The client then invokes a method on the proxy which results in another remote network call to the underlying service. In a nutshell, traditional remote JNDI involves two calls to invoke an EE component, whereas Client JNDI requires one. It does however allow for customized names, and for a centralised directory for multiple application servers. This centralized directory is, however, <i class=" ">a single point of failure</i>.&nbsp;    </p>
</li><li class=" ">    <p>
EE Application Client / Server-To-Server Delegation - This approach is where local names are bound as an <i class=" ">alias</i>&nbsp;to a remote name using one of the above mechanisms. This is useful in that it allows applications to only ever reference standard portable Java EE names in both code and deployment descriptors. It also allows for the application to be unaware of network topology details/ This can even work with Java SE clients by using the little known EE Application Client feature. This feature allows you to run an extremely minimal AS server around your application, so that you can take advantage of certain core services such as naming and injection. &nbsp;    </p>
</li></ul>    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-LocalJNDI"  >
        <h3>Local JNDI</h3>
    
    <p>
The Java EE platform specification defines the following JNDI contexts:    </p>
<ul class=" "><li class=" ">    <p>
<tt class=" ">java:comp</tt> - The namespace is scoped to the current component (i.e. EJB)    </p>
</li><li class=" ">    <p>
<tt class=" ">java:module</tt> - Scoped to the current module    </p>
</li><li class=" ">    <p>
<tt class=" ">java:app</tt> - Scoped to the current application    </p>
</li><li class=" ">    <p>
<tt class=" ">java:global</tt> - Scoped to the application server    </p>
</li></ul>    <p>
In addition to the standard namespaces, WildFly also provides the following two global namespaces:    </p>
<ul class=" "><li class=" ">    <p>
java:jboss    </p>
</li><li class=" ">    <p>
java:/    </p>
</li></ul>    <div class="confbox admonition admonition-note">
        
    <p>
Only entries within the&nbsp;<tt class=" ">java:jboss/exported</tt> context are accessible over remote JNDI.    </p>
    </div>
    
    <div class="confbox admonition admonition-note">
        
    <p>
For web deployments <tt class=" ">java:comp</tt> is aliased to <tt class=" ">java:module</tt>, so EJB's deployed in a war do not have their own comp namespace.    </p>
    </div>
    
    <div class="section-4"  id="80873187_DeveloperGuide-BindingentriestoJNDI"  >
        <h4>Binding entries to JNDI</h4>
    
    <p>
There are several methods that can be used to bind entries into JNDI in WildFly.    </p>
    <div class="section-5"  id="80873187_DeveloperGuide-Usingadeploymentdescriptor"  >
        <h5>Using a deployment descriptor</h5>
    
    <p>
For Java EE applications the recommended way is to use a <a href="https://docs.jboss.org/author/display/AS71/Deployment+Descriptors+used+In+AS7.1">deployment descriptor</a> to create the binding. For example the following <tt class=" ">web.xml</tt> binds the string <tt class=" ">&quot;Hello World&quot;</tt> to <tt class=" ">java:global/mystring</tt> and the string <tt class=" ">&quot;Hello Module&quot;</tt> to <tt class=" ">java:comp/env/hello</tt> (any non absolute JNDI name is relative to <tt class=" ">java:comp/env</tt> context).    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;
         version=&quot;3.1&quot;&gt;
    &lt;env-entry&gt;
        &lt;env-entry-name&gt;java:global/mystring&lt;/env-entry-name&gt;
        &lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;
        &lt;env-entry-value&gt;Hello World&lt;/env-entry-value&gt;
    &lt;/env-entry&gt;
    &lt;env-entry&gt;
        &lt;env-entry-name&gt;hello&lt;/env-entry-name&gt;
        &lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;
        &lt;env-entry-value&gt;Hello Module&lt;/env-entry-value&gt;
    &lt;/env-entry&gt;
&lt;/web-app&gt;</pre>
        </div>
    </div>
    <p>
For more details, see the <a href="http://jcp.org/en/jsr/detail?id=342">Java EE Platform Specification</a>.    </p>
    </div>
    
    <div class="section-5"  id="80873187_DeveloperGuide-Programatically"  >
        <h5>Programatically</h5>
    
    <div class="section-6"  id="80873187_DeveloperGuide-JavaEEApplications"  >
        <h6>Java EE Applications</h6>
    
    </div>
    
    <div class="section-6"  id="80873187_DeveloperGuide-"  >
        <h6></h6>
    
    <p>
Standard Java EE applications may use the standard JNDI API, included with Java SE, to bind entries in the global namespaces (the standard <tt class=" ">java:comp</tt>, <tt class=" ">java:module</tt> and <tt class=" ">java:app</tt> namespaces are read-only, as mandated by the Java EE Platform Specification).    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">  InitialContext initialContext = new InitialContext();
  initialContext.bind(&quot;java:global/a&quot;, 100);</pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
        
    <p>
There is no need to unbind entries created programatically, since WildFly tracks which bindings belong to a deployment, and the bindings are automatically removed when the deployment is undeployed.    </p>
    </div>
    
    <div class="section-7"  id="80873187_DeveloperGuide-WildFlyModulesandExtensions"  >
        <h7>WildFly Modules and Extensions</h7>
    
    </div>
    
    </div>
    
    <div class="section-6"  id="80873187_DeveloperGuide-2"  >
        <h6></h6>
    
    <p>
With respect to code in WildFly Modules/Extensions, which is executed out of a Java EE application context, using the standard JNDI API may result in a UnsupportedOperationException if the target namespace uses a WritableServiceBasedNamingStore. To work around that, the bind() invocation needs to be wrapped using WildFly proprietary APIs:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">  InitialContext initialContext = new InitialContext();
  WritableServiceBasedNamingStore.pushOwner(serviceTarget);
  try {
    initialContext.bind(&quot;java:global/a&quot;, 100);
  } finally {
    WritableServiceBasedNamingStore.popOwner();
  }</pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
        
    <p>
The ServiceTarget removes the bind when uninstalled, thus using one out of the module/extension domain usage should be avoided, unless entries are removed using unbind().    </p>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-5"  id="80873187_DeveloperGuide-NamingSubsystemConfiguration"  >
        <h5>Naming Subsystem Configuration</h5>
    
    <p>
It is also possible to bind to one of the three global namespaces using configuration in the naming subsystem. This can be done by either editing the <tt class=" ">standalone.xml/domain.xml</tt> file directly, or through the management API.    </p>
    <p>
Four different types of bindings are supported:    </p>
<ul class=" "><li class=" ">    <p>
Simple - A primitive or java.net.URL entry (default is&nbsp;<tt class=" ">java.lang.String</tt>).    </p>
</li><li class=" ">    <p>
Object Factory - This allows to to specify the <tt class=" ">javax.naming.spi.ObjectFactory</tt> that is used to create the looked up value.    </p>
</li><li class=" ">    <p>
External Context - An external context to federate, such as an LDAP Directory Service&nbsp;    </p>
</li><li class=" ">    <p>
Lookup - The allows to create JNDI aliases, when this entry is looked up it will lookup the target and return the result.    </p>
</li></ul>    <p>
An example standalone.xml might look like:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;subsystem xmlns=&quot;urn:jboss:domain:naming:2.0&quot; &gt;
  &lt;bindings&gt;
    &lt;simple name=&quot;java:global/a&quot; value=&quot;100&quot; type=&quot;int&quot; /&gt;
    &lt;simple name=&quot;java:global/jbossDocs&quot; value=&quot;https://docs.jboss.org&quot; type=&quot;java.net.URL&quot; /&gt;
&nbsp;   &lt;object-factory name=&quot;java:global/b&quot; module=&quot;com.acme&quot; class=&quot;org.acme.MyObjectFactory&quot; /&gt;
    &lt;external-context name=&quot;java:global/federation/ldap/example&rdquo; class=&quot;javax.naming.directory.InitialDirContext&quot; cache=&quot;true&quot;&gt;
      &lt;environment&gt;
        &lt;property name=&quot;java.naming.factory.initial&quot; value=&ldquo;com.sun.jndi.ldap.LdapCtxFactory&rdquo; /&gt;
        &lt;property name=&quot;java.naming.provider.url&quot; value=&ldquo;ldap://ldap.example.com:389&rdquo; /&gt;
        &lt;property name=&quot;java.naming.security.authentication&quot; value=&ldquo;simple&rdquo; /&gt;
        &lt;property name=&quot;java.naming.security.principal&quot; value=&ldquo;uid=admin,ou=system&rdquo; /&gt;
        &lt;property name=&quot;java.naming.security.credentials&quot; value=&ldquo;secret&rdquo; /&gt;
      &lt;/environment&gt;
    &lt;/external-context&gt;
    &lt;lookup name=&quot;java:global/c&quot; lookup=&quot;java:global/b&quot; /&gt;
 &lt;/bindings&gt;
&lt;/subsystem&gt;</pre>
        </div>
    </div>
    <p>
The CLI may also be used to bind an entry. As an example:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">/subsystem=naming/binding=java\:global\/mybinding:add(binding-type=simple, type=long, value=1000)</pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
        
    <p>
WildFly's Administrator Guide includes a section describing in detail the Naming subsystem configuration.    </p>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-4"  id="80873187_DeveloperGuide-RetrievingentriesfromJNDI"  >
        <h4>Retrieving entries from JNDI</h4>
    
    <div class="section-5"  id="80873187_DeveloperGuide-ResourceInjection"  >
        <h5>Resource Injection</h5>
    
    <p>
For Java EE applications the recommended way to lookup a JNDI entry is to use <tt class=" ">@Resource</tt> injection:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">  @Resource(lookup = &quot;java:global/mystring&quot;)
  private String myString;

  @Resource(name = &quot;hello&quot;)
  private String hello;

  @Resource
  ManagedExecutorService executor;</pre>
        </div>
    </div>
    <p>
Note that <tt class=" ">@Resource</tt> is more than a JNDI lookup, it also binds an entry in the component's JNDI environment. The new bind JNDI name is defined by <tt class=" ">@Resource</tt>'s <tt class=" ">name</tt> attribute, which value, if unspecified, is the Java type concatenated with&nbsp;<tt class=" ">/</tt>&nbsp;and the field's name, for instance <tt class=" ">java.lang.String/myString</tt>. More, similar to when using deployment descriptors to bind JNDI entries. unless the name is an absolute JNDI name, it is considered relative to&nbsp;<tt class=" ">java:comp/env</tt>. For instance, with respect to the field named <tt class=" ">myString</tt> above, the <tt class=" ">@Resource</tt>'s <tt class=" ">lookup</tt> attribute instructs WildFly to lookup the value in <tt class=" ">java:global/mystring</tt>, bind it in <tt class=" ">java:comp/env/java.lang.String/myString</tt>, and then inject such value into the field.    </p>
    <p>
With respect to the field named <tt class=" ">hello</tt>, there is no <tt class=" ">lookup</tt> attribute value defined, so the responsibility to provide the entry's value is delegated to the deployment descriptor. Considering that the deployment descriptor was the <tt class=" ">web.xml</tt> previously shown, which defines an environment entry with same <tt class=" ">hello</tt> name, then WildFly inject the valued defined in the deployment descriptor into the field.    </p>
    <p>
The <tt class=" ">executor</tt> field has no attributes specified, so the bind's name would default to <tt class=" ">java:comp/env/javax.enterprise.concurrent.ManagedExecutorService/executor</tt>, but there is no such entry in the deployment descriptor, and when that happens it's up to WildFly to provide a default value or null, depending on the field's Java type. In this particular case WildFly would inject the default instance of a managed executor service, the value in <tt class=" ">java:comp/DefaultManagedExecutorService</tt>, as mandated by the EE Concurrency Utilities 1.0 Specification (JSR 236).    </p>
    </div>
    
    <div class="section-5"  id="80873187_DeveloperGuide-StandardJavaSEJNDIAPI"  >
        <h5>Standard Java SE JNDI API</h5>
    
    <p>
Java EE applications may use, without any additional configuration needed, the standard JNDI API to lookup an entry from JNDI:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">  String myString = (String) new InitialContext().lookup(&quot;java:global/mystring&quot;);</pre>
        </div>
    </div>
    <p>
or simply    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">  String myString = InitialContext.doLookup(&quot;java:global/mystring&quot;);</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-RemoteJNDI"  >
        <h3>Remote JNDI</h3>
    
    <p>
WildFly supports two different types of remote JNDI. The old jnp based JNDI implementation used in JBoss AS versions prior to 7.x is no longer supported.    </p>
    <div class="section-4"  id="80873187_DeveloperGuide-remote%3A"  >
        <h4>remote:</h4>
    
    <p>
The <tt class=" ">remote:</tt> protocol uses the WildFly&nbsp;remoting protocol to lookup items from the servers local JNDI. To use it, you must have the appropriate jars on the class path, if you are maven user can be done simply by adding the following to your <tt class=" ">pom.xml</tt>:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: xml; gutter: false;">&lt;dependency&gt;
  &lt;groupId&gt;org.wildfly&lt;/groupId&gt;
  &lt;artifactId&gt;wildfly-ejb-client-bom&lt;/artifactId&gt;
  &lt;version&gt;8.0.0.Final&lt;/version&gt;
  &lt;type&gt;pom&lt;/type&gt;
  &lt;scope&gt;compile&lt;/scope&gt;
&lt;/dependency&gt;</pre>
        </div>
    </div>
    <p>
If you are not using maven a shaded jar that contains all required classes<br/>can be found in the <tt class=" ">bin/client</tt> directory of WildFly's distribution.    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">final Properties env = new Properties();
env.put(Context.INITIAL_CONTEXT_FACTORY, org.jboss.naming.remote.client.InitialContextFactory.class.getName());
env.put(Context.PROVIDER_URL, &quot;remote://localhost:4447&quot;);
remoteContext = new InitialContext(env);</pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="80873187_DeveloperGuide-ejb%3A"  >
        <h4>ejb:</h4>
    
    <p>
The ejb: namespace is provided by the jboss-ejb-client library. This protocol allows you to look up EJB's, using their application name, module name, ejb name and interface type.    </p>
    <p>
This is a client side JNDI implementation. Instead of looking up an EJB on the server the lookup name contains enough information for the client side library to generate a proxy with the EJB information. When you invoke a method on this proxy it will use the current EJB client context to perform the invocation. If the current context does not have a connection to a server with the specified EJB deployed then an error will occur. Using this protocol it is possible to look up EJB's that do not actually exist, and no error will be thrown until the proxy is actually used. The exception to this is stateful session beans, which need to connect to a server when they are created in order to create the session bean instance on the server.    </p>
    <p>
Some examples are:    </p>
    <p>
<tt class=" ">ejb:myapp/myejbjar/MyEjbName!com.test.MyRemoteInterface</tt><br/><tt class=" ">ejb:myapp/myejbjar/MyStatefulName!comp.test.MyStatefulRemoteInterface?stateful</tt>    </p>
    <p>
The first example is a lookup of a singleton, stateless or EJB 2.x home interface. This lookup will not hit the server, instead a proxy will be generated for the remote interface specified in the name. The second example is for a stateful session bean, in this case the JNDI lookup will hit the server, in order to tell the server to create the SFSB session.    </p>
    <p>
For more details on how the server connections are configured, please see <a href="EJB_invocations_from_a_remote_client_using_JNDI.html">EJB invocations from a remote client using JNDI</a>.    </p>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="80873187_DeveloperGuide-Springapplicationsdevelopmentandmigrationguide"  >
        <h2>Spring applications development and migration guide</h2>
    
    <p>
This document details the main points that need to be considered by Spring developers that wish to develop new applications or to migrate existing applications to be run into WildFly 8.    </p>
    <div class="section-3"  id="80873187_DeveloperGuide-DependenciesandModularity"  >
        <h3>Dependencies and Modularity</h3>
    
    <p>
WildFly 8&nbsp;has a modular class loading strategy, different from previous versions of JBoss AS, which enforces a better class loading isolation between deployments and the application server itself. A detailed description can be found in the documentation dedicated to&nbsp;<a href="https://docs.jboss.org/author/display/AS7/Class+Loading+in+AS7">class loading in WildFly 8</a>.    </p>
    <p>
This reduces significantly the risk of running into a class loading conflict and allows applications to package their own dependencies if they choose to do so. This makes it easier for Spring applications that package their own dependencies - such as logging frameworks or persistence providers to run on WildFly 8.&nbsp;    </p>
    <p>
At the same time, this does not mean that duplications and conflicts cannot exist on the classpath. Some module dependencies are implicit, depending on the type of deployment as shown&nbsp;<a href="https://docs.jboss.org/author/display/AS7/Implicit+module+dependencies+for+deployments">here</a>.&nbsp;    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-Persistenceusageguide"  >
        <h3>Persistence usage guide</h3>
    
    <p>
Depending on the strategy being used, Spring applications can be:    </p>
<ul class=" "><li class=" ">    <p>
native Hibernate applications;    </p>
</li><li class=" ">    <p>
JPA-based applications;    </p>
</li><li class=" ">    <p>
native JDBC applications;    </p>
</li></ul>    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-NativeSpring%2FHibernateapplications"  >
        <h3>Native Spring/Hibernate applications</h3>
    
    <p>
Applications that use the Hibernate API directly with Spring (i.e. through either one of LocalSessionFactoryBean or AnnotationSessionFactoryBean) may use a version of Hibernate 3 packaged inside the application. Hibernate 4 (which is provided through the 'org.hibernate' module of WildFly 8) is not supported by Spring 3.0 and Spring 3.1 (and may be supported by Spring 3.2 as described in&nbsp;<a href="https://jira.springsource.org/browse/SPR-8096">SPR-8096</a>), so adding this module as a dependency is not a solution.    </p>
    </div>
    
    <div class="section-3"  id="80873187_DeveloperGuide-JPAbasedapplications"  >
        <h3>based applications</h3>
    
    <p>
Spring applications using JPA may choose between:    </p>
<ul class=" "><li class=" ">    <p>
using a server-deployed persistence unit;    </p>
</li><li class=" ">    <p>
using a Spring-managed persistence unit.    </p>
</li></ul>    <div class="section-4"  id="80873187_DeveloperGuide-Usingserverdeployedpersistenceunits"  >
        <h4>Using server-deployed persistence units</h4>
    
    <p>
Applications that use a server-deployed persistence unit must observe the typical Java EE rules in what concerns dependency management, i.e.&nbsp;the javax.persistence classes and persistence provider (Hibernate) are contained in modules which are added automatically by the application when the persistence unit is deployed.    </p>
    <p>
In order to use the server-deployed persistence units from within Spring, either the persistence context or the persistence unit need to be registered in JNDI via web.xml as follows:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;persistence-context-ref&gt;
    &lt;persistence-context-ref-name&gt;persistence/petclinic-em&lt;/persistence-unit-ref-name&gt;
    &lt;persistence-unit-name&gt;petclinic&lt;/persistence-unit-name&gt;
&lt;/persistence-context-ref&gt;</pre>
        </div>
    </div>
    <p>
or, respectively:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;persistence-unit-ref&gt;
&nbsp; &nbsp; &lt;persistence-unit-ref-name&gt;persistence/petclinic-emf&lt;/persistence-unit-ref-name&gt;
&nbsp; &nbsp; &lt;persistence-unit-name&gt;petclinic&lt;/persistence-unit-name&gt;
&lt;/persistence-unit-ref&gt;</pre>
        </div>
    </div>
    <p>
When doing so, the persistence context or persistence unit are available to be looked up in JNDI, as follows:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;jee:jndi-lookup id=&quot;entityManager&quot; jndi-name=&quot;java:comp/env/persistence/petclinic-em&quot;&nbsp;
            expected-type=&quot;javax.persistence.EntityManager&quot;/&gt;</pre>
        </div>
    </div>
    <p>
or    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;jee:jndi-lookup id=&quot;entityManagerFactory&quot; jndi-name=&quot;java:comp/env/persistence/petclinic-emf&quot;&nbsp;
            expected-type=&quot;javax.persistence.EntityManagerFactory&quot;/&gt;</pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
            <div class="title">JNDI binding</div>
        
    <p>
JNDI binding via persistence.xml properties is not supported in&nbsp;WildFly 8.    </p>
    </div>
    
    </div>
    
    <div class="section-4"  id="80873187_DeveloperGuide-UsingSpringmanagedpersistenceunits"  >
        <h4>Using Spring-managed persistence units</h4>
    
    <p>
Spring applications running in WildFly 8&nbsp;may also create persistence units on their own, using the LocalContainerEntityManagerFactoryBean. This is what these applications need to consider:    </p>
    <div class="section-5"  id="80873187_DeveloperGuide-Placementofthepersistenceunitdefinitions"  >
        <h5>Placement of the persistence unit definitions</h5>
    
    <p>
When the application server encounters a deployment that has a file named META-INF/persistence.xml (or, for that matter, WEB-INF/classes/META-INF/persistence.xml), it will attempt to create a persistence unit based on what is provided in the file. In most cases, such definition files are not compliant with the Java EE requirements, mostly because required elements such as the datasource of the persistence unit are supposed to be provided by the Spring context definitions, which will fail the deployment of the persistence unit, and consequently of the entire deployment.    </p>
    <p>
Spring applications can easily avoid this type of conflict, by using a feature of the LocalContainerEntityManagerFactoryBean which is designed for this purpose. Persistence unit definition files can exist in other locations than META-INF/persistence.xml and the location can be indicated through the persistenceXmlLocation property of the factory bean class.    </p>
    <p>
Assuming that the persistence unit is in the META-INF/jpa-persistence.xml, the corresponding definition can be:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;bean id=&quot;entityManagerFactory&quot; class=&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;&gt;&nbsp;
 &nbsp; &nbsp; &nbsp; &lt;property name=&quot;persistenceXmlLocation&quot; value=&quot;classpath*:META-INF/jpa-persistence.xml&quot;/&gt;&nbsp;
 &nbsp; &nbsp; &nbsp; &lt;!-- other definitions --&gt;
&lt;/bean&gt;</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-4"  id="80873187_DeveloperGuide-Managingdependencies"  >
        <h4>Managing dependencies</h4>
    
    <p>
Since the LocalContainerEntityManagerFactoryBean and the corresponding HibernateJpaVendorAdapter are based on Hibernate 3, it is required to use that version with the application. Therefore, the Hibernate 3 jars must be included in the deployment. At the same time, due the presence of @PersistenceUnit or @PersistenceContext annotations on the application classes, the application server will automatically add the 'org.hibernate' module as a dependency.    </p>
    <p>
This can be avoided by instructing the server to exclude the module from the deployment's list of dependencies. In order to do so, include a META-INF/jboss-deployment-structure.xml or, for web applications, WEB-INF/jboss-deployment-structure.xml with the following content:    </p>
    <div class="confbox programlisting">
                <div class="content">
        <pre class="brush: java; gutter: false;">&lt;jboss-deployment-structure xmlns=&quot;urn:jboss:deployment-structure:1.0&quot;&gt;
  &lt;deployment&gt;
    &lt;exclusions&gt;
       &lt;module name=&quot;org.hibernate&quot;/&gt;
    &lt;/exclusions&gt;
  &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre>
        </div>
    </div>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="80873187_DeveloperGuide-AllWildFly8documentation"  >
        <h2>All WildFly 8 documentation</h2>
    
<div class=" error">    <p>
Couldn't find a page to include called: All JBoss AS 7 documentation    </p>
</div>    </div>
    
        </div>
              <ul class="docnav">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <li class="previous"><a accesskey="p" href="Target_Audience.html"><strong>Prev</strong>Target Audience</a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li>
          <li class="home"><a accesskey="h" href="Documentation.html"><strong>Front page</strong></a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <li class="next"><a accesskey="n" href="Application_Client_Reference.html"><strong>Next</strong>Application Client Reference</a></li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </ul>
          </div>
    <script type="text/javascript">
      SyntaxHighlighter.all()
    </script>
</body>
</html>
